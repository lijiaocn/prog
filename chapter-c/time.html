
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>时间操作 · Go语言简明手册</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-atoc/atoc.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="dynamiclib.html" />
    
    
    <link rel="prev" href="strings.html" />
    

    <!--Google ads -->
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8176866190626448",
        enable_page_level_ads: true
      });
    </script>
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-105389858-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-105389858-1');
    </script>
    
    <!--百度统计-->
    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?8f59ea10145df28da8932c8743ec1d60";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>
    
    <!--百度收录-->
    <script>
    (function(){
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
        }
        else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
    </script>
    <style type="text/css">
    .book.color-theme-1 .book-body .page-wrapper .page-inner section.normal a {color: #4183c4;}
    </style>
    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
            
                
<div style="text-align:center">
	<h2><a href="https://www.lijiaocn.com" style="color:#afa790">www.lijiaocn.com</a></h2>
	<h4><a href="https://www.lijiaocn.com/linux" style="color:#afa790">《Linux实用手册》</a></h4>
	<h4><a href="https://www.lijiaocn.com/go" style="color:#afa790">《Go语言简明手册》</a></h4>
	<h4><a href="https://www.lijiaocn.com/nginx" style="color:#afa790">《Nginx、Openresty、Lua和Kong》</a></h4>
	<h4><a href="https://www.lijiaocn.com/programming" style="color:#afa790">《实用编程速查手册》</a></h4>
</div>


                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    实用编程速查手册
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="./">
            
                <a href="./">
            
                    
                    C语言速查手册
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="strings.html">
            
                <a href="strings.html">
            
                    
                    字符串处理
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.2.2" data-path="time.html">
            
                <a href="time.html">
            
                    
                    时间操作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="dynamiclib.html">
            
                <a href="dynamiclib.html">
            
                    
                    动态链接库
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="signal.html">
            
                <a href="signal.html">
            
                    
                    信号量操作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="memory.html">
            
                <a href="memory.html">
            
                    
                    内存管理操作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="print.html">
            
                <a href="print.html">
            
                    
                    格式化打印输出
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="file.html">
            
                <a href="file.html">
            
                    
                    文件&设备操作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8" data-path="process.html">
            
                <a href="process.html">
            
                    
                    进程管理操作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.9" data-path="concurrent.html">
            
                <a href="concurrent.html">
            
                    
                    并发编程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.10" data-path="socket.html">
            
                <a href="socket.html">
            
                    
                    socket通信
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.11" data-path="filesystem.html">
            
                <a href="filesystem.html">
            
                    
                    文件系统
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.12" data-path="sysconfig.html">
            
                <a href="sysconfig.html">
            
                    
                    系统配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.13" data-path="namespace.html">
            
                <a href="namespace.html">
            
                    
                    Namespace操作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.14" data-path="hardware.html">
            
                <a href="hardware.html">
            
                    
                    硬件信息读取
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../chapter-lua/">
            
                <a href="../chapter-lua/">
            
                    
                    Lua语言速查手册
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../chapter-lua/basic_type.html">
            
                <a href="../chapter-lua/basic_type.html">
            
                    
                    基本数据类型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../chapter-lua/keywords_operator.html">
            
                <a href="../chapter-lua/keywords_operator.html">
            
                    
                    关键字与操作符
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../chapter-lua/control_flow.html">
            
                <a href="../chapter-lua/control_flow.html">
            
                    
                    条件语句与循环
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../chapter-lua/function.html">
            
                <a href="../chapter-lua/function.html">
            
                    
                    函数定义使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../chapter-lua/module.html">
            
                <a href="../chapter-lua/module.html">
            
                    
                    模块定义使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="../chapter-lua/metatable.html">
            
                <a href="../chapter-lua/metatable.html">
            
                    
                    元表定义设置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="../chapter-lua/object_oriented.html">
            
                <a href="../chapter-lua/object_oriented.html">
            
                    
                    面向对象设计
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8" data-path="../chapter-lua/01-standard-output.html">
            
                <a href="../chapter-lua/01-standard-output.html">
            
                    
                    标准输出打印
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.9" data-path="../chapter-lua/02-string-operation.html">
            
                <a href="../chapter-lua/02-string-operation.html">
            
                    
                    字符串操作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.10" data-path="../chapter-lua/03-lua-performance.html">
            
                <a href="../chapter-lua/03-lua-performance.html">
            
                    
                    性能相关
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.10.1" data-path="../chapter-lua/03-lua-performance-local-var.html">
            
                <a href="../chapter-lua/03-lua-performance-local-var.html">
            
                    
                    局部变量比全局变量快30%
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.10.2" data-path="../chapter-lua/03-lua-performance-load-dynamic.html">
            
                <a href="../chapter-lua/03-lua-performance-load-dynamic.html">
            
                    
                    动态加载代码非常慢
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.10.3" data-path="../chapter-lua/03-lua-performance-table-space.html">
            
                <a href="../chapter-lua/03-lua-performance-table-space.html">
            
                    
                    table自动扩容代价很高
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.10.4" data-path="../chapter-lua/03-lua-performance-table-space-1.html">
            
                <a href="../chapter-lua/03-lua-performance-table-space-1.html">
            
                    
                    清理table成员不会触发rehash
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.10.5" data-path="../chapter-lua/03-lua-performance-string.html">
            
                <a href="../chapter-lua/03-lua-performance-string.html">
            
                    
                    慎用字符串拼接
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.10.6" data-path="../chapter-lua/03-lua-performance-less-var.html">
            
                <a href="../chapter-lua/03-lua-performance-less-var.html">
            
                    
                    尽量少创建变量
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.10.7" data-path="../chapter-lua/03-lua-performance-cache-result.html">
            
                <a href="../chapter-lua/03-lua-performance-cache-result.html">
            
                    
                    缓存运算结果
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.10.8" data-path="../chapter-lua/03-lua-performance-garbage-collect.html">
            
                <a href="../chapter-lua/03-lua-performance-garbage-collect.html">
            
                    
                    主动控制垃圾回收
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.lijiaocn.com" target="blank" class="gitbook-link">
           以上内容由 www.lijiaocn.com 提供
        </a>
    </li>
</ul>


                </nav>
                
<div style="text-align:center">
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Summary_Bottom -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-8176866190626448"
     data-ad-slot="2156601384"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>


            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >时间操作</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
                                <section class="normal markdown-section">
                                
                                
<!-- Page_Top -->
<!--div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-8176866190626448"
     data-ad-slot="5702052586"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div-->


                                <h1 id="c&#x8BED;&#x8A00;&#x4E2D;&#x7684;&#x65F6;&#x95F4;&#x64CD;&#x4F5C;">C&#x8BED;&#x8A00;&#x4E2D;&#x7684;&#x65F6;&#x95F4;&#x64CD;&#x4F5C;</h1>
<!-- toc -->
<ul>
<li><a href="#&#x83B7;&#x53D6;&#x5F53;&#x524D;&#x65F6;&#x95F4;">&#x83B7;&#x53D6;&#x5F53;&#x524D;&#x65F6;&#x95F4;</a></li>
<li><a href="#&#x83B7;&#x53D6;&#x6307;&#x5B9A;&#x8FDB;&#x7A0B;&#x7684;&#x542F;&#x52A8;&#x65F6;&#x95F4;&#x548C;&#x8FD0;&#x884C;&#x65F6;&#x957F;">&#x83B7;&#x53D6;&#x6307;&#x5B9A;&#x8FDB;&#x7A0B;&#x7684;&#x542F;&#x52A8;&#x65F6;&#x95F4;&#x548C;&#x8FD0;&#x884C;&#x65F6;&#x957F;</a></li>
</ul>
<!-- tocstop -->
<h2 id="&#x83B7;&#x53D6;&#x5F53;&#x524D;&#x65F6;&#x95F4;">&#x83B7;&#x53D6;&#x5F53;&#x524D;&#x65F6;&#x95F4;</h2>
<p>&#x83B7;&#x53D6;<code>&#x76F8;&#x5BF9;&#x6307;&#x5B9A;&#x65F6;&#x949F;</code>&#x7684;&#x5F53;&#x524D;&#x65F6;&#x95F4;&#xFF1A;</p>
<p><code>man clock_gettime</code></p>
<pre><code class="lang-c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;time.h&gt;</span></span>

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">clock_getres</span><span class="hljs-params">(clockid_t clk_id, <span class="hljs-keyword">struct</span> timespec *res)</span></span>;

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">clock_gettime</span><span class="hljs-params">(clockid_t clk_id, <span class="hljs-keyword">struct</span> timespec *tp)</span></span>;

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">clock_settime</span><span class="hljs-params">(clockid_t clk_id, <span class="hljs-keyword">const</span> <span class="hljs-keyword">struct</span> timespec *tp)</span></span>;

Link with -lrt (only <span class="hljs-keyword">for</span> glibc versions before <span class="hljs-number">2.17</span>).
</code></pre>
<p><code>*res</code>&#x662F;&#x8FD4;&#x56DE;&#x7684;&#x5F53;&#x524D;&#x65F6;&#x95F4;&#xFF0C;&#x5B9A;&#x4E49;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-c"><span class="hljs-keyword">struct</span> timespec {
    <span class="hljs-keyword">time_t</span>   tv_sec;        <span class="hljs-comment">/* seconds */</span>
    <span class="hljs-keyword">long</span>     tv_nsec;       <span class="hljs-comment">/* nanoseconds */</span>
};
</code></pre>
<p>&#x65F6;&#x949F;<code>clk_id</code>&#x53EF;&#x4EE5;&#x53D6;&#x4EE5;&#x4E0B;&#x503C;&#xFF1A;</p>
<p>CLOCK_REALTIME&#xFF1A;</p>
<pre><code>   System-wide  clock  that  measures  real  (i.e., wall-clock) time.  Setting this clock requires
   appropriate privileges.  This clock is affected by  discontinuous  jumps  in  the  system  time
   (e.g.,  if the system administrator manually changes the clock), and by the incremental adjust&#x2010;
   ments performed by adjtime(3) and NTP.
</code></pre><p>CLOCK_REALTIME_COARSE (since Linux 2.6.32; Linux-specific)&#xFF1A;</p>
<pre><code>   A faster but less precise version of CLOCK_REALTIME.  Use when you  need  very  fast,  but  not
   fine-grained timestamps.
</code></pre><p>CLOCK_MONOTONIC&#xFF1A;</p>
<pre><code>   Clock  that  cannot be set and represents monotonic time since some unspecified starting
   point.  This clock is not affected by discontinuous jumps in the system time  (e.g.,  if
   the system administrator manually changes the clock), but is affected by the incremental
   adjustments performed by adjtime(3) and NTP.
</code></pre><p>CLOCK_MONOTONIC_COARSE (since Linux 2.6.32; Linux-specific)&#xFF1A;</p>
<pre><code>   A faster but less precise version of CLOCK_MONOTONIC.  Use when you need very fast,  but
   not fine-grained timestamps.
</code></pre><p>CLOCK_MONOTONIC_RAW (since Linux 2.6.28; Linux-specific)&#xFF1A;</p>
<pre><code>   Similar to CLOCK_MONOTONIC, but provides access to a raw hardware-based time that is not
   subject to NTP adjustments or the incremental adjustments performed by adjtime(3).
</code></pre><p>CLOCK_BOOTTIME (since Linux 2.6.39; Linux-specific)&#xFF1A;</p>
<pre><code>   Identical to CLOCK_MONOTONIC, except it also includes any time that the system  is  sus&#x2010;
   pended.   This allows applications to get a suspend-aware monotonic clock without having
   to deal with the complications of CLOCK_REALTIME, which may have discontinuities if  the
   time is changed using settimeofday(2).
</code></pre><p>CLOCK_PROCESS_CPUTIME_ID&#xFF1A;</p>
<pre><code>   High-resolution per-process timer from the CPU.
</code></pre><p>CLOCK_THREAD_CPUTIME_ID&#xFF1A;</p>
<pre><code>   Thread-specific CPU-time clock.
</code></pre><p>&#x5176;&#x4E2D;<code>CLOCK_BOOTTIME</code>&#x53EF;&#x4EE5;&#x7B80;&#x5355;&#x7406;&#x89E3;&#x4E3A;&#x7CFB;&#x7EDF;&#x542F;&#x52A8;&#x4EE5;&#x540E;&#x8FC7;&#x53BB;&#x7684;&#x65F6;&#x95F4;&#xFF0C;<a href="https://lwn.net/Articles/420142/" target="_blank">Introduce CLOCK_BOOTTIME </a>&#x3002;</p>
<h2 id="&#x83B7;&#x53D6;&#x6307;&#x5B9A;&#x8FDB;&#x7A0B;&#x7684;&#x542F;&#x52A8;&#x65F6;&#x95F4;&#x548C;&#x8FD0;&#x884C;&#x65F6;&#x957F;">&#x83B7;&#x53D6;&#x6307;&#x5B9A;&#x8FDB;&#x7A0B;&#x7684;&#x542F;&#x52A8;&#x65F6;&#x95F4;&#x548C;&#x8FD0;&#x884C;&#x65F6;&#x957F;</h2>
<p><a href="https://github.com/lxc/lxcfs" target="_blank">lxcfs</a>&#x4E2D;&#x7684;&#x505A;&#x6CD5;&#xFF0C;&#x9002;&#x7528;&#x4E8E;linux&#x3002;</p>
<p><code>/proc/[PID]/stat</code>&#x6587;&#x4EF6;&#x7684;&#x7B2C;22&#x4E2A;&#x5B57;&#x6BB5;&#x662F;&#x8FDB;&#x7A0B;&#x521B;&#x5EFA;&#x65F6;&#x95F4;&#xFF0C;&#x5355;&#x4F4D;&#x662F;&#x7CFB;&#x7EDF;&#x65F6;&#x949F;&#x5600;&#x55D2;&#x6570;&#xFF1A;</p>
<pre><code>starttime %llu (was %lu before Linux 2.6)
    (22)  The  time  the process started after system boot.  In kernels before Linux 2.6, this value was expressed in jiffies.  
    Since Linux 2.6, the value is expressed in clock ticks (divide by sysconf(_SC_CLK_TCK)).
</code></pre><p>&#x5C06;&#x5176;&#x53D6;&#x51FA;&#x540E;&#x9664;&#x4EE5;&#x7CFB;&#x7EDF;&#x7684;&#x65F6;&#x949F;&#x9891;&#x7387;&#xFF0C;&#x5F97;&#x5230;&#x7684;&#x5C31;&#x662F;&#x4EE5;&#x79D2;&#x4E3A;&#x5355;&#x4F4D;&#x7684;&#x542F;&#x52A8;&#x65F6;&#x95F4;&#xFF0C;&#x8FD9;&#x4E2A;&#x65F6;&#x95F4;&#x662F;&#x76F8;&#x5BF9;&#x4E8E;&#x7CFB;&#x7EDF;&#x542F;&#x52A8;&#x65F6;&#x95F4;&#x7684;&#xFF0C;&#x5B9E;&#x73B0;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">static</span> uint64_t <span class="hljs-title">get_reaper_start_time_in_sec</span><span class="hljs-params">(pid_t pid)</span>
</span>{
    <span class="hljs-keyword">uint64_t</span> clockticks;
    <span class="hljs-keyword">int64_t</span> ticks_per_sec;

    clockticks = get_reaper_start_time(pid);
    <span class="hljs-keyword">if</span> (clockticks == <span class="hljs-number">0</span> &amp;&amp; errno == EINVAL) {
        lxcfs_debug(<span class="hljs-string">&quot;failed to retrieve start time of pid %d\n&quot;</span>, pid);
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }

    ticks_per_sec = sysconf(_SC_CLK_TCK);
    <span class="hljs-keyword">if</span> (ticks_per_sec &lt; <span class="hljs-number">0</span> &amp;&amp; errno == EINVAL) {
        lxcfs_debug(
            <span class="hljs-string">&quot;%s\n&quot;</span>,
            <span class="hljs-string">&quot;failed to determine number of clock ticks in a second&quot;</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }

    <span class="hljs-keyword">return</span> (clockticks /= ticks_per_sec);
}
</code></pre>
<p>&#x51FD;&#x6570;<code>sysconf()</code>&#x7684;&#x7528;&#x6CD5;&#x89C1;&#xFF1A;<a href="https://www.lijiaocn.com/programming/chapter-c/sysconfig.html#sysconf" target="_blank">&#x7CFB;&#x7EDF;&#x914D;&#x7F6E;-&gt;sysconf</a>&#x3002;</p>
<p><code>/proc/[PID]/stat</code>&#x6587;&#x4EF6;&#x7684;&#x7B2C;22&#x4E2A;&#x5B57;&#x6BB5;&#x7684;&#x8BFB;&#x53D6;&#x65B9;&#x6CD5;&#xFF1A;</p>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">static</span> uint64_t <span class="hljs-title">get_reaper_start_time</span><span class="hljs-params">(pid_t pid)</span>
</span>{
    <span class="hljs-keyword">int</span> ret;
    FILE *f;
    <span class="hljs-keyword">uint64_t</span> starttime;
    <span class="hljs-comment">/* strlen(&quot;/proc/&quot;) = 6
     * +
     * LXCFS_NUMSTRLEN64
     * +
     * strlen(&quot;/stat&quot;) = 5
     * +
     * \0 = 1
     * */</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> __PROC_PID_STAT_LEN (6 + LXCFS_NUMSTRLEN64 + 5 + 1)</span>
    <span class="hljs-keyword">char</span> path[__PROC_PID_STAT_LEN];
    <span class="hljs-keyword">pid_t</span> qpid;

    qpid = lookup_initpid_in_store(pid);
    <span class="hljs-keyword">if</span> (qpid &lt;= <span class="hljs-number">0</span>) {
        <span class="hljs-comment">/* Caller can check for EINVAL on 0. */</span>
        errno = EINVAL;
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }

    ret = <span class="hljs-built_in">snprintf</span>(path, __PROC_PID_STAT_LEN, <span class="hljs-string">&quot;/proc/%d/stat&quot;</span>, qpid);
    <span class="hljs-keyword">if</span> (ret &lt; <span class="hljs-number">0</span> || ret &gt;= __PROC_PID_STAT_LEN) {
        <span class="hljs-comment">/* Caller can check for EINVAL on 0. */</span>
        errno = EINVAL;
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }

    f = fopen(path, <span class="hljs-string">&quot;r&quot;</span>);
    <span class="hljs-keyword">if</span> (!f) {
        <span class="hljs-comment">/* Caller can check for EINVAL on 0. */</span>
        errno = EINVAL;
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }

    <span class="hljs-comment">/* Note that the *scanf() argument supression requires that length
     * modifiers such as &quot;l&quot; are omitted. Otherwise some compilers will yell
     * at us. It&apos;s like telling someone you&apos;re not married and then asking
     * if you can bring your wife to the party.
     */</span>
    ret = <span class="hljs-built_in">fscanf</span>(f, <span class="hljs-string">&quot;%*d &quot;</span>      <span class="hljs-comment">/* (1)  pid         %d   */</span>
            <span class="hljs-string">&quot;%*s &quot;</span>      <span class="hljs-comment">/* (2)  comm        %s   */</span>
            <span class="hljs-string">&quot;%*c &quot;</span>      <span class="hljs-comment">/* (3)  state       %c   */</span>
            <span class="hljs-string">&quot;%*d &quot;</span>      <span class="hljs-comment">/* (4)  ppid        %d   */</span>
            <span class="hljs-string">&quot;%*d &quot;</span>      <span class="hljs-comment">/* (5)  pgrp        %d   */</span>
            <span class="hljs-string">&quot;%*d &quot;</span>      <span class="hljs-comment">/* (6)  session     %d   */</span>
            <span class="hljs-string">&quot;%*d &quot;</span>      <span class="hljs-comment">/* (7)  tty_nr      %d   */</span>
            <span class="hljs-string">&quot;%*d &quot;</span>      <span class="hljs-comment">/* (8)  tpgid       %d   */</span>
            <span class="hljs-string">&quot;%*u &quot;</span>      <span class="hljs-comment">/* (9)  flags       %u   */</span>
            <span class="hljs-string">&quot;%*u &quot;</span>      <span class="hljs-comment">/* (10) minflt      %lu  */</span>
            <span class="hljs-string">&quot;%*u &quot;</span>      <span class="hljs-comment">/* (11) cminflt     %lu  */</span>
            <span class="hljs-string">&quot;%*u &quot;</span>      <span class="hljs-comment">/* (12) majflt      %lu  */</span>
            <span class="hljs-string">&quot;%*u &quot;</span>      <span class="hljs-comment">/* (13) cmajflt     %lu  */</span>
            <span class="hljs-string">&quot;%*u &quot;</span>      <span class="hljs-comment">/* (14) utime       %lu  */</span>
            <span class="hljs-string">&quot;%*u &quot;</span>      <span class="hljs-comment">/* (15) stime       %lu  */</span>
            <span class="hljs-string">&quot;%*d &quot;</span>      <span class="hljs-comment">/* (16) cutime      %ld  */</span>
            <span class="hljs-string">&quot;%*d &quot;</span>      <span class="hljs-comment">/* (17) cstime      %ld  */</span>
            <span class="hljs-string">&quot;%*d &quot;</span>      <span class="hljs-comment">/* (18) priority    %ld  */</span>
            <span class="hljs-string">&quot;%*d &quot;</span>      <span class="hljs-comment">/* (19) nice        %ld  */</span>
            <span class="hljs-string">&quot;%*d &quot;</span>      <span class="hljs-comment">/* (20) num_threads %ld  */</span>
            <span class="hljs-string">&quot;%*d &quot;</span>      <span class="hljs-comment">/* (21) itrealvalue %ld  */</span>
            <span class="hljs-string">&quot;%&quot;</span> PRIu64, <span class="hljs-comment">/* (22) starttime   %llu */</span>
             &amp;starttime);
    <span class="hljs-keyword">if</span> (ret != <span class="hljs-number">1</span>) {
        fclose(f);
        <span class="hljs-comment">/* Caller can check for EINVAL on 0. */</span>
        errno = EINVAL;
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }

    fclose(f);

    errno = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">return</span> starttime;
}
</code></pre>
<p>&#x7528;&#x5F53;&#x524D;&#x65F6;&#x95F4;&#x51CF;&#x53BB;&#x8FDB;&#x7A0B;&#x7684;&#x542F;&#x52A8;&#x65F6;&#x95F4;&#xFF0C;&#x5C31;&#x662F;&#x8FDB;&#x7A0B;&#x7684;&#x8FD0;&#x884C;&#x65F6;&#x957F;&#xFF0C;&#x5F53;&#x524D;&#x65F6;&#x95F4;&#x9700;&#x8981;&#x662F;&#x76F8;&#x5BF9;&#x7CFB;&#x7EDF;&#x542F;&#x52A8;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x7528;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;<code>clock_gettime()</code>&#x83B7;&#x53D6;&#xFF1A;</p>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">static</span> uint64_t <span class="hljs-title">get_reaper_age</span><span class="hljs-params">(pid_t pid)</span>
</span>{
    <span class="hljs-keyword">uint64_t</span> procstart, uptime, procage;

    <span class="hljs-comment">/* We need to substract the time the process has started since system
     * boot minus the time when the system has started to get the actual
     * reaper age.
     */</span>
    procstart = get_reaper_start_time_in_sec(pid);
    procage = procstart;
    <span class="hljs-keyword">if</span> (procstart &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">int</span> ret;
        <span class="hljs-keyword">struct</span> timespec spec;

        ret = clock_gettime(CLOCK_BOOTTIME, &amp;spec);
        <span class="hljs-keyword">if</span> (ret &lt; <span class="hljs-number">0</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
        <span class="hljs-comment">/* We could make this more precise here by using the tv_nsec
         * field in the timespec struct and convert it to milliseconds
         * and then create a double for the seconds and milliseconds but
         * that seems more work than it is worth.
         */</span>
        uptime = spec.tv_sec;
        procage = uptime - procstart;
    }

    <span class="hljs-keyword">return</span> procage;
}
</code></pre>
<script type="text/javascript">var className='atoc';</script>
                                
<div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Page_Bottom -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-8176866190626448"
     data-ad-slot="7945072540"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>


                                
                                </section>
                            
                        </div>
                    </div>
                
            </div>

            
                
                <a href="strings.html" class="navigation navigation-prev " aria-label="Previous page: 字符串处理">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="dynamiclib.html" class="navigation navigation-next " aria-label="Next page: 动态链接库">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"时间操作","level":"1.2.2","depth":2,"next":{"title":"动态链接库","level":"1.2.3","depth":2,"path":"chapter-c/dynamiclib.md","ref":"./chapter-c/dynamiclib.md","articles":[]},"previous":{"title":"字符串处理","level":"1.2.1","depth":2,"path":"chapter-c/strings.md","ref":"./chapter-c/strings.md","articles":[]},"dir":"ltr"},"config":{"plugins":["atoc","livereload"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"atoc":{"addClass":true,"className":"atoc"},"livereload":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Go语言简明手册","gitbook":"*"},"file":{"path":"chapter-c/time.md","mtime":"2019-03-12T12:36:58.877Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-03-12T12:36:59.855Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-atoc/atoc.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

