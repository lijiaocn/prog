<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title></title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <div style="width:100%;text-align:center">
                  <h2 style="color:#afa790">ç¼–ç¨‹åŸºç¡€</h2>
                  <p style="font-weight:bold"><a style="color:lightgray;" href="https://www.lijiaocn.com">www.lijiaocn.com</a></p>
                </div>
                <ol class="chapter"><li class="chapter-item expanded "><a href="index.html"><strong aria-hidden="true">1.</strong> ç¬”è®°è¯´æ˜</a></li><li class="chapter-item expanded "><a href="shell/index.html"><strong aria-hidden="true">2.</strong> Shell è„šæœ¬</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="shell/struct.html"><strong aria-hidden="true">2.1.</strong> å˜é‡ä¸æ•°æ®ç»“æ„</a></li><li class="chapter-item expanded "><a href="shell/cmd.html"><strong aria-hidden="true">2.2.</strong> å†…ç½®å‘½ä»¤ç”¨æ³•</a></li></ol></li><li class="chapter-item expanded "><a href="c/index.html"><strong aria-hidden="true">3.</strong> C è¯­è¨€</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="c/strings.html"><strong aria-hidden="true">3.1.</strong> å­—ç¬¦ä¸²å¤„ç†</a></li><li class="chapter-item expanded "><a href="c/time.html"><strong aria-hidden="true">3.2.</strong> æ—¶é—´æ“ä½œ</a></li><li class="chapter-item expanded "><a href="c/dynamiclib.html"><strong aria-hidden="true">3.3.</strong> åŠ¨æ€é“¾æ¥åº“</a></li><li class="chapter-item expanded "><a href="c/signal.html"><strong aria-hidden="true">3.4.</strong> ä¿¡å·é‡æ“ä½œ</a></li><li class="chapter-item expanded "><a href="c/memory.html"><strong aria-hidden="true">3.5.</strong> å†…å­˜ç®¡ç†æ“ä½œ</a></li><li class="chapter-item expanded "><a href="c/print.html"><strong aria-hidden="true">3.6.</strong> æ ¼å¼åŒ–æ‰“å°è¾“å‡º</a></li><li class="chapter-item expanded "><a href="c/file.html"><strong aria-hidden="true">3.7.</strong> æ–‡ä»¶&è®¾å¤‡æ“ä½œ</a></li><li class="chapter-item expanded "><a href="c/process.html"><strong aria-hidden="true">3.8.</strong> è¿›ç¨‹ç®¡ç†æ“ä½œ</a></li><li class="chapter-item expanded "><a href="c/concurrent.html"><strong aria-hidden="true">3.9.</strong> å¹¶å‘ç¼–ç¨‹</a></li><li class="chapter-item expanded "><a href="c/socket.html"><strong aria-hidden="true">3.10.</strong> socketé€šä¿¡</a></li><li class="chapter-item expanded "><a href="c/filesystem.html"><strong aria-hidden="true">3.11.</strong> æ–‡ä»¶ç³»ç»Ÿ</a></li><li class="chapter-item expanded "><a href="c/sysconfig.html"><strong aria-hidden="true">3.12.</strong> ç³»ç»Ÿé…ç½®</a></li><li class="chapter-item expanded "><a href="c/namespace.html"><strong aria-hidden="true">3.13.</strong> Namespaceæ“ä½œ</a></li><li class="chapter-item expanded "><a href="c/hardware.html"><strong aria-hidden="true">3.14.</strong> ç¡¬ä»¶ä¿¡æ¯è¯»å–</a></li></ol></li><li class="chapter-item expanded "><a href="go/index.html"><strong aria-hidden="true">4.</strong> Go è¯­è¨€</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="go/chapter01/01-install.html"><strong aria-hidden="true">4.1.</strong> å®‰è£…å’Œæ–‡æ¡£</a></li><li class="chapter-item expanded "><a href="go/chapter02/00-about.html"><strong aria-hidden="true">4.2.</strong> åŸºç¡€è¯­æ³•</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="go/chapter02/02-lexical-elements.html"><strong aria-hidden="true">4.2.1.</strong> è¯æ³•</a></li><li class="chapter-item expanded "><a href="go/chapter02/03-constants.html"><strong aria-hidden="true">4.2.2.</strong> å¸¸é‡</a></li><li class="chapter-item expanded "><a href="go/chapter02/04-variables.html"><strong aria-hidden="true">4.2.3.</strong> å˜é‡</a></li><li class="chapter-item expanded "><a href="go/chapter02/05-types.html"><strong aria-hidden="true">4.2.4.</strong> ç±»å‹</a></li><li class="chapter-item expanded "><a href="go/chapter02/06-declarations.html"><strong aria-hidden="true">4.2.5.</strong> å£°æ˜</a></li><li class="chapter-item expanded "><a href="go/chapter02/07-expressions.html"><strong aria-hidden="true">4.2.6.</strong> è¡¨è¾¾å¼</a></li><li class="chapter-item expanded "><a href="go/chapter02/08-statements.html"><strong aria-hidden="true">4.2.7.</strong> è¯­å¥</a></li><li class="chapter-item expanded "><a href="go/chapter02/10-package.html"><strong aria-hidden="true">4.2.8.</strong> åŒ…å£°æ˜</a></li></ol></li><li class="chapter-item expanded "><a href="go/chapter02/09-builtin.html"><strong aria-hidden="true">4.3.</strong> å†…ç½®å‡½æ•°</a></li><li class="chapter-item expanded "><a href="go/chapter02/11-initialization.html"><strong aria-hidden="true">4.4.</strong> åˆå§‹åŒ–</a></li><li class="chapter-item expanded "><a href="go/chapter02/12-errors.html"><strong aria-hidden="true">4.5.</strong> é”™è¯¯å¤„ç†</a></li><li class="chapter-item expanded "><a href="go/chapter02/13-system.html"><strong aria-hidden="true">4.6.</strong> ç³»ç»Ÿç›¸å…³</a></li><li class="chapter-item expanded "><a href="go/chapter03/01-cmdline.html"><strong aria-hidden="true">4.7.</strong> å‘½ä»¤è¡Œå‚æ•°</a></li><li class="chapter-item expanded "><a href="go/chapter03/02-log.html"><strong aria-hidden="true">4.8.</strong> æ—¥å¿—æ‰“å°</a></li><li class="chapter-item expanded "><a href="go/chapter03/convert.html"><strong aria-hidden="true">4.9.</strong> ç±»å‹è½¬æ¢</a></li><li class="chapter-item expanded "><a href="go/chapter04/01-dependency.html"><strong aria-hidden="true">4.10.</strong> ä»£ç ç®¡ç†</a></li><li class="chapter-item expanded "><a href="go/template/index.html"><strong aria-hidden="true">4.11.</strong> Go Tempalte</a></li><li class="chapter-item expanded "><a href="go/chapter02/99-examples.html"><strong aria-hidden="true">4.12.</strong> é—ç•™ä»£ç ç‰‡æ®µ</a></li><li class="chapter-item expanded "><a href="testframe/ginkgo.html"><strong aria-hidden="true">4.13.</strong> Go æµ‹è¯•æ¡†æ¶ GinkGo</a></li></ol></li><li class="chapter-item expanded "><a href="go/article/index.html"><strong aria-hidden="true">5.</strong> Go è¯­è¨€æ·±å…¥</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="go/article/pkg.html"><strong aria-hidden="true">5.1.</strong> ä»£ç è¦å¦‚ä½•ç»„ç»‡?</a></li><li class="chapter-item expanded "><a href="go/article/create_mod.html"><strong aria-hidden="true">5.2.</strong> å¤šç‰ˆæœ¬ä¾èµ–åŠŸèƒ½éªŒè¯</a></li><li class="chapter-item expanded "><a href="go/article/testcase.html"><strong aria-hidden="true">5.3.</strong> æµ‹è¯•ç”¨ä¾‹çš„è¦†ç›–ç‡</a></li><li class="chapter-item expanded "><a href="go/article/varcopy.html"><strong aria-hidden="true">5.4.</strong> æŒ‰å€¼ä¼ é€’çš„å¼€é”€å¾ˆå¤§</a></li><li class="chapter-item expanded "><a href="go/article/waitgroup.html"><strong aria-hidden="true">5.5.</strong> å¹¶å‘ä¸æŒ‰å€¼ä¼ é€’è¡€æ¡ˆ</a></li><li class="chapter-item expanded "><a href="go/article/debug.html"><strong aria-hidden="true">5.6.</strong> ç¨‹åºè¿è¡Œæ—¶è·Ÿè¸ªè°ƒè¯•</a></li><li class="chapter-item expanded "><a href="go/article/pprof.html"><strong aria-hidden="true">5.7.</strong> ç¨‹åºè¿è¡Œæ—¶çŠ¶æ€æŸ¥çœ‹</a></li><li class="chapter-item expanded "><a href="go/article/unmarshal.html"><strong aria-hidden="true">5.8.</strong> å¤§é‡ååºåˆ—åŒ–ç”¨æŒ‡é’ˆ</a></li></ol></li><li class="chapter-item expanded "><a href="go/gin/index.html"><strong aria-hidden="true">6.</strong> Gin çš„åŸç†ä¸å­¦ä¹ èµ„æ–™</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="go/gin/quickstart.html"><strong aria-hidden="true">6.1.</strong> å¿«é€Ÿå¼€å§‹</a></li><li class="chapter-item expanded "><a href="go/gin/router.html"><strong aria-hidden="true">6.2.</strong> è·¯ç”±ç®¡ç†</a></li><li class="chapter-item expanded "><a href="go/gin/param.html"><strong aria-hidden="true">6.3.</strong> å‚æ•°è¯»å–</a></li><li class="chapter-item expanded "><a href="go/gin/response.html"><strong aria-hidden="true">6.4.</strong> å“åº”æ•°æ®</a></li></ol></li><li class="chapter-item expanded "><a href="lua/index.html"><strong aria-hidden="true">7.</strong> Lua è¯­è¨€</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="lua/basic_type.html"><strong aria-hidden="true">7.1.</strong> åŸºæœ¬æ•°æ®ç±»å‹</a></li><li class="chapter-item expanded "><a href="lua/keywords_operator.html"><strong aria-hidden="true">7.2.</strong> å…³é”®å­—ä¸æ“ä½œç¬¦</a></li><li class="chapter-item expanded "><a href="lua/control_flow.html"><strong aria-hidden="true">7.3.</strong> æ¡ä»¶è¯­å¥ä¸å¾ªç¯</a></li><li class="chapter-item expanded "><a href="lua/function.html"><strong aria-hidden="true">7.4.</strong> å‡½æ•°å®šä¹‰ä½¿ç”¨</a></li><li class="chapter-item expanded "><a href="lua/module.html"><strong aria-hidden="true">7.5.</strong> æ¨¡å—å®šä¹‰ä½¿ç”¨</a></li><li class="chapter-item expanded "><a href="lua/metatable.html"><strong aria-hidden="true">7.6.</strong> å…ƒè¡¨å®šä¹‰è®¾ç½®</a></li><li class="chapter-item expanded "><a href="lua/object_oriented.html"><strong aria-hidden="true">7.7.</strong> é¢å‘å¯¹è±¡è®¾è®¡</a></li><li class="chapter-item expanded "><a href="lua/01-standard-output.html"><strong aria-hidden="true">7.8.</strong> æ ‡å‡†è¾“å‡ºæ‰“å°</a></li><li class="chapter-item expanded "><a href="lua/02-string-operation.html"><strong aria-hidden="true">7.9.</strong> å­—ç¬¦ä¸²æ“ä½œ</a></li><li class="chapter-item expanded "><a href="lua/03-lua-performance.html"><strong aria-hidden="true">7.10.</strong> æ€§èƒ½ç›¸å…³</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="lua/03-lua-performance-local-var.html"><strong aria-hidden="true">7.10.1.</strong> å±€éƒ¨å˜é‡æ¯”å…¨å±€å˜é‡å¿«30%</a></li><li class="chapter-item expanded "><a href="lua/03-lua-performance-load-dynamic.html"><strong aria-hidden="true">7.10.2.</strong> åŠ¨æ€åŠ è½½ä»£ç éå¸¸æ…¢</a></li><li class="chapter-item expanded "><a href="lua/03-lua-performance-table-space.html"><strong aria-hidden="true">7.10.3.</strong> tableè‡ªåŠ¨æ‰©å®¹ä»£ä»·å¾ˆé«˜</a></li><li class="chapter-item expanded "><a href="lua/03-lua-performance-table-space-1.html"><strong aria-hidden="true">7.10.4.</strong> æ¸…ç†tableæˆå‘˜ä¸ä¼šè§¦å‘rehash</a></li><li class="chapter-item expanded "><a href="lua/03-lua-performance-string.html"><strong aria-hidden="true">7.10.5.</strong> æ…ç”¨å­—ç¬¦ä¸²æ‹¼æ¥</a></li><li class="chapter-item expanded "><a href="lua/03-lua-performance-less-var.html"><strong aria-hidden="true">7.10.6.</strong> å°½é‡å°‘åˆ›å»ºå˜é‡</a></li><li class="chapter-item expanded "><a href="lua/03-lua-performance-cache-result.html"><strong aria-hidden="true">7.10.7.</strong> ç¼“å­˜è¿ç®—ç»“æœ</a></li><li class="chapter-item expanded "><a href="lua/03-lua-performance-garbage-collect.html"><strong aria-hidden="true">7.10.8.</strong> ä¸»åŠ¨æ§åˆ¶åƒåœ¾å›æ”¶</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="python3/index.html"><strong aria-hidden="true">8.</strong> Python3</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="python3/2to3.html"><strong aria-hidden="true">8.1.</strong> python2 ä»£ç è½¬æ¢æˆ python3</a></li><li class="chapter-item expanded "><a href="python3/project.html"><strong aria-hidden="true">8.2.</strong> è¿è¡Œç¯å¢ƒä¸ä¾èµ–ç®¡ç†</a></li><li class="chapter-item expanded "><a href="python3/syntax.html"><strong aria-hidden="true">8.3.</strong> ä»£ç æ–‡ä»¶</a></li><li class="chapter-item expanded "><a href="python3/struct.html"><strong aria-hidden="true">8.4.</strong> åŸºæœ¬ç±»å‹</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="python3/list.html"><strong aria-hidden="true">8.4.1.</strong> list</a></li><li class="chapter-item expanded "><a href="python3/tuple.html"><strong aria-hidden="true">8.4.2.</strong> tuple</a></li><li class="chapter-item expanded "><a href="python3/set.html"><strong aria-hidden="true">8.4.3.</strong> set</a></li><li class="chapter-item expanded "><a href="python3/dictionary.html"><strong aria-hidden="true">8.4.4.</strong> dictionary</a></li></ol></li><li class="chapter-item expanded "><a href="python3/string.html"><strong aria-hidden="true">8.5.</strong> å­—ç¬¦ä¸²å¤„ç†</a></li><li class="chapter-item expanded "><a href="python3/time.html"><strong aria-hidden="true">8.6.</strong> æ—¶é—´å¤„ç†</a></li><li class="chapter-item expanded "><a href="python3/num.html"><strong aria-hidden="true">8.7.</strong> æ•°å€¼å¤„ç†</a></li><li class="chapter-item expanded "><a href="python3/builtin.html"><strong aria-hidden="true">8.8.</strong> å†…ç½®å‡½æ•°</a></li><li class="chapter-item expanded "><a href="python3/scope.html"><strong aria-hidden="true">8.9.</strong> å˜é‡ä½œç”¨åŸŸ</a></li><li class="chapter-item expanded "><a href="python3/params.html"><strong aria-hidden="true">8.10.</strong> å‚æ•°è¯»å–</a></li><li class="chapter-item expanded "><a href="python3/module.html"><strong aria-hidden="true">8.11.</strong> æ¨¡å—ç”¨æ³•</a></li><li class="chapter-item expanded "><a href="python3/package.html"><strong aria-hidden="true">8.12.</strong> åŒ…ç”¨æ³•</a></li><li class="chapter-item expanded "><a href="python3/format.html"><strong aria-hidden="true">8.13.</strong> æ ¼å¼åŒ–è¾“å‡º</a></li><li class="chapter-item expanded "><a href="python3/file.html"><strong aria-hidden="true">8.14.</strong> æ–‡ä»¶è¯»å†™</a></li><li class="chapter-item expanded "><a href="python3/error.html"><strong aria-hidden="true">8.15.</strong> é”™è¯¯å’Œå¼‚å¸¸</a></li><li class="chapter-item expanded "><a href="python3/class.html"><strong aria-hidden="true">8.16.</strong> ç±»</a></li><li class="chapter-item expanded "><a href="python3/generator.html"><strong aria-hidden="true">8.17.</strong> ç”Ÿæˆå™¨</a></li></ol></li><li class="chapter-item expanded "><a href="py3spider/index.html"><strong aria-hidden="true">9.</strong> Python3 çˆ¬è™«å¼€å‘</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="py3spider/request.html"><strong aria-hidden="true">9.1.</strong> Python3 è¯·æ±‚åº“</a></li><li class="chapter-item expanded "><a href="py3spider/parse.html"><strong aria-hidden="true">9.2.</strong> Python3 è§£æåº“</a></li><li class="chapter-item expanded "><a href="py3spider/mobile.html"><strong aria-hidden="true">9.3.</strong> ç§»åŠ¨ APP å·¥å…·</a></li><li class="chapter-item expanded "><a href="py3spider/framework.html"><strong aria-hidden="true">9.4.</strong> Python3 çˆ¬è™«æ¡†æ¶</a></li></ol></li><li class="chapter-item expanded "><a href="django/index.html"><strong aria-hidden="true">10.</strong> Django å¼€å‘æ‰‹å†Œ</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="django/install.html"><strong aria-hidden="true">10.1.</strong> ç¯å¢ƒå®‰è£…</a></li><li class="chapter-item expanded "><a href="django/first-project.html"><strong aria-hidden="true">10.2.</strong> é¡¹ç›®çš„åˆ›å»º</a></li><li class="chapter-item expanded "><a href="django/first-app.html"><strong aria-hidden="true">10.3.</strong> åº”ç”¨çš„åˆ›å»º</a></li><li class="chapter-item expanded "><a href="django/database.html"><strong aria-hidden="true">10.4.</strong> å¯¹æ¥æ•°æ®åº“</a></li><li class="chapter-item expanded "><a href="django/database-init.html"><strong aria-hidden="true">10.5.</strong> æ•°æ®åº“åˆå§‹åŒ–</a></li><li class="chapter-item expanded "><a href="django/database-usage.html"><strong aria-hidden="true">10.6.</strong> æ•°æ®åº“æŸ¥è¯¢å†™å…¥</a></li><li class="chapter-item expanded "><a href="django/database-shell.html"><strong aria-hidden="true">10.7.</strong> å‘½ä»¤è¡Œæ“ä½œæ•°æ®åº“</a></li><li class="chapter-item expanded "><a href="django/admin.html"><strong aria-hidden="true">10.8.</strong> ä½¿ç”¨åå°ç®¡ç†é¡µé¢</a></li><li class="chapter-item expanded "><a href="django/views.html"><strong aria-hidden="true">10.9.</strong> views çš„å¼€å‘</a></li><li class="chapter-item expanded "><a href="django/generic_views.html"><strong aria-hidden="true">10.10.</strong> ä½¿ç”¨ Generic Views</a></li><li class="chapter-item expanded "><a href="django/test.html"><strong aria-hidden="true">10.11.</strong> ç¼–å†™æµ‹è¯•ä»£ç </a></li><li class="chapter-item expanded "><a href="django/static.html"><strong aria-hidden="true">10.12.</strong> é¡µé¢æ¨¡ç‰ˆä¸­å¼•å…¥é™æ€èµ„æº</a></li><li class="chapter-item expanded "><a href="django/input.html"><strong aria-hidden="true">10.13.</strong> ä¼ å…¥å‚æ•°çš„è·å–</a></li><li class="chapter-item expanded "><a href="django/log.html"><strong aria-hidden="true">10.14.</strong> æ—¥å¿—ç®¡ç†</a></li><li class="chapter-item expanded "><a href="django/global_setting.html"><strong aria-hidden="true">10.15.</strong> é¡¹ç›®çš„å…¨å±€è®¾ç½®</a></li><li class="chapter-item expanded "><a href="django/problems.html"><strong aria-hidden="true">10.16.</strong> é—®é¢˜è®°å½•</a></li><li class="chapter-item expanded "><a href="django/idea_usage.html"><strong aria-hidden="true">10.17.</strong> IDEA è¿œç¨‹è°ƒè¯• python</a></li><li class="chapter-item expanded "><a href="django/package.html"><strong aria-hidden="true">10.18.</strong> ä½¿ç”¨è‡ªå®šä¹‰çš„ Package</a></li><li class="chapter-item expanded "><a href="django/deploy.html"><strong aria-hidden="true">10.19.</strong> ç”¨WSGIæ–¹å¼éƒ¨ç½²DjangoæœåŠ¡</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="django/deploy_apache.html"><strong aria-hidden="true">10.19.1.</strong> åœ¨Apacheä¸­éƒ¨ç½²Djangoåº”ç”¨</a></li></ol></li><li class="chapter-item expanded "><a href="django/redis_cache.html"><strong aria-hidden="true">10.20.</strong> å¼•å…¥redisç¼“å­˜</a></li><li class="chapter-item expanded "><a href="django/import-django.html"><strong aria-hidden="true">10.21.</strong> å¯¼å…¥djangoç¯å¢ƒ</a></li></ol></li><li class="chapter-item expanded "><a href="android/start.html"><strong aria-hidden="true">11.</strong> Android</a></li><li class="chapter-item expanded "><a href="vue/start.html"><strong aria-hidden="true">12.</strong> Vue</a></li><li class="chapter-item expanded "><a href="wechat/index.html"><strong aria-hidden="true">13.</strong> å¾®ä¿¡å…¬ä¼—å· API ä½¿ç”¨</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="wechat/shezhi.html"><strong aria-hidden="true">13.1.</strong> è®¾ç½®æ–¹æ³•</a></li><li class="chapter-item expanded "><a href="wechat/message.html"><strong aria-hidden="true">13.2.</strong> æ¶ˆæ¯æ ¼å¼</a></li><li class="chapter-item expanded "><a href="wechat/debug.html"><strong aria-hidden="true">13.3.</strong> æ¥å£è°ƒè¯•</a></li></ol></li><li class="chapter-item expanded "><a href="taobaoke/index.html"><strong aria-hidden="true">14.</strong> æ·˜å®å®¢ API ä½¿ç”¨</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="taobaoke/kaitong.html"><strong aria-hidden="true">14.1.</strong> å¼€é€šæ–¹æ³•</a></li><li class="chapter-item expanded "><a href="taobaoke/sdk.html"><strong aria-hidden="true">14.2.</strong> SDKä¸‹è½½</a></li><li class="chapter-item expanded "><a href="taobaoke/api.html"><strong aria-hidden="true">14.3.</strong> æ¥å£æ¢³ç†</a></li><li class="chapter-item expanded "><a href="taobaoke/api_call.html"><strong aria-hidden="true">14.4.</strong> æ¥å£è°ƒç”¨</a></li></ol></li></ol>
               <div style="width:100%;text-align:center">
                  <img style="width:100%" src="https://www.lijiaocn.com/img/ercode/cur.jpg"/>
               </div>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div style="text-align:center;width:100%">
                    <!--h1>é¡¶éƒ¨æ¡å¹…å¹¿å‘Š</h1-->
                    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8176866190626448"
                     crossorigin="anonymous"></script>
                     <!-- é¡¶éƒ¨æ¡å¹…å¹¿å‘Š -->
                    <ins class="adsbygoogle"
                     style="display:block"
                     data-ad-client="ca-pub-8176866190626448"
                     data-ad-slot="1000173679"
                     data-ad-format="auto"
                     data-full-width-responsive="true"></ins>
                     <script>
                     (adsbygoogle = window.adsbygoogle || []).push({});
                     </script>
                </div>

                <div id="content" class="content">
                    <main>
                        <h1 id="ç¼–ç¨‹è¯­è¨€æ‰‹å†Œ"><a class="header" href="#ç¼–ç¨‹è¯­è¨€æ‰‹å†Œ">ç¼–ç¨‹è¯­è¨€æ‰‹å†Œ</a></h1>
<p>è¯¥æ‰‹å†Œçš„ç›®çš„æ˜¯åœ¨é•¿æ—¶é—´ä¸æ¥è§¦æŸä¸€é—¨è¯­è¨€åï¼Œèƒ½å¤Ÿé€šè¿‡è¯¥æ‰‹å†Œå¿«é€Ÿå›æƒ³èµ·åŸºæœ¬çš„è¯­æ³•å’Œç”¨æ³•ã€‚</p>
<p>å·¥ä½œè¿‡ç¨‹ä¸­æ¥è§¦åˆ°ä»€ä¹ˆç¼–ç¨‹è¯­è¨€ï¼Œå°±è®°å½•ä»€ä¹ˆè¯­è¨€çš„å†…å®¹ï¼Œæ–‡æ¡£ç»“æ„å’Œå†…å®¹åœ¨æŒç»­ä¼˜åŒ–ä¸­ã€‚</p>
<p>ğŸ‘ˆ ä»å·¦ä¾§ç›®å½•å¼€å§‹é˜…è¯»ã€‚</p>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="bash-è„šæœ¬è¯­æ³•"><a class="header" href="#bash-è„šæœ¬è¯­æ³•">Bash è„šæœ¬è¯­æ³•</a></h1>
<p>è¿™é‡Œè®°å½• Shell è„šæœ¬çš„ç”¨æ³•ï¼Œä¸»è¦æ˜¯ bashã€‚</p>
<p>å­¦ä¹ èµ„æ–™ï¼š</p>
<ul>
<li><a href="https://www.lijiaocn.com/%E7%BC%96%E7%A8%8B/2014/01/08/shell-usage.html" title="Shell(bash)ç¼–ç¨‹">Shell(bash)ç¼–ç¨‹</a></li>
<li><a href="http://man7.org/linux/man-pages/man1/bash.1.html" title="bash - GNU Bourne-Again SHell">bash - GNU Bourne-Again SHell</a></li>
</ul>
<h2 id="bash-çš„å‘½ä»¤è¡Œå‚æ•°"><a class="header" href="#bash-çš„å‘½ä»¤è¡Œå‚æ•°">bash çš„å‘½ä»¤è¡Œå‚æ•°</a></h2>
<pre><code class="language-sh">-c &quot;ls&quot;   : æ‰§è¡Œå­—ç¬¦ä¸²ä¸­çš„å‘½ä»¤
--        : å‘½ä»¤è¡Œå‚æ•°ç»“æŸç¬¦
</code></pre>
<h2 id="å‚è€ƒ"><a class="header" href="#å‚è€ƒ">å‚è€ƒ</a></h2>
<ol>
<li><a href="https://www.lijiaocn.com" title="æä½¶æ¾³çš„åšå®¢">æä½¶æ¾³çš„åšå®¢</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="bash-çš„å˜é‡ä¸æ•°æ®ç»“æ„"><a class="header" href="#bash-çš„å˜é‡ä¸æ•°æ®ç»“æ„">Bash çš„å˜é‡ä¸æ•°æ®ç»“æ„</a></h1>
<p>ä¸»è¦å­¦ä¹ èµ„æ–™ï¼š <a href="http://man7.org/linux/man-pages/man1/bash.1.html" title="bash - GNU Bourne-Again SHell">bash - GNU Bourne-Again SHell</a>ã€‚</p>
<h2 id="ç¼–ç¨‹å¸¸ç”¨æ“ä½œ"><a class="header" href="#ç¼–ç¨‹å¸¸ç”¨æ“ä½œ">ç¼–ç¨‹å¸¸ç”¨æ“ä½œ</a></h2>
<h3 id="ç”¨-read-å®ç°å¤šå˜é‡èµ‹å€¼"><a class="header" href="#ç”¨-read-å®ç°å¤šå˜é‡èµ‹å€¼">ç”¨ read å®ç°å¤šå˜é‡èµ‹å€¼</a></h3>
<p>ç”¨ä¸‹é¢çš„å‘½ä»¤å¯ä»¥åŒæ—¶å®šä¹‰å¤šä¸ªå˜é‡ï¼Œå¹¶èµ‹å€¼ï¼š</p>
<pre><code class="language-sh">read a b c &lt;&lt;&lt; &quot;1 2 3&quot;;echo &quot;$a|$b|$c&quot;
</code></pre>
<p>å‚è€ƒï¼š<a href="https://codeday.me/bug/20170709/39537.html">Linux bashï¼šå¤šä¸ªå˜é‡èµ‹å€¼</a></p>
<h3 id="è¯»å–å‘½ä»¤è¡Œå‚æ•°"><a class="header" href="#è¯»å–å‘½ä»¤è¡Œå‚æ•°">è¯»å–å‘½ä»¤è¡Œå‚æ•°</a></h3>
<h4 id="å†…ç½®å‘½ä»¤-getopts"><a class="header" href="#å†…ç½®å‘½ä»¤-getopts">å†…ç½®å‘½ä»¤ getopts</a></h4>
<p>æœ€æ–°ä»£ç  <a href="https://github.com/lijiaocn/workspace/blob/master/studys/study-shell/cmdline/getopts.sh">getopts.sh</a>ã€‚</p>
<p>ç”¨ getopts è§£æå‘½ä»¤è¡Œå‚æ•°ï¼Œgetopts ä¸æ”¯æŒé•¿æ ¼å¼ï¼Œåªèƒ½ç”¨ <code>-h</code> è¿™æ ·çš„çŸ­æ ¼å¼ï¼š</p>
<pre><code class="language-sh">while getopts &quot;p:h:&quot; option ;do
    if [[ $option == &quot;p&quot; ]];then
        echo &quot;listener port: $OPTARG&quot;
    fi
    if [[ $option == &quot;h&quot; ]];then
        read name value &lt;&lt;&lt; &quot;${OPTARG//:/ }&quot;;
        headers=&quot;$headers\nproxy_set_header $name $value;&quot;
    fi
done

echo $headers
</code></pre>
<p>æ‰§è¡Œæ•ˆæœå¦‚ä¸‹ï¼š</p>
<pre><code class="language-sh">$ ./getopts.sh -p 80 -h h1:v1 -h h2:v2
listener port: 80

proxy_set_header h1 v1;
proxy_set_header h2 v2;
</code></pre>
<h3 id="ç”¨éå†å‚æ•°çš„æ–¹å¼å®ç°"><a class="header" href="#ç”¨éå†å‚æ•°çš„æ–¹å¼å®ç°">ç”¨éå†å‚æ•°çš„æ–¹å¼å®ç°</a></h3>
<p>æœ€æ–°ä»£ç  <a href="https://github.com/lijiaocn/workspace/blob/master/studys/study-shell/cmdline/loop.sh">loop.sh</a>ã€‚ </p>
<pre><code class="language-sh">#! /bin/sh
#
# loop.sh
# Copyright (C) 2019 lijiaocn &lt;lijiaocn@foxmail.com wechat:lijiaocn&gt;
#
# Distributed under terms of the GPL license.
#

function help(){
	echo &quot;usage: $0 [-f file] [-n name] [arguments...]&quot;
}

while :; do
	case $1 in
		-h|-\?|--help)
			help
			exit
			;;
		-f|--file)
			if [[ $2 == &quot;&quot; || ${2:0:1} == &quot;-&quot; ]];then
				echo 'ERROR: &quot;--file&quot; requires a non-empty option argument.' 2&gt;&amp;1
				exit 1
			fi
			file=$2
			shift
			;;
		-n|--name)
			if [[ $2 == &quot;&quot; || ${2:0:1} == &quot;-&quot; ]];then
				echo 'ERROR: &quot;--name&quot; requires a non-empty option argument.' 2&gt;&amp;1
				exit 1
			fi
			name=$2
			shift
			;;
		-|--)
			shift
			break
			;;
		*)
			break
			;;
	esac
	shift
done

echo &quot;file is: $file&quot;
echo &quot;name is: $name&quot;
echo &quot;arguments: $*&quot;
</code></pre>
<p>ä¸€ä¸ªå¤æ‚ä¸€äº›çš„ç¤ºä¾‹ï¼š<a href="https://github.com/lijiaocn/containers/blob/master/docker-nginx-tranproxy/entrypoint.sh#L81">docker-nginx-tranproxy/entrypoint.sh</a></p>
<h2 id="å˜é‡å€¼è¯»å–"><a class="header" href="#å˜é‡å€¼è¯»å–">å˜é‡å€¼è¯»å–</a></h2>
<p>Bash çš„å˜é‡å€¼è¯»å–æ”¯æŒå¾ˆå¤šæ‰©å±•æ–¹å¼ï¼ˆParameter Expansionï¼‰ã€‚</p>
<h3 id="æœªå®šä¹‰å˜é‡"><a class="header" href="#æœªå®šä¹‰å˜é‡">æœªå®šä¹‰å˜é‡</a></h3>
<p>é’ˆå¯¹å˜é‡æ˜¯å¦å®šä¹‰ï¼Œå­˜åœ¨ä»¥ä¸‹å‡ ç§å¤„ç†æ–¹æ³•ï¼š</p>
<pre><code class="language-sh">${parameter:-word}:  å¦‚æœå˜é‡æ²¡æœ‰å®šä¹‰æˆ–è€… nullï¼Œè¿”å›é»˜è®¤å€¼ word
${parameter:=word}:  å¦‚æœå˜é‡æ²¡æœ‰å®šä¹‰æˆ–è€… nullï¼Œä¸ºå˜é‡èµ‹å€¼ wordï¼Œå¹¶è¿”å› word
${parameter:?word}:  å¦‚æœå˜é‡æ²¡æœ‰å®šä¹‰æˆ–è€… nullï¼Œåœ¨é”™è¯¯è¾“å‡ºä¸­æ˜¾ç¤º word
${parameter:+word}:  å¦‚æœå®šä¹‰å˜é‡ï¼Œæ³¨æ„æ˜¯æ˜¯å®šä¹‰äº†ï¼ç”¨ word æ›¿ä»£ï¼ˆè¿”å› wordï¼‰
</code></pre>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="language-sh">echo &quot;æœªå®šä¹‰çš„å˜é‡ï¼Œä½¿ç”¨é»˜è®¤å€¼ï¼š${notdef1:-word}  $notdef1&quot;
echo &quot;æœªå®šä¹‰çš„å˜é‡ï¼Œèµ‹å€¼é»˜è®¤å€¼ï¼š${notdef2:=word}  $notdef2&quot;
echo &quot;å·²å®šä¹‰çš„å˜é‡ï¼Œä½¿ç”¨æ›¿ä»£æ•°å€¼ï¼š${notdef2:+valueinstead}&quot;
echo &quot;æœªå®šä¹‰çš„å˜é‡ï¼Œæ‰“å°é”™è¯¯ä¿¡æ¯ï¼š${notdef3:?notdef}&quot;
</code></pre>
<p>æ‰§è¡Œç»“æœä¸ºï¼š</p>
<pre><code class="language-sh">æœªå®šä¹‰çš„å˜é‡ï¼Œä½¿ç”¨é»˜è®¤å€¼ï¼šword
æœªå®šä¹‰çš„å˜é‡ï¼Œèµ‹å€¼é»˜è®¤å€¼ï¼šword  word
å·²å®šä¹‰çš„å˜é‡ï¼Œä½¿ç”¨æ›¿ä»£æ•°å€¼ï¼švalueinstead
./variable.sh: line 13: notdef3: notdef
</code></pre>
<h3 id="å­—ç¬¦ä¸²å¤„ç†"><a class="header" href="#å­—ç¬¦ä¸²å¤„ç†">å­—ç¬¦ä¸²å¤„ç†</a></h3>
<p>å¦‚æœå˜é‡çš„å€¼æ˜¯å­—ç¬¦ä¸²ï¼Œåœ¨è¯»å–æ—¶å¯ä»¥ç›´æ¥è¿›è¡Œå¤„ç†ã€‚</p>
<p>ä¸‹é¢çš„ç”¨æ³•å¯¹éå­—ç¬¦ä¸²å˜é‡ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼Œè­¬å¦‚<code>@</code>å’Œ<code>*</code>ï¼Œè­¬å¦‚æ•°ç»„ï¼Œæ“ä½œå«ä¹‰ä¹Ÿç›¸åº”å˜åŒ–ï¼Œå˜é‡ä¸ºå­—ç¬¦ä¸²æ—¶ï¼Œè¿™äº›æ“ä½œçš„å«ä¹‰æ˜¯æœ€å¥½ç†è§£çš„ï¼š</p>
<pre><code class="language-sh">${parameter:offset}         :ç¬¬ä¸€ä¸ªå­—ç¬¦ä»¥åçš„å­—ç¬¦ï¼Œä¸åŒ…æ‹¬ç¬¬ä¸€ä¸ª
${parameter:offset:length}  :ç¬¬ä¸€ä¸ªå­—ç¬¦ä»¥åçš„ä¸¤ä¸ªå­—ç¬¦ï¼Œä¸åŒ…æ‹¬ç¬¬ä¸€ä¸ª

 :å¦‚æœå˜é‡æ˜¯ @ï¼Œæ˜¾ç¤ºä» offset å¼€å§‹çš„ length ä¸ªå‘½ä»¤è¡Œå‚æ•°
 :å¦‚æœå˜é‡æ˜¯ Array[@] æˆ– Array[*] ï¼Œæ˜¾ç¤ºä» offset å¼€å§‹çš„ length ä¸ªæ•°ç»„æˆå‘˜

${#parameter}               :å­—ç¬¦ä¸²é•¿åº¦

 :å¦‚æœå˜é‡æ˜¯ @ æˆ– *ï¼Œè¿”å›å‘½ä»¤è¡Œå‚æ•°ä¸ªæ•°
 :å¦‚æœå˜é‡æ˜¯ Array[@] æˆ– Array[*]ï¼Œè¿”å›æ•°ç»„çš„æˆå‘˜æ•°é‡

${parameter#word}           :ä»å­—ç¬¦ä¸²å¤´å¼€å§‹ï¼Œå»æ‰ word åŒ¹é…çš„éƒ¨åˆ†ï¼Œæœ€çŸ­åŒ¹é…
${parameter##word}          :ä»å­—ç¬¦ä¸²å¤´å¼€å§‹ï¼Œå»æ‰ word åŒ¹é…çš„éƒ¨åˆ†ï¼Œæœ€é•¿åŒ¹é…
${parameter%word}           :ä»å­—ç¬¦ä¸²å°¾å¼€å§‹ï¼Œå»æ‰ word åŒ¹é…çš„éƒ¨åˆ†ï¼Œæœ€çŸ­åŒ¹é…
${parameter%%word}          :ä»å­—ç¬¦ä¸²å°¾å¼€å§‹ï¼Œå»æ‰ word åŒ¹é…çš„éƒ¨åˆ†ï¼Œæœ€é•¿åŒ¹é…
${parameter/pattern/string} :å­—ç¬¦åæ¢ï¼Œé»˜è®¤åªæ›¿æ¢ç¬¬ä¸€ä¸ª
                             pattern ä»¥ &quot;/&quot; å¼€å¤´ï¼Œå…¨æ›¿æ¢
                             pattern ä»¥ &quot;#&quot; å¼€å¤´ï¼Œä»é¦–å­—æ¯å¼€å§‹åŒ¹é…
                             pattern ä»¥ &quot;%&quot; å¼€å¤´ï¼Œä»å°¾å­—æ¯å¼€å§‹åŒ¹é…

 :å¦‚æœå˜é‡æ˜¯ @ æˆ– *ï¼Œå¯¹æ‰€æœ‰å‘½ä»¤è¡Œå‚æ•°è¿›è¡Œå¤„ç†ï¼Œè¿”å›å¤„ç†åçš„åˆ—è¡¨
 :å¦‚æœå˜é‡æ˜¯ Array[@] æˆ– Array[*]ï¼Œå¯¹æ•°ç»„æ‰€æœ‰æˆå‘˜è¿›è¡Œå¤„ç†ï¼Œè¿”å›å¤„ç†åçš„åˆ—è¡¨
</code></pre>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="language-sh">str=&quot;abcddeddfghijka&quot;

echo &quot;ç¬¬0ä¸ªå­—ç¬¦å: ${str:0}&quot;
echo &quot;ç¬¬1ä¸ªå­—ç¬¦å: ${str:1}&quot;
echo &quot;ç¬¬1ä¸ªå­—ç¬¦åçš„ä¸¤ä¸ªå­—ç¬¦: ${str:1:2}&quot;

echo &quot;å­—ç¬¦ä¸²é•¿åº¦ï¼š${#str}&quot;

echo &quot;head match #abc: ${str#abc}&quot;
echo &quot;head match ##abc: ${str##abc}&quot;

echo &quot;head match #abc*: ${str#abc*}&quot;
echo &quot;head match ##abc*: ${str##abc*}&quot;

echo &quot;tail match %ijk: ${str%ijk}&quot;
echo &quot;tail match %%ijk: ${str%%ijk}&quot;

echo &quot;tail match %*ijk: ${str%*ijk}&quot;
echo &quot;tail match %%*ijk: ${str%%*ijk}&quot;

echo &quot;replace /d/Dï¼ˆæ›¿æ¢ä¸€ä¸ªï¼‰: ${str/d/D}&quot;
echo &quot;replace //d/Dï¼ˆå…¨éƒ¨æ›¿æ¢ï¼‰: ${str//d/D}&quot;
echo &quot;replace /#a/Aï¼ˆä»å¼€å§‹å¤„åŒ¹é…æ›¿æ¢ï¼‰: ${str/#a/A}&quot;
echo &quot;replace /%a/Aï¼ˆä»ç»“å°¾å¤„åŒ¹é…æ›¿æ¢ï¼‰: ${str/%a/A}&quot;
</code></pre>
<p>æ‰§è¡Œç»“æœä¸ºï¼š</p>
<pre><code class="language-sh">ç¬¬0ä¸ªå­—ç¬¦å: abcddeddfghijka
ç¬¬1ä¸ªå­—ç¬¦å: bcddeddfghijka
ç¬¬1ä¸ªå­—ç¬¦åçš„ä¸¤ä¸ªå­—ç¬¦: bc
å­—ç¬¦ä¸²é•¿åº¦ï¼š15
head match #abc: ddeddfghijka
head match ##abc: ddeddfghijka
head match #abc*: ddeddfghijka
head match ##abc*:
tail match %ijk: abcddeddfghijka
tail match %%ijk: abcddeddfghijka
tail match %*ijk: abcddeddfghijka
tail match %%*ijk: abcddeddfghijka
replace /d/Dï¼ˆæ›¿æ¢ä¸€ä¸ªï¼‰: abcDdeddfghijka
replace //d/Dï¼ˆå…¨éƒ¨æ›¿æ¢ï¼‰: abcDDeDDfghijka
replace /#a/Aï¼ˆä»å¼€å§‹å¤„åŒ¹é…æ›¿æ¢ï¼‰: Abcddeddfghijka
replace /%a/Aï¼ˆä»ç»“å°¾å¤„åŒ¹é…æ›¿æ¢ï¼‰: abcddeddfghijkA
</code></pre>
<h3 id="è¯»å–å˜é‡å"><a class="header" href="#è¯»å–å˜é‡å">è¯»å–å˜é‡å</a></h3>
<p>æ³¨æ„è¯»å–çš„æ˜¯å˜é‡çš„åå­—ï¼Œä¸æ˜¯å˜é‡å€¼ï¼Œ</p>
<pre><code class="language-sh">${!prefix*}ï¼Œ${!prefix@}: è¿”å›ä»¥ prefix ä¸ºå‰ç¼€çš„å·²ç»å®šä¹‰çš„å˜é‡å
</code></pre>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="language-sh">prefixV1=&quot;a&quot;
prefixV2=&quot;b&quot;
prefixV3=&quot;c&quot;

echo ${!prefix*}
echo ${!prefix@}
</code></pre>
<p>æ‰§è¡Œç»“æœä¸ºï¼š</p>
<pre><code class="language-sh">prefixV1 prefixV2 prefixV3
prefixV1 prefixV2 prefixV3
</code></pre>
<h3 id="è¯»å–æ•°ç»„ä¿¡æ¯"><a class="header" href="#è¯»å–æ•°ç»„ä¿¡æ¯">è¯»å–æ•°ç»„ä¿¡æ¯</a></h3>
<p>è§æ•°ç»„ç« èŠ‚ã€‚</p>
<pre><code class="language-sh">${!name[@]}ï¼Œ${!name[*]}ï¼šè¯»å–æ•°ç»„çš„ key å€¼
</code></pre>
<h2 id="æ•°ç»„"><a class="header" href="#æ•°ç»„">æ•°ç»„</a></h2>
<p>ä½¿ç”¨ä¸‹é¢çš„å½¢å¼èµ‹äºˆå€¼æ—¶ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºæ•°ç»„å˜é‡ï¼š</p>
<pre><code class="language-sh">array[&quot;0&quot;]=&quot;value0&quot;
array[&quot;1&quot;]=&quot;value1&quot;
array[&quot;2&quot;]=&quot;value2&quot;
array[&quot;5&quot;]=&quot;value5&quot;
</code></pre>
<p>å¦‚æœè¦å£°æ˜ä¸€ä¸ªæ•°ç»„ç±»å‹çš„å˜é‡ï¼Œç”¨ declare -a å£°æ˜ï¼š</p>
<pre><code class="language-sh"># å£°æ˜æ•°ç»„å˜é‡ array
declare -a array
</code></pre>
<p>ç”¨ä¸‹é¢çš„æ–¹å¼ç”Ÿæˆä¸€ä¸ªå¸¦æœ‰å€¼æ•°ç»„å˜é‡ï¼š</p>
<pre><code class="language-sh">array=(&quot;value0&quot; &quot;value1&quot; &quot;value2&quot; &quot;value3&quot;)
</code></pre>
<p>è¯»å–æ•°ç»„ä¸­æŒ‡å®šä½ç½®çš„å€¼ï¼š</p>
<pre><code class="language-sh">echo ${array[1]}
</code></pre>
<p>è¯»å–æ•°ç»„çš„ä¿¡æ¯ï¼š</p>
<pre><code class="language-sh"># æ‰“å°æ•°ç»„ä¸­çš„æ‰€æœ‰å€¼
for i in ${array[@]}
do
    echo &quot;data: $i&quot;
done

# æ‰“å°æ•°ç»„ä¸­æœ‰å€¼çš„ index
for i in ${!array[@]}
do
    echo &quot;index: $i&quot;
done

# æ‰“å°æ•°ç»„å†…å…ƒç´ ä¸ªæ•°
echo &quot;array size: ${#array[@]}&quot;
</code></pre>
<h2 id="å‚è€ƒ-1"><a class="header" href="#å‚è€ƒ-1">å‚è€ƒ</a></h2>
<ol>
<li><a href="https://www.lijiaocn.com" title="æä½¶æ¾³çš„åšå®¢">æä½¶æ¾³çš„åšå®¢</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="å¸¸ç”¨çš„-bash-å†…ç½®çš„å‘½ä»¤"><a class="header" href="#å¸¸ç”¨çš„-bash-å†…ç½®çš„å‘½ä»¤">å¸¸ç”¨çš„ Bash å†…ç½®çš„å‘½ä»¤</a></h1>
<p>Bash æœ‰å¾ˆå¤šå†…ç½®å‘½ä»¤ï¼Œè­¬å¦‚ <code>:</code>ã€<code>.</code>ã€<code>source</code>ã€<code>alias</code>ã€<code>bg</code> ç­‰ã€‚</p>
<h2 id="trap"><a class="header" href="#trap">trap</a></h2>
<p>è®¾ç½®ä¿¡å·å¤„ç†å‡½æ•°ï¼Œä¿¡å·å‘ç”Ÿåï¼Œè§¦å‘å‡½æ•°çš„æ‰§è¡Œã€‚</p>
<p>é™¤äº†æ”¯æŒ <code>man signal</code> ä¸­åˆ—å‡ºçš„ 32 ä¸ªç³»ç»Ÿä¿¡å·ï¼Œè¿˜æ”¯æŒ DEBUGã€ERRã€EXITï¼Œåˆ†åˆ«åœ¨æ¯ä¸ªå‘½ä»¤æ‰§è¡Œå‰åè§¦å‘ã€å‡ºé”™æ—¶è§¦å‘ã€é€€å‡ºæ—¶è§¦å‘ã€‚</p>
<pre><code class="language-sh">function debug {
   echo &quot;DEBUG&quot;
}
trap debug DEBUG

function err {
   echo &quot;ERR&quot;
}
trap err ERR

function cleanup {
   echo &quot;EXIT&quot;
}
trap cleanup EXIT

echo &quot;exec command...&quot;
ls /noexit
</code></pre>
<p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code class="language-sh">DEBUG
DEBUG
DEBUG
exec command...
DEBUG
ls: /noexit: No such file or directory
DEBUG
ERR
DEBUG
EXIT
</code></pre>
<h2 id="å‚è€ƒ-2"><a class="header" href="#å‚è€ƒ-2">å‚è€ƒ</a></h2>
<ol>
<li><a href="https://www.lijiaocn.com" title="æä½¶æ¾³çš„åšå®¢">æä½¶æ¾³çš„åšå®¢</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cè¯­è¨€é€ŸæŸ¥æ‰‹å†Œ"><a class="header" href="#cè¯­è¨€é€ŸæŸ¥æ‰‹å†Œ">Cè¯­è¨€é€ŸæŸ¥æ‰‹å†Œ</a></h1>
<p>Cè¯­è¨€ç¼–ç¨‹ï¼ˆè¿™é‡Œç‰¹æŒ‡linux cï¼‰ä¸­ï¼Œæœ€å¸¸ç”¨çš„èµ„æ–™æ˜¯manæ‰‹å†Œå’Œå¤´æ–‡ä»¶ã€‚</p>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="cè¯­è¨€ä¸­çš„å­—ç¬¦ä¸²æ“ä½œ"><a class="header" href="#cè¯­è¨€ä¸­çš„å­—ç¬¦ä¸²æ“ä½œ">Cè¯­è¨€ä¸­çš„å­—ç¬¦ä¸²æ“ä½œ</a></h1>
<p>ç¼–ç¨‹è¿‡ç¨‹ä¸­ï¼Œå¦‚æœä¸æ˜¯åœ¨å¤„ç†æ•°å€¼ï¼Œå°±æ˜¯åœ¨å¤„ç†å­—ç¬¦ä¸²ã€‚  by me ...</p>
<h2 id="å­—ç¬¦ä¸²é•¿åº¦"><a class="header" href="#å­—ç¬¦ä¸²é•¿åº¦">å­—ç¬¦ä¸²é•¿åº¦</a></h2>
<p><code>man strlen</code>ã€<code>man strnlen</code></p>
<pre><code class="language-c">#include &lt;string.h&gt;

size_t strlen(const char *s);
size_t strnlen(const char *s, size_t maxlen);
</code></pre>
<p><code>man wcslen</code>ã€<code>man wcsnlen</code></p>
<pre><code class="language-c">#include &lt;wchar.h&gt;

size_t wcslen(const wchar_t *s);
size_t wcsnlen(const wchar_t *s, size_t maxlen);
</code></pre>
<h2 id="å­—ç¬¦ä¸²æ¯”è¾ƒ"><a class="header" href="#å­—ç¬¦ä¸²æ¯”è¾ƒ">å­—ç¬¦ä¸²æ¯”è¾ƒ</a></h2>
<p><code>man strcmp</code></p>
<pre><code class="language-c">#include &lt;string.h&gt;

int strcmp(const char *s1, const char *s2);

int strncmp(const char *s1, const char *s2, size_t n);
</code></pre>
<h2 id="å­—ç¬¦ä¸²å¤åˆ¶"><a class="header" href="#å­—ç¬¦ä¸²å¤åˆ¶">å­—ç¬¦ä¸²å¤åˆ¶</a></h2>
<p><code>man strdup</code></p>
<pre><code class="language-c">#include &lt;string.h&gt;

char *strdup(const char *s);

char *strndup(const char *s, size_t n);
char *strdupa(const char *s);
char *strndupa(const char *s, size_t n);
</code></pre>
<p>æ³¨æ„è¿”å›çš„æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡é’ˆæŒ‡å‘çš„å†…å­˜æ˜¯ç”¨mallocå‡½æ•°åˆ†é…çš„ï¼Œä¸å†ä½¿ç”¨çš„æ—¶å€™éœ€è¦è°ƒç”¨freeå‡½æ•°é‡Šæ”¾ã€‚</p>
<h2 id="æŒ‰ç…§æŒ‡å®šçš„åˆ†éš”ç¬¦å°†å­—ç¬¦ä¸²åˆ†å‰²"><a class="header" href="#æŒ‰ç…§æŒ‡å®šçš„åˆ†éš”ç¬¦å°†å­—ç¬¦ä¸²åˆ†å‰²">æŒ‰ç…§æŒ‡å®šçš„åˆ†éš”ç¬¦ï¼Œå°†å­—ç¬¦ä¸²åˆ†å‰²</a></h2>
<p><code>man strtok</code></p>
<pre><code class="language-c">#include &lt;string.h&gt;

char *strtok(char *str, const char *delim);

char *strtok_r(char *str, const char *delim, char **saveptr);
</code></pre>
<p><strong>æ³¨æ„</strong>ï¼š</p>
<ol>
<li>strtokæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œçº¿ç¨‹å®‰å…¨éœ€è¦ä½¿ç”¨strtok_rã€‚</li>
<li>ä¼ å…¥çš„å­—ç¬¦ä¸²çš„å†…å®¹ä¼šè¢«æ”¹å†™ï¼Œç”¨<code>\0</code>åˆ†å‰²æˆäº†å¤šä¸ªtokenï¼Œå¦‚æœéœ€è¦ä¿ç•™åŸå…ˆå­—ç¬¦ä¸²ï¼Œéœ€è¦å¤åˆ¶ä¿ç•™ã€‚</li>
</ol>
<p>ç¤ºä¾‹1ï¼š</p>
<pre><code class="language-c">#include &lt;stdio.h&gt;
#include &lt;string.h&gt;

int main(int argc, char *argv[])
{
    char str[100];
    sprintf(str,&quot;a b c d e f&quot;);
    char *delim = &quot; &quot;;
    char *token = NULL;

    token = strtok(str, delim);
    while (NULL != token) {
        printf(&quot;%s\n&quot;, token);
        token = strtok(NULL, delim);
    }

    return 0;
}
</code></pre>
<p>ç¤ºä¾‹2:</p>
<pre><code class="language-c">/*
 * main.c
 * Copyright (C) 2019 lijiaocn &lt;lijiaocn@foxmail.com&gt;
 *
 * Distributed under terms of the GPL license.
 */

#include &lt;stdio.h&gt;
#include &lt;string.h&gt;

#define str_iterate_parts(__iterator, __splitme, __separators)            \
    for (char *__p = NULL, *__it = strtok_r(__splitme, __separators, &amp;__p); \
            (__iterator = __it);                                            \
            __iterator = __it = strtok_r(NULL, __separators, &amp;__p))

int main(int argc, char *argv[])
{
	char str[100];
	sprintf(str,&quot;a b c d e f&quot;);
	printf(&quot;before: %s\n&quot;, str);
	char *delim = &quot; &quot;;
	char *token = NULL;
	char *saveptr = NULL;

/*
	token = strtok_r(str, delim, &amp;saveptr);
	while (NULL != token) {
		printf(&quot;%s\n&quot;, token);
		token = strtok_r(NULL, delim, &amp;saveptr);
	}
*/

	int i = 0;
	str_iterate_parts(token, str, delim){
		if (i &gt;= 3 ) break;
		printf(&quot;%s\n&quot;, token);
		i++;
	}
	printf(&quot;after : %s\n&quot;, str);

	return 0;
}
</code></pre>
<h2 id="å®šä½æŒ‡å®šå­—ç¬¦"><a class="header" href="#å®šä½æŒ‡å®šå­—ç¬¦">å®šä½æŒ‡å®šå­—ç¬¦</a></h2>
<pre><code class="language-c">#include &lt;string.h&gt;

char *strchr(const char *s, int c);

char *strrchr(const char *s, int c);

#define _GNU_SOURCE         /* See feature_test_macros(7) */
#include &lt;string.h&gt;

char *strchrnul(const char *s, int c);
</code></pre>
<h2 id="å®šä½å­å­—ç¬¦ä¸²"><a class="header" href="#å®šä½å­å­—ç¬¦ä¸²">å®šä½å­å­—ç¬¦ä¸²</a></h2>
<pre><code class="language-c">#include &lt;string.h&gt;

char *strstr(const char *haystack, const char *needle);

#define _GNU_SOURCE         /* See feature_test_macros(7) */

#include &lt;string.h&gt;

char *strcasestr(const char *haystack, const char *needle);
</code></pre>
<h2 id="è¾“å…¥å­—ç¬¦ä¸²è½¬æ¢"><a class="header" href="#è¾“å…¥å­—ç¬¦ä¸²è½¬æ¢">è¾“å…¥å­—ç¬¦ä¸²è½¬æ¢</a></h2>
<p><code>man scanf</code> </p>
<pre><code class="language-c">#include &lt;stdio.h&gt;

int scanf(const char *format, ...);
int fscanf(FILE *stream, const char *format, ...);
int sscanf(const char *str, const char *format, ...);

#include &lt;stdarg.h&gt;

int vscanf(const char *format, va_list ap);
int vsscanf(const char *str, const char *format, va_list ap);
int vfscanf(FILE *stream, const char *format, va_list ap);
</code></pre>
<p>fscanfå’Œsscanfå¯èƒ½æœ‰å¦™ç”¨ã€‚</p>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="cè¯­è¨€ä¸­çš„æ—¶é—´æ“ä½œ"><a class="header" href="#cè¯­è¨€ä¸­çš„æ—¶é—´æ“ä½œ">Cè¯­è¨€ä¸­çš„æ—¶é—´æ“ä½œ</a></h1>
<h2 id="è·å–å½“å‰æ—¶é—´"><a class="header" href="#è·å–å½“å‰æ—¶é—´">è·å–å½“å‰æ—¶é—´</a></h2>
<p>è·å–<code>ç›¸å¯¹æŒ‡å®šæ—¶é’Ÿ</code>çš„å½“å‰æ—¶é—´ï¼š</p>
<p><code>man clock_gettime</code></p>
<pre><code class="language-c">#include &lt;time.h&gt;

int clock_getres(clockid_t clk_id, struct timespec *res);

int clock_gettime(clockid_t clk_id, struct timespec *tp);

int clock_settime(clockid_t clk_id, const struct timespec *tp);

Link with -lrt (only for glibc versions before 2.17).
</code></pre>
<p><code>*res</code>æ˜¯è¿”å›çš„å½“å‰æ—¶é—´ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre><code class="language-c">struct timespec {
    time_t   tv_sec;        /* seconds */
    long     tv_nsec;       /* nanoseconds */
};
</code></pre>
<p>æ—¶é’Ÿ<code>clk_id</code>å¯ä»¥å–ä»¥ä¸‹å€¼ï¼š</p>
<p>CLOCK_REALTIMEï¼š</p>
<pre><code>   System-wide  clock  that  measures  real  (i.e., wall-clock) time.  Setting this clock requires
   appropriate privileges.  This clock is affected by  discontinuous  jumps  in  the  system  time
   (e.g.,  if the system administrator manually changes the clock), and by the incremental adjustâ€
   ments performed by adjtime(3) and NTP.
</code></pre>
<p>CLOCK_REALTIME_COARSE (since Linux 2.6.32; Linux-specific)ï¼š</p>
<pre><code>   A faster but less precise version of CLOCK_REALTIME.  Use when you  need  very  fast,  but  not
   fine-grained timestamps.
</code></pre>
<p>CLOCK_MONOTONICï¼š</p>
<pre><code>   Clock  that  cannot be set and represents monotonic time since some unspecified starting
   point.  This clock is not affected by discontinuous jumps in the system time  (e.g.,  if
   the system administrator manually changes the clock), but is affected by the incremental
   adjustments performed by adjtime(3) and NTP.
</code></pre>
<p>CLOCK_MONOTONIC_COARSE (since Linux 2.6.32; Linux-specific)ï¼š</p>
<pre><code>   A faster but less precise version of CLOCK_MONOTONIC.  Use when you need very fast,  but
   not fine-grained timestamps.
</code></pre>
<p>CLOCK_MONOTONIC_RAW (since Linux 2.6.28; Linux-specific)ï¼š</p>
<pre><code>   Similar to CLOCK_MONOTONIC, but provides access to a raw hardware-based time that is not
   subject to NTP adjustments or the incremental adjustments performed by adjtime(3).
</code></pre>
<p>CLOCK_BOOTTIME (since Linux 2.6.39; Linux-specific)ï¼š</p>
<pre><code>   Identical to CLOCK_MONOTONIC, except it also includes any time that the system  is  susâ€
   pended.   This allows applications to get a suspend-aware monotonic clock without having
   to deal with the complications of CLOCK_REALTIME, which may have discontinuities if  the
   time is changed using settimeofday(2).
</code></pre>
<p>CLOCK_PROCESS_CPUTIME_IDï¼š</p>
<pre><code>   High-resolution per-process timer from the CPU.
</code></pre>
<p>CLOCK_THREAD_CPUTIME_IDï¼š</p>
<pre><code>   Thread-specific CPU-time clock.
</code></pre>
<p>å…¶ä¸­<code>CLOCK_BOOTTIME</code>å¯ä»¥ç®€å•ç†è§£ä¸ºç³»ç»Ÿå¯åŠ¨ä»¥åè¿‡å»çš„æ—¶é—´ï¼Œ<a href="https://lwn.net/Articles/420142/">Introduce CLOCK_BOOTTIME </a>ã€‚</p>
<h2 id="è·å–æŒ‡å®šè¿›ç¨‹çš„å¯åŠ¨æ—¶é—´å’Œè¿è¡Œæ—¶é•¿"><a class="header" href="#è·å–æŒ‡å®šè¿›ç¨‹çš„å¯åŠ¨æ—¶é—´å’Œè¿è¡Œæ—¶é•¿">è·å–æŒ‡å®šè¿›ç¨‹çš„å¯åŠ¨æ—¶é—´å’Œè¿è¡Œæ—¶é•¿</a></h2>
<p><a href="https://github.com/lxc/lxcfs">lxcfs</a>ä¸­çš„åšæ³•ï¼Œé€‚ç”¨äºlinuxã€‚</p>
<p><code>/proc/[PID]/stat</code>æ–‡ä»¶çš„ç¬¬22ä¸ªå­—æ®µæ˜¯è¿›ç¨‹åˆ›å»ºæ—¶é—´ï¼Œå•ä½æ˜¯ç³»ç»Ÿæ—¶é’Ÿå˜€å—’æ•°ï¼š</p>
<pre><code>starttime %llu (was %lu before Linux 2.6)
    (22)  The  time  the process started after system boot.  In kernels before Linux 2.6, this value was expressed in jiffies.  
    Since Linux 2.6, the value is expressed in clock ticks (divide by sysconf(_SC_CLK_TCK)).
</code></pre>
<p>å°†å…¶å–å‡ºåé™¤ä»¥ç³»ç»Ÿçš„æ—¶é’Ÿé¢‘ç‡ï¼Œå¾—åˆ°çš„å°±æ˜¯ä»¥ç§’ä¸ºå•ä½çš„å¯åŠ¨æ—¶é—´ï¼Œè¿™ä¸ªæ—¶é—´æ˜¯ç›¸å¯¹äºç³»ç»Ÿå¯åŠ¨æ—¶é—´çš„ï¼Œå®ç°å¦‚ä¸‹ï¼š</p>
<pre><code class="language-c">static uint64_t get_reaper_start_time_in_sec(pid_t pid)
{
    uint64_t clockticks;
    int64_t ticks_per_sec;

    clockticks = get_reaper_start_time(pid);
    if (clockticks == 0 &amp;&amp; errno == EINVAL) {
        lxcfs_debug(&quot;failed to retrieve start time of pid %d\n&quot;, pid);
        return 0;
    }

    ticks_per_sec = sysconf(_SC_CLK_TCK);
    if (ticks_per_sec &lt; 0 &amp;&amp; errno == EINVAL) {
        lxcfs_debug(
            &quot;%s\n&quot;,
            &quot;failed to determine number of clock ticks in a second&quot;);
        return 0;
    }

    return (clockticks /= ticks_per_sec);
}
</code></pre>
<p>å‡½æ•°<code>sysconf()</code>çš„ç”¨æ³•è§ï¼š<a href="https://www.lijiaocn.com/programming/chapter-c/sysconfig.html#sysconf">ç³»ç»Ÿé…ç½®-&gt;sysconf</a>ã€‚</p>
<p><code>/proc/[PID]/stat</code>æ–‡ä»¶çš„ç¬¬22ä¸ªå­—æ®µçš„è¯»å–æ–¹æ³•ï¼š</p>
<pre><code class="language-c">static uint64_t get_reaper_start_time(pid_t pid)
{
    int ret;
    FILE *f;
    uint64_t starttime;
    /* strlen(&quot;/proc/&quot;) = 6
     * +
     * LXCFS_NUMSTRLEN64
     * +
     * strlen(&quot;/stat&quot;) = 5
     * +
     * \0 = 1
     * */
#define __PROC_PID_STAT_LEN (6 + LXCFS_NUMSTRLEN64 + 5 + 1)
    char path[__PROC_PID_STAT_LEN];
    pid_t qpid;

    qpid = lookup_initpid_in_store(pid);
    if (qpid &lt;= 0) {
        /* Caller can check for EINVAL on 0. */
        errno = EINVAL;
        return 0;
    }

    ret = snprintf(path, __PROC_PID_STAT_LEN, &quot;/proc/%d/stat&quot;, qpid);
    if (ret &lt; 0 || ret &gt;= __PROC_PID_STAT_LEN) {
        /* Caller can check for EINVAL on 0. */
        errno = EINVAL;
        return 0;
    }

    f = fopen(path, &quot;r&quot;);
    if (!f) {
        /* Caller can check for EINVAL on 0. */
        errno = EINVAL;
        return 0;
    }

    /* Note that the *scanf() argument supression requires that length
     * modifiers such as &quot;l&quot; are omitted. Otherwise some compilers will yell
     * at us. It's like telling someone you're not married and then asking
     * if you can bring your wife to the party.
     */
    ret = fscanf(f, &quot;%*d &quot;      /* (1)  pid         %d   */
            &quot;%*s &quot;      /* (2)  comm        %s   */
            &quot;%*c &quot;      /* (3)  state       %c   */
            &quot;%*d &quot;      /* (4)  ppid        %d   */
            &quot;%*d &quot;      /* (5)  pgrp        %d   */
            &quot;%*d &quot;      /* (6)  session     %d   */
            &quot;%*d &quot;      /* (7)  tty_nr      %d   */
            &quot;%*d &quot;      /* (8)  tpgid       %d   */
            &quot;%*u &quot;      /* (9)  flags       %u   */
            &quot;%*u &quot;      /* (10) minflt      %lu  */
            &quot;%*u &quot;      /* (11) cminflt     %lu  */
            &quot;%*u &quot;      /* (12) majflt      %lu  */
            &quot;%*u &quot;      /* (13) cmajflt     %lu  */
            &quot;%*u &quot;      /* (14) utime       %lu  */
            &quot;%*u &quot;      /* (15) stime       %lu  */
            &quot;%*d &quot;      /* (16) cutime      %ld  */
            &quot;%*d &quot;      /* (17) cstime      %ld  */
            &quot;%*d &quot;      /* (18) priority    %ld  */
            &quot;%*d &quot;      /* (19) nice        %ld  */
            &quot;%*d &quot;      /* (20) num_threads %ld  */
            &quot;%*d &quot;      /* (21) itrealvalue %ld  */
            &quot;%&quot; PRIu64, /* (22) starttime   %llu */
             &amp;starttime);
    if (ret != 1) {
        fclose(f);
        /* Caller can check for EINVAL on 0. */
        errno = EINVAL;
        return 0;
    }

    fclose(f);

    errno = 0;
    return starttime;
}
</code></pre>
<p>ç”¨å½“å‰æ—¶é—´å‡å»è¿›ç¨‹çš„å¯åŠ¨æ—¶é—´ï¼Œå°±æ˜¯è¿›ç¨‹çš„è¿è¡Œæ—¶é•¿ï¼Œå½“å‰æ—¶é—´éœ€è¦æ˜¯ç›¸å¯¹ç³»ç»Ÿå¯åŠ¨çš„æ—¶é—´ï¼Œç”¨ç³»ç»Ÿè°ƒç”¨<code>clock_gettime()</code>è·å–ï¼š</p>
<pre><code class="language-c">static uint64_t get_reaper_age(pid_t pid)
{
    uint64_t procstart, uptime, procage;

    /* We need to substract the time the process has started since system
     * boot minus the time when the system has started to get the actual
     * reaper age.
     */
    procstart = get_reaper_start_time_in_sec(pid);
    procage = procstart;
    if (procstart &gt; 0) {
        int ret;
        struct timespec spec;

        ret = clock_gettime(CLOCK_BOOTTIME, &amp;spec);
        if (ret &lt; 0)
            return 0;
        /* We could make this more precise here by using the tv_nsec
         * field in the timespec struct and convert it to milliseconds
         * and then create a double for the seconds and milliseconds but
         * that seems more work than it is worth.
         */
        uptime = spec.tv_sec;
        procage = uptime - procstart;
    }

    return procage;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="åŠ¨æ€é“¾æ¥åº“æ“ä½œ"><a class="header" href="#åŠ¨æ€é“¾æ¥åº“æ“ä½œ">åŠ¨æ€é“¾æ¥åº“æ“ä½œ</a></h1>
<h2 id="æ‰“å¼€å…³é—­åŠ¨æ€é“¾æ¥åº“"><a class="header" href="#æ‰“å¼€å…³é—­åŠ¨æ€é“¾æ¥åº“">æ‰“å¼€/å…³é—­åŠ¨æ€é“¾æ¥åº“</a></h2>
<pre><code class="language-c">#include &lt;dlfcn.h&gt;

void *dlopen(const char *filename, int flag);

int dlclose(void *handle);
</code></pre>
<h2 id="è¯»å–åŠ¨æ€é“¾æ¥åº“çš„æ“ä½œé”™è¯¯"><a class="header" href="#è¯»å–åŠ¨æ€é“¾æ¥åº“çš„æ“ä½œé”™è¯¯">è¯»å–åŠ¨æ€é“¾æ¥åº“çš„æ“ä½œé”™è¯¯</a></h2>
<pre><code class="language-c">#include &lt;dlfcn.h&gt;

char *dlerror(void);
</code></pre>
<h2 id="è·å–åŠ¨æ€é“¾æ¥åº“ä¸­çš„ç¬¦å·åœ°å€"><a class="header" href="#è·å–åŠ¨æ€é“¾æ¥åº“ä¸­çš„ç¬¦å·åœ°å€">è·å–åŠ¨æ€é“¾æ¥åº“ä¸­çš„ç¬¦å·åœ°å€</a></h2>
<pre><code class="language-c">#include &lt;dlfcn.h&gt;

void *dlsym(void *handle, const char *symbol);
</code></pre>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="language-c">static int do_proc_open(const char *path, struct fuse_file_info *fi)
{
    int (*proc_open)(const char *path, struct fuse_file_info *fi);
    char *error;
    dlerror();    /* Clear any existing error */
    proc_open = (int (*)(const char *path, struct fuse_file_info *fi)) dlsym(dlopen_handle, &quot;proc_open&quot;);
    error = dlerror();
    if (error != NULL) {
        lxcfs_error(&quot;%s\n&quot;, error);
        return -1;
    }

    return proc_open(path, fi);
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="ä¿¡å·é‡æ“ä½œ"><a class="header" href="#ä¿¡å·é‡æ“ä½œ">ä¿¡å·é‡æ“ä½œ</a></h1>
<h2 id="ä¿¡å·é‡åˆ—è¡¨"><a class="header" href="#ä¿¡å·é‡åˆ—è¡¨">ä¿¡å·é‡åˆ—è¡¨</a></h2>
<p><code>man 7 signal</code></p>
<pre><code class="language-bash">Signal     Value     Action   Comment
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SIGHUP        1       Term    Hangup detected on controlling terminal
                              or death of controlling process
SIGINT        2       Term    Interrupt from keyboard
SIGQUIT       3       Core    Quit from keyboard
SIGILL        4       Core    Illegal Instruction
SIGABRT       6       Core    Abort signal from abort(3)
SIGFPE        8       Core    Floating point exception
SIGKILL       9       Term    Kill signal
SIGSEGV      11       Core    Invalid memory reference
SIGPIPE      13       Term    Broken pipe: write to pipe with no
                              readers
SIGALRM      14       Term    Timer signal from alarm(2)
SIGTERM      15       Term    Termination signal
SIGUSR1   30,10,16    Term    User-defined signal 1
SIGUSR2   31,12,17    Term    User-defined signal 2
SIGCHLD   20,17,18    Ign     Child stopped or terminated
SIGCONT   19,18,25    Cont    Continue if stopped
SIGSTOP   17,19,23    Stop    Stop process
SIGTSTP   18,20,24    Stop    Stop typed at terminal
SIGTTIN   21,21,26    Stop    Terminal input for background process
SIGTTOU   22,22,27    Stop    Terminal output for background process
</code></pre>
<h2 id="ä¿¡å·é‡æ•è·"><a class="header" href="#ä¿¡å·é‡æ•è·">ä¿¡å·é‡æ•è·</a></h2>
<p><code>man signal</code></p>
<pre><code class="language-c">#include &lt;signal.h&gt;

typedef void (*sighandler_t)(int);

sighandler_t signal(int signum, sighandler_t handler);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="å†…å­˜ç®¡ç†æ“ä½œ"><a class="header" href="#å†…å­˜ç®¡ç†æ“ä½œ">å†…å­˜ç®¡ç†æ“ä½œ</a></h1>
<h2 id="ä»æ ˆä¸Šåˆ†é…ä¼šè‡ªåŠ¨å›æ”¶çš„å†…å­˜"><a class="header" href="#ä»æ ˆä¸Šåˆ†é…ä¼šè‡ªåŠ¨å›æ”¶çš„å†…å­˜">ä»æ ˆä¸Šåˆ†é…ä¼šè‡ªåŠ¨å›æ”¶çš„å†…å­˜</a></h2>
<p><code>man alloca</code></p>
<pre><code class="language-c">#include &lt;alloca.h&gt;

void *alloca(size_t size);
</code></pre>
<p>è¿™ä¸ªå‡½æ•°éœ€è¦ç‰¹æ„è¯´æ˜ä¸€ä¸‹ï¼Œallocaåˆ†é…çš„æ˜¯è°ƒç”¨å®ƒçš„å‡½æ•°çš„æ ˆä¸­çš„å†…å­˜ï¼Œåœ¨è°ƒç”¨å‡½æ•°è¿”å›æ—¶ï¼Œallocaåˆ†é…çš„å†…å­˜ä¼šéšç€æ ˆç©ºé—´çš„é‡Šæ”¾ä¸€åŒé‡Šæ”¾ã€‚</p>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="æ ¼å¼åŒ–æ‰“å°è¾“å‡º"><a class="header" href="#æ ¼å¼åŒ–æ‰“å°è¾“å‡º">æ ¼å¼åŒ–æ‰“å°è¾“å‡º</a></h1>
<h2 id="printfç³»åˆ—å‡½æ•°"><a class="header" href="#printfç³»åˆ—å‡½æ•°">printfç³»åˆ—å‡½æ•°</a></h2>
<p><code>man 3 printf</code></p>
<pre><code class="language-c">#include &lt;stdio.h&gt;

int printf(const char *format, ...);
int fprintf(FILE *stream, const char *format, ...);
int sprintf(char *str, const char *format, ...);
int snprintf(char *str, size_t size, const char *format, ...);

#include &lt;stdarg.h&gt;

int vprintf(const char *format, va_list ap);
int vfprintf(FILE *stream, const char *format, va_list ap);
int vsprintf(char *str, const char *format, va_list ap);
int vsnprintf(char *str, size_t size, const char *format, va_list ap);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="æ–‡ä»¶è®¾å¤‡æ“ä½œ"><a class="header" href="#æ–‡ä»¶è®¾å¤‡æ“ä½œ">æ–‡ä»¶&amp;è®¾å¤‡æ“ä½œ</a></h1>
<h2 id="æ£€æŸ¥å¯¹æŸä¸ªæ–‡ä»¶çš„æ“ä½œæƒé™"><a class="header" href="#æ£€æŸ¥å¯¹æŸä¸ªæ–‡ä»¶çš„æ“ä½œæƒé™">æ£€æŸ¥å¯¹æŸä¸ªæ–‡ä»¶çš„æ“ä½œæƒé™</a></h2>
<p>æ£€æŸ¥å¯¹ç›¸å¯¹æŸä¸ªç›®å½•ä¸‹çš„æŸæ–‡ä»¶çš„æ“ä½œæƒé™ï¼Œ<code>man faccessat</code>ï¼š</p>
<pre><code class="language-c">#include &lt;fcntl.h&gt; /* Definition of AT_* constants */
#include &lt;unistd.h&gt;

int faccessat(int dirfd, const char *pathname, int mode, int flags);
</code></pre>
<h2 id="è·å–æ–‡ä»¶çŠ¶æ€"><a class="header" href="#è·å–æ–‡ä»¶çŠ¶æ€">è·å–æ–‡ä»¶çŠ¶æ€</a></h2>
<p><code>man 2 stat</code></p>
<pre><code class="language-c">#include &lt;sys/types.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;unistd.h&gt;

int stat(const char *path, struct stat *buf);
int fstat(int fd, struct stat *buf);
int lstat(const char *path, struct stat *buf);
</code></pre>
<p><code>struct stat</code>åœ¨<code>/usr/include/bits/stat.h</code>ä¸­å®šä¹‰ï¼ŒåŸå§‹å®šä¹‰ä¸­ä½¿ç”¨å¾ˆå¤šå®ä¸æ–¹ä¾¿é˜…è¯»ï¼Œå¯ä»¥ç”¨ä»¥ä¸‹å®šä¹‰ä»£æ›¿ï¼š</p>
<pre><code class="language-c">struct stat {
    dev_t     st_dev;     /* ID of device containing file */
    ino_t     st_ino;     /* inode number */
    mode_t    st_mode;    /* protection */
    nlink_t   st_nlink;   /* number of hard links */
    uid_t     st_uid;     /* user ID of owner */
    gid_t     st_gid;     /* group ID of owner */
    dev_t     st_rdev;    /* device ID (if special file) */
    off_t     st_size;    /* total size, in bytes */
    blksize_t st_blksize; /* blocksize for file system I/O */
    blkcnt_t  st_blocks;  /* number of 512B blocks allocated */
    time_t    st_atime;   /* time of last access */
    time_t    st_mtime;   /* time of last modification */
    time_t    st_ctime;   /* time of last status change */
};
</code></pre>
<p>å¯ä»¥ç”¨ä¸‹é¢çš„å®å®šä¹‰åˆ¤æ–­æ–‡ä»¶ç±»å‹ï¼Œä¼ å…¥å‚æ•°æ˜¯statä¸­çš„<code>st_mode</code>ï¼š</p>
<pre><code class="language-c">S_ISREG(m)  is it a regular file?
S_ISDIR(m)  directory?
S_ISCHR(m)  character device?
S_ISBLK(m)  block device?
S_ISFIFO(m) FIFO (named pipe)?
S_ISLNK(m)  symbolic link?  (Not in POSIX.1-1996.)
S_ISSOCK(m) socket?  (Not in POSIX.1-1996.)
</code></pre>
<p>st_modeä¸­æ¯ä¸ªbitå«ä¹‰å¦‚ä¸‹ï¼š</p>
<pre><code class="language-c">S_IFMT     0170000   bit mask for the file type bit fields
S_IFSOCK   0140000   socket
S_IFLNK    0120000   symbolic link
S_IFREG    0100000   regular file
S_IFBLK    0060000   block device
S_IFDIR    0040000   directory
S_IFCHR    0020000   character device
S_IFIFO    0010000   FIFO
S_ISUID    0004000   set-user-ID bit
S_ISGID    0002000   set-group-ID bit (see below)
S_ISVTX    0001000   sticky bit (see below)
S_IRWXU    00700     mask for file owner permissions
S_IRUSR    00400     owner has read permission
S_IWUSR    00200     owner has write permission
S_IXUSR    00100     owner has execute permission
S_IRWXG    00070     mask for group permissions
S_IRGRP    00040     group has read permission
S_IWGRP    00020     group has write permission
S_IXGRP    00010     group has execute permission
S_IRWXO    00007     mask for permissions for others (not in group)
S_IROTH    00004     others have read permission
S_IWOTH    00002     others have write permission
S_IXOTH    00001     others have execute permission
</code></pre>
<h2 id="æ‰“å¼€åˆ›å»ºæ–‡ä»¶"><a class="header" href="#æ‰“å¼€åˆ›å»ºæ–‡ä»¶">æ‰“å¼€ã€åˆ›å»ºæ–‡ä»¶</a></h2>
<p><code>man open</code></p>
<pre><code class="language-c">#include &lt;sys/types.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;fcntl.h&gt;

int open(const char *pathname, int flags);
int open(const char *pathname, int flags, mode_t mode);

int creat(const char *pathname, mode_t mode);
</code></pre>
<p><code>openat()</code>æ˜¯ç›¸å¯¹æŒ‡å®šçš„ç›®å½•æè¿°ç¬¦æ‰“å¼€æ–‡ä»¶ï¼š</p>
<pre><code class="language-c">#include &lt;fcntl.h&gt;

int openat(int dirfd, const char *pathname, int flags);
int openat(int dirfd, const char *pathname, int flags, mode_t mode);
</code></pre>
<h2 id="å…³é—­æ–‡ä»¶"><a class="header" href="#å…³é—­æ–‡ä»¶">å…³é—­æ–‡ä»¶</a></h2>
<p><code>man close</code></p>
<pre><code class="language-c">#include &lt;unistd.h&gt;

int close(int fildes);
</code></pre>
<h2 id="æ–‡ä»¶æè¿°ç¬¦"><a class="header" href="#æ–‡ä»¶æè¿°ç¬¦">æ–‡ä»¶æè¿°ç¬¦</a></h2>
<p><code>man fcntl</code></p>
<pre><code class="language-c">#include &lt;unistd.h&gt;
#include &lt;fcntl.h&gt;

int fcntl(int fd, int cmd, ... /* arg */ );
</code></pre>
<p>å¯¹å·²ç»æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦è¿›è¡Œæ“ä½œã€‚å¯ä»¥è¿›è¡Œçš„æ“ä½œæ¯”è¾ƒå¤šï¼Œè€Œä¸”ç”¨é€”ä¸‰è¨€ä¸¤è¯­éš¾ä»¥è¯´æ¸…æ¥šï¼Œè¿™é‡Œåªåˆ—å‡ºä¸ªç›®å½•ï¼Œè¯¦æƒ…åˆ°manæ‰‹å†Œä¸­æŸ¥çœ‹ã€‚</p>
<p>æ–‡ä»¶æè¿°ç¬¦å¤åˆ¶ï¼ˆDuplicating a file descriptorï¼‰ï¼š</p>
<pre><code> F_DUPFD (int)ã€F_DUPFD_CLOEXEC (int; since Linux 2.6.24)
</code></pre>
<p>æ–‡ä»¶æè¿°ç¬¦æ ‡è®°ï¼ˆFile descriptor flagsï¼‰ï¼š</p>
<pre><code> F_GETFD (void)ã€F_SETFD (int)
</code></pre>
<p>æ–‡ä»¶çŠ¶æ€æ ‡è®°ï¼ˆFile status flagsï¼‰ï¼š</p>
<pre><code>F_GETFL (void)ã€F_SETFL (int)
</code></pre>
<p>æ–‡ä»¶è½¯é”ï¼ˆAdvisory lockingï¼‰ï¼š</p>
<pre><code>F_SETLK (struct flock *)ã€F_SETLKW (struct flock *)ã€F_GETLK (struct flock *)
</code></pre>
<p>æ–‡ä»¶ä¿¡å·å“åº”ç®¡ç†ï¼ˆManaging signalsï¼‰ï¼š</p>
<pre><code>F_GETOWN (void)ã€F_SETOWN (int)ã€F_GETOWN_EX (struct f_owner_ex *) (since Linux 2.6.32)
F_SETOWN_EX (struct f_owner_ex *) (since Linux 2.6.32)ã€F_GETSIG (void)ã€F_SETSIG (int)
</code></pre>
<p>æ–‡ä»¶æè¿°ç¬¦ç§Ÿçº¦ï¼ˆLeasesï¼‰ï¼š</p>
<pre><code> F_SETLEASE (int)ã€ F_GETLEASE (void)
</code></pre>
<p>æ–‡ä»¶å’Œè·¯å¾„å˜åŒ–é€šçŸ¥ï¼ˆFile and directory change notification (dnotify)ï¼‰ï¼š</p>
<pre><code> F_NOTIFY (int)
</code></pre>
<p>Pipeå®¹é‡è®¾ç½®ï¼ˆChanging the capacity of a pipeï¼‰ï¼š</p>
<pre><code>F_SETPIPE_SZ (int; since Linux 2.6.35)ã€F_GETPIPE_SZ (void; since Linux 2.6.35)
</code></pre>
<h2 id="æ–‡ä»¶å†…å®¹æˆªæ–­åˆ°æŒ‡å®šé•¿åº¦"><a class="header" href="#æ–‡ä»¶å†…å®¹æˆªæ–­åˆ°æŒ‡å®šé•¿åº¦">æ–‡ä»¶å†…å®¹æˆªæ–­åˆ°æŒ‡å®šé•¿åº¦</a></h2>
<p><code>man truncate</code></p>
<pre><code class="language-c">#include &lt;unistd.h&gt;
#include &lt;sys/types.h&gt;

int truncate(const char *path, off_t length);
int ftruncate(int fd, off_t length);
</code></pre>
<h2 id="é€è¡Œè¯»å–æ–‡ä»¶å†…å®¹"><a class="header" href="#é€è¡Œè¯»å–æ–‡ä»¶å†…å®¹">é€è¡Œè¯»å–æ–‡ä»¶å†…å®¹</a></h2>
<pre><code class="language-c">#include &lt;stdio.h&gt;

ssize_t getline(char **lineptr, size_t *n, FILE *stream);

ssize_t getdelim(char **lineptr, size_t *n, int delim, FILE *stream);
</code></pre>
<p><code>*lineptr</code>æ˜¯å­˜æ”¾ä¸€è¡Œæ–‡æœ¬çš„å†…å­˜åœ°å€ï¼Œ<code>*n</code>æ˜¯<code>*lineptr</code>æŒ‡å‘çš„å†…å­˜ç©ºé—´çš„å¤§å°ã€‚</p>
<p><strong>æ³¨æ„</strong>ï¼šå¦‚æœ<code>*lineptr</code>æ˜¯nullï¼Œgetlineå’Œgetdelimä¼šè®©<code>*lineptr</code>æŒ‡å®šè‡ªåŠ¨åˆ†é…çš„ä¸€å—å†…å­˜ï¼Œè¦ä¸»åŠ¨é‡Šæ”¾<code>*lineptr</code>æŒ‡å‘çš„å†…å­˜ï¼Œè¿™ç§æƒ…å†µä¸‹<code>*n</code>è¢«å¿½ç•¥ã€‚</p>
<p><strong>æ³¨æ„</strong>ï¼šå¦‚æœ<code>*lineptr</code>æŒ‡å®šçš„å†…å­˜ç©ºé—´ä¸è¶³ä»¥å­˜æ”¾æ•´è¡Œæ•°æ®ï¼Œgetlineå’Œgetdelimä¼šè°ƒç”¨reallocé‡æ–°åˆ†é…å†…å­˜ï¼Œæ›´æ”¹<code>*lineptr</code>æŒ‡å‘æ–°åˆ†é…çš„å†…å­˜ï¼Œå¹¶åŒæ­¥æ›´æ–°<code>*n</code>ã€‚ </p>
<h2 id="å‘æ–‡ä»¶ä¸­å†™å…¥å†…å®¹"><a class="header" href="#å‘æ–‡ä»¶ä¸­å†™å…¥å†…å®¹">å‘æ–‡ä»¶ä¸­å†™å…¥å†…å®¹</a></h2>
<p><code>man 3 write</code></p>
<pre><code class="language-c">#include &lt;unistd.h&gt;

ssize_t pwrite(int fildes, const void *buf, size_t nbyte,
       off_t offset);
ssize_t write(int fildes, const void *buf, size_t nbyte);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="è¿›ç¨‹ç®¡ç†æ“ä½œ"><a class="header" href="#è¿›ç¨‹ç®¡ç†æ“ä½œ">è¿›ç¨‹ç®¡ç†æ“ä½œ</a></h1>
<h2 id="è·å–è¿›ç¨‹id"><a class="header" href="#è·å–è¿›ç¨‹id">è·å–è¿›ç¨‹ID</a></h2>
<p><code>man pid</code></p>
<pre><code class="language-c">#include &lt;sys/types.h&gt;
#include &lt;unistd.h&gt;

pid_t getpid(void);
pid_t getppid(void);
</code></pre>
<p>åˆ†åˆ«æ˜¯è·å–å½“å‰è¿›ç¨‹idï¼Œå’Œçˆ¶è¿›ç¨‹idã€‚</p>
<h2 id="åˆ›å»ºå­è¿›ç¨‹"><a class="header" href="#åˆ›å»ºå­è¿›ç¨‹">åˆ›å»ºå­è¿›ç¨‹</a></h2>
<h3 id="fork"><a class="header" href="#fork">fork</a></h3>
<p><code>man fork</code></p>
<pre><code class="language-c">#include &lt;unistd.h&gt;

pid_t fork(void);
</code></pre>
<p>å­è¿›ç¨‹åˆ›å»ºå¤±è´¥è¿”å›<code>-1</code>ï¼Œåˆ›å»ºæˆåŠŸï¼Œåœ¨çˆ¶è¿›ç¨‹ä¸­è¿”å›å­è¿›ç¨‹çš„<code>è¿›ç¨‹å·</code>ï¼Œåœ¨å­è¿›ç¨‹ä¸­è¿”å›<code>0</code>ã€‚</p>
<h3 id="clone"><a class="header" href="#clone">clone</a></h3>
<p><code>man clone</code></p>
<p><code>clone()</code>æ¯”<code>fork()</code>åŠŸèƒ½æ›´å¼ºå¤§ï¼Œå¯ä»¥ä¼ å…¥å­è¿›ç¨‹çš„è¿è¡Œå‡½æ•°ï¼Œä»¥åŠè®¾ç½®namespaceç­‰ã€‚</p>
<pre><code class="language-c">#include &lt;sched.h&gt;

int clone(int (*fn)(void *), void *child_stack,
          int flags, void *arg, ...
          /* pid_t *ptid, struct user_desc *tls, pid_t *ctid */ );

/* Prototype for the raw system call */

long clone(unsigned long flags, void *child_stack,
          void *ptid, void *ctid,
          struct pt_regs *regs);
</code></pre>
<p>ä¸Šé¢ç¬¬ä¸€ä¸ªå®šä¹‰æ˜¯glibcæä¾›çš„ï¼Œå°è£…äº†åŸå§‹çš„cloneç³»ç»Ÿè°ƒç”¨ï¼Œç¬¬äºŒä¸ªå®šä¹‰æ˜¯åŸå§‹çš„cloneç³»ç»Ÿè°ƒç”¨å®šä¹‰ã€‚</p>
<p>å…³é”®æ˜¯å‚æ•°<code>flags</code>ï¼Œå®ƒçš„bitä½æœ‰ç‰¹æ®Šå«ä¹‰ï¼Œåˆ†åˆ«æ˜¯é€€å‡ºæ—¶å‘çˆ¶è¿›ç¨‹å‘é€çš„ä¿¡å·é‡å’Œä¸‹é¢çš„æ ‡å¿—ä½ï¼ˆå…·ä½“è¯´æ˜æŸ¥é˜…æ‰‹å†Œ<code>man clone</code>ï¼‰ï¼š</p>
<pre><code>CLONE_CHILD_CLEARTID (since Linux 2.5.49)
CLONE_CHILD_SETTID (since Linux 2.5.49)
CLONE_FILES (since Linux 2.0)
CLONE_FS (since Linux 2.0)
CLONE_IO (since Linux 2.6.25)
CLONE_NEWIPC (since Linux 2.6.19)
CLONE_NEWNET (since Linux 2.6.24)
CLONE_NEWNS (since Linux 2.4.19)
CLONE_NEWPID (since Linux 2.6.24)
CLONE_NEWUTS (since Linux 2.6.19)
CLONE_PARENT (since Linux 2.3.12)
CLONE_PARENT_SETTID (since Linux 2.5.49)
CLONE_PID (obsolete)
CLONE_PTRACE (since Linux 2.2)
CLONE_SETTLS (since Linux 2.5.32)
CLONE_SIGHAND (since Linux 2.0)
CLONE_STOPPED (since Linux 2.6.0-test2)
CLONE_SYSVSEM (since Linux 2.5.10)
CLONE_THREAD (since Linux 2.4.0-test8)
CLONE_UNTRACED (since Linux 2.5.46)
CLONE_VFORK (since Linux 2.2)
CLONE_VM (since Linux 2.0)
</code></pre>
<p>ä¾‹å¦‚å­è¿›ç¨‹é€€å‡ºæ—¶å‘çˆ¶è¿›ç¨‹å‘é€SIGCHLDä¿¡å·ï¼š</p>
<pre><code class="language-c">pid = clone(childFunc, stackTop, CLONE_NEWUTS | SIGCHLD, argv[1]);
if (pid == -1)
    errExit(&quot;clone&quot;);
printf(&quot;clone() returned %ld\n&quot;, (long) pid);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="å¹¶å‘ç¼–ç¨‹"><a class="header" href="#å¹¶å‘ç¼–ç¨‹">å¹¶å‘ç¼–ç¨‹</a></h1>
<h2 id="once"><a class="header" href="#once">Once</a></h2>
<p>è®¾ç½®åªæœ‰ç¬¬ä¸€æ¬¡è¢«è°ƒç”¨æ—¶ä¼šæ‰§è¡Œçš„æ“ä½œï¼Œ<code>man pthread_once()</code>ï¼š</p>
<pre><code class="language-c">#include &lt;pthread.h&gt;

int pthread_once(pthread_once_t *once_control,  void (*init_routine)(void));

pthread_once_t once_control = PTHREAD_ONCE_INIT;
</code></pre>
<h2 id="çº¿ç¨‹é”"><a class="header" href="#çº¿ç¨‹é”">çº¿ç¨‹é”</a></h2>
<h3 id="çº¿ç¨‹è¯»å†™é”"><a class="header" href="#çº¿ç¨‹è¯»å†™é”">çº¿ç¨‹è¯»å†™é”</a></h3>
<h4 id="çº¿ç¨‹è¯»å†™é”çš„åˆ›å»ºåˆå§‹åŒ–å’Œé”€æ¯"><a class="header" href="#çº¿ç¨‹è¯»å†™é”çš„åˆ›å»ºåˆå§‹åŒ–å’Œé”€æ¯">çº¿ç¨‹è¯»å†™é”çš„åˆ›å»ºåˆå§‹åŒ–å’Œé”€æ¯</a></h4>
<p>åˆ›å»ºåˆå§‹åŒ–å’Œé”€æ¯ï¼Œ<code>man pthread_rwlock_init</code>ï¼š</p>
<pre><code class="language-c">#include &lt;pthread.h&gt;

int pthread_rwlock_destroy(pthread_rwlock_t *rwlock);
int pthread_rwlock_init(pthread_rwlock_t *restrict rwlock, 
       const pthread_rwlockattr_t *restrict attr);
</code></pre>
<h4 id="çº¿ç¨‹è¯»å†™é”çš„åŠ é”è§£é”æ“ä½œ"><a class="header" href="#çº¿ç¨‹è¯»å†™é”çš„åŠ é”è§£é”æ“ä½œ">çº¿ç¨‹è¯»å†™é”çš„åŠ é”è§£é”æ“ä½œ</a></h4>
<p>åŠ è¯»é”ï¼Œ<code>man pthread_rwlock_rdlock</code>ï¼š</p>
<pre><code class="language-c">#include &lt;pthread.h&gt;

int pthread_rwlock_rdlock(pthread_rwlock_t *rwlock);
int pthread_rwlock_tryrdlock(pthread_rwlock_t *rwlock);
</code></pre>
<p>åŠ è¯»é”ç­‰å¾…è¶…æ—¶ï¼Œ<code>man pthread_rwlock_timedrdlock</code>ï¼š</p>
<pre><code class="language-c">#include &lt;pthread.h&gt;
#include &lt;time.h&gt;

int pthread_rwlock_timedrdlock(pthread_rwlock_t *restrict rwlock,
       const struct timespec *restrict abs_timeout);
</code></pre>
<p>åŠ å†™é”ï¼Œ<code>man pthread_rwlock_wrlock</code>ï¼š</p>
<pre><code class="language-c">#include &lt;pthread.h&gt;

int pthread_rwlock_trywrlock(pthread_rwlock_t *rwlock);
int pthread_rwlock_wrlock(pthread_rwlock_t *rwlock);
</code></pre>
<p>åŠ å†™é”ç­‰å¾…è¶…æ—¶ï¼Œ<code>man pthread_rwlock_timedwrlock</code>ï¼š</p>
<pre><code class="language-c">#include &lt;pthread.h&gt;
#include &lt;time.h&gt;

int pthread_rwlock_timedwrlock(pthread_rwlock_t *restrict rwlock,
       const struct timespec *restrict abs_timeout);
</code></pre>
<p>è§£é”ï¼Œ<code>man pthread_rwlock_unlock</code>ï¼š</p>
<pre><code class="language-c">#include &lt;pthread.h&gt;

int pthread_rwlock_unlock(pthread_rwlock_t *rwlock);
</code></pre>
<h3 id="çº¿ç¨‹äº’æ–¥é”"><a class="header" href="#çº¿ç¨‹äº’æ–¥é”">çº¿ç¨‹äº’æ–¥é”</a></h3>
<h4 id="çº¿ç¨‹äº’æ–¥é”çš„åˆ›å»ºåˆå§‹åŒ–å’Œé”€æ¯"><a class="header" href="#çº¿ç¨‹äº’æ–¥é”çš„åˆ›å»ºåˆå§‹åŒ–å’Œé”€æ¯">çº¿ç¨‹äº’æ–¥é”çš„åˆ›å»ºåˆå§‹åŒ–å’Œé”€æ¯</a></h4>
<p>åˆ›å»ºåˆå§‹åŒ–å’Œé”€æ¯ï¼Œ<code>man pthread_mutex_init</code>ï¼š</p>
<pre><code class="language-c">#include &lt;pthread.h&gt;

int pthread_mutex_destroy(pthread_mutex_t *mutex);
int pthread_mutex_init(pthread_mutex_t *restrict mutex,
       const pthread_mutexattr_t *restrict attr);

pthread_mutex_t mutex = PTHREAD_MUTEX_INITIALIZER;
</code></pre>
<h4 id="çº¿ç¨‹äº’æ–¥é”çš„åŠ é”å’Œè§£é”æ“ä½œ"><a class="header" href="#çº¿ç¨‹äº’æ–¥é”çš„åŠ é”å’Œè§£é”æ“ä½œ">çº¿ç¨‹äº’æ–¥é”çš„åŠ é”å’Œè§£é”æ“ä½œ</a></h4>
<p>åŠ é”è§£é”ï¼Œ<code>man pthread_mutex_lock</code>ï¼š</p>
<pre><code class="language-c">#include &lt;pthread.h&gt;

int pthread_mutex_lock(pthread_mutex_t *mutex);
int pthread_mutex_trylock(pthread_mutex_t *mutex);
</code></pre>
<p>åŠ é”ç­‰å¾…è¶…æ—¶ï¼Œ<code>man pthread_mutex_timedlock</code>ï¼š</p>
<pre><code class="language-c">#include &lt;pthread.h&gt;
#include &lt;time.h&gt;

int pthread_mutex_timedlock(pthread_mutex_t *restrict mutex,
       const struct timespec *restrict abs_timeout);
</code></pre>
<p>è§£é”æ“ä½œï¼Œ<code>man pthread_mutex_unlock</code>ï¼š</p>
<pre><code class="language-c">#include &lt;pthread.h&gt;

int pthread_mutex_unlock(pthread_mutex_t *mutex);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="socketé€šä¿¡ç›¸å…³æ“ä½œ"><a class="header" href="#socketé€šä¿¡ç›¸å…³æ“ä½œ">socketé€šä¿¡ç›¸å…³æ“ä½œ</a></h1>
<h2 id="socketç®¡é“"><a class="header" href="#socketç®¡é“">socketç®¡é“</a></h2>
<p><code>man socketpair</code></p>
<p>ä¸€æ¬¡åˆ›å»ºä¸¤ä¸ªsocketï¼Œæ„æˆä¸€ä¸ªæœªå‘½åçš„socket pairï¼Œå†™å…¥ä¸€ä¸ªsocketçš„æ•°æ®èƒ½å¤Ÿä»å¦ä¸€ä¸ªsocketä¸­æ”¶åˆ°ã€‚</p>
<pre><code class="language-c">#include &lt;sys/types.h&gt;          /* See NOTES */
#include &lt;sys/socket.h&gt;

int socketpair(int domain, int type, int protocol, int sv[2]);
</code></pre>
<p>å¯ä»¥ä½œä¸ºçˆ¶å­è¿›ç¨‹çš„é€šä¿¡æ–¹å¼ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="language-c">static pid_t get_init_pid_for_task(pid_t task)
{
    int sock[2];
    pid_t pid;
    pid_t ret = -1;
    char v = '0';
    struct ucred cred;

    if (socketpair(AF_UNIX, SOCK_DGRAM, 0, sock) &lt; 0) {
        perror(&quot;socketpair&quot;);
        return -1;
    }

    pid = fork();
    if (pid &lt; 0)
        goto out;
    if (!pid) {
        close(sock[1]);
        write_task_init_pid_exit(sock[0], task);
        _exit(0);
    }

    if (!recv_creds(sock[1], &amp;cred, &amp;v))
        goto out;
    ret = cred.pid;

out:
    close(sock[0]);
    close(sock[1]);
    if (pid &gt; 0)
        wait_for_pid(pid);
    return ret;
}
</code></pre>
<h2 id="å‘socketå†™æ•°æ®"><a class="header" href="#å‘socketå†™æ•°æ®">å‘socketå†™æ•°æ®</a></h2>
<p><code>man sendmsg</code></p>
<pre><code class="language-c">#include &lt;sys/types.h&gt;
#include &lt;sys/socket.h&gt;

ssize_t send(int sockfd, const void *buf, size_t len, int flags);

ssize_t sendto(int sockfd, const void *buf, size_t len, int flags,
               const struct sockaddr *dest_addr, socklen_t addrlen);

ssize_t sendmsg(int sockfd, const struct msghdr *msg, int flags);
</code></pre>
<h2 id="ä½¿ç”¨socketæ¶ˆæ¯å¤´"><a class="header" href="#ä½¿ç”¨socketæ¶ˆæ¯å¤´">ä½¿ç”¨socketæ¶ˆæ¯å¤´</a></h2>
<p>ä¸‹é¢è¿™äº›å‡½æ•°æä¾›äº†æ“ä½œé€šè¿‡socketå‘é€çš„æ•°æ®çš„æ¶ˆæ¯å¤´çš„èƒ½åŠ›ï¼š</p>
<pre><code class="language-c">#include &lt;sys/socket.h&gt;

struct cmsghdr *CMSG_FIRSTHDR(struct msghdr *msgh);
struct cmsghdr *CMSG_NXTHDR(struct msghdr *msgh, struct cmsghdr *cmsg);
size_t CMSG_ALIGN(size_t length);
size_t CMSG_SPACE(size_t length);
size_t CMSG_LEN(size_t length);
unsigned char *CMSG_DATA(struct cmsghdr *cmsg);
</code></pre>
<p><code>msghdr</code>æè¿°è¦å‘é€çš„æ•°æ®ï¼š</p>
<pre><code class="language-c">/* Structure describing messages sent by
   `sendmsg' and received by `recvmsg'.  */
struct msghdr
  {
    void *msg_name;     /* Address to send to/receive from.  */
    socklen_t msg_namelen;  /* Length of address data.  */

    struct iovec *msg_iov;  /* Vector of data to send/receive into.  */
    size_t msg_iovlen;      /* Number of elements in the vector.  */

    void *msg_control;      /* Ancillary data (eg BSD filedesc passing). */
    size_t msg_controllen;  /* Ancillary data buffer length.
                   !! The type should be socklen_t but the
                   definition of the kernel is incompatible
                   with this.  */

    int msg_flags;      /* Flags on received message.  */
  };
</code></pre>
<p>å¯ä»¥åœ¨å…¶ä¸­æ·»åŠ é¢å¤–çš„æ§åˆ¶ä¿¡æ¯ï¼Œ<code>msg_control</code>æŒ‡å‘é¢å¤–çš„æ§åˆ¶ä¿¡æ¯ï¼Œ<code>msg_controllen</code>æ˜¯é¢å¤–çš„æ§åˆ¶ä¿¡æ¯å ç”¨çš„å†…å­˜ç©ºé—´ã€‚</p>
<p>é¢å¤–çš„æ§åˆ¶ä¿¡æ¯ç”¨ç»“æ„ä½“<code>cmsghdr</code>è¡¨è¾¾ï¼Œmsg_controlä¸­å¯ä»¥åŒ…å«å¤šä¸ªcmsghdrï¼š</p>
<pre><code class="language-c">/* Structure used for storage of ancillary data object information.  */
struct cmsghdr
  {
    size_t cmsg_len;        /* Length of data in cmsg_data plus length
                   of cmsghdr structure.
                   !! The type should be socklen_t but the
                   definition of the kernel is incompatible
                   with this.  */
    int cmsg_level;     /* Originating protocol.  */
    int cmsg_type;      /* Protocol specific type.  */
#if (!defined __STRICT_ANSI__ &amp;&amp; __GNUC__ &gt;= 2) || __STDC_VERSION__ &gt;= 199901L
    __extension__ unsigned char __cmsg_data __flexarr; /* Ancillary data.  */
#endif
  };
</code></pre>
<p>ç”¨å®<code>CMSG_FIRSTHDR</code>è·å¾—ç¬¬ä¸€ä¸ªcmsghdrçš„åœ°å€ï¼š</p>
<pre><code class="language-c">cmsg = CMSG_FIRSTHDR(&amp;msg);
</code></pre>
<p>ç”¨å®<code>CMSG_DATA</code>è·å¾—cmsghdrçš„æ•°æ®åœ°å€ï¼š</p>
<pre><code class="language-c">memcpy(CMSG_DATA(cmsg), cred, sizeof(*cred));
</code></pre>
<h3 id="å‘é€ç«¯çš„ä¾‹å­"><a class="header" href="#å‘é€ç«¯çš„ä¾‹å­">å‘é€ç«¯çš„ä¾‹å­</a></h3>
<pre><code class="language-c">// lxcfs/bindings.c: 2053
static int send_creds(int sock, struct ucred *cred, char v, bool pingfirst)
{
    struct msghdr msg = { 0 };
    struct iovec iov;
    struct cmsghdr *cmsg;
    //é¢å¤–çš„æ§åˆ¶ä¿¡æ¯å ç”¨çš„å†…å­˜
    char cmsgbuf[CMSG_SPACE(sizeof(*cred))];
    char buf[1];
    buf[0] = 'p';

    if (pingfirst) {
        if (msgrecv(sock, buf, 1) != 1) {
            lxcfs_error(&quot;%s\n&quot;, &quot;Error getting reply from server over socketpair.&quot;);
            return SEND_CREDS_FAIL;
        }
    }

    //æ§åˆ¶ä¿¡æ¯å ç”¨çš„å†…å­˜çš„åœ°å€å†™å…¥msg
    msg.msg_control = cmsgbuf;
    msg.msg_controllen = sizeof(cmsgbuf);

    //è·å–ç¬¬ä¸€ä¸ªé¢å¤–æ§åˆ¶ä¿¡æ¯çš„åœ°å€ï¼Œå¹¶è®¾ç½®
    cmsg = CMSG_FIRSTHDR(&amp;msg);
    cmsg-&gt;cmsg_len = CMSG_LEN(sizeof(struct ucred));
    cmsg-&gt;cmsg_level = SOL_SOCKET;
    cmsg-&gt;cmsg_type = SCM_CREDENTIALS;
    memcpy(CMSG_DATA(cmsg), cred, sizeof(*cred));

    msg.msg_name = NULL;
    msg.msg_namelen = 0;

    //è®¾ç½®è¦å‘é€çš„æ•°æ®
    buf[0] = v;
    iov.iov_base = buf;
    iov.iov_len = sizeof(buf);
    msg.msg_iov = &amp;iov;
    msg.msg_iovlen = 1;

    if (sendmsg(sock, &amp;msg, 0) &lt; 0) {
        lxcfs_error(&quot;Failed at sendmsg: %s.\n&quot;,strerror(errno));
        if (errno == 3)
            return SEND_CREDS_NOTSK;
        return SEND_CREDS_FAIL;
    }

    return SEND_CREDS_OK;
}
</code></pre>
<h3 id="æ¥æ”¶ç«¯çš„ä¾‹å­"><a class="header" href="#æ¥æ”¶ç«¯çš„ä¾‹å­">æ¥æ”¶ç«¯çš„ä¾‹å­</a></h3>
<pre><code class="language-c">// lxcfs/bindings.c: 2097
static bool recv_creds(int sock, struct ucred *cred, char *v)
{
    struct msghdr msg = { 0 };
    struct iovec iov;
    struct cmsghdr *cmsg;
    char cmsgbuf[CMSG_SPACE(sizeof(*cred))];
    char buf[1];
    int ret;
    int optval = 1;

    *v = '1';

    cred-&gt;pid = -1;
    cred-&gt;uid = -1;
    cred-&gt;gid = -1;

    if (setsockopt(sock, SOL_SOCKET, SO_PASSCRED, &amp;optval, sizeof(optval)) == -1) {
        lxcfs_error(&quot;Failed to set passcred: %s\n&quot;, strerror(errno));
        return false;
    }
    buf[0] = '1';
    if (write(sock, buf, 1) != 1) {
        lxcfs_error(&quot;Failed to start write on scm fd: %s\n&quot;, strerror(errno));
        return false;
    }

    //å‡†å¤‡ç”¨å‘é€ç«¯åŒæ ·è§„æ ¼çš„æ¶ˆæ¯å¤´
    msg.msg_name = NULL;
    msg.msg_namelen = 0;
    msg.msg_control = cmsgbuf;
    msg.msg_controllen = sizeof(cmsgbuf);

    iov.iov_base = buf;
    iov.iov_len = sizeof(buf);
    msg.msg_iov = &amp;iov;
    msg.msg_iovlen = 1;

    if (!wait_for_sock(sock, 2)) {
        lxcfs_error(&quot;Timed out waiting for scm_cred: %s\n&quot;, strerror(errno));
        return false;
    }
    //æ¥æ”¶æ•°æ®
    ret = recvmsg(sock, &amp;msg, MSG_DONTWAIT);
    if (ret &lt; 0) {
        lxcfs_error(&quot;Failed to receive scm_cred: %s\n&quot;, strerror(errno));
        return false;
    }
    //è¯»å–é¢å¤–çš„æ§åˆ¶ä¿¡æ¯
    cmsg = CMSG_FIRSTHDR(&amp;msg);

    if (cmsg &amp;&amp; cmsg-&gt;cmsg_len == CMSG_LEN(sizeof(struct ucred)) &amp;&amp;
            cmsg-&gt;cmsg_level == SOL_SOCKET &amp;&amp;
            cmsg-&gt;cmsg_type == SCM_CREDENTIALS) {
        memcpy(cred, CMSG_DATA(cmsg), sizeof(*cred));
    }
    //bufä¸­å·²ç»å†™å…¥å‘é€è¿‡æ¥çš„æ•°æ®
    *v = buf[0];

    return true;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="æ–‡ä»¶ç³»ç»Ÿç›¸å…³æ“ä½œ"><a class="header" href="#æ–‡ä»¶ç³»ç»Ÿç›¸å…³æ“ä½œ">æ–‡ä»¶ç³»ç»Ÿç›¸å…³æ“ä½œ</a></h1>
<h2 id="libfuseä½¿ç”¨"><a class="header" href="#libfuseä½¿ç”¨">libfuseä½¿ç”¨</a></h2>
<p>libfuseçš„ç”¨é€”ä»¥åŠåŸºç¡€ä½¿ç”¨æ–¹æ³•å‚è€ƒ<a href="https://www.lijiaocn.com/%E6%8A%80%E5%B7%A7/2019/01/21/linux-fuse-filesystem-in-userspace-usage.html">ã€ŠLinux FUSEï¼ˆç”¨æˆ·æ€æ–‡ä»¶ç³»ç»Ÿï¼‰çš„ä½¿ç”¨ï¼šç”¨libfuseåˆ›å»ºFUSEæ–‡ä»¶ç³»ç»Ÿã€‹</a>ã€‚</p>
<h3 id="fuse_get_context"><a class="header" href="#fuse_get_context">fuse_get_context</a></h3>
<p>fuse_get_contextç”¨äºåœ¨æ–‡ä»¶ç³»ç»Ÿæ“ä½œæ—¶è·å–ä¸Šä¸‹æ–‡ï¼Œåœ¨å¤´æ–‡ä»¶<code>fuse/fuse.h</code>ä¸­å®šä¹‰ï¼š</p>
<pre><code class="language-c">/**
 * Get the current context
 *
 * The context is only valid for the duration of a filesystem
 * operation, and thus must not be stored and used later.
 *
 * @return the context
 */
struct fuse_context *fuse_get_context(void);
</code></pre>
<p>è¿”å›çš„ç»“æ„ä½“fuse_contextåŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š</p>
<pre><code class="language-c">/** Extra context that may be needed by some filesystems
 *
 * The uid, gid and pid fields are not filled in case of a writepage
 * operation.
 */
struct fuse_context {
    /** Pointer to the fuse object */
    struct fuse *fuse;

    /** User ID of the calling process */
    uid_t uid;

    /** Group ID of the calling process */
    gid_t gid;

    /** Thread ID of the calling process */
    pid_t pid;

    /** Private filesystem data */
    void *private_data;

    /** Umask of the calling process (introduced in version 2.8) */
    mode_t umask;
};
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="ç³»ç»Ÿé…ç½®è¯»å–"><a class="header" href="#ç³»ç»Ÿé…ç½®è¯»å–">ç³»ç»Ÿé…ç½®è¯»å–</a></h1>
<h2 id="æ“ä½œç³»ç»Ÿç›¸å…³é…ç½®è·å–"><a class="header" href="#æ“ä½œç³»ç»Ÿç›¸å…³é…ç½®è·å–">æ“ä½œç³»ç»Ÿç›¸å…³é…ç½®è·å–</a></h2>
<p>sysconfï¼š   è·å–æ•°å€¼ç±»å‹çš„é…ç½®é¡¹</p>
<p>fpathconfï¼š è·å–æ‰“å¼€çš„æ–‡ä»¶å¥æŸ„å¯¹åº”çš„é…ç½®é¡¹</p>
<p>pathconfï¼š  è·å–æ–‡ä»¶å¯¹åº”çš„é…ç½®é¡¹</p>
<p>confstrï¼š   è·å–å­—ç¬¦ä¸²ç±»å‹çš„é…ç½®é¡¹</p>
<pre><code class="language-c">#include &lt;unistd.h&gt;

long sysconf(int name);
long fpathconf(int fd, int name);
long pathconf(char *path, int name);
size_t confstr(int name, char *buf, size_t len);
</code></pre>
<h3 id="sysconf"><a class="header" href="#sysconf">sysconf</a></h3>
<p>sysconfç”¨äºåœ¨è¿è¡Œæ—¶è·å–ç³»ç»Ÿé…ç½®å¸¸é‡ï¼Œä¸»è¦æ˜¯POSIXä¸­è§„å®šä¸€äº›å‚æ•°ï¼Œä¾‹å¦‚æœ€å¤§é•¿åº¦ã€æœ€å¤§æ•°å€¼ç­‰ã€‚</p>
<p><code>man 3 sysconf</code></p>
<pre><code class="language-c">#include &lt;unistd.h&gt;

long sysconf(int name);
</code></pre>
<p><code>sysconf</code>å¯ä»¥è¯»å–ä»¥ä¸‹é…ç½®ï¼š</p>
<p>First, the POSIX.1 compatible values.</p>
<pre><code>ARG_MAX - _SC_ARG_MAX
    The maximum length of the arguments to the exec(3) family of functions.  Must not be less than _POSIX_ARG_MAX (4096).

CHILD_MAX - _SC_CHILD_MAX
    The maximum number of simultaneous processes per user ID.  Must not be less than _POSIX_CHILD_MAX (25).

HOST_NAME_MAX - _SC_HOST_NAME_MAX
    Maximum length of a hostname, not including the terminating null byte, as returned by gethostname(2).  Must not be less than _POSIX_HOST_NAME_MAX (255).

LOGIN_NAME_MAX - _SC_LOGIN_NAME_MAX
    Maximum length of a login name, including the terminating null byte.  Must not be less than _POSIX_LOGIN_NAME_MAX (9).

clock ticks - _SC_CLK_TCK
    The  number  of  clock  ticks per second.  The corresponding variable is obsolete.  It was of course called CLK_TCK.  (Note: the macro CLOCKS_PER_SEC does not give information: it must
    equal 1000000.)

OPEN_MAX - _SC_OPEN_MAX
    The maximum number of files that a process can have open at any time.  Must not be less than _POSIX_OPEN_MAX (20).

PAGESIZE - _SC_PAGESIZE
    Size of a page in bytes.  Must not be less than 1.  (Some systems use PAGE_SIZE instead.)

RE_DUP_MAX - _SC_RE_DUP_MAX
    The number of repeated occurrences of a BRE permitted by regexec(3) and regcomp(3).  Must not be less than _POSIX2_RE_DUP_MAX (255).

STREAM_MAX - _SC_STREAM_MAX
    The maximum number of streams that a process can have open at any time.  If defined, it has the same value as the standard C macro FOPEN_MAX.  Must not be less  than  _POSIX_STREAM_MAX
    (8).

SYMLOOP_MAX - _SC_SYMLOOP_MAX
    The maximum number of symbolic links seen in a pathname before resolution returns ELOOP.  Must not be less than _POSIX_SYMLOOP_MAX (8).

TTY_NAME_MAX - _SC_TTY_NAME_MAX
    The maximum length of terminal device name, including the terminating null byte.  Must not be less than _POSIX_TTY_NAME_MAX (9).

TZNAME_MAX - _SC_TZNAME_MAX
    The maximum number of bytes in a timezone name.  Must not be less than _POSIX_TZNAME_MAX (6).

_POSIX_VERSION - _SC_VERSION
    indicates the year and month the POSIX.1 standard was approved in the format YYYYMML; the value 199009L indicates the Sept. 1990 revision.
</code></pre>
<p>Next, the POSIX.2 values, giving limits for utilities.</p>
<pre><code>BC_BASE_MAX - _SC_BC_BASE_MAX
    indicates the maximum obase value accepted by the bc(1) utility.

BC_DIM_MAX - _SC_BC_DIM_MAX
    indicates the maximum value of elements permitted in an array by bc(1).

BC_SCALE_MAX - _SC_BC_SCALE_MAX
    indicates the maximum scale value allowed by bc(1).

BC_STRING_MAX - _SC_BC_STRING_MAX
    indicates the maximum length of a string accepted by bc(1).

COLL_WEIGHTS_MAX - _SC_COLL_WEIGHTS_MAX
    indicates the maximum numbers of weights that can be assigned to an entry of the LC_COLLATE order keyword in the locale definition file,

EXPR_NEST_MAX - _SC_EXPR_NEST_MAX
    is the maximum number of expressions which can be nested within parentheses by expr(1).

LINE_MAX - _SC_LINE_MAX
    The maximum length of a utility's input line, either from standard input or from a file.  This includes space for a trailing newline.

RE_DUP_MAX - _SC_RE_DUP_MAX
    The maximum number of repeated occurrences of a regular expression when the interval notation \{m,n\} is used.

POSIX2_VERSION - _SC_2_VERSION
    indicates the version of the POSIX.2 standard in the format of YYYYMML.

POSIX2_C_DEV - _SC_2_C_DEV
    indicates whether the POSIX.2 C language development facilities are supported.

POSIX2_FORT_DEV - _SC_2_FORT_DEV
    indicates whether the POSIX.2 FORTRAN development utilities are supported.

POSIX2_FORT_RUN - _SC_2_FORT_RUN
    indicates whether the POSIX.2 FORTRAN run-time utilities are supported.

_POSIX2_LOCALEDEF - _SC_2_LOCALEDEF
    indicates whether the POSIX.2 creation of locates via localedef(1) is supported.

POSIX2_SW_DEV - _SC_2_SW_DEV
    indicates whether the POSIX.2 software development utilities option is supported.
</code></pre>
<p>These values also exist, but may not be standard.</p>
<pre><code> - _SC_PHYS_PAGES
    The number of pages of physical memory.  Note that it is possible for the product of this value and the value of _SC_PAGESIZE to overflow.

 - _SC_AVPHYS_PAGES
    The number of currently available pages of physical memory.

 - _SC_NPROCESSORS_CONF
    The number of processors configured.

     - _SC_NPROCESSORS_ONLN
           The number of processors currently online (available).
</code></pre>
<h3 id="pathconf-å’Œ-fpathconf"><a class="header" href="#pathconf-å’Œ-fpathconf">pathconf å’Œ fpathconf</a></h3>
<p><code>man  pathconf</code></p>
<pre><code class="language-c">#include &lt;unistd.h&gt;

long fpathconf(int fd, int name);
long pathconf(char *path, int name);
</code></pre>
<p>Setting name equal to one of the following constants returns the following configuration options:</p>
<pre><code>_PC_LINK_MAX
    returns the maximum number of links to the file.  If fd or path refer to a directory, then the value applies to the whole directory.  The corresponding macro is _POSIX_LINK_MAX.

_PC_MAX_CANON
    returns the maximum length of a formatted input line, where fd or path must refer to a terminal.  The corresponding macro is _POSIX_MAX_CANON.

_PC_MAX_INPUT
    returns the maximum length of an input line, where fd or path must refer to a terminal.  The corresponding macro is _POSIX_MAX_INPUT.

_PC_NAME_MAX
    returns the maximum length of a filename in the directory path or fd that the process is allowed to create.  The corresponding macro is _POSIX_NAME_MAX.

_PC_PATH_MAX
    returns the maximum length of a relative pathname when path or fd is the current working directory.  The corresponding macro is _POSIX_PATH_MAX.

_PC_PIPE_BUF
    returns the size of the pipe buffer, where fd must refer to a pipe or FIFO and path must refer to a FIFO.  The corresponding macro is _POSIX_PIPE_BUF.

_PC_CHOWN_RESTRICTED
    returns nonzero if the chown(2) call may not be used on this file.  If fd or path refer to a directory, then this applies to all files in that directory.  The  corresponding  macro  is
    _POSIX_CHOWN_RESTRICTED.

_PC_NO_TRUNC
    returns nonzero if accessing filenames longer than _POSIX_NAME_MAX generates an error.  The corresponding macro is _POSIX_NO_TRUNC.

_PC_VDISABLE
    returns nonzero if special character processing can be disabled, where fd or path must refer to a terminal.
</code></pre>
<h3 id="confstr"><a class="header" href="#confstr">confstr</a></h3>
<p>The name argument is the system variable to be queried.  The following variables are supported:</p>
<pre><code>_CS_GNU_LIBC_VERSION (GNU C library only; since glibc 2.3.2)
    A string which identifies the GNU C library version on this system (e.g, &quot;glibc 2.3.4&quot;).

_CS_GNU_LIBPTHREAD_VERSION (GNU C library only; since glibc 2.3.2)
    A string which identifies the POSIX implementation supplied by this C library (e.g, &quot;NPTL 2.3.4&quot; or &quot;linuxthreads-0.10&quot;).

_CS_PATH
    A value for the PATH variable which indicates where all the POSIX.2 standard utilities can be found.
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="namespaceç›¸å…³æ“ä½œ"><a class="header" href="#namespaceç›¸å…³æ“ä½œ">Namespaceç›¸å…³æ“ä½œ</a></h1>
<h2 id="å½“å‰è¿›ç¨‹å…³è”åˆ°æŒ‡å®šçš„namespace"><a class="header" href="#å½“å‰è¿›ç¨‹å…³è”åˆ°æŒ‡å®šçš„namespace">å½“å‰è¿›ç¨‹å…³è”åˆ°æŒ‡å®šçš„namespace</a></h2>
<pre><code class="language-c">#define _GNU_SOURCE             /* See feature_test_macros(7) */
#include &lt;sched.h&gt;

int setns(int fd, int nstype);
</code></pre>
<p>fdæ˜¯<code>/proc/è¿›ç¨‹å·/ns/</code>ä¸­çš„æŸä¸ªæ–‡ä»¶æ‰“å¼€åçš„å¥æŸ„ï¼Œnstypeå¯ä»¥å–ä»¥ä¸‹å€¼ï¼š</p>
<pre><code>0      Allow any type of namespace to be joined.

CLONE_NEWIPC
       fd must refer to an IPC namespace.

CLONE_NEWNET
       fd must refer to a network namespace.

CLONE_NEWUTS
       fd must refer to a UTS namespace.
</code></pre>
<h2 id="è§£é™¤namespaceå…³è”"><a class="header" href="#è§£é™¤namespaceå…³è”">è§£é™¤namespaceå…³è”</a></h2>
<p><a href="https://lwn.net/Articles/135266/">new system call, unshare</a>ï¼Œ<code>man unshare</code>ã€‚</p>
<pre><code class="language-c">#include &lt;sched.h&gt;

int unshare(int flags);
</code></pre>
<p>unshare() allows a process to disassociate parts of its execution context that are currently being shared with other processes.  Part of the execution context, such as the mount namespace, is
shared implicitly when a new process is created using fork(2) or vfork(2), while other parts, such as virtual memory, may be shared by explicit request when creating a process using clone(2).</p>
<p>å‚æ•°flagså¯ä»¥ä½¿ç”¨ä¸€ä¸‹æ ‡å¿—ä½ï¼š</p>
<pre><code>CLONE_FILES
       Reverse the effect of the clone(2) CLONE_FILES flag.  Unshare the  file  descriptor  table,  so
       that the calling process no longer shares its file descriptors with any other process.

CLONE_FS
       Reverse  the effect of the clone(2) CLONE_FS flag.  Unshare file system attributes, so that the
       calling process no longer shares its root directory (chroot(2)), current directory  (chdir(2)),
       or umask (umask(2)) attributes with any other process.

CLONE_NEWIPC (since Linux 2.6.19)
       This  flag  has  the  same  effect as the clone(2) CLONE_NEWIPC flag.  Unshare the System V IPC
       namespace, so that the calling process has a private copy of the System V IPC  namespace  which
       is not shared with any other process.  Specifying this flag automatically implies CLONE_SYSVSEM
       as well.  Use of CLONE_NEWIPC requires the CAP_SYS_ADMIN capability.

CLONE_NEWNET (since Linux 2.6.24)
       This flag has the same effect as the clone(2) CLONE_NEWNET flag.  Unshare  the  network  namesâ€
       pace,  so  that  the  calling process is moved into a new network namespace which is not shared
       with any previously existing process.  Use of CLONE_NEWNET requires the CAP_SYS_ADMIN  capabilâ€
       ity.

CLONE_NEWNS
       This  flag  has the same effect as the clone(2) CLONE_NEWNS flag.  Unshare the mount namespace,
       so that the calling process has a private copy of its namespace which is not  shared  with  any
       other  process.   Specifying  this  flag  automatically  implies  CLONE_FS  as  well.   Use  of
       CLONE_NEWNS requires the CAP_SYS_ADMIN capability.

CLONE_NEWUTS (since Linux 2.6.19)
       This flag has the same effect as the clone(2) CLONE_NEWUTS flag.  Unshare the  UTS  IPC  namesâ€
       pace,  so  that the calling process has a private copy of the UTS namespace which is not shared
       with any other process.  Use of CLONE_NEWUTS requires the CAP_SYS_ADMIN capability.

CLONE_SYSVSEM (since Linux 2.6.26)
       This flag reverses the effect of the clone(2) CLONE_SYSVSEM flag.  Unshare System  V  semaphore
       undo  values, so that the calling process has a private copy which is not shared with any other
       process.  Use of CLONE_SYSVSEM requires the CAP_SYS_ADMIN capability.
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="ç¡¬ä»¶ä¿¡æ¯è¯»å–"><a class="header" href="#ç¡¬ä»¶ä¿¡æ¯è¯»å–">ç¡¬ä»¶ä¿¡æ¯è¯»å–</a></h1>
<h2 id="è¯»å–cpuä¸ªæ•°"><a class="header" href="#è¯»å–cpuä¸ªæ•°">è¯»å–CPUä¸ªæ•°</a></h2>
<p>è¯»å–ç³»ç»Ÿé…ç½®çš„cpuä¸ªæ•°å’Œå¯ç”¨çš„cpuä¸ªæ•°å’Œï¼Œ<code>man get_nprocs</code>ï¼š</p>
<pre><code class="language-c">#include &lt;sys/sysinfo.h&gt;

int get_nprocs_conf(void);
int get_nprocs(void);
</code></pre>
<p><code>get_nprocs_conf()</code>è¿”å›çš„é…ç½®çš„CPUä¸ªæ•°å¯èƒ½ä¼šå¤§äº<code>get_nprocs()</code>è¿”å›çš„å¯ç”¨çš„CPUä¸ªæ•°ï¼Œå› ä¸ºCPUå¯èƒ½ç¦»çº¿ï¼ˆofflineï¼‰ä¸å¯ç”¨ã€‚</p>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="go-è¯­è¨€ç¼–ç¨‹æ‰‹å†Œ"><a class="header" href="#go-è¯­è¨€ç¼–ç¨‹æ‰‹å†Œ">Go è¯­è¨€ç¼–ç¨‹æ‰‹å†Œ</a></h1>
<p>è®°å½•ä¸€äº› Go è¯­è¨€çš„å¸¸è¯†ï¼Œä¸»è¦ç›®çš„æ˜¯åœ¨é•¿æ—¶é—´ä¸å†™ä»£ç åï¼Œèƒ½å¤Ÿé€šè¿‡è¿™ä»½ç¬”è®°å¿«é€Ÿå›æƒ³èµ·æ¥ã€‚</p>
<p>goè¯­è¨€çš„è®¾è®¡ç›®æ ‡æ˜¯<code>é€šç”¨</code>çš„<code>ç³»ç»Ÿ</code>ç¼–ç¨‹è¯­è¨€ã€‚</p>
<blockquote>
<p>Go is a general-purpose language designed with systems programming in mind. It is strongly typed and garbage-collected and has explicit support for concurrent programming. Programs are constructed from packages, whose properties allow efficient management of dependencies. The existing implementations use a traditional compile/link model to generate executable binaries. </p>
</blockquote>
<p>é€šç”¨ï¼Œæ„å‘³ç€å¯ä»¥ç”¨goè¯­è¨€åšå¾ˆå¤šäº‹æƒ…ï¼Œä¸å—é¢†åŸŸçš„é™åˆ¶ã€‚å¯ä»¥ç”¨å®ƒæ¥å†™åå°ç¨‹åºã€åº”ç”¨ç¨‹åºï¼Œä¹Ÿå¯ä»¥ç”¨æ¥åšæ•°æ®å¤„ç†ã€åˆ†æå†³ç­–ã€‚ä¸é€šç”¨ç›¸å¯¹çš„æ˜¯<code>ä¸“ç”¨</code>ï¼Œä¾‹å¦‚matlabä¹Ÿæ˜¯ä¸€é—¨ç¼–ç¨‹è¯­è¨€ï¼Œä½†å®ƒåªèƒ½ç”¨æ¥åšæ•°æ®å¤„ç†ã€‚ç›¸æ¯”ä¹‹ä¸‹goè¯­è¨€å¯ä»¥åšçš„äº‹æƒ…ä¸°å¯Œå¤šäº†ï¼Œä½†goå¯ä»¥åšä¸ç­‰äºå®ƒåšçš„æ›´å¥½ï¼Œè­¬å¦‚è¦åšæ•°æ®ç»Ÿè®¡å¤„ç†ï¼Œè¿˜æ˜¯ç”¨matlabã€Rç­‰è¯­è¨€åˆé€‚ã€‚</p>
<p>ç³»ç»Ÿï¼Œæ˜¯æŒ‡goè¯­è¨€æ˜¯é¢å‘æ“ä½œç³»ç»Ÿçš„ï¼Œä½¿ç”¨goå¼€å‘çš„ç¨‹åºç›´æ¥åœ¨æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨æ“ä½œç³»ç»Ÿçš„æ¥å£ã€‚Cã€C++éƒ½æ˜¯ç³»ç»Ÿè¯­è¨€ï¼ŒJavaä¸æ˜¯ã€‚ç”¨Javaå¼€å‘çš„ç¨‹åºæ˜¯è¿è¡Œåœ¨JVMä¸Šçš„ï¼Œè¿è¡Œåœ¨æ“ä½œç³»ç»Ÿä¸Šçš„JVMä»£ä¸ºè°ƒç”¨æ“ä½œç³»ç»Ÿçš„æ¥å£ã€‚åŒç†ï¼ŒHTMLã€Javascriptã€Excelä¸­çš„å®è¯­è¨€ç­‰ä¹Ÿä¸æ˜¯ç³»ç»Ÿç¼–ç¨‹è¯­è¨€ã€‚( <a href="https://en.wikipedia.org/wiki/System_programming_language" title="System programming language">System programming language</a>)</p>
<p>å­¦ä¹ èµ„æ–™ï¼š</p>
<ul>
<li><a href="https://golang.org/" title="golang.org">golang.org</a></li>
<li><a href="https://golang.org/" title="golang.org">golang documentation</a></li>
<li><a href="https://golang.org/doc/" title="golang documentation">The Go Programming Language Specification</a></li>
</ul>
<h2 id="å‚è€ƒ-3"><a class="header" href="#å‚è€ƒ-3">å‚è€ƒ</a></h2>
<ol>
<li><a href="https://www.lijiaocn.com" title="æä½¶æ¾³çš„åšå®¢">æä½¶æ¾³çš„åšå®¢</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="go-è¯­è¨€çš„å®‰è£…å’Œæ–‡æ¡£"><a class="header" href="#go-è¯­è¨€çš„å®‰è£…å’Œæ–‡æ¡£">Go è¯­è¨€çš„å®‰è£…å’Œæ–‡æ¡£</a></h1>
<p>ä¸‹é¢æ˜¯åœ¨linuxç³»ç»Ÿä¸Šå®‰è£…goçš„æ­¥éª¤ï¼Œåœ¨macä¸Šå®‰è£…ä¹Ÿæ˜¯ç±»ä¼¼çš„è¿‡ç¨‹ã€‚</p>
<h2 id="ä¸‹è½½è½¯ä»¶åŒ…"><a class="header" href="#ä¸‹è½½è½¯ä»¶åŒ…">ä¸‹è½½è½¯ä»¶åŒ…</a></h2>
<p>åˆ°golangå®˜æ–¹ç½‘ç«™çš„<a href="https://golang.org/dl/" title="golang.org download">ä¸‹è½½é¡µ</a>ä¸‹è½½è½¯ä»¶åŒ…ï¼Œgolangçš„ç½‘ç«™<code>https://golang.org</code>éœ€è¦ç¿»å¢™è®¿é—®ã€‚</p>
<p>å¦‚æœä¸èƒ½ç¿»å¢™ï¼Œå¯ä»¥åˆ°golangä¸­å›½çš„<a href="https://www.golangtc.com/download" title="golangtc.com download">ä¸‹è½½é¡µ</a>ä¸­ä¸‹è½½ï¼Œgolangä¸­å›½çš„ç½‘å€æ˜¯<code>https://www.golangtc.com</code>ã€‚</p>
<p>ä¸‹è½½é¡µåˆ—å‡ºæ¯ä¸ªç‰ˆæœ¬çš„è½¯ä»¶åŒ…çš„ä¿¡æ¯ï¼š</p>
<pre><code>go1.9.2.src.tar.gz           Source                         16MB   665f184bf8ac89986cfd5a4460736976f60b57df6b320ad71ad4cef53bb143dc
go1.9.2.darwin-amd64.tar.gz  Archive     macOS     x86-64   98MB   73fd5840d55f5566d8db6c0ffdd187577e8ebe650c783f68bd27cbf95bde6743
go1.9.2.darwin-amd64.pkg     Installer   macOS     x86-64   97MB   8b4f6ae6deae1150d2e341d02c247fd18a99af387516540eeb84702ffd76d3a1
go1.9.2.linux-386.tar.gz     Archive     Linux     x86      88MB   574b2c4b1a248e58ef7d1f825beda15429610a2316d9cbd3096d8d3fa8c0bc1a
go1.9.2.linux-amd64.tar.gz   Archive     Linux     x86-64   99MB   de874549d9a8d8d8062be05808509c09a88a248e77ec14eb77453530829ac02b
go1.9.2.linux-armv6l.tar.gz  Archive     Linux     ARMv6    86MB   8a6758c8d390e28ef2bcea511f62dcb43056f38c1addc06a8bc996741987e7bb
go1.9.2.windows-386.zip      Archive     Windows   x86      92MB   35d3be5d7b97c6d11ffb76c1b19e20a824e427805ee918e82c08a2e5793eda20
go1.9.2.windows-386.msi      Installer   Windows   x86      79MB   020ea4a53093dd98b5ad074c4e493ff52be0aa71eee89dc24ca7783cb528de97
go1.9.2.windows-amd64.zip    Archive     Windows   x86-64   104MB  682ec3626a9c45b657c2456e35cadad119057408d37f334c6c24d88389c2164c
go1.9.2.windows-amd64.msi    Installer   Windows   x86-64   90MB   daeb761aa6fdb22dc3954fd911963b347c44aa5c6ba974b9c01be7cbbd6922ba
</code></pre>
<p><code>src</code>è¡¨ç¤ºæºç ï¼Œ<code>darwin</code>è¡¨ç¤ºmacç³»ç»Ÿï¼Œ<code>linux</code>è¡¨ç¤ºlinuxç³»ç»Ÿï¼Œ<code>windows</code>è¡¨ç¤ºwindowsç³»ç»Ÿï¼Œ<code>386</code>è¡¨ç¤º32ä½å¹³å°ï¼Œ<code>amd64</code>è¡¨ç¤º64ä½å¹³å°ã€‚</p>
<p>è¿™é‡Œä»¥linuxç‰ˆæœ¬ä¸ºä¾‹ï¼Œé€‰æ‹©äº†<code>linux</code>å’Œ<code>amd64</code>ï¼Œå³è¿è¡Œåœ¨64ä½å¹³å°ä¸Šçš„linuxç³»ç»Ÿã€‚</p>
<blockquote>
<p>ç°åœ¨çš„CPUå‡ ä¹éƒ½æ˜¯64ä½çš„ï¼Œ64ä½è¿è¡Œæ•ˆç‡æ›´é«˜ï¼Œæ‰€ä»¥åº”å½“ä¼˜å…ˆé€‰æ‹©amd64ï¼Œé™¤ééå¸¸ç¡®å®šæ˜¯è¦åœ¨32å¹³å°ä¸Šå®‰è£…goã€‚</p>
</blockquote>
<p>ä¸‹è½½äº†å®‰è£…åŒ…ä¹‹åé¦–å…ˆåšä¸€ä¸‹æ ¡éªŒï¼ˆè¿™æ˜¯ä¸€ä¸ªè‰¯å¥½çš„ä¹ æƒ¯ï¼ï¼‰ã€‚</p>
<pre><code>$ sha256sum go1.9.2.linux-amd64.tar.gz
de874549d9a8d8d8062be05808509c09a88a248e77ec14eb77453530829ac02b  go1.9.2.linux-amd64.tar.gz
</code></pre>
<p>å¾—åˆ°çš„æ ¡éªŒç ä¸ç½‘ç«™ä¸Šå…¬å¸ƒçš„æ ¡éªŒç æ ¸å¯¹æ— è¯¯ä¹‹åï¼Œæ‰å¯ä»¥æ”¾å¿ƒçš„ä½¿ç”¨ã€‚</p>
<blockquote>
<p>ä¸ºä»€ä¹ˆè¦å¯¹ä¸‹è½½çš„æ–‡ä»¶åšæ ¡éªŒï¼Ÿ</p>
<p>äº’è”ç½‘å…¶å®å……æ»¡äº†å„ç§ç§˜å¯†çš„ï¼Œæˆ‘ä»¬ä»ç½‘ç»œä¸Šä¸‹è½½ä¸‹æ¥çš„æ–‡ä»¶å¾ˆæœ‰å¯èƒ½æ˜¯è¢«æ‰è¿‡åŒ…çš„ã€‚
å¾ˆå¤šäººéƒ½æœ‰åšè¿™ç§äº‹æƒ…çš„åŠ¨åŠ›ï¼Œè­¬å¦‚é»‘å®¢ã€è¿è¥å•†ã€æ£è›‹åˆ†å­ã€‚
ä½¿ç”¨ä¸€ä¸ªè¢«æ‰è¿‡åŒ…çš„æ–‡ä»¶æ˜¯éå¸¸å±é™©çš„ï¼Œå› ä¸ºæˆ‘ä»¬æ— æ³•é¢„çŸ¥å®ƒè¢«åšäº†ä»€ä¹ˆæ‰‹è„šã€‚
å› æ­¤ï¼Œä¸€å®šè¦å…»æˆä»å®˜ç½‘ä¸Šä¸‹è½½æ–‡ä»¶çš„ä¹ æƒ¯ï¼Œè€Œä¸”ä¸‹è½½å®Œæˆä¹‹åè¦åšæ ¡éªŒã€‚</p>
</blockquote>
<h2 id="è§£å‹è½¯ä»¶åŒ…"><a class="header" href="#è§£å‹è½¯ä»¶åŒ…">è§£å‹è½¯ä»¶åŒ…</a></h2>
<p>å°†ä¸‹è½½çš„è½¯ä»¶åŒ…è§£å‹åˆ°æŒ‡å®šç›®å½•ä¸­ï¼Œä¸ºgoå•ç‹¬å»ºç«‹ä¸€ä¸ªç›®å½•ã€‚</p>
<pre><code># mkdir -p /opt/go/1.9.2
# tar -C /opt/go/1.9.2/ -xzf go1.9.2.linux-amd64.tar.gz
</code></pre>
<p>è§£å‹å®Œæˆåï¼Œåœ¨æ–°å»ºçš„ç›®æ ‡ç›®å½•ä¸­ï¼Œæœ‰ä¸€ä¸ªgoç›®å½•ï¼Œè¿™ä¸ªç›®å½•é‡Œå­˜æ”¾äº†goçš„æ‰€æœ‰æ–‡ä»¶ã€‚</p>
<pre><code>$ ls /opt/go/1.9.2/
go
</code></pre>
<h2 id="æ·»åŠ goå‘½ä»¤"><a class="header" href="#æ·»åŠ goå‘½ä»¤">æ·»åŠ goå‘½ä»¤</a></h2>
<p>goå‘½ä»¤ä½äº<code>/opt/go/1.9.2/bin/</code>ç›®å½•ä¸­ï¼š</p>
<pre><code>$ ls /opt/go/1.9.2/go/bin/
go  godoc  gofmt
</code></pre>
<p>å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼š</p>
<pre><code>$ /opt/go/1.9.2/go/bin/go version
go version go1.9.2 linux/amd64
</code></pre>
<p>ä¸ºäº†æ–¹ä¾¿ï¼Œéœ€è¦å°†<code>/opt/go/1.9.2/go/bin/</code>æ·»åŠ åˆ°ç¯å¢ƒå˜é‡<code>PATH</code>ä¸­ï¼š</p>
<pre><code>$ echo 'export PATH=$PATH:/opt/go/1.9.2/go/bin/' &gt;&gt;~/.bash_profile
$ source ~/.bash_profile
</code></pre>
<p>è¿™æ ·å°±å¯ä»¥ç›´æ¥åœ¨å‘½ä»¤è¡Œæ‰§è¡Œgoå‘½ä»¤ï¼š</p>
<pre><code>$ go version
go version go1.4.2 linux/amd64
</code></pre>
<h2 id="godoc-æ–‡æ¡£"><a class="header" href="#godoc-æ–‡æ¡£">Godoc æ–‡æ¡£</a></h2>
<p>godoc æ˜¯ go çš„ä¸€ä¸ªå‘½ä»¤ï¼Œæä¾›äº†å¯ä»¥åœ¨æœ¬åœ°æµè§ˆçš„ go æ–‡æ¡£ã€‚godoc é»˜è®¤ä½äº go çš„å®‰è£…åŒ…ä¸­ï¼Œä¸ go å‘½ä»¤ä½äºåŒä¸€ä¸ªç›®å½•ä¸­ï¼Œå®‰è£…äº† go ä»¥åå°±å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</p>
<pre><code>$ godoc -h
usage: godoc package [name ...]
        godoc -http=:6060
...
</code></pre>
<p>è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå³å¯å¯åŠ¨ä¸€ä¸ªå¯ä»¥åœ¨æœ¬åœ°è®¿é—®çš„godocç½‘ç«™ï¼š</p>
<pre><code>$ godoc -http=:6060
</code></pre>
<p>ç”¨æµè§ˆå™¨æ‰“å¼€ http://127.0.0.1:6060/ï¼Œå°±å¯ä»¥çœ‹åˆ°è¿è¡Œåœ¨æœ¬åœ°çš„ godoc ç«™ç‚¹ã€‚å†…å®¹ä¸ <a href="https://www.golangtc.com/download" title="golangtc.com download">golang.org</a> ç›¸åŒï¼Œç”±äº”éƒ¨åˆ†ç»„æˆï¼›</p>
<pre><code>Documents
Packages
The Project
Help
Blog
</code></pre>
<p><a href="https://golang.org/doc/" title="go Documents">Documents</a>ä¸­åŒ…å«çš„ä¿¡æ¯æœ€å…¨ï¼Œéœ€è¦ä»”ç»†é˜…è¯»ã€‚ä¾‹å¦‚<a href="https://golang.org/doc/cmd" title="go Command Documentation">Command Documentation</a>ã€<a href="https://golang.org/ref/spec" title="The Go Programming Language Specification">The Go Programming Language Specification</a>ã€‚</p>
<p>ç‰¹åˆ«æ˜¯<a href="https://golang.org/ref/spec" title="The Go Programming Language Specification">The Go Programming Language Specification</a>ï¼Œå®ƒå¯¹goè¯­è¨€è¯­æ³•çš„è¯´æ˜æ˜¯æœ€ç»†è‡´ç²¾ç¡®ã€æœ€æƒå¨çš„ã€‚</p>
<p>go é¡¹ç›®ä»‹ç»ï¼š<a href="https://golang.org/project/" title="go Project">Project</a></p>
<p>go Packageæ–‡æ¡£ï¼š<a href="https://golang.org/pkg/" title="go Packages">Packages</a></p>
<p>go å¸®åŠ©æ‰‹å†Œï¼š<a href="https://golang.org/help/" title="go Help">Help</a></p>
<p>go æœ€æ–°åŠ¨æ€ï¼š<a href="https://golang.org/blog/" title="go Blog">Blog</a></p>
<h2 id="å‚è€ƒ-4"><a class="header" href="#å‚è€ƒ-4">å‚è€ƒ</a></h2>
<ol>
<li><a href="https://www.lijiaocn.com" title="æä½¶æ¾³çš„åšå®¢">æä½¶æ¾³çš„åšå®¢</a></li>
<li><a href="https://golang.org/dl/" title="golang.org download">golang.org download</a></li>
<li><a href="https://www.golangtc.com/download" title="golangtc.com download">golangtc.com download</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="åŸºç¡€è¯­æ³•"><a class="header" href="#åŸºç¡€è¯­æ³•">åŸºç¡€è¯­æ³•</a></h1>
<blockquote>
<p>å­¦ä¹ æ˜¯ä¸€ä¸ªå¾ªåºæ¸è¿›è¿‡ç¨‹ã€‚</p>
</blockquote>
<p>æ²¡æœ‰ç¼–ç¨‹ç»éªŒåˆå­¦è€…ï¼Œä¸åº”å½“ä¸€å¼€å§‹å°±è¯•å›¾æŒæ¡æ‰€æœ‰è¯­æ³•ç»†èŠ‚ï¼Œè€Œåº”å½“å¤šå†™ç¨‹åºã€å¤šå°è¯•ï¼Œæ‰¾åˆ°æ­£ç¡®çš„åšäº‹æ–¹æ³•ã€‚ç¼–ç¨‹å¤šå¹´çš„ç¨‹åºå‘˜ï¼Œè¦è„±ç¦»æ•™æï¼Œè¦èƒ½å¤Ÿçœ‹æ‡‚ã€ä½¿ç”¨æ›´å…¨é¢ç²¾ç¡®çš„ä¸€æ‰‹èµ„æ–™ã€‚</p>
<p><a href="https://golang.org/ref/spec" title="The Go Programming Language Specification">The Go Programming Language Specification</a>æ˜¯goè¯­æ³•çš„ä¸€æ‰‹èµ„æ–™ï¼Œæ˜¯è¿™ä¸€ç« å†…å®¹çš„ä¸»è¦æ¥æºã€‚</p>
<blockquote>
<p>è¿˜è®°å¾—å­¦ä¹ ç¬¬ä¸€é—¨ç¼–ç¨‹è¯­è¨€çš„è¿‡ç¨‹å—ï¼Ÿæˆ‘çš„ç¬¬ä¸€é—¨ç¼–ç¨‹è¯­è¨€æ˜¯Cï¼Œä¸»è¦ä»ä¹¦æœ¬ä¸Šå­¦ä¹ å®ƒçš„è¯­æ³•ã€‚åæ¥çŸ¥é“äº†ANSI Cã€GNU Cã€ä»¥åŠC99ç­‰çš„å­˜åœ¨ï¼Œå¼€å§‹å°è¯•å»çœ‹Cçš„è¯­æ³•è¯´æ˜ã€‚æ— å¥ˆï¼Œé‚£æ—¶å€™çš„æ ¹åŸºå®åœ¨å¤ªå·®ï¼Œå®Œå…¨çœ‹ä¸æ‡‚ï¼Œä¹Ÿæ²¡èƒ½åšæŒä¸‹å»ã€‚goæ˜¯ä¸€é—¨å¾ˆå¹´è½»ã€å¾ˆå¹´è½»çš„è¯­è¨€ï¼Œå®ƒçš„è¯­æ³•è¯´æ˜ä¸­ä½¿ç”¨çš„å¥å­ è¦é€šä¿—æ˜“æ‡‚å¤ªå¤šäº†ã€‚</p>
</blockquote>
<h2 id="å‚è€ƒ-5"><a class="header" href="#å‚è€ƒ-5">å‚è€ƒ</a></h2>
<ol>
<li><a href="https://golang.org/ref/spec" title="The Go Programming Language Specification">The Go Programming Language Specification</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="goè¯­è¨€çš„è¯æ³•è§„åˆ™"><a class="header" href="#goè¯­è¨€çš„è¯æ³•è§„åˆ™">goè¯­è¨€çš„è¯æ³•è§„åˆ™</a></h1>
<p>è‹±è¯­æœ‰å•è¯ï¼Œæ±‰è¯­æœ‰è¯è¯­ï¼Œç¼–ç¨‹è¯­è¨€ä¹Ÿæœ‰è‡ªå·±çš„è¯æ±‡ã€‚</p>
<p>å¾ˆå¤šå·¥ä½œå¤šå¹´çš„ç¨‹åºå‘˜éƒ½æ²¡æœ‰ä»è¯­è¨€çš„å±‚é¢äº†è§£è‡ªå·±æ­£åœ¨ä½¿ç”¨çš„ç¨‹åºè¯­è¨€ã€‚è¿™ä¸åº”å½“è¢«æ‰¹è¯„è°´è´£ï¼Œ<code>ç¨‹åºè¯­è¨€è®¾è®¡</code>æ˜¯ä¸€ä¸ªå¤§ç‰›äº‘é›†çš„å°ä¼—é¢†åŸŸï¼Œè€Œç¨‹åºå‘˜æ˜¯ä½¿ç”¨ç¨‹åºè¯­è¨€çš„èŠ¸èŠ¸å¤§ä¼—ã€‚</p>
<p>ç»å¤§å¤šæ•°ç¨‹åºå‘˜çš„ä»»åŠ¡æ˜¯ä½¿ç”¨ç¨‹åºè¯­è¨€å¼€å‘å‡ºè½¯ä»¶ï¼Œè€Œä¸æ˜¯è®¾è®¡ç¨‹åºè¯­è¨€ï¼Œæ­£å¦‚å¨å¸ˆçš„ä»»åŠ¡æ˜¯åšå‡ºç¾å‘³ä½³è‚´ï¼Œè€Œä¸æ˜¯åˆ¶ä½œé”…ç¢—ç“¢ç›†å’Œç”Ÿäº§åŸææ–™ã€‚</p>
<p>ä½†ï¼Œäº†è§£ä¸€ä¸‹è¿˜æ˜¯æœ‰å¥½å¤„çš„ï¼Œèƒ½å¤Ÿä»æ›´é«˜çš„å±‚é¢ã€æ›´æŠ½è±¡çš„çœ‹é—®é¢˜ï¼Œè¿™å¾ˆé‡è¦ã€‚</p>
<p>goè¯­è¨€ä½¿ç”¨çš„ç¼–ç æ˜¯utf-8ï¼Œç”¨goè¯­è¨€å†™çš„æºä»£ç æ˜¯utf-8ç¼–ç çš„æ–‡æœ¬æ–‡ä»¶ã€‚</p>
<h2 id="æ„æˆè¦ç´ "><a class="header" href="#æ„æˆè¦ç´ ">æ„æˆè¦ç´ </a></h2>
<p>è‹±è¯­å•è¯çš„æ„æˆè¦ç´ æ˜¯å­—æ¯ï¼Œæ±‰è¯­è¯è¯­çš„æ„æˆè¦ç´ æ˜¯å­—ï¼Œgoè¯­è¨€è¯æ±‡çš„æ„æˆè¦ç´ æ˜¯å­—ç¬¦ã€‚</p>
<p>å­—ç¬¦(Characters)ã€å­—æ¯(Letters)ã€æ•°å­—(Digits)</p>
<h3 id="å­—ç¬¦characters"><a class="header" href="#å­—ç¬¦characters">å­—ç¬¦(Characters)</a></h3>
<p>goè¯­è¨€ç”¨utf-8ç¼–ç ï¼Œå®ƒå®Œå…¨æ˜¯ç”±ä¸‹é¢çš„å­—ç¬¦(Characters)ç»„æˆçš„ã€‚</p>
<pre><code>newline        = /* the Unicode code point U+000A */ .
unicode_char   = /* an arbitrary Unicode code point except newline */ .
unicode_letter = /* a Unicode code point classified as &quot;Letter&quot; */ .
unicode_digit  = /* a Unicode code point classified as &quot;Number, decimal digit&quot; */ .
</code></pre>
<h3 id="å­—æ¯lettersæ•°å­—digits"><a class="header" href="#å­—æ¯lettersæ•°å­—digits">å­—æ¯(Letters)ã€æ•°å­—(Digits)</a></h3>
<p>goè¯­è¨€å°†éƒ¨åˆ†utf-8å­—ç¬¦ç§°ä¸ºå­—æ¯(letter)ä¸æ•°å­—(digit)ã€‚</p>
<pre><code>letter        = unicode_letter | &quot;_&quot; .
decimal_digit = &quot;0&quot; â€¦ &quot;9&quot; .
octal_digit   = &quot;0&quot; â€¦ &quot;7&quot; .
hex_digit     = &quot;0&quot; â€¦ &quot;9&quot; | &quot;A&quot; â€¦ &quot;F&quot; | &quot;a&quot; â€¦ &quot;f&quot; .
</code></pre>
<h2 id="æ³¨é‡Šcomments"><a class="header" href="#æ³¨é‡Šcomments">æ³¨é‡Š(Comments)</a></h2>
<p>æ³¨é‡Šæœ‰<code>å•è¡Œæ³¨é‡Š</code>(line comments)å’Œ<code>é€šç”¨æ³¨é‡Š</code>(general comments)ä¸¤ç§å½¢å¼ã€‚</p>
<p>å•è¡Œæ³¨é‡Šä»¥<code>//</code>å¼€å§‹ï¼Œåˆ°è¡Œå°¾ç»“æŸã€‚</p>
<p>é€šç”¨æ³¨é‡Šä»¥<code>/*</code>å¼€å§‹ï¼Œåˆ°<code>*/</code>ç»“æŸã€‚</p>
<p>æ³¨é‡Šä¸èƒ½ä½äºå­—ç¬¦(rune)ã€å­—ç¬¦ä¸²(string literal)å’Œå¦ä¸€ä¸ªæ³¨é‡Šå½“ä¸­ã€‚</p>
<h2 id="è¯æ±‡tokens"><a class="header" href="#è¯æ±‡tokens">è¯æ±‡(Tokens)</a></h2>
<p>Tokensæ˜¯ä¸€ä¸ªç»Ÿç§°ï¼Œå®ƒç”±æ ‡è¯†ç¬¦ã€å…³é”®å­—ã€è¿ç®—ç¬¦ã€åˆ†éš”ç¬¦ã€æ•´æ•°ã€æµ®ç‚¹æ•°ã€è™šæ•°ã€å­—ç¬¦ã€å­—ç¬¦ä¸²ç»„æˆã€‚</p>
<p>ç®€è€Œè¨€ä¹‹ï¼Œåœ¨ä¸€ä¸ªgoæ–‡ä»¶ä¸­ï¼Œå»æ‰ç©ºæ ¼(spaces, U+0020)ã€TAB(horizontal tabs, U+0009)ã€å›è½¦(carriage returns, U+000D)ã€æ¢è¡Œ(newlines, U+000A)ã€åˆ†å·(Semicolons)ä¹‹åï¼Œå‰©ä¸‹è‚‰çœ¼å¯è§çš„éƒ¨åˆ†å°±æ˜¯Tokensã€‚</p>
<p>Tokensæ˜¯ç¼–è¯‘åŸç†ä¸­ä¸€ä¸ªå¸¸ç”¨çš„æœ¯è¯­ã€‚ç¼–è¯‘å™¨åœ¨è¿›è¡Œè¯æ³•åˆ†æçš„æ—¶å€™ï¼Œä¼šè¿ç»­çš„è¯»å–æºç æ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œå®ƒä»ç¬¬ä¸€ä¸ªéç©ºç™½çš„ç¬¦å·å¼€å§‹è®°å½•ï¼Œé‡åˆ°ä¸‹ä¸€ä¸ªç©ºç™½çš„ç¬¦å·åï¼Œå°†å·²ç»è®°å½•çš„å†…å®¹ä½œä¸ºä¸€ä¸ªTokenã€‚</p>
<h2 id="åˆ†å·semicolons"><a class="header" href="#åˆ†å·semicolons">åˆ†å·(Semicolons)</a></h2>
<p>å¾ˆå¤šç¼–ç¨‹è¯­è¨€éƒ½ç”¨â€œ;â€ä½œä¸ºç»“æŸç¬¦å·ï¼Œæ ‡è®°ä¸€è¡Œä»£ç çš„ç»“æŸã€‚goè¯­è¨€ä¹Ÿç”¨åˆ†å·åšç»“æŸç¬¦ï¼Œä½†æ˜¯åœ¨æºç ä¸­å¯ä»¥ä¸å†™å‡ºåˆ†å·ï¼Œgoå¯ä»¥è‡ªä¸»æ¨æ–­å‡ºæ˜¯å¦ç»“æŸã€‚</p>
<p>å½“ä¸€è¡Œä»£ç çš„æœ€åä¸€ä¸ªTokenæ˜¯ä¸‹é¢çš„ç±»å‹æ—¶ï¼Œgoä¼šè‡ªåŠ¨åœ¨è¡Œå°¾è¡¥ä¸Šåˆ†å·ï¼š</p>
<pre><code>æ ‡è¯†ç¬¦(identifier)
æ•´æ•°ã€æµ®ç‚¹æ•°ã€è™šæ•°ã€å­—(rune)ã€å­—ç¬¦ä¸²
å…³é”®å­—ï¼šbreakã€continueã€fallthroughã€return
è¿ç®—ç¬¦å’Œåˆ†éš”ç¬¦ï¼š++ã€--ã€)ã€]ã€}
</code></pre>
<h2 id="æ ‡è¯†ç¬¦identifiers"><a class="header" href="#æ ‡è¯†ç¬¦identifiers">æ ‡è¯†ç¬¦(Identifiers)</a></h2>
<p>æ ‡è¯†ç¬¦æ˜¯ç”¨æ¥ç´¢å¼•ç¨‹åºä¸­çš„å®ä½“(entities)çš„ã€‚</p>
<p>è­¬å¦‚è¯´å˜é‡ã€å¸¸é‡ã€å‡½æ•°ç­‰ï¼Œè¿™äº›éƒ½æ˜¯ç¨‹åºä¸­çš„entityï¼Œå®ƒä»¬éœ€è¦æœ‰ä¸€ä¸ªåå­—ï¼Œè¿™ä¸ªåå­—å°±æ˜¯å®ƒä»¬çš„æ ‡è¯†ç¬¦ã€‚</p>
<p>å½“æˆ‘ä»¬è¯´å˜é‡Açš„æ—¶å€™ï¼Œå…¶å®æ˜¯åœ¨æŒ‡æ ‡è¯†ç¬¦Aå…³è”çš„æ•°å€¼ã€‚</p>
<p>goçš„æ ‡è¯†ç¬¦è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p>
<pre><code>identifier = letter { letter | unicode_digit } .
</code></pre>
<p>å³ï¼Œç”±å­—æ¯å’Œæ•°å­—ç»„æˆï¼Œä½†å¿…é¡»ä»¥å­—æ¯å¼€å¤´ï¼Œä¸”ä¸èƒ½æ˜¯å…³é”®å­—ã€‚</p>
<h2 id="å…³é”®å­—keywords"><a class="header" href="#å…³é”®å­—keywords">å…³é”®å­—(Keywords)</a></h2>
<p>å…³é”®å­—æ˜¯goè¯­è¨€ä¿ç•™çš„ä¸€äº›å•è¯ï¼Œå®ƒä»¬éƒ½æ˜¯ç”±ç‰¹å®šåŠŸèƒ½çš„ï¼Œä¸ç”¨ç”¨æ¥åšæ ‡è¯†ç¬¦ã€‚</p>
<p>å…³é”®å­—çš„æ•°é‡æ˜¯æœ‰é™çš„ï¼Œä¸‹é¢æ˜¯goçš„å…¨éƒ¨å…³é”®å­—ï¼š</p>
<pre><code>break        default      func         interface    select
case         defer        go           map          struct
chan         else         goto         package      switch
const        fallthrough  if           range        type
continue     for          import       return       var
</code></pre>
<h2 id="è¿ç®—ç¬¦å’Œåˆ†éš”ç¬¦operators-and-delimiters"><a class="header" href="#è¿ç®—ç¬¦å’Œåˆ†éš”ç¬¦operators-and-delimiters">è¿ç®—ç¬¦å’Œåˆ†éš”ç¬¦(Operators and Delimiters)</a></h2>
<p>è¿ç®—ç¬¦å’Œåˆ†éš”ç¬¦æ˜¯ä¸€ç±»æœ‰ç‰¹æ®Šçš„æ„ä¹‰çš„éå­—æ¯ç¬¦å·ã€‚</p>
<p>å®ƒä»¬çš„æ•°é‡ä¹Ÿæ˜¯æœ‰é™çš„ï¼Œä¸‹é¢æ˜¯goçš„å…¨éƒ¨è¿ç®—ç¬¦å’Œåˆ†éš”ç¬¦ï¼š</p>
<pre><code>+    &amp;     +=    &amp;=     &amp;&amp;    ==    !=    (    )
-    |     -=    |=     ||    &lt;     &lt;=    [    ]
*    ^     \*=    ^=     &lt;-    &gt;     &gt;=    {    }
/    &lt;&lt;    /=    &lt;&lt;=    ++    =     :=    ,    ;
%    &gt;&gt;    %=    &gt;&gt;=    --    !     ...   .    :
     &amp;^          &amp;^=
</code></pre>
<h2 id="æ•´æ•°integer-literals"><a class="header" href="#æ•´æ•°integer-literals">æ•´æ•°(Integer literals)</a></h2>
<p>æ•´æ•°å°±æ˜¯æ•°å­¦æ„ä¹‰ä¸Šçš„æ•´æ•°ï¼Œåœ¨goä¸­æœ‰åè¿›åˆ¶ã€å…«è¿›åˆ¶ã€åå…­è¿›åˆ¶ä¸‰ç§è¡¨ç¤ºæ–¹å¼ã€‚</p>
<pre><code>int_lit     = decimal_lit | octal_lit | hex_lit .
decimal_lit = ( &quot;1&quot; â€¦ &quot;9&quot; ) { decimal_digit } .
octal_lit   = &quot;0&quot; { octal_digit } .
hex_lit     = &quot;0&quot; ( &quot;x&quot; | &quot;X&quot; ) hex_digit { hex_digit } .
</code></pre>
<p>æ³¨æ„ï¼Œæ²¡æœ‰2è¿›åˆ¶çš„è¡¨ç¤ºæ–¹å¼ã€‚</p>
<p>æ³¨æ„ï¼Œ<code>decimal_digit</code>å‰é¢ç« èŠ‚ä¸­ç»™å‡ºçš„æ•°å­—ï¼Œåé¢å†é‡åˆ°å‰é¢å·²ç»å®šä¹‰çš„è¯æ³•æ—¶ï¼Œä¸å†æç¤ºã€‚</p>
<p>åœ¨åå…­è¿›åˆ¶è¡¨ç¤ºæ–¹å¼ä¸­ï¼Œå¤§å†™å­—æ¯ä¸å°å†™å­—æ¯çš„å«ä¹‰æ˜¯ç›¸åŒçš„ã€‚</p>
<pre><code>42            //åè¿›åˆ¶
0600          //å…«è¿›åˆ¶ï¼Œä»¥0å¼€å¤´
0xBadFace     //åå…­è¿›åˆ¶ï¼Œä»¥0xå¼€å¤´ï¼Œå¿½ç•¥å¤§å°å†™
</code></pre>
<h2 id="æµ®ç‚¹æ•°floating-point-literals"><a class="header" href="#æµ®ç‚¹æ•°floating-point-literals">æµ®ç‚¹æ•°(Floating-point literals)</a></h2>
<p>æµ®ç‚¹æ•°å°±æ˜¯æ•°å­¦ä¸Šçš„æµ®ç‚¹æ•°ï¼Œå¸¦æœ‰å°æ•°ç‚¹çš„æ•°ï¼Œgoæ”¯æŒç”¨ç§‘å­¦è®¡æ•°è¡¨ç¤ºæµ®ç‚¹æ•°ã€‚</p>
<pre><code>float_lit = decimals &quot;.&quot; [ decimals ] [ exponent ] |
            decimals exponent |
            &quot;.&quot; decimals [ exponent ] .
decimals  = decimal_digit { decimal_digit } .
exponent  = ( &quot;e&quot; | &quot;E&quot; ) [ &quot;+&quot; | &quot;-&quot; ] decimals .
</code></pre>
<p>æµ®ç‚¹æ•°å¯ä»¥æœ‰ä»¥ä¸‹å‡ ç§æ ·å¼ï¼š</p>
<pre><code>0.
72.40
072.40          //== 72.40
2.71828
1.e+0
6.67428e-11
1E6
.25
.12345E+5
</code></pre>
<p>æ³¨æ„åœ¨æµ®ç‚¹æ•°ä¸­ï¼Œå…¨æ˜¯åè¿›åˆ¶ï¼Œæ²¡æœ‰å…«è¿›åˆ¶å’Œåå…­è¿›åˆ¶ï¼Œ<code>0720.40</code>ç­‰äº<code>720.40</code>ã€‚</p>
<h2 id="è™šæ•°imaginary-literals"><a class="header" href="#è™šæ•°imaginary-literals">è™šæ•°(Imaginary literals)</a></h2>
<p>è™šæ•°æ˜¯å¤æ•°çš„ç»„æˆéƒ¨åˆ†ï¼Œåœ¨æ ·å¼ä¸Šï¼Œå®ƒå°±æ˜¯åœ¨æ•´æ•°æˆ–è€…æµ®ç‚¹æ•°åé¢åŠ ä¸Šâ€œiâ€ã€‚</p>
<pre><code>imaginary_lit = (decimals | float_lit) &quot;i&quot; .
</code></pre>
<p>è™šæ•°ä¹Ÿåªèƒ½ç”¨åè¿›åˆ¶è¡¨ç¤ºã€‚</p>
<pre><code>0i
011i  // == 11i
0.i
2.71828i
1.e+0i
6.67428e-11i
1E6i
.25i
.12345E+5i
</code></pre>
<h2 id="ç¬¦å·rune-literals"><a class="header" href="#ç¬¦å·rune-literals">ç¬¦å·(Rune literals)</a></h2>
<p>åœ¨goè¯­è¨€ä¸­ï¼ŒRune literalå°±æ˜¯ä¸€ä¸ªutf-8å­—ç¬¦çš„å€¼ã€‚</p>
<p>goè¯­è¨€ä½¿ç”¨utf8ç¼–ç ï¼Œutf8æ˜¯ä¸€ç§å˜é•¿çš„ç¼–ç ï¼Œå®ƒä½¿ç”¨1ï½4ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªç¬¦å·ã€‚</p>
<p>è¿™æ ·çš„ç¬¦å·ç”¨Cè¯­è¨€ä¸­çš„charæ¥æŒ‡ç¤ºï¼Œæ˜æ˜¾æ˜¯ä¸åˆé€‚çš„ï¼Œå› ä¸ºcharè¦æ±‚ç©ºé—´å¿…é¡»æ˜¯1ä¸ªbyteã€‚</p>
<p>å½“è¦å¯¹è¿™æ ·çš„å­—ç¬¦è¿›è¡Œå¤„ç†çš„æ—¶å€™ï¼Œéœ€è¦æœ‰ä¸€ä¸ªç§°å‘¼æ¥æŒ‡ç¤ºå®ƒï¼Œè¿™ä¸ªç§°å‘¼å°±æ˜¯<code>Rune</code>ã€‚</p>
<p>Runeï¼Œæ˜¯ä¸€ä¸ªå•ä¸€æ„ä¹‰çš„ç¬¦å·ï¼Œå®ƒå ç”¨çš„ç©ºé—´æ˜¯ä¸å›ºå®šçš„ã€‚</p>
<p>goè¯­è¨€ä¸­ï¼Œruneçš„è¯­æ³•æœ‰ä¸€äº›å¤æ‚ï¼š</p>
<pre><code>rune_lit         = &quot;'&quot; ( unicode_value | byte_value ) &quot;'&quot; .
unicode_value    = unicode_char | little_u_value | big_u_value | escaped_char .
byte_value       = octal_byte_value | hex_byte_value .
octal_byte_value = `\` octal_digit octal_digit octal_digit .
hex_byte_value   = `\` &quot;x&quot; hex_digit hex_digit .
little_u_value   = `\` &quot;u&quot; hex_digit hex_digit hex_digit hex_digit .
big_u_value      = `\` &quot;U&quot; hex_digit hex_digit hex_digit hex_digit
                           hex_digit hex_digit hex_digit hex_digit .
escaped_char     = `\` ( &quot;a&quot; | &quot;b&quot; | &quot;f&quot; | &quot;n&quot; | &quot;r&quot; | &quot;t&quot; | &quot;v&quot; | `\` | &quot;'&quot; | `&quot;` ) .
</code></pre>
<p>é¦–å…ˆï¼Œå®ƒæ˜¯ç”¨å•å¼•å·åŒ…è£¹çš„ã€‚</p>
<p>å•å¼•å·ä¸­åŒ…è£¹çš„å¯ä»¥æ˜¯byteå€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯unicodeç¼–ç å€¼ã€‚</p>
<p>byte_valueæœ‰å…«è¿›åˆ¶å’Œåå…­è¿›åˆ¶ä¸¤ç§è¡¨è¾¾æ–¹å¼ï¼Œå…«è¿›åˆ¶ä»¥<code>\</code>å¼€å§‹ï¼Œåé¢è·Ÿéšä¸‰ä¸ªæ•°å­—ï¼Œåå…­è¿›åº¦ä»¥<code>\x</code>å¼€å§‹ï¼Œåé¢è·Ÿéšä¸¤ä¸ªåå…­è¿›åˆ¶æ•°å­—ã€‚</p>
<p>unidecodeç¼–ç æœ‰å››ç§å½¢å¼ã€‚</p>
<p>ç¬¬ä¸€ç§æ˜¯å•å­—ç¬¦ï¼Œç¬¬äºŒç§æ˜¯ä»¥<code>\u</code>å¼€å¤´åé¢è·Ÿéš4ä¸ªåå…­è¿›åˆ¶æ•°å­—ï¼Œç¬¬ä¸‰ç§æ˜¯ä»¥<code>\U</code>å¼€å¤´åé¢è·Ÿéš8ä¸ªåå…­è¿›åˆ¶æ•°å­—ã€‚</p>
<p>ç¬¬å››ç§æ˜¯ä»¥<code>\</code>å¼€å¤´çš„è½¬ä¹‰å­—ç¬¦ï¼Œè½¬ä¹‰å­—ç¬¦çš„æ•°é‡æ˜¯æœ‰é™çš„ï¼Œåªæœ‰ä¸‹é¢è¿™äº›ï¼š</p>
<pre><code>\a   U+0007 alert or bell
\b   U+0008 backspace
\f   U+000C form feed
\n   U+000A line feed or newline
\r   U+000D carriage return
\t   U+0009 horizontal tab
\v   U+000b vertical tab
\\   U+005c backslash
\'   U+0027 single quote  (valid escape only within rune literals)
\&quot;   U+0022 double quote  (valid escape only within string literals)
</code></pre>
<p>æ³¨æ„ï¼Œç”¨unicode_valueè¡¨ç¤ºæ—¶ï¼Œunicode_valueå¿…é¡»æ˜¯æœ‰æ•ˆçš„ï¼Œç¬¦åˆutf-8ç¼–ç è§„èŒƒã€‚</p>
<p>godocä¸­ç»™å‡ºçš„rune literalï¼š</p>
<pre><code>'a'
'Ã¤'
'æœ¬'
'\t'
'\000'
'\007'
'\377'
'\x07'
'\xff'
'\u12e4'
'\U00101234'
'\''         // rune literal containing single quote character
'aa'         // illegal: too many characters
'\xa'        // illegal: too few hexadecimal digits
'\0'         // illegal: too few octal digits
'\uDFFF'     // illegal: surrogate half
'\U00110000' // illegal: invalid Unicode code point
</code></pre>
<h2 id="å­—ç¬¦ä¸²string-literals"><a class="header" href="#å­—ç¬¦ä¸²string-literals">å­—ç¬¦ä¸²(String literals)</a></h2>
<p>å­—ç¬¦ä¸²æœ‰ä¸¤ç§å½¢å¼ï¼ŒåŸå§‹å‹(raw string literals)å’Œè§£é‡Šå‹(interpreted string literals)ã€‚</p>
<pre><code>string_lit             = raw_string_lit | interpreted_string_lit .
raw_string_lit         = &quot;`&quot; { unicode_char | newline } &quot;`&quot; .
interpreted_string_lit = `&quot;` { unicode_value | byte_value } `&quot;` .
</code></pre>
<p>åŸå§‹å‹å­—ç¬¦ä¸²ç”¨åå¼•å·åŒ…è£¹ï¼Œåå¼•å·ä¸­çš„å†…å®¹éƒ½æ˜¯å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†ï¼Œåæ–œæ å°±æ˜¯åæ–œæ ï¼Œè¿˜åŒ…æ‹¬çœ‹ä¸åˆ°æ¢è¡Œå›è½¦ç­‰ã€‚</p>
<pre><code>`\n
\n`                  // same as &quot;\\n\n\\n&quot;
</code></pre>
<p>ç®€è€Œè¨€ä¹‹ï¼ŒåŸå§‹å‹å­—ç¬¦ä¸²ï¼Œå°±æ˜¯å®ƒçœ‹èµ·æ¥çš„æ ·å­ã€‚</p>
<p>è§£é‡Šå‹å­—ç¬¦ä¸²ç”¨åŒå¼•å·åŒ…è£¹ï¼Œå¯ä»¥ä½¿ç”¨åæ–œæ è¿›è¡Œè½¬ä¹‰ã€‚</p>
<pre><code>&quot;Hello, world!\n&quot;
&quot;æ—¥æœ¬èª&quot;
&quot;\u65e5æœ¬\U00008a9e&quot;
&quot;\xff\u00FF&quot;
&quot;\uD800&quot;             // illegal: surrogate half
&quot;\U00110000&quot;         // illegal: invalid Unicode code point
</code></pre>
<p>æ³¨æ„ä¸runeç±»ä¼¼ï¼Œunicode_valueå¿…é¡»æœ‰æ•ˆçš„ï¼Œç¬¦åˆutf-8è§„èŒƒçš„ã€‚</p>
<p>è§£é‡Šå‹å­—ç¬¦ä¸²å¯ä»¥ç”¨å¤šç§å½¢å¼æè¿°ç›¸åŒçš„å†…å®¹ï¼Œè¿™ä¸ªç‰¹ç‚¹ï¼Œæœ‰æ—¶å€™æ˜¯ç‰¹åˆ«æœ‰ç”¨çš„ã€‚</p>
<p>ä¸‹é¢çš„äº”ä¸ªè§£é‡Šå‹å­—ç¬¦ä¸²ï¼Œæ ·å¼ä¸åŒï¼Œä½†å†…å®¹å®Œå…¨ä¸€è‡´ï¼š</p>
<pre><code>&quot;æ—¥æœ¬èª&quot;                                 // UTF-8 input text
`æ—¥æœ¬èª`                                 // UTF-8 input text as a raw literal
&quot;\u65e5\u672c\u8a9e&quot;                    // the explicit Unicode code points
&quot;\U000065e5\U0000672c\U00008a9e&quot;        // the explicit Unicode code points
&quot;\xe6\x97\xa5\xe6\x9c\xac\xe8\xaa\x9e&quot;  // the explicit UTF-8 bytes
</code></pre>
<h2 id="å‚è€ƒ-6"><a class="header" href="#å‚è€ƒ-6">å‚è€ƒ</a></h2>
<ol>
<li><a href="https://golang.org/ref/spec#Lexical_elements" title="go Lexical elements">go Lexical elements</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="goçš„å¸¸é‡"><a class="header" href="#goçš„å¸¸é‡">goçš„å¸¸é‡</a></h1>
<p>å¸¸é‡æ„å¦‚èµ·åï¼Œæ˜¯ä¸ä¼šå˜åŒ–çš„é‡ï¼Œé‡å°±æ˜¯å€¼ã€‚å¸¸é‡æ˜¯ç¨‹åºè¿è¡Œæ—¶ï¼Œç³»ç»Ÿä¸­æŸä¸ªä½ç½®é‡Œçš„æ•°å€¼ã€‚</p>
<h2 id="å¸¸é‡åˆ†ç±»"><a class="header" href="#å¸¸é‡åˆ†ç±»">å¸¸é‡åˆ†ç±»</a></h2>
<p>å¸¸é‡åˆ†ä¸ºä»¥ä¸‹å‡ ç±»:</p>
<pre><code>å¸ƒå°”ï¼Œboolean
ç¬¦å·ï¼Œrune
æ•´æ•°ï¼Œinteger
æµ®ç‚¹æ•°ï¼Œfloating-point
å¤æ•°ï¼Œcomplex
å­—ç¬¦ä¸²ï¼Œstring
</code></pre>
<p>å…¶ä¸­ç¬¦å·(rune)ã€æ•´æ•°(intrger)ã€æµ®ç‚¹æ•°(floating-point)å’Œå¤æ•°(complex)å‹å¸¸é‡ï¼Œåˆè¢«ç§°ä¸ºæ•°å€¼å¸¸é‡(numeric constants)ã€‚</p>
<h2 id="å¸¸é‡è¡¨ç¤º"><a class="header" href="#å¸¸é‡è¡¨ç¤º">å¸¸é‡è¡¨ç¤º</a></h2>
<p>å¸¸é‡çš„å€¼æœ‰ä¸‹é¢å‡ ç§è¡¨è¾¾æ–¹å¼ï¼š</p>
<pre><code>ç¬¦å·ï¼Œrune
æ•´æ•°ï¼Œinteger
æµ®ç‚¹æ•°ï¼Œfloating-point
è™šæ•°ï¼Œimaginary
å­—ç¬¦ä¸²ï¼Œstring
æŒ‡å‘å¸¸é‡çš„æ ‡è®°ç¬¦ï¼Œidentifier denoting a constant
å¸¸é‡è¡¨è¾¾å¼ï¼Œconstant expression
ç»“æœä¸ºå¸¸é‡çš„ç±»å‹è½¬åŒ–ï¼Œ a conversion with a result that is a constant
å†…ç½®å‡½æ•°çš„è¿”å›ç»“æœ
å†…ç½®çš„å¸¸é‡trueå’Œfalse
å†…ç½®çš„å¸¸é‡æ ‡è¯†ç¬¦iota
</code></pre>
<p>æ•°å€¼å‹å¸¸é‡çš„å€¼ä¸æ‰€æ˜¾ç¤ºå€¼ä¸€è‡´ï¼Œä¸ä¼šå‡ºç°<code>æº¢å‡º</code>ï¼ŒIEEE-754ä¸­çš„â€œ-0â€(negative zero)ã€â€œæ— ç©·å¤§â€(infinity)ã€â€œéæ•°â€(not-a-number)æ²¡æœ‰å¯¹åº”çš„å¸¸é‡ã€‚</p>
<h2 id="å¸¸é‡çš„ç±»å‹"><a class="header" href="#å¸¸é‡çš„ç±»å‹">å¸¸é‡çš„ç±»å‹</a></h2>
<p>å¸¸é‡å¯ä»¥æ˜¯æ˜¾ç¤ºå£°æ˜äº†ç±»å‹çš„(typed)ï¼Œä¹Ÿå¯ä»¥æ˜¯æœªå£°æ˜ç±»å‹çš„(untyped)ã€‚</p>
<p>æœªå£°æ˜ç±»å‹çš„å¸¸é‡ä¼šä¾æ®å®ƒçš„å€¼è·å¾—ä¸€ä¸ªé»˜è®¤çš„ç±»å‹ï¼š</p>
<pre><code>value_type       default_type
------------------------------
boolean          bool
rune             rune
integer          int
floating-point   float64
complex          complex128
string           string
</code></pre>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code>i := 3
j := 3.0
</code></pre>
<p>&quot;3&quot;æ˜¯ä¸€ä¸ªuntypedçš„å¸¸é‡ï¼Œå› ä¸º3æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œå®ƒçš„é»˜è®¤ç±»å‹å°±æ˜¯intã€‚</p>
<p>&quot;3.0&quot;æ˜¯ä¸€ä¸ªæµ®ç‚¹æ•°ï¼Œå®ƒçš„é»˜è®¤ç±»å‹æ˜¯float64ã€‚</p>
<h2 id="æ•°å€¼å‹å¸¸é‡çš„èŒƒå›´"><a class="header" href="#æ•°å€¼å‹å¸¸é‡çš„èŒƒå›´">æ•°å€¼å‹å¸¸é‡çš„èŒƒå›´</a></h2>
<p>å¯ä»¥åœ¨ä»£ç ä¸­å†™å‡ºä»»æ„å¤§å°çš„æ•°å€¼ï¼Œä½†æ˜¯ä»£ç ä¸­å†™å‡ºæ•°æœªå¿…èƒ½è¢«ç¼–è¯‘å™¨æ”¯æŒã€‚</p>
<p>ç¼–è¯‘å™¨æ”¯æŒçš„æœ€å¤§æ•°å€¼æ˜¯æœ‰ä¸Šé™çš„ï¼Œåœ¨ä»£ç ä¸­å¯ä»¥å†™å…¥çš„æ•°å­—ç¡®å®æ— é™çš„ã€‚</p>
<p>goçš„ç¼–è¯‘å™¨åšäº†ä»¥ä¸‹æ‰¿è¯ºï¼š</p>
<pre><code>è‡³å°‘æ”¯æŒ256ä¸ªæ¯”ç‰¹é•¿åº¦çš„æ•´æ•°
è‡³å°‘æ”¯æŒ256ä¸ªæ¯”ç‰¹é•¿åº¦çš„å°æ•°
å¦‚æœæ•´æ•°æ•°å€¼è¶…è¿‡æ”¯æŒçš„èŒƒå›´ï¼Œç¼–è¯‘å™¨æŠ¥é”™
å¦‚æœæµ®ç‚¹æ•°å’Œå¤æ•°æº¢å‡ºï¼Œç¼–è¯‘å™¨æŠ¥é”™
å¦‚æœæµ®ç‚¹æ•°å’Œå¤æ•°è¶…å‡ºäº†æ”¯æŒçš„ç²¾åº¦ï¼Œä½¿ç”¨æœ€æ¥è¿‘çš„æ•°å€¼
</code></pre>
<p>ä¾‹å¦‚ä¸‹é¢çš„ä»£ç ç¼–è¯‘æ—¶ä¼šæŠ¥é”™ï¼š</p>
<pre><code>package main

func main() {
	i := 115792089237316195423570985008687907853269984665640564039457584007913129639936
}
</code></pre>
<p>Error:</p>
<pre><code>./main.go:6: constant 115792089237316195423570985008687907853269984665640564039457584007913129639936 overflows int
</code></pre>
<blockquote>
<p>2^256=115792089237316195423570985008687907853269984665640564039457584007913129639936</p>
</blockquote>
<h2 id="å‚è€ƒ-7"><a class="header" href="#å‚è€ƒ-7">å‚è€ƒ</a></h2>
<ol>
<li><a href="https://golang.org/ref/spec#Constants" title="go Constants">go Constants</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="goçš„å˜é‡"><a class="header" href="#goçš„å˜é‡">goçš„å˜é‡</a></h1>
<p>å˜é‡è®°å½•çš„æ˜¯ä¸€ä¸ªä½ç½®ï¼Œè¿™ä¸ªä½ç½®ä¸­å­˜æ”¾çš„å€¼æ˜¯å¯ä»¥å˜åŒ–çš„ã€‚</p>
<p>å˜é‡æ˜¯æœ‰ç±»å‹çš„ï¼Œå˜é‡çš„ç±»å‹è§„å®šäº†å¦‚ä½•è§£è¯»æŒ‡å®šä½ç½®ä¸­å­˜æ”¾çš„å€¼ã€‚</p>
<h2 id="é™æ€ç±»å‹å’ŒåŠ¨æ€ç±»å‹"><a class="header" href="#é™æ€ç±»å‹å’ŒåŠ¨æ€ç±»å‹">é™æ€ç±»å‹å’ŒåŠ¨æ€ç±»å‹</a></h2>
<p>å˜é‡çš„ç±»å‹åˆ†ä¸ºé™æ€ç±»å‹å’ŒåŠ¨æ€ç±»å‹ã€‚</p>
<p>å£°æ˜å˜é‡æ—¶ï¼ŒæŒ‡å®šçš„ç±»å‹æ˜¯å˜é‡çš„é™æ€ç±»å‹ã€‚</p>
<p>å¦‚æœå˜é‡é™æ€ç±»å‹æ˜¯æ¥å£(interface type)ï¼Œå®ƒè¿˜ä¼šæœ‰ä¸€ä¸ªåŠ¨æ€ç±»å‹ï¼ŒåŠ¨æ€ç±»å‹å°±æ˜¯è¢«èµ‹äºˆçš„å€¼çš„ç±»å‹ã€‚</p>
<pre><code>var x interface{}  // x is nil and has static type interface{}
x = 42             // x has value 42 and dynamic type int
x = v              // x has value (*T)(nil) and dynamic type *T
</code></pre>
<p>å¦‚æœå£°æ˜å˜é‡æ—¶æ²¡æœ‰è®¾ç½®å˜é‡çš„å€¼ï¼Œå®ƒçš„å€¼å°±æ˜¯å¯¹åº”ç±»å‹çš„é›¶å€¼ï¼ˆzero value)ã€‚</p>
<h2 id="å‚è€ƒ-8"><a class="header" href="#å‚è€ƒ-8">å‚è€ƒ</a></h2>
<ol>
<li><a href="https://golang.org/ref/spec#Lexical_elements" title="go Lexical elements">go Lexical elements</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="goçš„ç±»å‹"><a class="header" href="#goçš„ç±»å‹">goçš„ç±»å‹</a></h1>
<p>ç±»å‹æ˜¯ç”¨æ¥è¯ é‡Šå¦‚ä½•è§£è¯»æŒ‡å®šä½ç½®ä¸­å­˜æ”¾çš„æ•°æ®ï¼Œä»¥åŠçº¦å®šæ“ä½œç¬¦çš„å«ä¹‰çš„ã€‚</p>
<h2 id="ç±»å‹çš„å±æ€§"><a class="header" href="#ç±»å‹çš„å±æ€§">ç±»å‹çš„å±æ€§</a></h2>
<h3 id="å†…ç½®ç±»å‹predeclared"><a class="header" href="#å†…ç½®ç±»å‹predeclared">å†…ç½®ç±»å‹(predeclared)</a></h3>
<p>goè¯­è¨€å†…ç½®äº†ä¸‹é¢çš„ç±»å‹ï¼š</p>
<pre><code>bool byte complex64 complex128 error float32 float64
int int8 int16 int32 int64 rune string
uint uint8 uint16 uint32 uint64 uintptr
</code></pre>
<h3 id="å‘½åç±»å‹named"><a class="header" href="#å‘½åç±»å‹named">å‘½åç±»å‹(named)</a></h3>
<p>ç±»å‹å¯ä»¥æ˜¯å‘½åçš„(named)ï¼Œä¹Ÿå¯ä»¥æ˜¯æœªå‘½åçš„(unnamed)ã€‚</p>
<pre><code>Type      = TypeName | TypeLit | &quot;(&quot; Type &quot;)&quot; .
TypeName  = identifier | QualifiedIdent .
TypeLit   = ArrayType | StructType | PointerType | FunctionType | InterfaceType |
            SliceType | MapType | ChannelType .
</code></pre>
<p>ä½¿ç”¨<code>type</code>æŒ‡å®šäº†åå­—çš„ç±»å‹æ˜¯å‘½åçš„ï¼Œä¾‹å¦‚ä¸‹é¢çš„ç±»å‹çš„åå­—ä¸ºStudent</p>
<pre><code>type Student struct {
	Name string
	age int
}
</code></pre>
<p>ç”±å…¶å®ƒç±»å‹ç»„åˆæˆçš„æ–°ç±»å‹ï¼Œå¯ä»¥ä¸è¢«å‘½åï¼Œä¾‹å¦‚ä¸‹é¢çš„ç±»å‹æ˜¯æ²¡æœ‰åå­—çš„ï¼š</p>
<pre><code>[] string
[] int
</code></pre>
<p>æ— ç±»å‹çš„åå­—ï¼Œé€šç”¨ç”¨äºå®šä¹‰å…¶å®ƒç±»å‹:</p>
<pre><code>type Array []int
</code></pre>
<p>æˆ–è€…åœ¨å‡½æ•°å®šä¹‰ä¸­ä½¿ç”¨ï¼š</p>
<pre><code>func Display(s struct {
    name string
    age  int
}) {
    println(s.name)
    println(s.age)
}
</code></pre>
<h3 id="å®é™…ç±»å‹underlying-type"><a class="header" href="#å®é™…ç±»å‹underlying-type">å®é™…ç±»å‹(underlying type)</a></h3>
<p>ç±»å‹æ˜¯å¯ä»¥ç”¨æ¥å®šä¹‰å…¶å®ƒç±»å‹çš„ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code>type T1 string 
type T2 T1
</code></pre>
<p>è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªç±»å‹T1ï¼Œç„¶ååˆç”¨T1å®šä¹‰äº†ç±»å‹T2ã€‚</p>
<p>T1çš„å®é™…ç±»å‹(underlying type)æ˜¯stringï¼ŒT2çš„å®é™…ç±»å‹ä¸æ˜¯T1ï¼Œè€Œæ˜¯T1çš„å®é™…ç±»å‹stringã€‚</p>
<p>å®é™…ç±»å‹å¿…é¡»æ˜¯goçš„å†…ç½®ç±»å‹æˆ–è€…ç±»å‹çš„ç»„åˆã€‚</p>
<p>ä¾‹å¦‚ï¼Œstringã€T1ã€T2çš„å®é™…ç±»å‹æ˜¯stringã€‚</p>
<pre><code>type T1 string
type T2 T1
</code></pre>
<p>[]T1ã€T3ã€T4çš„å®é™…ç±»å‹æ˜¯[]T1ã€‚</p>
<pre><code>type T3 []T1
type T4 T3
</code></pre>
<h3 id="ç±»å‹çš„æ–¹æ³•method-sets"><a class="header" href="#ç±»å‹çš„æ–¹æ³•method-sets">ç±»å‹çš„æ–¹æ³•(method sets)</a></h3>
<p>ç±»å‹å¯ä»¥æœ‰è‡ªå·±çš„æ–¹æ³•(Method)ï¼Œä¹Ÿå°±æ˜¯å…¶å®ƒè¯­è¨€ä¸­çš„å‡½æ•°ã€‚</p>
<p>ä¸€ä¸ªéæ¥å£ç±»å‹çš„æ–¹æ³•é›†å°±æ‰€æœ‰æ¥å—è€…(receiver)ä¸ºæ”¹ç±»å‹çš„æ–¹æ³•ï¼Œæ¥å£ç±»å‹çš„æ–¹æ³•é›†å°±æ˜¯æ¥å£å®šä¹‰ä¸­åŒ…å«çš„æ–¹æ³•ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯æŒ‡é’ˆç±»å‹ç±»å‹ï¼ˆä¾‹å¦‚ * T)ï¼Œå®ƒçš„æ–¹æ³•é›†æ˜¯æ‰€æœ‰æ¥å—è€…ä¸ºæ‰€æŒ‡ç±»å‹(T)å’ŒæŒ‡é’ˆç±»å‹( * T)çš„æ–¹æ³•é›†ã€‚</p>
<p>ä¾‹å¦‚ä¸‹é¢çš„ä»£ç ä¸­ï¼Œæ–¹æ³•çš„Showçš„Receiveræ˜¯Strï¼Œä½†æ˜¯ç±»å‹ä¸º * Strçš„psträ¹Ÿå¯ä»¥è°ƒç”¨ã€‚</p>
<pre><code>package main

type Str string

func (s Str) Show() {
	println(s)
}

func main() {
	str := Str(&quot;Hello World!&quot;)
	pstr := &amp;str
	pstr.Show()
}
</code></pre>
<p>æ–¹æ³•é›†ä¸­çš„æ–¹æ³•ä¸èƒ½é‡åã€ä¸”å¿…é¡»æœ‰åå­—ã€‚</p>
<h3 id="ç±»å‹çš„ç­‰åŒæ€§identical"><a class="header" href="#ç±»å‹çš„ç­‰åŒæ€§identical">ç±»å‹çš„ç­‰åŒæ€§(identical)</a></h3>
<p>å‘½åè¯­å¥ä¸åŒçš„ä¸¤ä¸ªå‘½åç±»å‹ï¼Œæ˜¯ä¸ç­‰åŒçš„ã€‚ä¾‹å¦‚ä¸‹é¢çš„T1å’ŒT2ï¼Œè™½ç„¶å®é™…ç±»å‹éƒ½æ˜¯stringï¼Œä½†å®ƒä»¬æ˜¯ä¸¤ä¸ªç±»å‹ã€‚</p>
<pre><code>type T1 string
type T2 string
</code></pre>
<p>å‘½åç±»å‹ä¸æœªå‘½åç±»å‹æ˜¯ä¸ç­‰åŒçš„ï¼Œä¾‹å¦‚ä¸‹é¢çš„T1ä¸[]stringæ˜¯ä¸¤ä¸ªç±»å‹ã€‚</p>
<pre><code>type T1 []string
[]string
</code></pre>
<p>å‘½åè¯­å¥å’Œå®šä¹‰è¯­å¥<code>å®Œå…¨ç›¸åŒ</code>çš„ä¸¤ä¸ªå‘½åç±»å‹æ˜¯æ‰ç­‰åŒçš„ï¼Œä¾‹å¦‚ä¸‹é¢çš„T1ã€‚</p>
<pre><code>type T1 string
type T1 string
</code></pre>
<p>å®šä¹‰è¯­å¥<code>å®Œå…¨ç›¸åŒ</code>çš„ä¸¤ä¸ªæœªå‘½åç±»å‹æ‰æ˜¯ç­‰åŒçš„ï¼Œä¾‹å¦‚ä¸‹é¢çš„[]stringã€‚</p>
<pre><code>[5]string
[5]string
</code></pre>
<p>åœ¨ç¼–ç¨‹æ—¶ï¼ŒåŒä¸€ä¸ªç±»å‹åªä¼šå®šä¹‰ä¸€æ¬¡ã€‚</p>
<p>åœ¨ä»£ç ä¸­å®šä¹‰<code>ä¸¤ä¸ª</code>ç­‰åŒçš„ç±»å‹å…¶æ˜¯åšä¸åˆ°çš„ï¼Œå› ä¸ºå®ƒä»¬å¦‚æœç­‰åŒï¼Œé‚£ä¹ˆå…¶å®å°±æ˜¯ä¸€ä¸ªã€‚ä¾‹å¦‚ä¸‹é¢çš„ä»£ç ã€‚</p>
<pre><code>package main

type T string
type T string

func main() {
}
</code></pre>
<p>ç¼–è¯‘æ—¶ä¼šæŠ¥é”™ã€‚</p>
<pre><code>./main.go:5: T redeclared in this block
    previous declaration at ./main.go:4
</code></pre>
<p>ä¸¤ä¸ªç±»å‹ç­‰åŒæ˜¯ä¸€ä¸ªç”¨æ¥è§£é‡Šç±»å‹ä¸ç­‰åŒçš„è§„åˆ™ï¼Œå³å¦‚æœä¸ç¬¦åˆéµå®ˆç­‰åŒçš„è§„åˆ™ï¼Œé‚£ä¹ˆå°±æ˜¯ä¸ç­‰åŒçš„ã€‚</p>
<p>å¯¹äºæœªå‘½åç±»å‹éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼Œåªè¦ä¸æ»¡è¶³ä¸‹é¢çš„æ¡ä»¶ï¼Œé‚£ä¹ˆå°±æ˜¯ä¸¤ä¸ªä¸åŒçš„ç±»å‹ï¼š</p>
<pre><code>ä¸¤ä¸ªæ•°ç»„ç±»å‹è¦ç­‰åŒï¼Œä¸ä»…æ•°ç»„ä¸­æˆå‘˜çš„ç±»å‹è¦ç›¸åŒï¼Œè€Œä¸”æ•°ç»„çš„é•¿åº¦ä¹Ÿè¦ç›¸åŒã€‚
ä¸¤ä¸ªåˆ†ç‰‡ç±»å‹ç­‰åŒï¼Œåªéœ€è¦åˆ†ç‰‡çš„æˆå‘˜ç±»å‹ç›¸åŒã€‚
ä¸¤ä¸ªç»“æ„ä½“ç­‰åŒï¼Œç»“æ„ä½“æˆå‘˜çš„é¡ºåºã€åç§°ã€æ ‡ç­¾(tag)éƒ½å¿…é¡»ç›¸åŒã€‚
ä¸¤ä¸ªæŒ‡é’ˆç±»å‹ï¼Œæ‰€æŒ‡å‘çš„ç±»å‹ç›¸åŒã€‚
ä¸¤ä¸ªå‡½æ•°ç±»å‹ï¼Œè¦æœ‰ç›¸åŒçš„æ•°é‡çš„å‚æ•°å’Œè¿”å›å€¼ï¼Œå‚æ•°å’Œè¿”å›å€¼çš„ç±»å‹è¦ç›¸åŒï¼Œå‚æ•°åå’Œè¿”å›å€¼çš„åå­—å¯ä»¥ä¸åŒã€‚
ä¸¤ä¸ªæ¥å£ç±»å‹ï¼Œè¦æœ‰ç›¸åŒçš„æ–¹æ³•ï¼Œæ–¹æ³•çš„é¡ºåºå¯ä»¥ä¸åŒã€‚
ä¸¤ä¸ªå­—å…¸ç±»å‹ï¼Œkeyçš„ç±»å‹å’Œvalueçš„ç±»å‹å¿…é¡»ç›¸åŒã€‚
ä¸¤ä¸ªé€šé“(channel)ç±»å‹ï¼Œé€šé“çš„æ–¹å‘å’Œä¼ é€’çš„ç±»å‹å¿…é¡»ç›¸åŒã€‚
</code></pre>
<p>ä¾‹å¦‚ä¸‹é¢ä¸¤ä¸ªå‡½æ•°ç±»å‹ç¬¦åˆä¸Šé¢çš„æ¡ä»¶ï¼Œæ‰€ä»¥æ˜¯ç›¸åŒçš„ï¼š</p>
<pre><code>func(x int, y float64) *[]string
func(int, float64) (result *[]string)
</code></pre>
<h3 id="ç±»å‹çš„èµ‹å€¼assignability"><a class="header" href="#ç±»å‹çš„èµ‹å€¼assignability">ç±»å‹çš„èµ‹å€¼(Assignability)</a></h3>
<p>ä¸€ä¸ªå€¼(value)åªæœ‰åœ¨æ»¡è¶³ä¸‹é¢çš„æ¡ä»¶æ—¶ï¼Œæ‰å¯ä»¥è¢«èµ‹ç»™å¯¹åº”çš„ç±»å‹çš„å˜é‡(variable)ã€‚</p>
<pre><code>å€¼çš„ç±»å‹ä¸å˜é‡çš„ç±»å‹ç›¸åŒ
å€¼çš„ç±»å‹ä¸å˜é‡çš„å®é™…ç±»å‹ç›¸åŒï¼Œä¸”å…¶ä¸­ä¸€ä¸ªçš„ç±»å‹æ˜¯æœªå‘½åçš„ç±»å‹
å˜é‡çš„ç±»å‹æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå€¼å®ç°äº†æ¥å£ä¸­æ–¹æ³•
å€¼æ˜¯ä¸€ä¸ªåŒå‘çš„é€šé“(channel)ï¼Œå˜é‡ç±»å‹ä¹Ÿæ˜¯é€šé“ï¼Œä¼ é€’çš„æ•°æ®ç±»å‹ç›¸åŒï¼Œå¹¶ä¸”å…¶ä¸­ä¸€ä¸ªçš„ç±»å‹æ˜¯æœªå‘½åçš„ã€‚
å€¼æ˜¯å†…ç½®çš„æ•°å€¼nilï¼Œå˜é‡çš„ç±»å‹æ˜¯æŒ‡é’ˆ(pointer)ã€å‡½æ•°(function)ã€åˆ†ç‰‡(slice)ã€å­—å…¸(map)ã€é€šé“(channel)ã€æ¥å£(interface)
å€¼æ˜¯ä¸€ä¸ªç¬¦åˆå˜é‡çš„ç±»å‹è¦æ±‚çš„å¸¸é‡ã€‚
</code></pre>
<h2 id="goæ”¯æŒçš„ç±»å‹"><a class="header" href="#goæ”¯æŒçš„ç±»å‹">goæ”¯æŒçš„ç±»å‹</a></h2>
<h3 id="å¸ƒå°”boolean-types"><a class="header" href="#å¸ƒå°”boolean-types">å¸ƒå°”(Boolean types)</a></h3>
<p>å¸ƒå°”ç±»å‹æ˜¯å†…ç½®çš„ç±»å‹<code>bool</code>ï¼Œå®ƒçš„valueåªèƒ½æ˜¯ä¸¤ä¸ªå†…ç½®çš„å¸¸é‡ï¼š</p>
<pre><code>true
false
</code></pre>
<h3 id="æ•°å€¼numeric-types"><a class="header" href="#æ•°å€¼numeric-types">æ•°å€¼(Numeric types)</a></h3>
<p>æ•°å€¼ç±»å‹éƒ½æ˜¯å†…ç½®çš„ç±»å‹ï¼Œä¸€å…±æœ‰ä»¥ä¸‹å‡ ç§ã€‚</p>
<pre><code>uint8       the set of all unsigned  8-bit integers (0 to 255)
uint16      the set of all unsigned 16-bit integers (0 to 65535)
uint32      the set of all unsigned 32-bit integers (0 to 4294967295)
uint64      the set of all unsigned 64-bit integers (0 to 18446744073709551615)

int8        the set of all signed  8-bit integers (-128 to 127)
int16       the set of all signed 16-bit integers (-32768 to 32767)
int32       the set of all signed 32-bit integers (-2147483648 to 2147483647)
int64       the set of all signed 64-bit integers (-9223372036854775808 to 9223372036854775807)

float32     the set of all IEEE-754 32-bit floating-point numbers
float64     the set of all IEEE-754 64-bit floating-point numbers

complex64   the set of all complex numbers with float32 real and imaginary parts
complex128  the set of all complex numbers with float64 real and imaginary parts

byte        alias for uint8
rune        alias for int32
</code></pre>
<p>å¦å¤–è¿˜æœ‰ä¸‰ä¸ªæ•°å€¼ç±»å‹ï¼Œå®ƒä»¬å ç”¨çš„ç©ºé—´å–å†³äºå®ç°ï¼š</p>
<pre><code>uint     either 32 or 64 bits
int      same size as uint
uintptr  an unsigned integer large enough to store the uninterpreted bits of a pointer value
</code></pre>
<h3 id="å­—ç¬¦ä¸²string-types"><a class="header" href="#å­—ç¬¦ä¸²string-types">å­—ç¬¦ä¸²(String types)</a></h3>
<p>å­—ç¬¦ä¸²æ˜¯å†…ç½®çš„ç±»å‹<code>string</code>ï¼Œå­—ç¬¦ä¸²çš„å€¼æ˜¯è¿ç»­çš„å­—èŠ‚ï¼Œè¿™äº›å­—èŠ‚æ˜¯ä¸å¯æ›´æ”¹çš„ã€‚</p>
<p>å¯ä»¥é€šè¿‡å†…ç½®å‡½æ•°<code>len</code>è·å–å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œå¯ä»¥ç”¨é€šè¿‡[i]è¯»å–å­—ç¬¦ä¸²çš„ç¬¬iä¸ª(ä»0å¼€å§‹)å­—èŠ‚ã€‚</p>
<p>å­—ç¬¦ä¸²çš„å­—èŠ‚åªèƒ½è¯»å–ï¼Œä¸èƒ½æ›´æ”¹ï¼Œä¹Ÿä¸èƒ½å–å€ã€‚</p>
<pre><code>package main

import (
    &quot;fmt&quot;
)

func main() {
    str := &quot;Hello World!&quot;
    fmt.Printf(&quot;%c\n&quot;, str[6])

    //not allow
    //ptr := &amp;str[6]

    //not allow
    //str[6] = 'w'
}
</code></pre>
<h3 id="æ•°ç»„array-types"><a class="header" href="#æ•°ç»„array-types">æ•°ç»„(Array types)</a></h3>
<p>æ•°ç»„æ˜¯å¤šä¸ªç›¸åŒç±»å‹çš„å€¼ï¼Œåœ¨goä¸­ï¼Œæ•°ç»„å¿…é¡»æœ‰é•¿åº¦ï¼Œé•¿åº¦æ˜¯æ•°ç»„ç±»å‹çš„ä¸€éƒ¨åˆ†ã€‚</p>
<pre><code>ArrayType   = &quot;[&quot; ArrayLength &quot;]&quot; ElementType .
ArrayLength = Expression .
ElementType = Type .
</code></pre>
<p>æ•°ç»„æ˜¯å•ç»´çš„ï¼Œå¯ä»¥ç´¯è¿›æˆå¤šç»´æ•°ç»„ï¼š</p>
<pre><code>[32]byte
[2*N] struct { x, y int32 }
[1000]*float64
[3][5]int
[2][2][2]float64  // same as [2]([2]([2]float64))
</code></pre>
<p>è¦æ³¨æ„é•¿åº¦æ˜¯æ•°ç»„ç±»å‹çš„ä¸€éƒ¨åˆ†ï¼Œé•¿åº¦ä¸åŒçš„æ•°ç»„æ˜¯ä¸åŒçš„ç±»å‹ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code>package main

func main() {
    var array1 [32]byte
    var array2 [24]byte

    array1[0] = 'a'
    array2[0] = 'b'

    //not allow
    //array2 = array1
}
</code></pre>
<p>æ•°ç»„æˆå‘˜å¯ä»¥ç”¨ä»0å¼€å§‹çš„åæ ‡ç´¢å¼•ï¼Œé•¿åº¦å¯ä»¥ç”¨å†…ç½®çš„å‡½æ•°<code>len</code>è·å–ã€‚</p>
<h3 id="åˆ†ç‰‡slice-types"><a class="header" href="#åˆ†ç‰‡slice-types">åˆ†ç‰‡(Slice types)</a></h3>
<p>åˆ†ç‰‡(Slice)æ˜¯ç”¨æ¥ç´¢å¼•æ•°ç»„(Array)ä¸­çš„ä¸€æ®µè¿ç»­çš„æˆå‘˜çš„ã€‚</p>
<pre><code>SliceType = &quot;[&quot; &quot;]&quot; ElementType .
</code></pre>
<p>åˆ†ç‰‡åˆå§‹åŒ–åå°±ç»‘å®šåˆ°äº†ä¸€ä¸ªæ•°ç»„ï¼Œå¤šä¸ªåˆ†ç‰‡å¯ä»¥ç»‘å®šåˆ°åŒä¸€ä¸ªæ•°ç»„ã€‚</p>
<p>ä¸æ•°ç»„ä¸åŒçš„æ˜¯ï¼Œåˆ†ç‰‡æœ‰é•¿åº¦(length)å’Œå®¹é‡(capacity)ä¸¤ä¸ªå±æ€§ã€‚</p>
<p>é•¿åº¦æ˜¯åˆ†ç‰‡æ‰€ç´¢å¼•çš„æ•°ç»„æˆå‘˜çš„æ•°é‡ï¼Œå¯ä»¥ç”¨å†…ç½®çš„å‡½æ•°<code>len</code>è·å–ã€‚</p>
<p>å®¹é‡æ˜¯åˆ†ç‰‡èƒ½å¤Ÿç´¢å¼•çš„æ•°ç»„æˆå‘˜çš„æœ€å¤§æ•°é‡ï¼Œç­‰äºæ•°ç»„çš„é•¿åº¦å‡å»åˆ†ç‰‡ç´¢å¼•çš„ç¬¬ä¸€ä¸ªæ•°ç»„æˆå‘˜åœ¨æ•°ç»„ä¸­ä½ç½®ã€‚</p>
<p>ä¾‹å¦‚åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œåˆ†ç‰‡slice1çš„é•¿åº¦æ˜¯5ï¼Œå®¹é‡æ˜¯20(=30-10)</p>
<pre><code>package main

func main() {
    var array1 [30]int
    for i := 0; i &lt; len(array1); i++ {
        array1[i] = i
    }

    slice1 := array1[10:15]

    println(&quot;array's length: &quot;, len(array1))
    println(&quot;slice1's length: &quot;, len(slice1))
    println(&quot;slice1's capacity: &quot;, cap(slice1))

    for i := 0; i &lt; len(slice1); i++ {
        println(slice1[i])
    }
}
</code></pre>
<p>åˆ†ç‰‡å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼åˆ›å»ºï¼Œç¬¬ä¸€ç§æ–¹å¼å°±æ˜¯ä¸Šé¢çš„ä»£ç ä¸­ä½¿ç”¨çš„æ–¹å¼ï¼š</p>
<pre><code>    slice1 := array1[10:15]
</code></pre>
<p>è¿™æ ·åˆ›å»ºçš„slice1ç´¢å¼•çš„æ˜¯æ•°ç»„çš„ä»0å¼€å§‹ç¼–å·çš„ç¬¬10ä¸ªã€ç¬¬11ä¸ªã€ç¬¬12ä¸ªã€ç¬¬13ä¸ªã€ç¬¬14ä¸ªä¸ªæˆå‘˜ï¼Œæ€»è®¡5ä¸ªã€‚</p>
<pre><code>10
11
12
13
14
</code></pre>
<blockquote>
<p>æ³¨æ„[10:15]æ˜¯ä¸€ä¸ªå‰é—­åå¼€çš„é›†åˆï¼Œå³åŒ…æ‹¬10ï¼Œä¸åŒ…æ‹¬15ã€‚</p>
</blockquote>
<p>ç¬¬äºŒç§æ–¹å¼æ˜¯ä½¿ç”¨å†…ç½®çš„<code>make</code>å‡½æ•°åˆ›å»ºã€‚</p>
<pre><code>make([]T, length, capacity)
</code></pre>
<p>ä½¿ç”¨makeåˆ›å»ºçš„æ—¶å€™ï¼Œè‡³å°‘éœ€è¦æŒ‡å®šåˆ†ç‰‡çš„é•¿åº¦ï¼Œmakeä¼šä¸ºåˆ†ç‰‡åˆ›å»ºä¸€ä¸ªéšè—çš„æ•°ç»„ã€‚</p>
<p>å¦‚æœæŒ‡å®šäº†capacityï¼Œæ•°ç»„çš„é•¿åº¦å°±æ˜¯capacityï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œæ•°ç»„çš„é•¿åº¦ç­‰äºåˆ†ç‰‡çš„é•¿åº¦ã€‚</p>
<p>ä¾‹å¦‚ä¸‹é¢çš„ä»£ç ä¸­slice2çš„é•¿åº¦å’Œå®¹é‡éƒ½æ˜¯10ï¼Œslice3çš„é•¿åº¦æ˜¯10ï¼Œå®¹é‡æ˜¯20ã€‚</p>
<pre><code>package main

func main() {
    //not allow
    //slice1 := make([]int)
    //println(&quot;slice1ï¼Œ len is &quot;, len(slice1), &quot;capacity is &quot;, cap(slice1))

    slice2 := make([]int, 10)
    println(&quot;slice2ï¼Œ len is &quot;, len(slice2), &quot;capacity is &quot;, cap(slice2))

    slice3 := make([]int, 10, 20)
    println(&quot;slice3ï¼Œ len is &quot;, len(slice3), &quot;capacity is &quot;, cap(slice3))
}
</code></pre>
<p>é€šè¿‡makeåˆ›å»ºåˆ†ç‰‡ï¼Œç›¸å½“ä¸æ–°å»ºä¸€ä¸ªæ•°ç»„ï¼Œç„¶åå–å®ƒçš„[0:length]ã€‚</p>
<pre><code>make([]int, 50, 100)
</code></pre>
<p>ç­‰åŒäºï¼š</p>
<pre><code>new([100]int)[0:50]
</code></pre>
<h3 id="ç»“æ„ä½“struct-types"><a class="header" href="#ç»“æ„ä½“struct-types">ç»“æ„ä½“(Struct types)</a></h3>
<p>ç»“æ„ä½“(Struct)æ˜¯æ¯”è¾ƒå¤æ‚çš„ç±»å‹ï¼Œå®ƒæ˜¯ç”±å¤šä¸ªå‘½åå˜é‡ç»„æˆï¼Œè¿™äº›å˜é‡æ¯ä¸ªéƒ½æœ‰åå­—å’Œç±»å‹ï¼Œè¢«æˆä¸º&quot;ç»“æ„ä½“æˆå‘˜(field)&quot;ã€‚</p>
<pre><code>StructType     = &quot;struct&quot; &quot;{&quot; { FieldDecl &quot;;&quot; } &quot;}&quot; .
FieldDecl      = (IdentifierList Type | AnonymousField) [ Tag ] .
AnonymousField = [ &quot;*&quot; ] TypeName .
Tag            = string_lit .
</code></pre>
<p>goè¯­è¨€çš„structç”¨æ³•ä¸Cè¯­è¨€ä¸­çš„ä¸åŒï¼ŒCè¯­è¨€ä¸­æ˜¯â€œstruct ç»“æ„ä½“å{ ç»“æ„ä½“æˆå‘˜...}â€ï¼Œgoè¯­è¨€ä¸­æ²¡æœ‰ä¸­é—´çš„ç»“æ„ä½“åã€‚å¦‚æœè¦ç»™goçš„ç»“æ„ä½“å‘½åï¼Œéœ€è¦ä½¿ç”¨å…³é”®typeï¼š</p>
<pre><code>type ç»“æ„ä½“å struct{
	ç»“æ„ä½“æˆå‘˜
}
</code></pre>
<p>ç»“æ„ä½“æˆå‘˜çš„åç§°å¯ä»¥æ˜¾ç¤ºå£°æ˜(IdentifierList Type)ï¼Œä¹Ÿå¯ä»¥éšå¼å£°æ˜(AnonymousField)ã€‚</p>
<p>éšå¼å£°æ˜æ˜æ˜¯ä¸ä¸ºå˜é‡è®¾ç½®æ˜ç¡®çš„æ ‡è¯†ç¬¦æ—¶ï¼Œå˜é‡çš„åå­—é»˜è®¤ä¸ºç±»å‹çš„åå­—ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code>struct {
    T1        // field name is T1
    *T2       // field name is T2
    P.T3      // field name is T3
    *P.T4     // field name is T4
    x, y int  // field names are x and y
}
</code></pre>
<p>goè¯­è¨€ä¸­çš„éšå¼å£°æ˜çš„æˆå‘˜ï¼Œå…¶å®æœ‰ä¸€ç‚¹C++ä¸­çš„ç»§æ‰¿çš„æ„æ€ï¼Œä¾‹å¦‚åœ¨ä¸‹é¢çš„å®šä¹‰ä¸­ï¼Œç»“æ„ä½“Bå¯ä»¥ç›´æ¥ä½¿ç”¨å®ƒçš„éšå¼æˆå‘˜Açš„ç»“æ„ä½“æˆå‘˜ï¼š</p>
<pre><code>package main

import (
    &quot;fmt&quot;
)

type A struct {
    A1 string
    A2 string
}

type B struct {
    A
    B1 string
    B2 string
}

func main() {
    b := B{
        A: A{
            A1: &quot;a1&quot;,
            A2: &quot;a2&quot;,
        },
        B1: &quot;b1&quot;,
        B2: &quot;b2&quot;,
    }
    fmt.Println(b.A)
    fmt.Println(b.A.A1)
    fmt.Println(b.A1)
}
</code></pre>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œç»“æ„ä½“Bæ²¡æœ‰æ˜¾ç¤ºå£°æ˜ä¸ºA1çš„æˆå‘˜ï¼Œå› æ­¤<code>b.A1</code>ç´¢å¼•çš„æ˜¯å®ƒçš„éšå¼æˆå‘˜Açš„æˆå‘˜ã€‚</p>
<p>å¦‚æœç»“æ„ä½“Bæœ‰ä¸€ä¸ªåä¸ºA1çš„æ˜¾ç¤ºæˆå‘˜ï¼Œé‚£ä¹ˆåªèƒ½é€šè¿‡<code>b.A.A1</code>çš„æ–¹å¼ç´¢å¼•åˆ°Açš„æˆå‘˜A1ï¼Œ<code>b.A</code>ç´¢å¼•çš„å°†æ˜¯Bçš„æ˜¾ç¤ºæˆå‘˜A1ã€‚</p>
<p>ä¾‹å¦‚ä¸‹é¢ä»£ç ä¸­ï¼Œæœ€åä¸€è¡Œæ‰“å°çš„æ˜¯<code>b1's a1</code>ã€‚</p>
<pre><code>package main

import (
    &quot;fmt&quot;
)

type A struct {
    A1 string
    A2 string
}

type B struct {
    A
    A1 string
    B1 string
    B2 string
}

func main() {
    b := B{
        A: A{
            A1: &quot;a1&quot;,
            A2: &quot;a2&quot;,
        },
        A1: &quot;b's a1&quot;,
        B1: &quot;b1&quot;,
        B2: &quot;b2&quot;,
    }
    fmt.Println(b.A)
    fmt.Println(b.A.A1)
    fmt.Println(b.A1)
}
</code></pre>
<p>åŒä¸€ä¸ªç»“æ„ä½“å†…çš„æˆå‘˜ä¸èƒ½é‡åï¼Œåœ¨ä½¿ç”¨éšå¼å£°æ˜çš„æ—¶å€™è¦ç‰¹åˆ«æ³¨æ„ï¼Œå› ä¸ºä¸€ä¸ªç±»å‹ä¸å®ƒçš„æŒ‡é’ˆç±»å‹ï¼Œåœ¨è¢«éšå¼å£°æ˜çš„æ—¶å€™ï¼Œä¼šå¾—åˆ°ç›¸åŒçš„å˜é‡åã€‚ä¾‹å¦‚ä¸‹é¢çš„ç»“æ„ä½“çš„ä¸‰ä¸ªæˆå‘˜çš„åå­—éƒ½æ˜¯<code>T</code>ï¼Œè¿™æ˜¯ä¸å…è®¸çš„ã€‚</p>
<pre><code>struct {
    T     // conflicts with anonymous field *T and *P.T
    *T    // conflicts with anonymous field T and *P.T
    *P.T  // conflicts with anonymous field T and *T
}
</code></pre>
<p>éšå¼å£°æ˜çš„<code>T</code>å’Œéšå¼å£°æ˜çš„<code>*T</code>çš„åŒºåˆ«ä¹‹ä¸€æ˜¯è¿™ä¸ªéšå¼å£°æ˜çš„å˜é‡çš„å­˜æ”¾ä½ç½®ã€‚å¦å¤–goè¯­è¨€å£°ç§°ï¼š</p>
<pre><code>If S contains an anonymous field T, the method sets of S and *S both include promoted methods with receiver T. The method set of *S also includes promoted methods with receiver *T.

If S contains an anonymous field *T, the method sets of S and *S both include promoted methods with receiver T or *T.
</code></pre>
<p>ä½†æ˜¯è¯•éªŒå´å‘ç°ï¼Œä¸‹é¢çš„ä¸¤æ®µä»£ç æ‰§è¡Œçš„æ•ˆæœæ˜¯ç›¸åŒçš„ã€‚</p>
<p>ä»£ç ä¸€ï¼Œéšå¼æˆå‘˜ä¸º<code>A</code>ï¼š</p>
<pre><code>package main

type A struct {
    A1 string
}

type B struct {
    A
    B1 string
    B2 string
}

func main() {
    b := B{
        A: A{
            A1: &quot;a1&quot;,
        },
        B1: &quot;b1&quot;,
        B2: &quot;b2&quot;,
    }

    b.method()
    println(b.A1)

    b.pointer_method()
    println(b.A1)

    pb := &amp;b

    pb.method()
    println(b.A1)

    pb.pointer_method()
    println(b.A1)
}
</code></pre>
<p>ä»£ç äºŒï¼Œéšå¼æˆå‘˜ä¸º<code>*A</code>ï¼š</p>
<pre><code>package main

type A struct {
    A1 string
}

func (a A) method() {
    a.A1 = &quot;method set a1&quot;
}

func (a *A) pointer_method() {
    a.A1 = &quot;pointer method set a1&quot;
}

type B struct {
    *A
    B1 string
    B2 string
}

func main() {
    b := B{
        A: &amp;A{
            A1: &quot;a1&quot;,
        },
        B1: &quot;b1&quot;,
        B2: &quot;b2&quot;,
    }

    b.method()
    println(b.A1)

    b.pointer_method()
    println(b.A1)

    pb := &amp;b

    pb.method()
    println(b.A1)

    pb.pointer_method()
    println(b.A1)
}
</code></pre>
<p>goè¯­è¨€ä¸­å¯ä»¥åœ¨æ¯ä¸ªç»“æ„ä½“æˆå‘˜åé¢è·Ÿéšä¸€ä¸ªæ ‡ç­¾(tag)ï¼Œæ ‡ç­¾ç”¨æ¥æ³¨æ˜æˆå‘˜çš„å±æ€§ã€‚æ ‡ç­¾å¯ä»¥æ˜¯è§£é‡Šå‹å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯åŸå§‹å‹å­—ç¬¦ä¸²ã€‚</p>
<pre><code>Tag            = string_lit .
string_lit     = raw_string_lit | interpreted_string_lit .
</code></pre>
<p>å¦å¤–ï¼Œåœ¨ç»“æ„ä½“ä¸­è¿˜å¯ä»¥æ·»åŠ åªèµ·åˆ°å¡«å……(padding)ä½œç”¨çš„æˆå‘˜ï¼š</p>
<pre><code>// A struct with 6 fields.
struct {
    x, y int
    u float32
    _ float32  // padding
    A *[]int
    F func()
}
</code></pre>
<h3 id="æŒ‡é’ˆpointer-types"><a class="header" href="#æŒ‡é’ˆpointer-types">æŒ‡é’ˆ(Pointer types)</a></h3>
<p>æŒ‡é’ˆç±»å‹æ¯”è¾ƒç®€å•ï¼š</p>
<pre><code>PointerType = &quot;*&quot; BaseType .
BaseType    = Type .
</code></pre>
<p>æ”¯æŒå¤šé‡æŒ‡é’ˆï¼š</p>
<pre><code>package main

func main() {
    i := 8
    pi := &amp;i
    ppi := &amp;pi

    println(*ppi, pi)
    println(*pi, i)
}
</code></pre>
<h3 id="å‡½æ•°function-types"><a class="header" href="#å‡½æ•°function-types">å‡½æ•°(Function types)</a></h3>
<p>goè¯­è¨€çš„å‡½æ•°çš„å£°æ˜æ ¼å¼ä¸å…¶å®ƒè¯­è¨€ä¹Ÿæœ‰æ‰€ä¸åŒã€‚</p>
<pre><code>FunctionType   = &quot;func&quot; Signature .
Signature      = Parameters [ Result ] .
Result         = Parameters | Type .
Parameters     = &quot;(&quot; [ ParameterList [ &quot;,&quot; ] ] &quot;)&quot; .
ParameterList  = ParameterDecl { &quot;,&quot; ParameterDecl } .
ParameterDecl  = [ IdentifierList ] [ &quot;...&quot; ] Type .
</code></pre>
<p>å¯ä»¥ç”±ä»¥ä¸‹å‡ ç§æ ·å¼çš„å‡½æ•°ï¼š</p>
<pre><code>func()
func(x int) int
func(a, _ int, z float32) bool
func(a, b int, z float32) (bool)
func(prefix string, values ...int)
func(a, b int, z float64, opt ...interface{}) (success bool)
func(int, int, float64) (float64, *[]int)
func(n int) func(p *T)
</code></pre>
<p>æœ€æ˜¾è‘—çš„ä¸åŒæ˜¯ï¼Œå‚æ•°çš„ç±»å‹æ˜¯åœ¨å‚æ•°åä¹‹åçš„ï¼Œå¦‚æœä¸¤ä¸ªå‚æ•°ç±»å‹ç›¸åŒä¸”ä½ç½®ç›¸ä¸´ï¼Œå¯ä»¥çœç•¥å‰ä¸€ä¸ªå‚æ•°çš„ç±»å‹ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code>func(a, b int, z float32) (bool)
</code></pre>
<p>å‡½æ•°çš„æœ€åä¸€ä¸ªå‚æ•°å¯ä»¥æ˜¯å˜é•¿å‚æ•°(variadic)ï¼Œå¯ä»¥å¯¹åº”0ä¸ªåˆ°å¤šä¸ªè¾“å…¥å‚æ•°ï¼š</p>
<pre><code>func(prefix string, values ...int)
</code></pre>
<p>å‡½æ•°å¯ä»¥æœ‰å¤šä¸ªè¿”å›å€¼ï¼š</p>
<pre><code>func(int, int, float64) (float64, *[]int)
</code></pre>
<p>ä¹Ÿå¯ä»¥è¿”å›å‡½æ•°ï¼š</p>
<pre><code>func(n int) func(p *T)
</code></pre>
<p>æ³¨æ„ï¼Œè¿™é‡Œç»™å‡ºçš„æ˜¯å‡½æ•°ç±»å‹ï¼Œå‡½æ•°ç±»å‹ä¸ç­‰äºå‡½æ•°çš„å£°æ˜ä¸å®ç°ï¼Œå‡½æ•°çš„å£°æ˜ä¸å®ç°åœ¨åé¢ç« èŠ‚ä¸­ã€‚</p>
<h3 id="æ¥å£interface-types"><a class="header" href="#æ¥å£interface-types">æ¥å£(Interface types)</a></h3>
<p>æ¥å£ç±»å‹çš„æ ¼å¼å¦‚ä¸‹ï¼š</p>
<pre><code>InterfaceType      = &quot;interface&quot; &quot;{&quot; { MethodSpec &quot;;&quot; } &quot;}&quot; .
MethodSpec         = MethodName Signature | InterfaceTypeName .
MethodName         = identifier .
InterfaceTypeName  = TypeName .
</code></pre>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code>interface {
    Read(b Buffer) bool
    Write(b Buffer) bool
    Close()
}
</code></pre>
<p>æ¥å£çš„æˆå‘˜æ˜¯æ–¹æ³•(method)ï¼Œä¸€ä¸ªç±»å‹åªè¦å®ç°ä¸€ä¸ªæ¥å£ä¸­çš„æ‰€æœ‰æ–¹æ³•çš„ç±»å‹ï¼Œå¯ä»¥ä½œä¸ºç±»å‹ä¸ºè¯¥æ¥å£çš„å˜é‡çš„çš„åŠ¨æ€ç±»å‹ã€‚</p>
<p>ä¾‹å¦‚ä¸‹é¢çš„Tå°±å®ç°äº†ä¸Šé¢çš„æ¥å£ï¼š</p>
<pre><code>func (p T) Read(b Buffer) bool { return â€¦ }
func (p T) Write(b Buffer) bool { return â€¦ }
func (p T) Close() { â€¦ }
</code></pre>
<p>ä¸€ä¸ªç±»å‹å¯ä»¥å®ç°å¤šä¸ªæ¥å£çš„æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥æ˜¯ç©ºçš„ï¼Œä¸åŒ…å«ä»»ä½•çš„æ–¹æ³•ï¼š</p>
<pre><code>interface{}
</code></pre>
<p>æ¥å£å¯ä»¥åŒ…å«å…¶å®ƒçš„æ¥å£ï¼Œä½†æ˜¯ä¸èƒ½åŒ…å«å®ƒè‡ªèº«ï¼Œæˆ–è€…é€šè¿‡å…¶å®ƒæ¥å£å½¢æˆäº†é‡å¤åŒ…å«ï¼š</p>
<pre><code>// illegal: Bad cannot embed itself
type Bad interface {
    Bad
}

// illegal: Bad1 cannot embed itself using Bad2
type Bad1 interface {
    Bad2
}
type Bad2 interface {
    Bad1
}
</code></pre>
<h3 id="å­—å…¸map-types"><a class="header" href="#å­—å…¸map-types">å­—å…¸(Map types)</a></h3>
<p>goè¯­è¨€åŸç”Ÿæ”¯æŒå­—å…¸(map)ã€‚</p>
<pre><code>MapType     = &quot;map&quot; &quot;[&quot; KeyType &quot;]&quot; ElementType .
KeyType     = Type .
</code></pre>
<p>Keyçš„ç±»å‹ä¸èƒ½æ˜¯å‡½æ•°(function)ã€å­—å…¸(map)ã€åˆ†ç‰‡(slice)</p>
<p>å¦‚æœKeyçš„ç±»å‹æ˜¯æ¥å£ï¼Œå¯ä»¥ä½œä¸ºè¯¥æ¥å£å˜é‡çš„åŠ¨æ€ç±»å‹çš„ç±»å‹å¿…é¡»æ˜¯å¯æ¯”è¾ƒçš„ï¼Œå¦åˆ™ä¼španicã€‚</p>
<p>å­—å…¸ä¸­çš„æˆå‘˜æ•°é‡æˆä¸ºå­—å…¸çš„é•¿åº¦(length)ï¼Œå¯ä»¥é€šè¿‡å†…ç½®å‡½æ•°len()è·å–ã€‚</p>
<p>å­—å…¸çš„æˆå‘˜å¯ä»¥é€šè¿‡èµ‹å€¼æ“ä½œå¢åŠ ï¼Œç”¨Keyä½œä¸ºindexè¯»å–ã€‚</p>
<p>å¦‚æœè¦åˆ é™¤å­—å…¸ä¸­çš„æˆå‘˜ï¼Œéœ€è¦ä½¿ç”¨å†…ç½®çš„delete()å‡½æ•°ã€‚</p>
<p>mapéœ€è¦ä½¿ç”¨å†…ç½®å‡½æ•°makeåˆ›å»º:</p>
<pre><code>make(map[string]int)
make(map[string]int, 100)
</code></pre>
<p>åˆ›å»ºæ—¶æŒ‡å®šlengthæ„æ€æ˜¯ï¼Œé¢„å…ˆåˆ†é…å‡ºå¯ä»¥å®¹çº³è¿™ä¹ˆå¤šæˆå‘˜çš„ç©ºé—´ï¼Œè€Œä¸æ˜¯åªèƒ½å®¹çº³è¿™ä¹ˆå¤šã€‚</p>
<p>mapçš„é•¿åº¦ä¸å—åˆ›å»ºæ—¶æŒ‡å®šçš„lengthçš„é™åˆ¶ï¼Œå¯ä»¥æ— é™å¢åŠ æˆå‘˜ã€‚</p>
<pre><code>package main

import (
    &quot;fmt&quot;
)

func main() {
    m := make(map[int]int, 10)
    for i := 0; i &lt; 10; i++ {
        m[i] = i
    }
    println(len(m))
    fmt.Println(m)
    m[11] = 11
    println(len(m))
    fmt.Println(m)
}
</code></pre>
<h3 id="é€šé“channel-types"><a class="header" href="#é€šé“channel-types">é€šé“(Channel types)</a></h3>
<p>é€šé“æ˜¯ç”¨æ¥åœ¨å¹¶å‘ç¼–ç¨‹ä¸­ä¼ é€’valueçš„ã€‚</p>
<pre><code>ChannelType = ( &quot;chan&quot; | &quot;chan&quot; &quot;&lt;-&quot; | &quot;&lt;-&quot; &quot;chan&quot; ) ElementType .
</code></pre>
<p>å®ƒå¯ä»¥æ˜¯å¯è¯»ã€å¯å†™ã€æ—¢å¯è¯»åˆå¯å†™çš„ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code>chan T          // can be used to send and receive values of type T
chan&lt;- float64  // can only be used to send float64s
&lt;-chan int      // can only be used to receive ints
</code></pre>
<p>&lt;- æ˜¯é å·¦ä¸´è¿‘çš„ï¼Œé€šé“ç±»å‹æœ¬èº«ä¹Ÿå¼€å§‹è¢«ä¼ é€’ï¼š</p>
<pre><code>chan&lt;- chan int    // same as chan&lt;- (chan int)
chan&lt;- &lt;-chan int  // same as chan&lt;- (&lt;-chan int)
&lt;-chan &lt;-chan int  // same as &lt;-chan (&lt;-chan int)
chan (&lt;-chan int)
</code></pre>
<p>é€šé“ç±»å‹çš„å˜é‡å¿…é¡»ç”¨å†…ç½®çš„makeå‡½æ•°åˆ›å»ºï¼š</p>
<pre><code>make(chan int, 100)
</code></pre>
<p>ç¬¬äºŒå‚æ•°æ˜¯æŒ‡å®šé€šé“ä¸­å¯ä»¥ç¼“å­˜çš„æˆå‘˜çš„æ•°é‡ï¼Œå¦‚æœæ²¡æœ‰ç¬¬äºŒä¸ªå‚æ•°æˆ–è€…ç¬¬äºŒä¸ªå‚æ•°ä¸º0ï¼Œé‚£ä¹ˆè¯¥é€šé“æ˜¯ä¸åšç¼“å­˜çš„ï¼Œå¿…é¡»ç­‰å¯¹æ–¹æ¥æ”¶æˆ–è€…å†™å…¥å®Œæˆåï¼Œæ‰å¯ä»¥å®Œæˆå†™å…¥æˆ–æ¥æ”¶ã€‚</p>
<p>é€šé“éœ€è¦ç”±å†™å…¥æ–¹ä½¿ç”¨å†…ç½®çš„closeå‡½æ•°å…³é—­ï¼Œæ¥æ”¶æ–¹æ”¶å–äº†æœ€åä¸€ä¸ªæ•°æ®åï¼Œå†ä»é€šé“ä¸­è¯•å›¾è¯»å–çš„æ—¶å€™ï¼Œä¼šç«‹å³è¿”å›å¤±è´¥ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœé€šé“cè¢«å…³é—­ï¼Œä¸”é€šé“ä¸­æ²¡æœ‰æ•°æ®äº†ï¼Œä¸‹é¢çš„è¯­å¥å°†ä¼šç«‹å³è¿”å›ï¼Œä¸”okæ˜¯falseã€‚</p>
<pre><code>x, ok := &lt;-c
</code></pre>
<p>é€šé“æ˜¯å¹¶å‘å®‰å…¨çš„ï¼Œä½¿ç”¨å†…ç½®å‡½æ•°lenè¯»å–é€šé“ä¸­ç¼“å­˜çš„æ•°æ®ä¸ªæ•°ï¼Œæˆ–è€…ç”¨capè¯»å–é€šé“å®¹é‡ï¼Œä¸éœ€è¦è€ƒè™‘å¹¶å‘çš„å½±å“ã€‚</p>
<p>å¦å¤–é€šé“ä¸­çš„æ•°æ®éµå¾ªå…ˆå…¥å…ˆå‡ºçš„è§„åˆ™ã€‚</p>
<h2 id="å‚è€ƒ-9"><a class="header" href="#å‚è€ƒ-9">å‚è€ƒ</a></h2>
<ol>
<li><a href="https://golang.org/ref/spec#Lexical_elements" title="go Lexical elements">go Lexical elements</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="ä»£ç åŒºå—å£°æ˜å£°æ˜ä½œç”¨åŸŸå"><a class="header" href="#ä»£ç åŒºå—å£°æ˜å£°æ˜ä½œç”¨åŸŸå">ä»£ç åŒºå—ã€å£°æ˜ã€å£°æ˜ä½œç”¨åŸŸå</a></h1>
<p>å£°æ˜çš„å½±å“æ˜¯æœ‰èŒƒå›´çš„ï¼Œå®ƒçš„å½±å“èŒƒå›´å«åšä½œç”¨åŸŸï¼Œä½œç”¨åŸŸå¯¹åº”çš„æ˜¯ä»£ç åŒºå—ã€‚</p>
<h2 id="ä»£ç åŒºå—blocks"><a class="header" href="#ä»£ç åŒºå—blocks">ä»£ç åŒºå—(blocks)</a></h2>
<pre><code>Block = &quot;{&quot; StatementList &quot;}&quot; .
StatementList = { Statement &quot;;&quot; } .
</code></pre>
<p>åœ¨goä¸­æœ‰è¿™æ ·å‡ ç§ä»£ç åŒºå—ï¼š</p>
<pre><code>æ‰€æœ‰çš„ä»£ç ç»„æˆä¸€ä¸ªç»ˆæåŒºå—(universe block)
éš¶å±äºåŒä¸€ä¸ªpackageçš„ä»£ç ï¼Œç»„æˆå¯¹åº”çš„åŒ…åŒºå—(package block)
åŒä¸€ä¸ªæ–‡ä»¶ä¸­çš„ä»£ç ï¼Œç»„æˆä¸€ä¸ªæ–‡ä»¶åŒºå—(file block)
ifã€forã€switchè¯­å¥åŒ…è£¹çš„ä»£ç ï¼Œç»„æˆäº†ç‹¬ç«‹çš„éšå¼åŒºå—(implicit block)
switchã€selectçš„æ¡ä»¶(clause)è¯­å¥ä¸­çš„ä»£ç ï¼Œç»„æˆäº†ç‹¬ç«‹çš„éšå¼åŒºå—
&quot;{&quot;å’Œ&quot;}&quot;åŒ…è£¹çš„ä»£ç ï¼Œç»„æˆä¸€ä¸ªéšå¼åŒºå—
</code></pre>
<h2 id="å£°æ˜çš„ä½œç”¨åŸŸdeclarations-and-scope"><a class="header" href="#å£°æ˜çš„ä½œç”¨åŸŸdeclarations-and-scope">å£°æ˜çš„ä½œç”¨åŸŸ(Declarations and scope)</a></h2>
<p>å£°æ˜å°±æ˜¯è®¾ç½®æ ‡è®°ç¬¦(identifier)çš„è¿‡ç¨‹ï¼Œå®ç°æ ‡è®°ç¬¦ä»¥ä¸‹å†…å®¹çš„ç»‘å®šï¼š</p>
<pre><code>constantï¼Œå¸¸é‡
typeï¼Œç±»å‹
variableï¼Œå˜é‡
functionï¼Œå‡½æ•°
labelï¼Œæ ‡è®°
packageï¼ŒåŒ…
</code></pre>
<p>å£°æ˜çš„è¯­æ³•æ ¼å¼ï¼š</p>
<pre><code>Declaration   = ConstDecl | TypeDecl | VarDecl .
TopLevelDecl  = Declaration | FunctionDecl | MethodDecl .
</code></pre>
<p>åœ¨åŒ…åŒºå—ä¸­ï¼Œ<code>init</code>åªèƒ½ç”¨äºå£°æ˜initå‡½æ•°ã€‚</p>
<p>å£°æ˜çš„æ•ˆæœæ˜¯é™å®šåœ¨åŒºå—ä¸­çš„ã€‚</p>
<pre><code>goå†…ç½®çš„æ ‡è®°ç¬¦åœ¨ç»ˆæåŒºå—(universe block)ä¸­æœ‰æ•ˆ
åœ¨å‡½æ•°ä¹‹å¤–å£°æ˜çš„å¸¸é‡ã€ç±»å‹ã€å˜é‡ã€å‡½æ•°åœ¨åŒ…åŒºå—(package block)ä¸­æœ‰æ•ˆï¼Œæ³¨æ„ä¸åŒ…æ‹¬æ–¹æ³•(method)ã€‚
é€šè¿‡importå¯¼å…¥çš„åŒ…(package)çš„åå­—ï¼Œåœ¨æ–‡ä»¶åŒºå—(file block)ä¸­æœ‰æ•ˆ
å£°æ˜çš„æ–¹æ³•çš„æ¥æ”¶è€…(receiver)ã€å‡½æ•°å‚æ•°ã€å‡½æ•°è¿”å›å€¼ï¼Œåœ¨å‡½æ•°çš„ä»£ç åŒºå—ä¸­æœ‰æ•ˆ
åœ¨å‡½æ•°çš„ä»£ç åŒºå—ä¸­å£°æ˜çš„å¸¸é‡ã€å˜é‡ã€ç±»å‹ï¼Œåœ¨å£°æ˜ä½ç½®å’Œæ‰€åœ¨çš„æœ€å†…å±‚åŒºå—çš„æœ«å°¾ä¹‹é—´æœ‰æ•ˆ
</code></pre>
<p>ä»£ç åŒºå—æ˜¯å¯ä»¥åµŒå¥—çš„ï¼Œå†…å±‚ä»£ç åŒºå—ä¸­çš„å£°æ˜åœ¨å†…å­˜ä»£ç åŒºå—ä¸­è¦†ç›–å¤–å±‚ä»£ç åŒºå—ä¸­çš„å£°æ˜ã€‚</p>
<h2 id="æ ‡è®°ä½œç”¨åŸŸlabel-scopes"><a class="header" href="#æ ‡è®°ä½œç”¨åŸŸlabel-scopes">æ ‡è®°ä½œç”¨åŸŸ(Label scopes)</a></h2>
<p>æ ‡è®°(Label)çš„ä½œç”¨åŸŸä¸å…¶å®ƒçš„æ ‡è®°ç¬¦ä¸åŒï¼Œå®ƒè¢«ç”¨äº<code>break</code>ã€<code>continue</code>ã€<code>goto</code>ã€‚</p>
<p>æ ‡è®°ä¸€æ—¦å£°æ˜ï¼Œå¿…é¡»ä½¿ç”¨ï¼Œå¦åˆ™ç¼–è¯‘æŠ¥é”™ã€‚</p>
<p>æ ‡è®°åœ¨å‡½æ•°å†…å£°æ˜ï¼Œå®ƒåœ¨æ•´ä¸ªå‡½æ•°åŒºå—ä»¥åŠå‡½æ•°åŒºå—çš„åµŒå…¥åŒºå—ä¸­æœ‰æ•ˆï¼Œå¹¶ä¸”å¯ä»¥ä¸å…¶å®ƒæ ‡è¯†ç¬¦åŒåï¼Œ</p>
<h2 id="å†…ç½®çš„æ ‡è®°ç¬¦"><a class="header" href="#å†…ç½®çš„æ ‡è®°ç¬¦">å†…ç½®çš„æ ‡è®°ç¬¦</a></h2>
<p>goå†…ç½®äº†ç©ºç™½æ ‡è®°ç¬¦(Blank identifier)å’Œé¢„å£°æ˜çš„æ ‡è®°æœ(Predeclared identifiers)ã€‚</p>
<p>ç©ºç™½æ ‡è®°ç¬¦å°±æ˜¯ä¸€ä¸ªä¸‹åˆ’çº¿<code>_</code>ï¼Œè¡¨ç¤ºå¯¹åº”çš„ç›®æ ‡ä¸è¢«å£°æ˜ã€‚</p>
<p>é¢„å£°æ˜çš„æ ‡è®°ç¬¦æœ‰ä»¥ä¸‹è¿™äº›:</p>
<pre><code>Types:
    bool byte complex64 complex128 error float32 float64
    int int8 int16 int32 int64 rune string
    uint uint8 uint16 uint32 uint64 uintptr

Constants:
    true false iota

Zero value:
    nil

Functions:
    append cap close complex copy delete imag len
    make new panic print println real recover
</code></pre>
<h2 id="æ ‡è¯†ç¬¦çš„å¯¼å‡ºexported-identifiers"><a class="header" href="#æ ‡è¯†ç¬¦çš„å¯¼å‡ºexported-identifiers">æ ‡è¯†ç¬¦çš„å¯¼å‡º(Exported identifiers)</a></h2>
<p>å¯ä»¥å°†åŒ…åŒºå—(package block)ä¸­çš„æ»¡è¶³æ¡ä»¶çš„æ ‡è®°ç¬¦å¯¼å‡ºåˆ°å…¶å®ƒåŒ…åŒºå—ä¸­ã€‚</p>
<pre><code>æ ‡è®°ç¬¦å¿…é¡»ä»¥å¤§å†™å­—æ¯å¼€å¤´(Unicode upper case letter)
æ ‡è®°ç¬¦æ˜¯åœ¨åŒ…åŒºå—ä¸­å£°æ˜çš„ï¼Œæˆ–è€…æ˜¯ç»“æ„çš„æˆè¯­åï¼ˆfiled name)ã€æ–¹æ³•å(method name)
</code></pre>
<p>ä¸ç¬¦åˆè¿™ä¸¤ç‚¹çš„æ ‡è®°ç¬¦ä¸èƒ½å¯¼å‡ºã€‚</p>
<h2 id="æ ‡è®°ç¬¦çš„å”¯ä¸€æ€§uniqueness-of-identifiers"><a class="header" href="#æ ‡è®°ç¬¦çš„å”¯ä¸€æ€§uniqueness-of-identifiers">æ ‡è®°ç¬¦çš„å”¯ä¸€æ€§(Uniqueness of identifiers)</a></h2>
<p>ä¸åŒåçš„ä¸¤ä¸ªæ ‡è®°ç¬¦æ˜¯ä¸åŒçš„ï¼Œåœ¨ä¸åŒçš„åŒ…ä¸­åŒåçš„ä¸¤ä¸ªæ ‡è®°ç¬¦ä¹Ÿä¸åŒçš„ã€‚</p>
<h2 id="å¸¸é‡çš„å£°æ˜constant-declarations"><a class="header" href="#å¸¸é‡çš„å£°æ˜constant-declarations">å¸¸é‡çš„å£°æ˜(Constant declarations)</a></h2>
<p>å¸¸é‡çš„å£°æ˜æ˜¯å°†å¸¸é‡ã€å¸¸é‡è¡¨è¾¾å¼ç»‘å®šåˆ°æŒ‡å®šçš„æ ‡è®°ç¬¦ï¼Œä¹‹åå¯ç”¨æ ‡è®°ç¬¦è¯»å–å¸¸é‡ã€‚</p>
<pre><code>ConstDecl      = &quot;const&quot; ( ConstSpec | &quot;(&quot; { ConstSpec &quot;;&quot; } &quot;)&quot; ) .
ConstSpec      = IdentifierList [ [ Type ] &quot;=&quot; ExpressionList ] .

IdentifierList = identifier { &quot;,&quot; identifier } .
ExpressionList = Expression { &quot;,&quot; Expression } .
</code></pre>
<p>æœ‰ä»¥ä¸‹å‡ ç§å£°æ˜æ ·å¼ï¼š</p>
<pre><code>const Pi float64 = 3.14159265358979323846
const zero = 0.0         // untyped floating-point constant
const (
    size int64 = 1024
    eof        = -1  // untyped integer constant
)
const a, b, c = 3, 4, &quot;foo&quot;  // a = 3, b = 4, c = &quot;foo&quot;, untyped integer and string constants
const u, v float32 = 0, 3    // u = 0.0, v = 3.0
</code></pre>
<p>åœ¨ä½¿ç”¨å°æ‹¬å·æ ·å¼æ—¶ï¼Œå¦‚æœåç»­å£°æ˜çš„å¸¸é‡è¡¨è¾¾å¼æ˜¯ç›¸åŒçš„ï¼Œé‚£ä¹ˆå¯ä»¥çœç•¥è¿™äº›å¸¸é‡è¡¨è¾¾æ ·å¼ã€‚</p>
<p>ä¸‹é¢çš„å£°æ˜:</p>
<pre><code>const (
    Sunday = iota
    Monday
    Tuesday
)
</code></pre>
<p>ç­‰åŒäºï¼š</p>
<pre><code>const (
    Sunday = iota
    Monday = iota
    Tuesday = iota
)
</code></pre>
<p>goå†…ç½®å¸¸é‡iotaæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å¸¸é‡è¡¨è¾¾å¼ï¼Œå®ƒåœ¨<code>const</code>å…³é”®å­—ä¹‹åç¬¬ä¸€æ¬¡å‡ºç°æ˜¯valueæ˜¯0ï¼Œåœ¨åç»­çš„æ¯æ¬¡å£°æ˜ä¸­ï¼Œvalueå¢åŠ 1ï¼Œç›´åˆ°é‡åˆ°ä¸‹ä¸€ä¸ªconståï¼Œé‡æ–°å½’é›¶ã€‚</p>
<pre><code>const ( // iota is reset to 0
    c0 = iota  // c0 == 0
    c1 = iota  // c1 == 1
    c2 = iota  // c2 == 2
)

const ( // iota is reset to 0
    a = 1 &lt;&lt; iota  // a == 1
    b = 1 &lt;&lt; iota  // b == 2
    c = 3          // c == 3  (iota is not used but still incremented)
    d = 1 &lt;&lt; iota  // d == 8
)

const ( // iota is reset to 0
    u         = iota * 42  // u == 0     (untyped integer constant)
    v float64 = iota * 42  // v == 42.0  (float64 constant)
    w         = iota * 42  // w == 84    (untyped integer constant)
)

const x = iota  // x == 0  (iota has been reset)
const y = iota  // y == 0  (iota has been reset)
</code></pre>
<p>æ³¨æ„ï¼Œåœ¨åŒä¸€ä¸ªå£°æ˜ä¸­å‡ºç°çš„å¤šä¸ªitoaçš„valueæ˜¯ç›¸åŒçš„ï¼š</p>
<pre><code>const (
    bit0, mask0 = 1 &lt;&lt; iota, 1&lt;&lt;iota - 1  // bit0 == 1, mask0 == 0
    bit1, mask1                           // bit1 == 2, mask1 == 1
    _, _                                  // skips iota == 2
    bit3, mask3                           // bit3 == 8, mask3 == 7
)
</code></pre>
<h2 id="ç±»å‹å£°æ˜"><a class="header" href="#ç±»å‹å£°æ˜">ç±»å‹å£°æ˜</a></h2>
<p>ç±»å‹ç”¨å…³é”®å­—typeè¿›è¡Œå£°æ˜ã€‚</p>
<pre><code>TypeDecl     = &quot;type&quot; ( TypeSpec | &quot;(&quot; { TypeSpec &quot;;&quot; } &quot;)&quot; ) .
TypeSpec     = identifier Type .
</code></pre>
<p>ç±»å‹å£°æ˜ä¹Ÿæœ‰å‡ ç§æ ·å¼:</p>
<pre><code>type IntArray [16]int

type (
    Point struct{ x, y float64 }
    Polar Point
)

type TreeNode struct {
    left, right *TreeNode
    value *Comparable
}

type Block interface {
    BlockSize() int
    Encrypt(src, dst []byte)
    Decrypt(src, dst []byte)
}
</code></pre>
<p>éœ€è¦æ³¨æ„ï¼Œä¸ºä¸€ä¸ªç±»å‹å£°æ˜äº†å¦ä¸€ä¸ªæ ‡è®°ç¬¦ä¹‹åï¼Œè¿™ä¸ªæ ‡è®°ç¬¦å¯¹åº”çš„ç±»å‹ä¸ä¼šå¾—åˆ°è¢«å£°æ˜çš„ç±»å‹çš„æ–¹æ³•ã€‚</p>
<pre><code>// A Mutex is a data type with two methods, Lock and Unlock.
type Mutex struct         { /* Mutex fields */ }
func (m *Mutex) Lock()    { /* Lock implementation */ }
func (m *Mutex) Unlock()  { /* Unlock implementation */ }

// NewMutex has the same composition as Mutex but its method set is empty.
type NewMutex Mutex

// The method set of the base type of PtrMutex remains unchanged,
// but the method set of PtrMutex is empty.
type PtrMutex *Mutex
</code></pre>
<h2 id="å˜é‡çš„å£°æ˜variable-declarations"><a class="header" href="#å˜é‡çš„å£°æ˜variable-declarations">å˜é‡çš„å£°æ˜(Variable declarations)</a></h2>
<pre><code>VarDecl     = &quot;var&quot; ( VarSpec | &quot;(&quot; { VarSpec &quot;;&quot; } &quot;)&quot; ) .
VarSpec     = IdentifierList ( Type [ &quot;=&quot; ExpressionList ] | &quot;=&quot; ExpressionList ) .
</code></pre>
<p>å˜é‡æœ‰ä»¥ä¸‹å‡ ç§å£°æ˜æ ¼å¼:</p>
<pre><code>var i int
var U, V, W float64
var k = 0
var x, y float32 = -1, -2
var (
    i       int
    u, v, s = 2.0, 3.0, &quot;bar&quot;
)
var re, im = complexSqrt(-1)
var _, found = entries[name]  // map lookup; only interested in &quot;found&quot;
</code></pre>
<p>å¦‚æœå£°æ˜æ—¶æ²¡æœ‰èµ‹å€¼ï¼Œå˜é‡çš„å€¼ä¸ºå¯¹åº”çš„ç±»å‹çš„é›¶å€¼(zero value)ã€‚</p>
<p>å¦‚æœå£°æ˜æ—¶æ²¡æœ‰æŒ‡å®šç±»å‹ï¼Œå˜é‡çš„ç±»å‹æ ¹æ®èµ‹çš„å€¼æ¨å¯¼å‡ºæ¥ï¼š</p>
<pre><code>var d = math.Sin(0.5)  // d is float64
var i = 42             // i is int
var t, ok = x.(T)      // t is T, ok is bool
</code></pre>
<p>ç‰¹åˆ«æ³¨æ„ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šç±»å‹ï¼Œèµ‹å€¼æ—¶ä¸èƒ½ä½¿ç”¨nilï¼š</p>
<pre><code>var n = nil            // illegal
</code></pre>
<h2 id="å˜é‡çš„ç®€å•å£°æ˜short-variable-declarations"><a class="header" href="#å˜é‡çš„ç®€å•å£°æ˜short-variable-declarations">å˜é‡çš„ç®€å•å£°æ˜(Short variable declarations)</a></h2>
<p>å˜é‡è¿˜å¯ä»¥ä½¿ç”¨ç®€çŸ­çš„æ–¹å¼å£°æ˜ã€‚</p>
<pre><code>ShortVarDecl = IdentifierList &quot;:=&quot; ExpressionList .
</code></pre>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code>i, j := 0, 10
f := func() int { return 7 }
ch := make(chan int)
r, w := os.Pipe(fd)  // os.Pipe() returns two values
_, y, _ := coord(p)  // coord() returns three values; only interested in y coordinate
</code></pre>
<p>ä½¿ç”¨ç®€çŸ­æ–¹å¼æ—¶å¿…é¡»æ³¨æ„ï¼Œ&quot;:=&quot;å³è¾¹å¿…é¡»æœ‰æ–°çš„æ ‡è®°ç¬¦ï¼š</p>
<pre><code>field1, offset := nextField(str, 0)
field2, offset := nextField(str, offset)  // redeclares offset
a, a := 1, 2                              // illegal: double declaration of a or no new variable 
                                          // if a was declared elsewhere
</code></pre>
<p>ç®€å•æ–¹å¼æ¯”è¾ƒé€‚åˆåœ¨&quot;if&quot;ã€&quot;for&quot;ã€&quot;switch&quot;è¯­å¥å£°æ˜åªä¼šåœ¨æœ¬åŒºå—ä¸­ä½¿ç”¨çš„å˜é‡ã€‚</p>
<h2 id="å‡½æ•°çš„å£°æ˜function-declarations"><a class="header" href="#å‡½æ•°çš„å£°æ˜function-declarations">å‡½æ•°çš„å£°æ˜(Function declarations)</a></h2>
<p>å‡½æ•°ä½¿ç”¨å…³é”®å­—<code>func</code>å£°æ˜ã€‚</p>
<pre><code>FunctionDecl = &quot;func&quot; FunctionName ( Function | Signature ) .
FunctionName = identifier .
Function     = Signature FunctionBody .
FunctionBody = Block .
</code></pre>
<p>å¦‚æœå‡½æ•°ç±»å‹ä¸­æœ‰è¿”å›å€¼ï¼Œå‡½æ•°å£°æ˜ä¸­å¿…é¡»åœ¨æ¯ä¸ªè·¯å¾„çš„æœ€åè¿›è¡Œreturnã€‚</p>
<pre><code>func IndexRune(s string, r rune) int {
    for i, c := range s {
        if c == r {
            return i
        }
    }
    // invalid: missing return statement
}
</code></pre>
<p>å¯ä»¥å£°æ˜ä¸€ä¸ªä¸æ˜¯ç”¨goå®ç°çš„å‡½æ•°ï¼Œåœ¨å£°æ˜ä¸­çœç•¥å‡½æ•°ä½“å³å¯ã€‚</p>
<pre><code>func flushICache(begin, end uintptr)  // implemented externally
</code></pre>
<h2 id="æ–¹æ³•çš„å£°æ˜method-declarations"><a class="header" href="#æ–¹æ³•çš„å£°æ˜method-declarations">æ–¹æ³•çš„å£°æ˜(Method declarations)</a></h2>
<p>æ–¹æ³•ä¹Ÿç”¨å…³é”®å­—<code>func</code>å£°æ˜ï¼Œä½†æ˜¯æ ¼å¼ä¸åŒï¼Œæ¯”å‡½æ•°å£°æ˜å¤šäº†ä¸€ä¸ªReceiverã€‚</p>
<pre><code>MethodDecl   = &quot;func&quot; Receiver MethodName ( Function | Signature ) .
Receiver     = Parameters .
</code></pre>
<p>Receiverçš„ç±»å‹æ˜¯<code>T</code>æˆ–è€…<code>*T</code>ï¼ŒTçš„ç±»å‹ä¸èƒ½æ˜¯æŒ‡é’ˆå’Œæ¥å£ï¼Œå¹¶ä¸”å¿…é¡»æ˜¯åœ¨åŒä¸€ä¸ªåŒ…ä¸­å®šä¹‰çš„ã€‚</p>
<p>Receiverå¯ä»¥è®¾ç½®æ ‡è®°ç¬¦ï¼Œæ ‡è®°ç¬¦åœ¨æ–¹æ³•çš„åŒºå—ä¸­æœ‰æ•ˆï¼Œä¸”ä¸èƒ½ä¸æ–¹æ³•ä¸­çš„å…¶å®ƒæ ‡è®°ç¬¦é‡åã€‚</p>
<pre><code>func (p *Point) Length() float64 {
   return math.Sqrt(p.x * p.x + p.y * p.y)
}

func (p *Point) Scale(factor float64) {
   p.x *= factor
   p.y *= factor
}
</code></pre>
<p>æ–¹æ³•çš„ç±»å‹æ˜¯å‡½æ•°ï¼Œä¾‹å¦‚ä¸Šé¢å£°æ˜çš„æ–¹æ³•Scaleï¼Œå®ƒçš„ç±»å‹æ˜¯ï¼š</p>
<pre><code>func(p *Point, factor float64)
</code></pre>
<h2 id="å‚è€ƒ-10"><a class="header" href="#å‚è€ƒ-10">å‚è€ƒ</a></h2>
<ol>
<li><a href="https://golang.org/ref/spec#Lexical_elements" title="go Lexical elements">go Lexical elements</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="è¡¨è¾¾å¼expressions-ä¸è¿ç®—ç¬¦operator"><a class="header" href="#è¡¨è¾¾å¼expressions-ä¸è¿ç®—ç¬¦operator">è¡¨è¾¾å¼(Expressions) ä¸è¿ç®—ç¬¦(Operator)</a></h1>
<h2 id="è¡¨è¾¾å¼"><a class="header" href="#è¡¨è¾¾å¼">è¡¨è¾¾å¼</a></h2>
<p>è¡¨è¾¾å¼æ˜¯ç”¨è¿ç®—ç¬¦å’Œå‡½æ•°çš„æè¿°çš„ä¸€ä¸ªè®¡ç®—è¿‡ç¨‹ã€‚</p>
<h3 id="å¸¸é‡è¡¨è¾¾å¼constant-expressions"><a class="header" href="#å¸¸é‡è¡¨è¾¾å¼constant-expressions">å¸¸é‡è¡¨è¾¾å¼(Constant expressions)</a></h3>
<p>å¸¸é‡è¡¨è¾¾å¼åœ¨ç¼–è¯‘æ—¶æ‰§è¡Œï¼Œå¸¸é‡è¡¨è¾¾å¼ä¸­åªèƒ½ä½¿ç”¨å¸¸é‡ã€‚</p>
<p>ä½¿ç”¨å¸¸é‡è¡¨è¾¾å¼æ—¶ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„æœªæ˜ç¡®å£°æ˜ç±»å‹çš„å¸¸é‡çš„ç±»å‹ã€‚</p>
<pre><code>const a = 2 + 3.0             // a == 5.0   (untyped floating-point constant)
const b = 15 / 4              // b == 3     (untyped integer constant)
const c = 15 / 4.0            // c == 3.75  (untyped floating-point constant)
const Î˜ float64 = 3/2         // Î˜ == 1.0   (type float64, 3/2 is integer division)
const Î  float64 = 3/2.        // Î  == 1.5   (type float64, 3/2. is float division)
const d = 1 &lt;&lt; 3.0            // d == 8     (untyped integer constant)
const e = 1.0 &lt;&lt; 3            // e == 8     (untyped integer constant)
const f = int32(1) &lt;&lt; 33      // illegal    (constant 8589934592 overflows int32)
const g = float64(2) &gt;&gt; 1     // illegal    (float64(2) is a typed floating-point constant)
const h = &quot;foo&quot; &gt; &quot;bar&quot;       // h == true  (untyped boolean constant)
const j = true                // j == true  (untyped boolean constant)
const k = 'w' + 1             // k == 'x'   (untyped rune constant)
const l = &quot;hi&quot;                // l == &quot;hi&quot;  (untyped string constant)
const m = string(k)           // m == &quot;x&quot;   (type string)
const Î£ = 1 - 0.707i          //            (untyped complex constant)
const Î” = Î£ + 2.0e-4          //            (untyped complex constant)
const Î¦ = iota*1i - 1/1i      //            (untyped complex constant)
</code></pre>
<p>complexæ˜¯å†…ç½®çš„å‡½æ•°ï¼Œè¿”å›å¸¸é‡ï¼š</p>
<pre><code>const ic = complex(0, c)      // ic == 3.75i  (untyped complex constant)
const iÎ˜ = complex(0, Î˜)      // iÎ˜ == 1i     (type complex128)
</code></pre>
<p>å¦‚æœå¸¸é‡çš„å€¼è¶…è¿‡äº†èƒ½å¤Ÿè¡¨è¾¾çš„èŒƒå›´ï¼Œè¿™ä¸ªå¸¸é‡å¯ä»¥ä½œä¸ºä¸­é—´å€¼ä½¿ç”¨ï¼š</p>
<pre><code>const Huge = 1 &lt;&lt; 100         // Huge == 1267650600228229401496703205376  (untyped integer constant)
const Four int8 = Huge &gt;&gt; 98  // Four == 4                                (type int8)
</code></pre>
<p>é™¤æ•°ä¸èƒ½ä¸º0ï¼š</p>
<pre><code>const n = 3.14 / 0.0          // illegal: division by zero
</code></pre>
<p>ä¸å¯ä»¥å°†å¸¸é‡è½¬æ¢ä¸ºä¸åŒ¹é…çš„ç±»å‹ï¼š</p>
<pre><code>uint(-1)     // -1 cannot be represented as a uint
int(3.14)    // 3.14 cannot be represented as an int
int64(Huge)  // 1267650600228229401496703205376 cannot be represented as an int64
Four * 300   // operand 300 cannot be represented as an int8 (type of Four)
Four * 100   // product 400 cannot be represented as an int8 (type of Four)
</code></pre>
<h3 id="é€‰æ‹©è¡¨è¾¾å¼selector"><a class="header" href="#é€‰æ‹©è¡¨è¾¾å¼selector">é€‰æ‹©è¡¨è¾¾å¼(Selector)</a></h3>
<p>é€‰æ‹©è¡¨è¾¾å¼çš„æ ¼å¼å¦‚ä¸‹:</p>
<pre><code>x.f
</code></pre>
<p>å…¶ä¸­fæ˜¯é€‰æ‹©å™¨(selector)ï¼Œç±»å‹ä¸ºfï¼Œå®ƒä¸èƒ½æ˜¯ç©ºç™½æ ‡è®°ç¬¦<code>_</code>ã€‚</p>
<p>å¦‚æœxæ˜¯åŒ…åï¼Œé‚£ä¹ˆé€‰æ‹©çš„æ˜¯åŒ…ä¸­çš„æ ‡è®°ç¬¦ã€‚</p>
<p>få¯ä»¥æ˜¯xçš„æˆå‘˜ã€æ–¹æ³•ã€åŒ¿åæˆå‘˜ã€åŒ¿åæˆå‘˜çš„æ–¹æ³•ï¼Œåˆ°è¾¾fæ—¶ç»è¿‡çš„é€‰æ‹©æ¬¡æ•°æ˜¯fçš„æ·±åº¦(depth)ã€‚</p>
<p>å¦‚æœfæ˜¯xçš„ç›´æ¥æˆå‘˜ï¼Œæ·±åº¦ä¸º0ï¼Œfæ˜¯xçš„ç›´æ¥åŒ¿åæˆå‘˜çš„æˆå‘˜ï¼Œæ·±åº¦ä¸ºfåœ¨åŒ¿åæˆå‘˜ä¸­çš„æ·±åº¦+1ã€‚</p>
<p>é€‰æ‹©è¡¨è¾¾å¼éµå¾ªä¸‹é¢çš„è§„åˆ™ï¼š</p>
<pre><code>xçš„ç±»å‹ä¸ºTæˆ–è€…*Tï¼Œå¹¶ä¸”Tä¸æ˜¯æŒ‡é’ˆå’Œæ¥å£ï¼Œx.fæ˜¯Tä¸­æ·±åº¦æœ€å°çš„åä¸ºfçš„æˆå‘˜ã€‚
xçš„ç±»å‹ä¸ºTï¼ŒTæ˜¯æ¥å£, x.fæ˜¯xçš„åŠ¨æ€ç±»å‹çš„åä¸ºfçš„æ–¹æ³•ã€‚
å¦‚æœxæ˜¯æŒ‡é’ˆï¼Œx.fæ˜¯(*x).fçš„ç®€å†™ï¼Œä¸¤è€…ç­‰åŒ
</code></pre>
<p>å¦‚æœæŒ‰ç…§ä¸Šé¢çš„è§„åˆ™ï¼Œæ‰¾ä¸åˆ°fï¼Œç¼–è¯‘æˆ–è¿è¡Œæ—¶æŠ¥é”™ã€‚</p>
<p>å¯¹äºä¸‹é¢çš„ä»£ç ï¼š</p>
<pre><code>type T0 struct {
	x int
}

func (*T0) M0()

type T1 struct {
	y int
}

func (T1) M1()

type T2 struct {
	z int
	T1
	*T0
}

func (*T2) M2()

type Q *T2

var t T2     // with t.T0 != nil
var p *T2    // with p != nil and (*p).T0 != nil
var q Q = p
</code></pre>
<p>å¯ä»¥æœ‰è¿™ä¹ˆäº›é€‰æ‹©æ–¹æ³•ï¼š</p>
<pre><code>t.z          // t.z
t.y          // t.T1.y
t.x          // (*t.T0).x

p.z          // (*p).z
p.y          // (*p).T1.y
p.x          // (*(*p).T0).x

q.x          // (*(*q).T0).x        (*q).x is a valid field selector

p.M0()       // ((*p).T0).M0()      M0 expects *T0 receiver
p.M1()       // ((*p).T1).M1()      M1 expects T1 receiver
p.M2()       // p.M2()              M2 expects *T2 receiver
t.M2()       // (&amp;t).M2()           M2 expects *T2 receiver, see section on Calls
</code></pre>
<p>æ³¨æ„qæ²¡æœ‰é€‰æ‹©<code>M0()</code>ï¼Œå› ä¸ºM0()çš„Reciverç±»å‹æ˜¯<code>*T1</code>ï¼Œç±»å‹Qä¸­ä¸èƒ½ç»§æ‰¿T1çš„æ–¹æ³•ã€‚</p>
<h3 id="æ–¹æ³•è¡¨è¾¾å¼method-expressions"><a class="header" href="#æ–¹æ³•è¡¨è¾¾å¼method-expressions">æ–¹æ³•è¡¨è¾¾å¼(Method expressions)</a></h3>
<p>æ–¹æ³•(method)è¡¨è¾¾å¼å°±æ˜¯æ–¹æ³•çš„å®ç°è¯­å¥ã€‚</p>
<pre><code>MethodExpr    = ReceiverType &quot;.&quot; MethodName .
ReceiverType  = TypeName | &quot;(&quot; &quot;*&quot; TypeName &quot;)&quot; | &quot;(&quot; ReceiverType &quot;)&quot; .
</code></pre>
<p>ä¸å‡½æ•°çš„ä¸åŒçš„æ˜¯ï¼Œæ–¹æ³•æ˜¯æœ‰æ¥æ”¶è€…(Receiver)çš„ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code>type T struct {
        a int
}
func (tv  T) Mv(a int) int         { return 0 }  // value receiver
func (tp *T) Mp(f float32) float32 { return 1 }  // pointer receiver

var t T
</code></pre>
<p>æ–¹æ³•æ˜¯å±äºç±»å‹çš„ï¼Œç±»å‹çš„æ–¹æ³•å’Œç±»å‹çš„æŒ‡é’ˆçš„æ–¹æ³•æ˜¯ä¸åŒçš„ã€‚</p>
<p>ç±»å‹çš„æ–¹æ³•æ˜¯ä¸€ä¸ªå°†æ¥æ”¶è€…ä½œä¸ºå‚æ•°ä¼ å…¥çš„å‡½æ•°ï¼Œä¾‹å¦‚åœ¨ä¸Šé¢ä¾‹å­ä¸­:</p>
<pre><code>T.Mv çš„ç±»å‹ä¸º func(tv T, a int) int
T.Mp çš„ç±»å‹ä¸º func(tv *T, a int) int
</code></pre>
<p>ç±»å‹çš„æ–¹æ³•å¯ä»¥ç›´æ¥é€šè¿‡ç±»å‹åè°ƒç”¨ï¼š</p>
<pre><code>T.Mv(t, 7)             //æ³¨æ„è¦ä¼ å…¥æ¥æ”¶è€…
(T).Mv(t, 7)
(*T).Mp(&amp;t, 7)         //æ³¨æ„ä¼ å…¥çš„æ˜¯æ¥æ”¶è€…æ˜¯æŒ‡é’ˆ
</code></pre>
<p>ç±»å‹ä¸èƒ½è°ƒç”¨ç±»å‹æŒ‡é’ˆçš„æ–¹æ³•ï¼Œç±»å‹æŒ‡é’ˆå¯ä»¥è°ƒç”¨ç±»å‹çš„æ–¹æ³•ï¼š</p>
<pre><code>T.Mp(&amp;t,7)       //Mpæ˜¯(*T)çš„æ–¹æ³•ï¼Œä¸å…è®¸Tè°ƒç”¨
(*T).Mv(t,7)     //Mvæ˜¯Tçš„æ–¹æ³•ï¼Œ*Tå¯ä»¥è°ƒç”¨
</code></pre>
<p>ä¹Ÿå¯ä»¥æŠŠæ–¹æ³•èµ‹å€¼ç»™å˜é‡ï¼Œç„¶åé€šè¿‡å˜é‡è°ƒç”¨:</p>
<pre><code>f1 := T.Mv; f1(t, 7)         //è¦ä¼ å…¥æ¥å—è€…t
f2 := (T).Mv; f2(t, 7)       //è¦ä¼ å…¥æ¥å—è€…t

f3 := T.Mp; f3(&amp;t, 7)         //è¦ä¼ å…¥æ¥å—è€…&amp;t
f4 := (T).Mp; f4(&amp;t, 7)       //è¦ä¼ å…¥æ¥å—è€…&amp;t
</code></pre>
<p>ä¹Ÿå¯ä»¥é€šè¿‡è¯¥ç±»å‹çš„å˜é‡è°ƒç”¨ï¼Œè¿™æ—¶å€™ä¸éœ€è¦ä¼ å…¥æ¥æ”¶è€…ã€‚</p>
<pre><code>t.Mv(7)
t.Mp(7)
</code></pre>
<p>å› ä¸ºå˜é‡çš„æ–¹æ³•å’Œç±»å‹çš„æ–¹æ³•æ˜¯ä¸åŒçš„ï¼Œæ‰€ä»¥ä¸éœ€è¦ä¼ å…¥æ¥æ”¶è€…ã€‚</p>
<pre><code>t.Mv çš„ç±»å‹ä¸º func(a int) int
t.Mp çš„ç±»å‹ä¸º func(a int) int
</code></pre>
<p>æ— è®ºä¸€ä¸ªå˜é‡(t)æ˜¯ä¸æ˜¯æŒ‡é’ˆ(ç±»å‹ä¸º<code>*T</code>çš„å˜é‡ï¼‰ï¼Œå®ƒéƒ½æ—¢å¯ä»¥è°ƒç”¨ç±»å‹(T)çš„æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨ç±»å‹æŒ‡é’ˆ(<code>*T</code>)çš„æ–¹æ³•ã€‚goè¯­è¨€è‡ªèº«ä»£ä¸ºå®Œæˆäº†å–å€å’Œå–å€¼æ“ä½œã€‚</p>
<p>å˜é‡çš„æ–¹æ³•ä¹Ÿå¯ä»¥å­˜æ”¾å•ç‹¬çš„å˜é‡ä¸­ï¼Œç„¶åé€šè¿‡å˜é‡è°ƒç”¨ï¼š</p>
<pre><code>f := t.Mv; f(7)   // like t.Mv(7)
f := pt.Mp; f(7)  // like pt.Mp(7)
f := pt.Mv; f(7)  // like (*pt).Mv(7)
f := t.Mp; f(7)   // like (&amp;t).Mp(7)
f := makeT().Mp   // invalid: result of makeT() is not addressable
</code></pre>
<p>å˜é‡çš„ç±»å‹ä¸ºæ¥å£æ—¶ï¼Œç”¨åŒæ ·çš„æ–¹å¼è°ƒç”¨æ–¹æ³•ï¼š</p>
<pre><code>var i interface { M(int) } = myVal
f := i.M; f(7)  // like i.M(7)
</code></pre>
<h3 id="ç´¢å¼•è¡¨è¾¾å¼index-expressions"><a class="header" href="#ç´¢å¼•è¡¨è¾¾å¼index-expressions">ç´¢å¼•è¡¨è¾¾å¼(Index expressions)</a></h3>
<p>ç´¢å¼•è¡¨è¾¾å¼æ ¼å¼å¦‚ä¸‹ï¼š</p>
<pre><code>a[x]
</code></pre>
<p>açš„ç±»å‹ä¸åŒï¼Œè¡¨è¾¾å¼çš„è¿è¡Œç»“æœä¸åŒã€‚</p>
<pre><code>å¦‚æœaä¸æ˜¯å­—å…¸ï¼Œxçš„å¿…é¡»æ˜¯æ•´æ•°ï¼Œå¹¶ä¸”0&lt;= x &lt;len(a)
å¦‚æœaæ˜¯æ•°ç»„ï¼Œè¿”å›æ•°ç»„ä¸­xä½ç½®å¤„çš„æˆå‘˜ï¼Œå¦‚æœxè¶…å‡ºæ•°ç»„èŒƒå›´ï¼Œç¨‹åºpanic
å¦‚æœaæ˜¯æŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆï¼Œa[x]ç­‰åŒäº(*a)[x]
å¦‚æœaæ˜¯åˆ†ç‰‡(Slice)ï¼Œ a[x]è¿”å›xä½ç½®å¤„çš„æ•°ç»„æˆå‘˜ï¼Œå¦‚æœxè¶…å‡ºèŒƒå›´ï¼Œç¨‹åºpanic
å¦‚æœaæ˜¯å­—ç¬¦ä¸²ï¼Œè¿”å›xä½ç½®å¤„çš„å­—ç¬¦ï¼Œå¦‚æœxè¶…å‡ºèŒƒå›´ï¼Œç¨‹åºpanicï¼Œä¸”a[x]ä¸èƒ½è¢«èµ‹å€¼
å¦‚æœaæ˜¯å­—å…¸(map)ï¼Œxçš„ç±»å‹å¿…é¡»æ˜¯å­—å…¸çš„keyçš„ç±»å‹ï¼Œè¿”å›å­—å…¸ä¸­xå¯¹åº”çš„å€¼ï¼Œå’Œè¡¨ç¤ºå¯¹åº”æˆå‘˜æ˜¯å¦å­˜åœ¨çš„å¸ƒå°”ç±»å‹çš„å€¼(bool)
å¦‚æœaæ˜¯å­—å…¸(map)ï¼Œä¸”açš„å€¼æ˜¯nilï¼Œa[x]è¿”å›å­—å…¸ä¸­æˆå‘˜ç±»å‹çš„é›¶å€¼
</code></pre>
<h3 id="åˆ†ç‰‡è¡¨è¾¾å¼slice-expressions"><a class="header" href="#åˆ†ç‰‡è¡¨è¾¾å¼slice-expressions">åˆ†ç‰‡è¡¨è¾¾å¼(Slice expressions)</a></h3>
<p>åˆ†ç‰‡è¡¨è¾¾å¼é€‚ç”¨äºå­—ç¬¦ä¸²ã€æ•°ç»„ã€æŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆå’Œåˆ†ç‰‡ã€‚</p>
<pre><code>a[low : high]
</code></pre>
<p>è¿”å›ä¸€ä¸ªä»é›¶å¼€å§‹ï¼Œé•¿åº¦ä¸ºhigh-lowçš„åˆ†ç‰‡ã€‚</p>
<pre><code>a := [5]int{1, 2, 3, 4, 5}
s := a[1:4]
</code></pre>
<p>å¾—åˆ°åˆ†ç‰‡sçš„æƒ…å†µå¦‚ä¸‹ï¼š</p>
<pre><code>s[0] == 2
s[1] == 3
s[2] == 4
</code></pre>
<p>åˆ†ç‰‡è¡¨è¾¾å¼ä¸­lowå’Œhighçœç•¥ï¼š</p>
<pre><code>a[2:]  // same as a[2 : len(a)]
a[:3]  // same as a[0 : 3]
a[:]   // same as a[0 : len(a)]
</code></pre>
<p>å¦‚æœaæ˜¯æŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆï¼Œa[low:high]ç­‰åŒäº<code>(*a)[low:high]</code>ã€‚</p>
<p>å¦‚æœaæ˜¯å­—ç¬¦ä¸²ã€æ•°ç»„ã€æŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆï¼Œlowå’Œhighçš„å–å€¼èŒƒå›´ä¸ºï¼š</p>
<pre><code>0 &lt;= low &lt;= high &lt;= len(a)
</code></pre>
<p>å¦‚æœaæ˜¯åˆ†ç‰‡ï¼Œlowå’Œhighçš„å–å€¼èŒƒå›´ä¸ºï¼š</p>
<pre><code>0 &lt;= low &lt;= high &lt;= cap(a)
</code></pre>
<p>lowå’Œhighè¶…å‡ºèŒƒå›´æ—¶ï¼Œå¼•å‘panicã€‚</p>
<p>å¦‚æœaæ˜¯å·²ç»å£°æ˜å­—ç¬¦ä¸²ã€åˆ†ç‰‡ï¼Œè¿”å›å€¼ä¹Ÿæ˜¯å­—ç¬¦ä¸²ã€åˆ†ç‰‡ã€‚</p>
<p>å¦‚æœaæ˜¯æœªå£°æ˜çš„å­—ç¬¦ä¸²ï¼Œè¿”å›ä¸€ä¸ªç±»å‹ä¸ºå­—ç¬¦ä¸²çš„å˜é‡.</p>
<p>å¦‚æœaæ˜¯æ•°ç»„ï¼Œè¿”å›æŒ‡å‘è¿™ä¸ªæ•°ç»„çš„åˆ†ç‰‡ã€‚</p>
<h3 id="å®Œæ•´åˆ†ç‰‡è¡¨è¾¾å¼full-slice-expressions"><a class="header" href="#å®Œæ•´åˆ†ç‰‡è¡¨è¾¾å¼full-slice-expressions">å®Œæ•´åˆ†ç‰‡è¡¨è¾¾å¼(Full slice expressions)</a></h3>
<p>å®Œæ•´çš„åˆ†ç‰‡è¡¨è¾¾å¼è¿˜å¸¦æœ‰ä¸€ä¸ªmaxï¼Œé™å®šè¿”å›çš„åˆ†ç‰‡çš„å®¹é‡ä¸º(capacity)ä¸º<code>max-low</code>ã€‚</p>
<pre><code>a[low : high : max]
</code></pre>
<p>åœ¨å®Œæ•´çš„åˆ†ç‰‡è¡¨è¾¾å¼ä¸­ï¼Œåªæœ‰lowå¯ä»¥çœç•¥ï¼Œé»˜è®¤ä¸º0ã€‚</p>
<p>å¦‚æœaæ˜¯å­—ç¬¦ä¸²ã€æ•°ç»„ã€æŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆï¼Œlowå’Œhighçš„å–å€¼èŒƒå›´ä¸ºï¼š</p>
<pre><code>0&lt;= low &lt;= high &lt;= max &lt;= len(a)
</code></pre>
<p>å¦‚æœaæ˜¯åˆ†ç‰‡ï¼Œlowã€highå’Œmaxçš„å–å€¼èŒƒå›´ä¸ºï¼š</p>
<pre><code>0&lt;= low &lt;= high &lt;= max &lt;= cap(a)
</code></pre>
<p>å¦‚æœè¶…å‡ºèŒƒå›´ï¼Œå¼•å‘panicã€‚</p>
<h3 id="ç±»å‹æ–­è¨€è¡¨è¾¾å¼type-assertions-expressions"><a class="header" href="#ç±»å‹æ–­è¨€è¡¨è¾¾å¼type-assertions-expressions">ç±»å‹æ–­è¨€è¡¨è¾¾å¼(Type assertions expressions)</a></h3>
<p>æ–­è¨€è¡¨è¾¾å¼ç”¨æ¥åˆ¤æ–­xæ˜¯å¦ä¸ä¸ºnilï¼Œä¸”å®ƒçš„ç±»å‹æ˜¯å¦ä¸TåŒ¹é…ã€‚</p>
<pre><code>x.(T)
</code></pre>
<p>å¦‚æœTä¸æ˜¯æ¥å£ç±»å‹ï¼Œxçš„ç±»å‹å¿…é¡»æ˜¯æ¥å£ï¼Œåˆ¤æ–­Tæ˜¯å¦å¯ä»¥æˆä¸ºxçš„åŠ¨æ€ç±»å‹ã€‚</p>
<p>å¦‚æœTæ˜¯æ¥å£ç±»å‹ï¼Œåˆ¤æ–­xæ˜¯å¦å®ç°äº†æ¥å£Tã€‚</p>
<p>å¦‚æœTä¸æ˜¯æ¥å£ç±»å‹ï¼Œxçš„ç±»å‹ä¹Ÿä¸æ˜¯æ¥å£ï¼Œå¼•å‘panicã€‚</p>
<p>å¦‚æœæ–­è¨€æˆç«‹ï¼Œè¡¨è¾¾å¼çš„å€¼å°±æ˜¯ç±»å‹ä¸ºTçš„xï¼Œå’Œå¸ƒå°”å€¼trueï¼›å¦‚æœæ–­è¨€ä¸æˆç«‹ï¼Œè¡¨è¾¾å¼çš„å€¼æ˜¯ç±»å‹Tçš„é›¶å€¼ï¼Œå’Œå¸ƒå°”å€¼falseã€‚</p>
<h3 id="è°ƒç”¨è¡¨è¾¾å¼call-expressions"><a class="header" href="#è°ƒç”¨è¡¨è¾¾å¼call-expressions">è°ƒç”¨è¡¨è¾¾å¼(Call expressions)</a></h3>
<p>è°ƒç”¨è¡¨è¾¾å¼é€‚ç”¨äºå‡½æ•°å’Œæ–¹æ³•ï¼š</p>
<pre><code>f(a1, a2, â€¦ an)
</code></pre>
<p>é’ˆå¯¹æ–¹æ³•ä½¿ç”¨æ—¶ï¼Œéœ€è¦å¸¦æœ‰receiver:</p>
<pre><code>math.Atan2(x, y)  // function call
var pt *Point
pt.Scale(3.5)     // method call with receiver pt
</code></pre>
<p>ä¼ å…¥å€¼æŒ‰å€¼ã€æŒ‰é¡ºåºä¼ é€’ç»™å‡½æ•°æˆ–æ–¹æ³•çš„å‚æ•°ï¼Œè¿”å›å€¼ä¹Ÿæ˜¯æŒ‰å€¼ä¼ é€’çš„ã€‚</p>
<p>å¦‚æœä¸€ä¸ªå‡½æ•°çš„è¿”å›å€¼ï¼Œæ»¡è¶³å¦ä¸€ä¸ªå‚æ•°çš„ä¼ å…¥å‚æ•°è¦æ±‚ï¼Œå¯ä»¥å†™æˆ<code>f(g(parameters_of_g))</code>ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code>func Split(s string, pos int) (string, string) {
        return s[0:pos], s[pos:]
}

func Join(s, t string) string {
        return s + t
}

if Join(Split(value, len(value)/2)) != value {
        log.Panic(&quot;test fails&quot;)
}
</code></pre>
<p>è°ƒç”¨è¡¨è¾¾å¼æ”¯æŒå˜é•¿å‚æ•°ï¼Œå˜é•¿å‚æ•°å¿…é¡»æ˜¯æœ€åä¸€ä¸ªï¼Œä¸”ç±»å‹å‰æ˜¯<code>...</code>ã€‚</p>
<p>ä¾‹å¦‚åœ¨ä¸‹é¢çš„å‡½æ•°ä¸­ï¼š</p>
<pre><code>func Greeting(prefix string, who ...string)
</code></pre>
<p>å¦‚æœä»¥è¿™ç§æ–¹å¼è°ƒç”¨ï¼Œå‚æ•°whoçš„å€¼æ˜¯nilï¼š</p>
<pre><code>Greeting(&quot;nobody&quot;)
</code></pre>
<p>å¦‚æœä»¥è¿™ç§æ–¹å¼è°ƒç”¨ï¼Œå‚æ•°whoçš„å€¼çš„ç±»å‹æ˜¯[]stringï¼š</p>
<pre><code>Greeting(&quot;hello:&quot;, &quot;Joe&quot;, &quot;Anna&quot;, &quot;Eileen&quot;)
</code></pre>
<p>å¦‚æœä»¥è¿™ç§æ–¹å¼è°ƒç”¨ï¼Œå‚æ•°whoç­‰äºsï¼š</p>
<pre><code>s:= []string{&quot;James&quot;, &quot;Jasmine&quot;}
Greeting(&quot;goodbye:&quot;, s...)
</code></pre>
<h2 id="è¿ç®—ç¬¦operator"><a class="header" href="#è¿ç®—ç¬¦operator">è¿ç®—ç¬¦(Operator)</a></h2>
<p>è¿ç®—ç¬¦ç”¨äºæ„æˆè¡¨è¾¾å¼ã€‚</p>
<pre><code>Expression = UnaryExpr | Expression binary_op Expression .
UnaryExpr  = PrimaryExpr | unary_op UnaryExpr .

binary_op  = &quot;||&quot; | &quot;&amp;&amp;&quot; | rel_op | add_op | mul_op .
rel_op     = &quot;==&quot; | &quot;!=&quot; | &quot;&lt;&quot; | &quot;&lt;=&quot; | &quot;&gt;&quot; | &quot;&gt;=&quot; .
add_op     = &quot;+&quot; | &quot;-&quot; | &quot;|&quot; | &quot;^&quot; .
mul_op     = &quot;*&quot; | &quot;/&quot; | &quot;%&quot; | &quot;&lt;&lt;&quot; | &quot;&gt;&gt;&quot; | &quot;&amp;&quot; | &quot;&amp;^&quot; .

unary_op   = &quot;+&quot; | &quot;-&quot; | &quot;!&quot; | &quot;^&quot; | &quot;*&quot; | &quot;&amp;&quot; | &quot;&lt;-&quot; .
</code></pre>
<p>è¿ç®—ç¬¦éƒ½æ˜¯goè¯­è¨€å†…ç½®çš„ã€‚</p>
<pre><code>Precedence    Operator
    5             *  /  %  &lt;&lt;  &gt;&gt;  &amp;  &amp;^
    4             +  -  |  ^
    3             ==  !=  &lt;  &lt;=  &gt;  &gt;=
    2             &amp;&amp;
    1             ||
</code></pre>
<p>ä¼˜å…ˆçº§ç›¸åŒçš„äºŒå…ƒè¿ç®—ç¬¦æŒ‰ç…§å…ˆå·¦åå³çš„é¡ºåºç»“åˆï¼š</p>
<pre><code>x / y * z
</code></pre>
<p>ç­‰åŒäºï¼š</p>
<pre><code>(x / y) * z
</code></pre>
<h3 id="ç®—æ•°è¿ç®—ç¬¦arithmetic-operators"><a class="header" href="#ç®—æ•°è¿ç®—ç¬¦arithmetic-operators">ç®—æ•°è¿ç®—ç¬¦(Arithmetic operators)</a></h3>
<pre><code>+    sum                    integers, floats, complex values, strings
-    difference             integers, floats, complex values
*    product                integers, floats, complex values
/    quotient               integers, floats, complex values
%    remainder              integers

&amp;    bitwise AND            integers
|    bitwise OR             integers
^    bitwise XOR            integers
&amp;^   bit clear (AND NOT)    integers

&lt;&lt;   left shift             integer &lt;&lt; unsigned integer
&gt;&gt;   right shift            integer &gt;&gt; unsigned integer
</code></pre>
<h3 id="å­—ç¬¦ä¸²æ‹¼æ¥string-concatenation"><a class="header" href="#å­—ç¬¦ä¸²æ‹¼æ¥string-concatenation">å­—ç¬¦ä¸²æ‹¼æ¥(String concatenation)</a></h3>
<p>å­—ç¬¦ä¸²å¯ä»¥ç”¨è¿ç®—ç¬¦&quot;+&quot;è¿›è¡Œæ‹¼æ¥ï¼š</p>
<pre><code>:= &quot;hi&quot; + string(c)
s += &quot; and good bye&quot;
</code></pre>
<h3 id="æ¯”è¾ƒè¿ç®—ç¬¦comparison-operators"><a class="header" href="#æ¯”è¾ƒè¿ç®—ç¬¦comparison-operators">æ¯”è¾ƒè¿ç®—ç¬¦(Comparison operators)</a></h3>
<pre><code>==    equal
!=    not equal
&lt;     less
&lt;=    less or equal
&gt;     greater
&gt;=    greater or equal
</code></pre>
<h3 id="é€»è¾‘è¿ç®—ç¬¦logical-operators"><a class="header" href="#é€»è¾‘è¿ç®—ç¬¦logical-operators">é€»è¾‘è¿ç®—ç¬¦(Logical operators)</a></h3>
<pre><code>&amp;&amp;    conditional AND    p &amp;&amp; q  is  &quot;if p then q else false&quot;
||    conditional OR     p || q  is  &quot;if p then true else q&quot;
!     NOT                !p      is  &quot;not p&quot;
</code></pre>
<h3 id="åœ°å€è¿ç®—ç¬¦address-operators"><a class="header" href="#åœ°å€è¿ç®—ç¬¦address-operators">åœ°å€è¿ç®—ç¬¦(Address operators)</a></h3>
<pre><code>&amp;     
*  
</code></pre>
<h3 id="è¯»å–è¿ç®—ç¬¦receive-operator"><a class="header" href="#è¯»å–è¿ç®—ç¬¦receive-operator">è¯»å–è¿ç®—ç¬¦(Receive operator)</a></h3>
<pre><code>v1 := &lt;-ch
v2 = &lt;-ch
f(&lt;-ch)
&lt;-strobe  // wait until clock pulse and discard received value
</code></pre>
<h3 id="ç±»å‹è½¬æ¢conversions"><a class="header" href="#ç±»å‹è½¬æ¢conversions">ç±»å‹è½¬æ¢(Conversions)</a></h3>
<pre><code>Conversion = Type &quot;(&quot; Expression [ &quot;,&quot; ] &quot;)&quot; .
</code></pre>
<h2 id="å‚è€ƒ-11"><a class="header" href="#å‚è€ƒ-11">å‚è€ƒ</a></h2>
<ol>
<li><a href="https://golang.org/ref/spec#Lexical_elements" title="go Lexical elements">go Lexical elements</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="goçš„çŠ¶æ€è¯­å¥"><a class="header" href="#goçš„çŠ¶æ€è¯­å¥">goçš„çŠ¶æ€è¯­å¥</a></h1>
<pre><code>Statement =
    Declaration | LabeledStmt | SimpleStmt |
    GoStmt | ReturnStmt | BreakStmt | ContinueStmt | GotoStmt |
    FallthroughStmt | Block | IfStmt | SwitchStmt | SelectStmt | ForStmt |
    DeferStmt .

SimpleStmt = EmptyStmt | ExpressionStmt | SendStmt | IncDecStmt | Assignment | ShortVarDecl .
</code></pre>
<h2 id="ç»ˆæ­¢è¯­å¥terminating-statements"><a class="header" href="#ç»ˆæ­¢è¯­å¥terminating-statements">ç»ˆæ­¢è¯­å¥(Terminating statements)</a></h2>
<p>ç»ˆæ­¢è¯­å¥æ˜¯æŒ‡ä¸‹çš„æƒ…å†µï¼š</p>
<pre><code>return
goto
è°ƒç”¨å†…ç½®å‡½æ•°panic(interface{})
ifè¯­å¥ä»¥åŠelseè¯­å¥ä¸­è¯­å¥çš„ç»“æŸ
forè¯­å¥è¯­å¥çš„ç»“æŸ
switchè¯­å¥è¯­å¥
select
labeled 
</code></pre>
<h2 id="ç©ºç™½è¯­å¥empty-statements"><a class="header" href="#ç©ºç™½è¯­å¥empty-statements">ç©ºç™½è¯­å¥(Empty statements)</a></h2>
<p>ç©ºç™½è¯­å¥ä¸åšä»»ä½•äº‹æƒ…ï¼š</p>
<pre><code>EmptyStmt = .
</code></pre>
<h2 id="æ ‡è®°è¯­å¥labeled-statements"><a class="header" href="#æ ‡è®°è¯­å¥labeled-statements">æ ‡è®°è¯­å¥(Labeled statements)</a></h2>
<p>æ ‡è®°è¯­å¥å¯ä»¥æ˜¯gotoã€breakã€continueçš„ç›®æ ‡ã€‚</p>
<pre><code>LabeledStmt = Label &quot;:&quot; Statement .
Label       = identifier .
</code></pre>
<h2 id="è¡¨è¾¾å¼è¯­å¥expression-statements"><a class="header" href="#è¡¨è¾¾å¼è¯­å¥expression-statements">è¡¨è¾¾å¼è¯­å¥(Expression statements)</a></h2>
<p>é™¤äº†ä¸‹é¢çš„å†…ç½®å‡½æ•°ï¼Œå…¶å®ƒçš„å‡½æ•°ã€æ–¹æ³•å’Œæ¥æ”¶æ“ä½œç¬¦éƒ½å¯ä»¥ç”¨äºè¡¨è¾¾å¼è¯­å¥ã€‚</p>
<pre><code>append cap complex imag len make new real
unsafe.Alignof unsafe.Offsetof unsafe.Sizeof
</code></pre>
<h2 id="å‘é€è¯­å¥send-statements"><a class="header" href="#å‘é€è¯­å¥send-statements">å‘é€è¯­å¥(Send statements)</a></h2>
<p>å‘é€è¯­å¥æ˜¯ä¸“ç”¨äºå‘é€šé“(channel)å‘é€æ•°æ®çš„ã€‚</p>
<pre><code>SendStmt = Channel &quot;&lt;-&quot; Expression .
Channel  = Expression .
</code></pre>
<h2 id="é€’å¢é€’å‡è¯­å¥incdec-statements"><a class="header" href="#é€’å¢é€’å‡è¯­å¥incdec-statements">é€’å¢é€’å‡è¯­å¥(IncDec statements)</a></h2>
<pre><code>IncDecStmt = Expression ( &quot;++&quot; | &quot;--&quot; ) .
</code></pre>
<h2 id="èµ‹å€¼è¯­å¥assignments"><a class="header" href="#èµ‹å€¼è¯­å¥assignments">èµ‹å€¼è¯­å¥(Assignments)</a></h2>
<pre><code>Assignment = ExpressionList assign_op ExpressionList .
assign_op = [ add_op | mul_op ] &quot;=&quot; .
</code></pre>
<h2 id="ifè¯­å¥if-statements"><a class="header" href="#ifè¯­å¥if-statements">ifè¯­å¥(If statements)</a></h2>
<pre><code>IfStmt = &quot;if&quot; [ SimpleStmt &quot;;&quot; ] Expression Block [ &quot;else&quot; ( IfStmt | Block ) ] .
</code></pre>
<h2 id="switchè¯­å¥switch-statements"><a class="header" href="#switchè¯­å¥switch-statements">switchè¯­å¥(Switch statements)</a></h2>
<p>switchè¯­å¥åˆ†ä¸ºä»¥è¡¨è¾¾å¼ä¸ºä¾æ®ï¼Œå’Œä»¥ç±»å‹ä¸ºä¾æ®ä¸¤ç§å½¢å¼ã€‚</p>
<pre><code>SwitchStmt = ExprSwitchStmt | TypeSwitchStmt .
</code></pre>
<p>ä½¿ç”¨è¡¨è¾¾å¼ä½œä¸ºåˆ†æ”¯ä¾æ®ï¼š</p>
<pre><code>ExprSwitchStmt = &quot;switch&quot; [ SimpleStmt &quot;;&quot; ] [ Expression ] &quot;{&quot; { ExprCaseClause } &quot;}&quot; .
ExprCaseClause = ExprSwitchCase &quot;:&quot; StatementList .
ExprSwitchCase = &quot;case&quot; ExpressionList | &quot;default&quot; .
</code></pre>
<p>ä¾‹å¦‚:</p>
<pre><code>switch tag {
default: s3()
case 0, 1, 2, 3: s1()
case 4, 5, 6, 7: s2()
}

switch x := f(); {  // missing switch expression means &quot;true&quot;
case x &lt; 0: return -x
default: return x
}

switch {
case x &lt; y: f1()
case x &lt; z: f2()
case x == 4: f3()
}
</code></pre>
<p>ä½¿ç”¨ç±»å‹ä¸ºä¾æ®ï¼š</p>
<pre><code>TypeSwitchStmt  = &quot;switch&quot; [ SimpleStmt &quot;;&quot; ] TypeSwitchGuard &quot;{&quot; { TypeCaseClause } &quot;}&quot; .
TypeSwitchGuard = [ identifier &quot;:=&quot; ] PrimaryExpr &quot;.&quot; &quot;(&quot; &quot;type&quot; &quot;)&quot; .
TypeCaseClause  = TypeSwitchCase &quot;:&quot; StatementList .
TypeSwitchCase  = &quot;case&quot; TypeList | &quot;default&quot; .
TypeList        = Type { &quot;,&quot; Type } .
</code></pre>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code>switch i := x.(type) {
case nil:
    printString(&quot;x is nil&quot;)                // type of i is type of x (interface{})
case int:
    printInt(i)                            // type of i is int
case float64:
    printFloat64(i)                        // type of i is float64
case func(int) float64:
    printFunction(i)                       // type of i is func(int) float64
case bool, string:
    printString(&quot;type is bool or string&quot;)  // type of i is type of x (interface{})
default:
    printString(&quot;don't know the type&quot;)     // type of i is type of x (interface{})
}
</code></pre>
<h2 id="forè¯­å¥for-statements"><a class="header" href="#forè¯­å¥for-statements">forè¯­å¥(For statements)</a></h2>
<p>forçš„è¯­å¥å¾ªç¯æ¡ä»¶æœ‰ä¸‰ç§ã€‚</p>
<pre><code>ForStmt = &quot;for&quot; [ Condition | ForClause | RangeClause ] Block .
Condition = Expression .
</code></pre>
<p>ç®€ç•¥æ¡ä»¶åˆ¤æ–­ï¼š</p>
<pre><code>for a &lt; b {
    a *= 2
}
</code></pre>
<p>å®Œæ•´æ¡ä»¶åˆ¤æ–­ï¼š</p>
<pre><code>ForClause = [ InitStmt ] &quot;;&quot; [ Condition ] &quot;;&quot; [ PostStmt ] .
InitStmt = SimpleStmt .
PostStmt = SimpleStmt .
</code></pre>
<p>ä¾‹å¦‚:</p>
<pre><code>for i := 0; i &lt; 10; i++ {
    f(i)
}

for cond { S() }    is the same as    for ; cond ; { S() }
for      { S() }    is the same as    for true     { S() }
</code></pre>
<p>rangeåˆ¤æ–­ï¼š</p>
<pre><code>RangeClause = [ ExpressionList &quot;=&quot; | IdentifierList &quot;:=&quot; ] &quot;range&quot; Expression .
</code></pre>
<p>éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯Expressionä¸åŒæ—¶ï¼Œ<code>range Expression</code>çš„è¿”å›å€¼ä¸åŒã€‚</p>
<pre><code>Range expression                          1st value          2nd value

array or slice  a  [n]E, *[n]E, or []E    index    i  int    a[i]       E
string          s  string type            index    i  int    see below  rune
map             m  map[K]V                key      k  K      m[k]       V
channel         c  chan E, &lt;-chan E       element  e  E
</code></pre>
<h2 id="goè¯­å¥go-statements"><a class="header" href="#goè¯­å¥go-statements">goè¯­å¥(Go statements)</a></h2>
<pre><code>Stmt = &quot;go&quot; Expression .
</code></pre>
<h2 id="selectè¯­å¥select-statements"><a class="header" href="#selectè¯­å¥select-statements">selectè¯­å¥(Select statements)</a></h2>
<p>selectè¯­å¥ç”¨äºæ‰§è¡Œå½“å‰å¯ä»¥æ‰§è¡Œçš„è¯­å¥ã€‚</p>
<pre><code>SelectStmt = &quot;select&quot; &quot;{&quot; { CommClause } &quot;}&quot; .
CommClause = CommCase &quot;:&quot; StatementList .
CommCase   = &quot;case&quot; ( SendStmt | RecvStmt ) | &quot;default&quot; .
RecvStmt   = [ ExpressionList &quot;=&quot; | IdentifierList &quot;:=&quot; ] RecvExpr .
RecvExpr   = Expression .
</code></pre>
<p>å¦‚æœæœ‰å¤šä¸ªè¯­å¥å½“å‰éƒ½å¯ä»¥æ‰§è¡Œï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„è¿™äº›è¯­å¥çš„æ‰§è¡Œé¡ºåºã€‚</p>
<pre><code>1. é€šé“(channel)ç›¸å…³çš„è¯­å¥å¦‚æœåŒæ—¶è¿›å…¥å¯æ‰§è¡ŒçŠ¶æ€ï¼Œåªæ‰§è¡Œåœ¨æºç ä¸­ä½ç½®é å‰çš„è¯­å¥
2. å¦‚æœå¤šä¸ªè¯­å¥å¯ä»¥æ‰§è¡Œï¼Œéšæœºé€‰æ‹©ä¸€ä¸ªæ‰§è¡Œã€‚
3. å¦‚æœæ‰€æœ‰è¯­å¥éƒ½ä¸èƒ½æ‰§è¡Œï¼Œé‚£ä¹ˆæ‰§è¡Œdefaultè¯­å¥ï¼Œå¦‚æœæ²¡æœ‰defaultè¯­å¥ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€
</code></pre>
<p>ä¾‹å¦‚:</p>
<pre><code>var a []int
var c, c1, c2, c3, c4 chan int
var i1, i2 int
select {
case i1 = &lt;-c1:
    print(&quot;received &quot;, i1, &quot; from c1\n&quot;)
case c2 &lt;- i2:
    print(&quot;sent &quot;, i2, &quot; to c2\n&quot;)
case i3, ok := (&lt;-c3):  // same as: i3, ok := &lt;-c3
    if ok {
        print(&quot;received &quot;, i3, &quot; from c3\n&quot;)
    } else {
        print(&quot;c3 is closed\n&quot;)
    }
case a[f()] = &lt;-c4:
    // same as:
    // case t := &lt;-c4
    //    a[f()] = t
default:
    print(&quot;no communication\n&quot;)
}

for {  // send random sequence of bits to c
    select {
    case c &lt;- 0:  // note: no statement, no fallthrough, no folding of cases
    case c &lt;- 1:
    }
}

select {}  // block forever
</code></pre>
<h2 id="è¿”å›è¯­å¥return-statements"><a class="header" href="#è¿”å›è¯­å¥return-statements">è¿”å›è¯­å¥(Return statements)</a></h2>
<pre><code>ReturnStmt = &quot;return&quot; [ ExpressionList ] .
</code></pre>
<p>ä¾‹å¦‚:</p>
<pre><code>func simpleF() int {
    return 2
}
</code></pre>
<p>æ”¯æŒå¤šå€¼è¿”å›:</p>
<pre><code>func complexF1() (re float64, im float64) {
    return -7.0, -4.0
}
</code></pre>
<p>å¯ä»¥ç›´æ¥å°†è¡¨è¾¾å¼çš„ç»“æœè¿”å›ï¼š</p>
<pre><code>func complexF2() (re float64, im float64) {
    return complexF1()
}
</code></pre>
<p>è¿˜å¯ä»¥å‘½åè¿”å›ï¼š</p>
<pre><code>func complexF3() (re float64, im float64) {
    re = 7.0
    im = 4.0
    return
}

func (devnull) Write(p []byte) (n int, _ error) {
    n = len(p)
    return
}
</code></pre>
<p>å‘½åçš„è¿”å›çš„æ—¶å€™ï¼Œä¸åŒæœ‰åŒåçš„å…¶å®ƒå˜é‡ï¼š</p>
<pre><code>func f(n int) (res int, err error) {
    if _, err := f(n-1); err != nil {
        return  // invalid return statement: err is shadowed
    }
    return
}
</code></pre>
<h2 id="breakè¯­å¥break-statement"><a class="header" href="#breakè¯­å¥break-statement">breakè¯­å¥(Break statement)</a></h2>
<pre><code>BreakStmt = &quot;break&quot; [ Label ] .
</code></pre>
<p>ä¾‹å¦‚:</p>
<pre><code>OuterLoop:
    for i = 0; i &lt; n; i++ {
        for j = 0; j &lt; m; j++ {
            switch a[i][j] {
            case nil:
                state = Error
                break OuterLoop
            case item:
                state = Found
                break OuterLoop
            }
        }
    }
</code></pre>
<h2 id="continueè¯­å¥continue-statements"><a class="header" href="#continueè¯­å¥continue-statements">continueè¯­å¥(Continue statements)</a></h2>
<pre><code>ContinueStmt = &quot;continue&quot; [ Label ] .
</code></pre>
<p>ä¾‹å¦‚:</p>
<pre><code>RowLoop:
	for y, row := range rows {
		for x, data := range row {
			if data == endOfRow {
				continue RowLoop
			}
			row[x] = data + bias(x, y)
		}
	}
</code></pre>
<h2 id="gotoè¯­å¥goto-statements"><a class="header" href="#gotoè¯­å¥goto-statements">gotoè¯­å¥(Goto statements)</a></h2>
<pre><code>GotoStmt = &quot;goto&quot; Label .
</code></pre>
<p>ä½¿ç”¨gotoçš„æ—¶å€™è¦ç‰¹åˆ«æ³¨æ„ï¼Œä¸è¦åœ¨gotoä¸Labelç›´æ¥å­˜åœ¨å˜é‡çš„å£°æ˜ã€‚</p>
<p>ä¾‹å¦‚ä¸‹é¢çš„åšæ³•ç¬¦åˆè¯­æ³•è¦æ±‚ï¼Œä½†æ˜¯å®¹æ˜“é€ æˆæ··ä¹±ï¼Œåœ¨<code>L:</code>ä¹‹åçš„ä½ç½®ä½¿ç”¨iï¼Œä¼šæŠ¥é”™ï¼š</p>
<pre><code>	goto L  // BAD
	v := 3
L:
</code></pre>
<p>gotoåªèƒ½è·³è½¬åˆ°æ‰€åœ¨åŒºå—ä¸­çš„æ ‡è®°ä½ç½®ã€‚</p>
<p>ä¾‹å¦‚ä¸‹é¢çš„åšæ³•æ˜¯ä¸ç¬¦åˆè¯­æ³•çš„ï¼ŒL1æ˜¯å¦ä¸€ä¸ªåŒºå—ä¸­çš„æ ‡è®°ã€‚</p>
<pre><code>if n%2 == 1 {
	goto L1
}
for n &gt; 0 {
	f()
	n--
L1:
	f()
	n--
}
</code></pre>
<h2 id="fallthroughè¯­å¥fallthrough-statements"><a class="header" href="#fallthroughè¯­å¥fallthrough-statements">fallthroughè¯­å¥(Fallthrough statements)</a></h2>
<p>fallthrouchç”¨äºswitchè¯­å¥ä¸­ï¼Œè¡¨ç¤ºç´§é‚»çš„ä¸‹ä¸€ä¸ªè¯­å¥éœ€è¦è¢«æ‰§è¡Œã€‚</p>
<pre><code>FallthroughStmt = &quot;fallthrough&quot; .
</code></pre>
<h2 id="deferè¯­å¥defer-statements"><a class="header" href="#deferè¯­å¥defer-statements">deferè¯­å¥(Defer statements)</a></h2>
<p>deferè¡¨ç¤ºè·Ÿéšçš„è¯­å¥éœ€è¦åœ¨å‡½æ•°æ‰§è¡Œç»“æŸçš„æ—¶å€™æ‰§è¡Œã€‚</p>
<pre><code>DeferStmt = &quot;defer&quot; Expression .
</code></pre>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code>lock(l)
defer unlock(l)  // unlocking happens before surrounding function returns

// prints 3 2 1 0 before surrounding function returns
for i := 0; i &lt;= 3; i++ {
	defer fmt.Print(i)
}

// f returns 1
func f() (result int) {
	defer func() {
		result++
	}()
	return 0
}
</code></pre>
<h2 id="å‚è€ƒ-12"><a class="header" href="#å‚è€ƒ-12">å‚è€ƒ</a></h2>
<ol>
<li><a href="https://golang.org/ref/spec#Lexical_elements" title="go Lexical elements">go Lexical elements</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="goçš„åŒ…ç®¡ç†è¯­å¥"><a class="header" href="#goçš„åŒ…ç®¡ç†è¯­å¥">goçš„åŒ…ç®¡ç†è¯­å¥</a></h1>
<h2 id="å£°æ˜åŒ…"><a class="header" href="#å£°æ˜åŒ…">å£°æ˜åŒ…</a></h2>
<pre><code>PckageClause  = &quot;package&quot; PackageName .
PackageName    = identifier .
</code></pre>
<h2 id="å¯¼å…¥åŒ…import-declarations-"><a class="header" href="#å¯¼å…¥åŒ…import-declarations-">å¯¼å…¥åŒ…(Import declarations )</a></h2>
<pre><code>ImportDecl       = &quot;import&quot; ( ImportSpec | &quot;(&quot; { ImportSpec &quot;;&quot; } &quot;)&quot; ) .
ImportSpec       = [ &quot;.&quot; | PackageName ] ImportPath .
ImportPath       = string_lit .
</code></pre>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code>Import declaration          Local name of Sin

import   &quot;lib/math&quot;         math.Sin
import m &quot;lib/math&quot;         m.Sin
import . &quot;lib/math&quot;         Sin
import _ &quot;lib/math&quot;
</code></pre>
<h2 id="å‚è€ƒ-13"><a class="header" href="#å‚è€ƒ-13">å‚è€ƒ</a></h2>
<ol>
<li><a href="https://www.lijiaocn.com" title="æä½¶æ¾³çš„åšå®¢">æä½¶æ¾³çš„åšå®¢</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="goçš„å†…ç½®å‡½æ•°"><a class="header" href="#goçš„å†…ç½®å‡½æ•°">goçš„å†…ç½®å‡½æ•°</a></h1>
<p>goå†…ç½®äº†ä¸€äº›å‡½æ•°ï¼Œè¿™äº›å‡½æ•°å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</p>
<h2 id="å…³é—­close"><a class="header" href="#å…³é—­close">å…³é—­(Close)</a></h2>
<pre><code>close
</code></pre>
<h2 id="é•¿åº¦å’Œå®¹é‡length-and-capacit"><a class="header" href="#é•¿åº¦å’Œå®¹é‡length-and-capacit">é•¿åº¦å’Œå®¹é‡(Length and capacit)</a></h2>
<pre><code>Call      Argument type    Result

len(s)    string type      string length in bytes
          [n]T, *[n]T      array length (== n)
          []T              slice length
          map[K]T          map length (number of defined keys)
          chan T           number of elements queued in channel buffer

cap(s)    [n]T, *[n]T      array length (== n)
          []T              slice capacity
          chan T           channel buffer capacity
</code></pre>
<h2 id="åˆ†é…allocation"><a class="header" href="#åˆ†é…allocation">åˆ†é…(Allocation)</a></h2>
<pre><code>new(T)
</code></pre>
<h2 id="åˆ›å»ºmaking-slices-maps-and-channels"><a class="header" href="#åˆ›å»ºmaking-slices-maps-and-channels">åˆ›å»º(Making slices, maps and channels)</a></h2>
<pre><code>Call             Type T     Result

make(T, n)       slice      slice of type T with length n and capacity n
make(T, n, m)    slice      slice of type T with length n and capacity m

make(T)          map        map of type T
make(T, n)       map        map of type T with initial space for n elements

make(T)          channel    unbuffered channel of type T
make(T, n)       channel    buffered channel of type T, buffer size n
</code></pre>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code>s := make([]int, 10, 100)       // slice with len(s) == 10, cap(s) == 100
s := make([]int, 1e3)           // slice with len(s) == cap(s) == 1000
s := make([]int, 1&lt;&lt;63)         // illegal: len(s) is not representable by a value of type int
s := make([]int, 10, 0)         // illegal: len(s) &gt; cap(s)
c := make(chan int, 10)         // channel with a buffer size of 10
m := make(map[string]int, 100)  // map with initial space for 100 elements
</code></pre>
<h2 id="åˆ†ç‰‡çš„è¿½åŠ appending-to-slices"><a class="header" href="#åˆ†ç‰‡çš„è¿½åŠ appending-to-slices">åˆ†ç‰‡çš„è¿½åŠ (Appending to slices)</a></h2>
<pre><code>append(s S, x ...T) S  // T is the element type of S
</code></pre>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code>s0 := []int{0, 0}
s1 := append(s0, 2)                // append a single element     s1 == []int{0, 0, 2}
s2 := append(s1, 3, 5, 7)          // append multiple elements    s2 == []int{0, 0, 2, 3, 5, 7}
s3 := append(s2, s0...)            // append a slice              s3 == []int{0, 0, 2, 3, 5, 7, 0, 0}
s4 := append(s3[3:6], s3[2:]...)   // append overlapping slice    s4 == []int{3, 5, 7, 2, 3, 5, 7, 0, 0}

var t []interface{}
t = append(t, 42, 3.1415, &quot;foo&quot;)   //                             t == []interface{}{42, 3.1415, &quot;foo&quot;}

var b []byte
b = append(b, &quot;bar&quot;...)            // append string contents      b == []byte{'b', 'a', 'r' }
</code></pre>
<h2 id="åˆ†ç‰‡çš„å¤åˆ¶copying-slices"><a class="header" href="#åˆ†ç‰‡çš„å¤åˆ¶copying-slices">åˆ†ç‰‡çš„å¤åˆ¶(Copying slices)</a></h2>
<pre><code>copy(dst, src []T) int
copy(dst []byte, src string) int
</code></pre>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code>var a = [...]int{0, 1, 2, 3, 4, 5, 6, 7}
var s = make([]int, 6)
var b = make([]byte, 5)
n1 := copy(s, a[0:])            // n1 == 6, s == []int{0, 1, 2, 3, 4, 5}
n2 := copy(s, s[2:])            // n2 == 4, s == []int{2, 3, 4, 5, 4, 5}
n3 := copy(b, &quot;Hello, World!&quot;)  // n3 == 5, b == []byte(&quot;Hello&quot;)
</code></pre>
<h2 id="å­—å…¸æˆå‘˜çš„åˆ é™¤deletion-of-map-elements"><a class="header" href="#å­—å…¸æˆå‘˜çš„åˆ é™¤deletion-of-map-elements">å­—å…¸æˆå‘˜çš„åˆ é™¤(Deletion of map elements)</a></h2>
<pre><code>delete(m, k)  // remove element m[k] from map m 
</code></pre>
<h2 id="å¤æ•°çš„æ“ä½œmanipulating-complex-numbers"><a class="header" href="#å¤æ•°çš„æ“ä½œmanipulating-complex-numbers">å¤æ•°çš„æ“ä½œ(Manipulating complex numbers)</a></h2>
<pre><code>complex(realPart, imaginaryPart floatT) complexT
real(complexT) floatT
imag(complexT) floatT
</code></pre>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code>var a = complex(2, -2)             // complex128
const b = complex(1.0, -1.4)       // untyped complex constant 1 - 1.4i
x := float32(math.Cos(math.Pi/2))  // float32
var c64 = complex(5, -x)           // complex64
var s uint = complex(1, 0)         // untyped complex constant 1 + 0i can be converted to uint
_ = complex(1, 2&lt;&lt;s)               // illegal: 2 assumes floating-point type, cannot shift
var rl = real(c64)                 // float32
var im = imag(a)                   // float64
const c = imag(b)                  // untyped constant -1.4
_ = imag(3 &lt;&lt; s)                   // illegal: 3 assumes complex type, cannot shift
</code></pre>
<h2 id="panicå¤„ç†handling-panics"><a class="header" href="#panicå¤„ç†handling-panics">panicå¤„ç†(Handling panics)</a></h2>
<pre><code>panic(interface{})
func recover() interface{}
</code></pre>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code>func protect(g func()) {
	defer func() {
		log.Println(&quot;done&quot;)  // Println executes normally even if there is a panic
		if x := recover(); x != nil {
			log.Printf(&quot;run time panic: %v&quot;, x)
		}
	}()
	log.Println(&quot;start&quot;)
	g()
}
</code></pre>
<h2 id="è‡ªä¸¾å‡½æ•°bootstrapping"><a class="header" href="#è‡ªä¸¾å‡½æ•°bootstrapping">è‡ªä¸¾å‡½æ•°(Bootstrapping)</a></h2>
<pre><code>Function   Behavior

print      prints all arguments; formatting of arguments is implementation-specific
println    like print but prints spaces between arguments and a newline at the end
</code></pre>
<h2 id="å‚è€ƒ-14"><a class="header" href="#å‚è€ƒ-14">å‚è€ƒ</a></h2>
<ol>
<li><a href="https://www.lijiaocn.com" title="æä½¶æ¾³çš„åšå®¢">æä½¶æ¾³çš„åšå®¢</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="goç¨‹åºçš„åˆå§‹åŒ–"><a class="header" href="#goç¨‹åºçš„åˆå§‹åŒ–">goç¨‹åºçš„åˆå§‹åŒ–</a></h1>
<h2 id="å˜é‡åˆå§‹åŒ–ä¸ºå¯¹åº”ç±»å‹çš„é›¶å€¼"><a class="header" href="#å˜é‡åˆå§‹åŒ–ä¸ºå¯¹åº”ç±»å‹çš„é›¶å€¼">å˜é‡åˆå§‹åŒ–ä¸ºå¯¹åº”ç±»å‹çš„é›¶å€¼</a></h2>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code>type T struct { i int; f float64; next *T }
t := new(T)
</code></pre>
<p>åˆå§‹åŒ–å€¼ä¸ºï¼š</p>
<pre><code>t.i == 0
t.f == 0.0
t.next == nil
</code></pre>
<h2 id="åŒ…çš„åˆå§‹åŒ–"><a class="header" href="#åŒ…çš„åˆå§‹åŒ–">åŒ…çš„åˆå§‹åŒ–</a></h2>
<p>ä¸‹é¢çš„ä»£ç ä¸­ï¼Œå˜é‡çš„åˆå§‹åŒ–é¡ºåºä¸ºï¼šdã€bã€cã€aã€‚</p>
<pre><code>var (
	a = c + b
	b = f()
	c = f()
	d = 3
)

func f() int {
	d++
	return d
}
</code></pre>
<p>initå‡½æ•°ï¼š</p>
<pre><code>init() { â€¦ }
</code></pre>
<h2 id="å¼€å§‹æ‰§è¡Œ"><a class="header" href="#å¼€å§‹æ‰§è¡Œ">å¼€å§‹æ‰§è¡Œ</a></h2>
<pre><code>func main() { â€¦ }
</code></pre>
<h2 id="å‚è€ƒ-15"><a class="header" href="#å‚è€ƒ-15">å‚è€ƒ</a></h2>
<ol>
<li><a href="https://www.lijiaocn.com" title="æä½¶æ¾³çš„åšå®¢">æä½¶æ¾³çš„åšå®¢</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="goçš„é”™è¯¯å¤„ç†"><a class="header" href="#goçš„é”™è¯¯å¤„ç†">goçš„é”™è¯¯å¤„ç†</a></h1>
<h2 id="è¿”å›çš„é”™è¯¯å€¼"><a class="header" href="#è¿”å›çš„é”™è¯¯å€¼">è¿”å›çš„é”™è¯¯å€¼</a></h2>
<pre><code>type error interface {
	Error() string
}
</code></pre>
<h2 id="panicçš„ä¼ å…¥å‚æ•°ç±»å‹"><a class="header" href="#panicçš„ä¼ å…¥å‚æ•°ç±»å‹">panicçš„ä¼ å…¥å‚æ•°ç±»å‹</a></h2>
<pre><code>package runtime

type Error interface {
	error
	// and perhaps other methods
}
</code></pre>
<h2 id="å‚è€ƒ-16"><a class="header" href="#å‚è€ƒ-16">å‚è€ƒ</a></h2>
<ol>
<li><a href="https://www.lijiaocn.com" title="æä½¶æ¾³çš„åšå®¢">æä½¶æ¾³çš„åšå®¢</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="æ“ä½œç³»ç»Ÿç›¸å…³"><a class="header" href="#æ“ä½œç³»ç»Ÿç›¸å…³">æ“ä½œç³»ç»Ÿç›¸å…³</a></h1>
<h2 id="unsafe"><a class="header" href="#unsafe">unsafe</a></h2>
<pre><code>package unsafe

type ArbitraryType int  // shorthand for an arbitrary Go type; it is not a real type
type Pointer *ArbitraryType

func Alignof(variable ArbitraryType) uintptr
func Offsetof(selector ArbitraryType) uintptr
func Sizeof(variable ArbitraryType) uintptr
</code></pre>
<h2 id="size-and-alignment-guarantees"><a class="header" href="#size-and-alignment-guarantees">Size and alignment guarantees</a></h2>
<pre><code>type                                 size in bytes

byte, uint8, int8                     1
uint16, int16                         2
uint32, int32, float32                4
uint64, int64, float64, complex64     8
</code></pre>
<h2 id="å‚è€ƒ-17"><a class="header" href="#å‚è€ƒ-17">å‚è€ƒ</a></h2>
<ol>
<li><a href="https://www.lijiaocn.com" title="æä½¶æ¾³çš„åšå®¢">æä½¶æ¾³çš„åšå®¢</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="å®ç°å‘½ä»¤è¡Œå‚æ•°"><a class="header" href="#å®ç°å‘½ä»¤è¡Œå‚æ•°">å®ç°å‘½ä»¤è¡Œå‚æ•°</a></h1>
<h2 id="flag"><a class="header" href="#flag">Flag</a></h2>
<p><code>flag</code>æ˜¯Goè¯­è¨€çš„ä¸€ä¸ªæ ‡å‡†åŒ…ï¼Œç”¨æ¥å¤„ç†å‘½ä»¤è¡Œå‚æ•°ã€‚</p>
<h3 id="ä»£ç "><a class="header" href="#ä»£ç ">ä»£ç </a></h3>
<pre><code class="language-go">//create: 2017/10/26 22:04:34 change: 2017/12/25 13:38:09 lijiaocn@foxmail.com
package main

import (
	&quot;flag&quot;
)

type CmdLine struct {
	Help    bool
	Host    string
	APIPath string
	Prefix  string
	Token   string
	SkipTLS bool
}

var cmdline CmdLine

func init() {
	flag.BoolVar(&amp;cmdline.Help, &quot;help&quot;, false, &quot;show usage&quot;)
	flag.StringVar(&amp;cmdline.Host, &quot;host&quot;, &quot;https://127.0.0.1:6443&quot;, &quot;kubernetes api host&quot;)
	flag.StringVar(&amp;cmdline.APIPath, &quot;apipath&quot;, &quot;/&quot;, &quot;kubernetes api path&quot;)
	flag.StringVar(&amp;cmdline.Prefix, &quot;prefix&quot;, &quot;&quot;, &quot;kubernetes api prefix&quot;)
	flag.StringVar(&amp;cmdline.Token, &quot;token&quot;, &quot;&quot;, &quot;user's bearer token&quot;)
	flag.BoolVar(&amp;cmdline.SkipTLS, &quot;skiptls&quot;, false, &quot;don't verify TLS certificate&quot;)
}

func main() {
	flag.Parse()
	if cmdline.Help {
		flag.Usage()
		return
	}
	println(&quot;Help:&quot;, cmdline.Help)
	println(&quot;Host:&quot;, cmdline.Host)
	println(&quot;APIPath:&quot;, cmdline.APIPath)
	println(&quot;Prefix:&quot;, cmdline.Prefix)
	println(&quot;Token:&quot;, cmdline.Token)
	println(&quot;SkipTLS:&quot;, cmdline.SkipTLS)
}
</code></pre>
<h3 id="è¿è¡Œ"><a class="header" href="#è¿è¡Œ">è¿è¡Œ</a></h3>
<p>æŸ¥çœ‹ä½¿ç”¨æ–¹æ³•ï¼š</p>
<pre><code class="language-bash">$ ./k8s-haproxy -h
Usage of ./k8s-haproxy:
  -apipath string
        kubernetes api path (default &quot;/&quot;)
  -help
        show usage
  -host string
        kubernetes api host (default &quot;https://127.0.0.1:6443&quot;)
  -prefix string
        kubernetes api prefix
  -skiptls
        don't verify TLS certificate
  -token string
        user's bearer token
</code></pre>
<p>æŒ‡å®šå‚æ•°å€¼ï¼š</p>
<pre><code class="language-bash">$ ./k8s-haproxy -host=192.168.2.1:443 -token=&quot;this is my token&quot;
Help: false
Host: 192.168.2.1:443
APIPath: /
Prefix:
Token: this is my token
SkipTLS: false
</code></pre>
<h2 id="å‚è€ƒ-18"><a class="header" href="#å‚è€ƒ-18">å‚è€ƒ</a></h2>
<ol>
<li><a href="https://www.lijiaocn.com" title="æä½¶æ¾³çš„åšå®¢">æä½¶æ¾³çš„åšå®¢</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="æ‰“å°æ—¥å¿—"><a class="header" href="#æ‰“å°æ—¥å¿—">æ‰“å°æ—¥å¿—</a></h1>
<h2 id="glog"><a class="header" href="#glog">glog</a></h2>
<p><code>glog</code>åŸæœ¬æ˜¯googleä½¿ç”¨C++å®ç°çš„ä¸€ä¸ªæ—¥å¿—æ¨¡å—(<a href="https://github.com/google/glog" title="glog c++">glog c++</a>)ï¼Œgoè¯­è¨€å‡ºæ¥ä»¥åï¼Œåˆå®ç°äº†ä¸€ä¸ªGoç‰ˆæœ¬çš„<a href="https://github.com/golang/glog" title="glog golang">glog</a>ã€‚</p>
<h3 id="ä»£ç -1"><a class="header" href="#ä»£ç -1">ä»£ç </a></h3>
<p>glogä¾èµ–æ ‡å‡†åŒ…flagï¼Œåœ¨è°ƒç”¨glogçš„æ–¹æ³•ä¹‹å‰ï¼Œéœ€è¦è°ƒç”¨<code>flag.Parse()</code>ã€‚</p>
<pre><code class="language-go">//create: 2017/12/25 14:24:03 change: 2017/12/25 15:08:49 lijiaocn@foxmail.com
package main

import (
	&quot;flag&quot;
	&quot;github.com/golang/glog&quot;
)

func main() {
	flag.Parse()
	glog.Infof(&quot;%s\n&quot;, &quot;This is a info&quot;)
	glog.Warningf(&quot;%s\n&quot;, &quot;This is a warning&quot;)
	glog.Errorf(&quot;%s\n&quot;, &quot;This is a error&quot;)
	glog.V(1).Infof(&quot;%s\n&quot;, &quot;This is a v1 log&quot;)
	glog.V(2).Infof(&quot;%s\n&quot;, &quot;This is a v2 log&quot;)
	//this call will make the progress exit.
	//glog.Fatalf(&quot;%s\n&quot;, &quot;This is a fatal&quot;)
	//this call will make the progress exit.
	//glog.Exitf(&quot;%s\n&quot;, &quot;This is a exit&quot;)
}
</code></pre>
<h3 id="è¿è¡Œ-1"><a class="header" href="#è¿è¡Œ-1">è¿è¡Œ</a></h3>
<p>glogæ”¯æŒä»¥ä¸‹å‚æ•°ã€‚</p>
<pre><code class="language-bash">$ ./glog -h
Usage of ./glog:
  -alsologtostderr
        log to standard error as well as files
  -log_backtrace_at value
        when logging hits line file:N, emit a stack trace
  -log_dir string
        If non-empty, write log files in this directory
  -logtostderr
        log to standard error instead of files
  -stderrthreshold value
        logs at or above this threshold go to stderr
  -v value
        log level for V logs
  -vmodule value
        comma-separated list of pattern=N settings for file-filtered logging
</code></pre>
<p>glogå°†æ—¥å¿—ä»¥æ–‡ä»¶çš„å½¢å¼å†™å…¥<code>-log_dir</code>æŒ‡å®šçš„ç›®å½•ï¼Œä½¿ç”¨<code>-log_dir</code>æ—¶åªæœ‰ERRORæ—¥å¿—ä¼šæ‰“å°åˆ°æ ‡å‡†è¾“å‡ºï¼Œ</p>
<pre><code class="language-bash">$ ./glog -log_dir=./log
E1225 15:19:10.514843   83246 main.go:13] This is a error
</code></pre>
<p>ç”Ÿæˆçš„æ—¥å¿—æ–‡ä»¶ï¼š</p>
<pre><code class="language-bash">lijiaos-MacBook-Pro:glog lijiao$ ls log/
glog.ERROR
glog.INFO
glog.WARNING
glog.lijiaos-MacBook-Pro.lijiao.log.ERROR.20171225-151858.83190
glog.lijiaos-MacBook-Pro.lijiao.log.ERROR.20171225-151910.83246
glog.lijiaos-MacBook-Pro.lijiao.log.INFO.20171225-151858.83190
glog.lijiaos-MacBook-Pro.lijiao.log.INFO.20171225-151910.83246
glog.lijiaos-MacBook-Pro.lijiao.log.WARNING.20171225-151858.83190
glog.lijiaos-MacBook-Pro.lijiao.log.WARNING.20171225-151910.83246
</code></pre>
<p>å‚æ•°<code>-logtostderr</code>å°†æ‰€æœ‰æ—¥å¿—æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºï¼Œä¸ä¿å­˜åˆ°æ–‡ä»¶ä¸­ã€‚</p>
<pre><code class="language-bash">$ ./glog  -logtostderr
I1225 15:22:11.770424   83995 main.go:11] This is a info
W1225 15:22:11.770510   83995 main.go:12] This is a warning
E1225 15:22:11.770513   83995 main.go:13] This is a error
</code></pre>
<p>å‚æ•°<code>-v</code>æŒ‡å®šæ—¥å¿—çš„çº§åˆ«ï¼Œåªæ‰“å°V(x)ä¸­ï¼Œxå°äºç­‰äº-væŒ‡å®šçš„æ•°å€¼çš„æ—¥å¿—ã€‚</p>
<pre><code class="language-bash">$ ./glog  -logtostderr -v 1
I1225 15:28:03.517261   85366 main.go:11] This is a info
W1225 15:28:03.517335   85366 main.go:12] This is a warning
E1225 15:28:03.517339   85366 main.go:13] This is a error
I1225 15:28:03.517342   85366 main.go:14] This is a v1 log
</code></pre>
<h3 id="å»ºè®®"><a class="header" href="#å»ºè®®">å»ºè®®</a></h3>
<p>å¿…é¡»è¦è®°å½•çš„æ—¥å¿—ä½¿ç”¨<code>glog.InfoX</code>ã€<code>glog.WarningX</code>ã€<code>glog.ErrorX</code>ç­‰å‡½æ•°æ‰“å°ã€‚</p>
<p>ç”¨äºå¼€å‘è°ƒè¯•çš„æ—¥å¿—ä½¿ç”¨<code>glov.V().InfoX</code>æ‰“å°ã€‚</p>
<h3 id="å‚è€ƒ-19"><a class="header" href="#å‚è€ƒ-19">å‚è€ƒ</a></h3>
<ol>
<li><a href="https://www.lijiaocn.com" title="æä½¶æ¾³çš„åšå®¢">æä½¶æ¾³çš„åšå®¢</a></li>
<li><a href="https://github.com/golang/glog" title="glog golang">glog golang</a></li>
<li><a href="https://github.com/google/glog" title="glog c++">glog c++</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="go-è¯­è¨€çš„ç±»å‹è½¬æ¢"><a class="header" href="#go-è¯­è¨€çš„ç±»å‹è½¬æ¢">Go è¯­è¨€çš„ç±»å‹è½¬æ¢</a></h1>
<h2 id="string-è½¬æ¢æˆ-byte"><a class="header" href="#string-è½¬æ¢æˆ-byte">string è½¬æ¢æˆ []byte</a></h2>
<pre><code class="language-go">var str string
str = &quot;abcd&quot;
var [] bytes

bytes = []byte(str)
</code></pre>
<h2 id="string-è½¬æ•°å€¼"><a class="header" href="#string-è½¬æ•°å€¼">string è½¬æ•°å€¼</a></h2>
<p>æ ‡å‡†åº“ <a href="https://golang.org/pkg/strconv/#pkg-index" title="Package strconv">strconv</a> æä¾›äº†å¤šä¸ª string ä¸æ•°å€¼çš„è½¬æ¢æ–¹æ³•ï¼š</p>
<pre><code class="language-go">i, err := strconv.Atoi(&quot;-42&quot;)
s := strconv.Itoa(-42)
</code></pre>
<p>æŒ‡å®šè¿›åˆ¶ï¼š</p>
<pre><code class="language-go">b, err := strconv.ParseBool(&quot;true&quot;)
f, err := strconv.ParseFloat(&quot;3.1415&quot;, 64)
i, err := strconv.ParseInt(&quot;-42&quot;, 10, 64)
u, err := strconv.ParseUint(&quot;42&quot;, 10, 64)
</code></pre>
<h2 id="æ•°å€¼è½¬å­—ç¬¦ä¸²"><a class="header" href="#æ•°å€¼è½¬å­—ç¬¦ä¸²">æ•°å€¼è½¬å­—ç¬¦ä¸²</a></h2>
<pre><code class="language-go">s := strconv.Itoa(-42)
s = fmt.Sprintf(&quot;%d&quot;, 32)
</code></pre>
<h2 id="å‚è€ƒ-20"><a class="header" href="#å‚è€ƒ-20">å‚è€ƒ</a></h2>
<ol>
<li><a href="https://www.lijiaocn.com" title="æä½¶æ¾³çš„åšå®¢">æä½¶æ¾³çš„åšå®¢</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="ä¾èµ–ä»£ç ç®¡ç†"><a class="header" href="#ä¾èµ–ä»£ç ç®¡ç†">ä¾èµ–ä»£ç ç®¡ç†</a></h1>
<p>è¿™é‡Œè®°å½•ç”¨äºGoé¡¹ç›®çš„ä¾èµ–ç®¡ç†å·¥å…·ã€‚</p>
<h2 id="go-modules"><a class="header" href="#go-modules">Go Modules</a></h2>
<p>Go 1.11å’ŒGo 1.12å¼•å…¥äº†Go Modulesï¼Œåœ¨Go 1.13ä¸­ï¼ŒGo Moduleå°†æ˜¯é»˜è®¤çš„ä¾èµ–ç®¡ç†æ–¹æ³•ï¼š<a href="https://www.lijiaocn.com/%E7%BC%96%E7%A8%8B/2019/05/05/go-modules.html">Go 1.11å’Œ1.12å¼•å…¥çš„æ–°çš„ä¾èµ–ä»£ç ç®¡ç†æ–¹æ³•ï¼šGo Modules</a>ã€‚</p>
<h2 id="dep"><a class="header" href="#dep">Dep</a></h2>
<p><a href="https://github.com/golang/dep" title="dep">dep</a>æ˜¯ä¸€ä¸ªæ¯”è¾ƒæ–°çš„ä¾èµ–ç®¡ç†å·¥å…·ï¼Œå®ƒè®¡åˆ’æˆä¸ºGoçš„æ ‡å‡†å·¥å…·(æˆªæ­¢2017-12-26 20:50:43)ã€‚</p>
<h3 id="å®‰è£…"><a class="header" href="#å®‰è£…">å®‰è£…</a></h3>
<p>å¯ä»¥ä¸‹é¢çš„æ–¹æ³•å®‰è£…ï¼š</p>
<pre><code class="language-bash">go get -u github.com/golang/dep/cmd/dep
</code></pre>
<p>åœ¨Macä¸Šè¿˜å¯ä»¥ç”¨brewå®‰è£…ï¼š</p>
<pre><code class="language-bash">brew install dep
brew upgrade dep
</code></pre>
<h3 id="ä½¿ç”¨"><a class="header" href="#ä½¿ç”¨">ä½¿ç”¨</a></h3>
<p>åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸­æ‰§è¡Œ<code>dep init</code>å®Œæˆåˆå§‹åŒ–è®¾ç½®ã€‚</p>
<pre><code class="language-bash">$ dep init
$ tree
.
â”œâ”€â”€ Gopkg.lock
â”œâ”€â”€ Gopkg.toml
â””â”€â”€ vendor

1 directory, 2 files
</code></pre>
<p><code>Gopkg.toml</code>å’Œ<code>Gopkg.lock</code>ç”¨æ¥è®°å½•é¡¹ç›®çš„ä¾èµ–åŒ…ï¼Œå¦‚æœé¡¹ç›®ä¸­æ²¡æœ‰ä»£ç ï¼Œè¿™ä¸¤ä¸ªæ–‡ä»¶æ˜¯ç©ºçš„ã€‚</p>
<p>ä½¿ç”¨<code>dep ensure -add</code>æ·»åŠ ä¾èµ–åŒ…ï¼ˆé¡¹ç›®ç›®å½•ä¸­éœ€è¦æœ‰æºç ï¼‰ï¼š</p>
<pre><code class="language-bash">dep ensure -add  k8s.io/client-go
</code></pre>
<p>è¿™æ—¶ä¾èµ–åŒ…çš„ä¾èµ–åŒ…è¿˜æ²¡æœ‰å®‰è£…åˆ°é¡¹ç›®æœ¬åœ°ï¼Œéœ€è¦æ‰§è¡Œ<code>dep ensure</code>è¿›è¡Œå®‰è£…ã€‚</p>
<p>ä»£ç ä¸­å¼•ç”¨çš„å…¶å®ƒ<code>æœªé€šè¿‡depæ·»åŠ </code>çš„ä¾èµ–åŒ…ï¼Œä¹Ÿéœ€è¦æ‰§è¡Œ<code>dep ensure</code>è¿›è¡Œå®‰è£…ã€‚</p>
<p>å¦‚æœè¦æ›´æ”¹ä¾èµ–çš„ç‰ˆæœ¬ï¼Œç¼–è¾‘<code>Gopkg.toml</code>ä¹‹åï¼Œæ‰§è¡Œ<code>dep ensure</code>ã€‚</p>
<p><code>dep ensure</code>å°†æ‰€æœ‰çš„ä¾èµ–åŒ…ä¿¡æ¯æ›´æ–°åˆ°Gopkg.lockæ–‡ä»¶ä¸­ï¼Œå¹¶å°†æ‰€æœ‰çš„ä¾èµ–åŒ…ä¸‹è½½åˆ°vendorç›®å½•ä¸­ã€‚</p>
<h3 id="å‘å¸ƒ"><a class="header" href="#å‘å¸ƒ">å‘å¸ƒ</a></h3>
<p>å¯ä»¥åªå°†<code>Gopkg.toml</code>å’Œ<code>Gopkg.lock</code>åŒ…å«åˆ°é¡¹ç›®ä»£ç åº“ä¸­ã€‚ä¹‹ååœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­æ‰§è¡Œ<code>dep ensure</code>ä¸‹è½½ä¾èµ–åŒ…ï¼š</p>
<pre><code class="language-bash">dep ensure
</code></pre>
<h2 id="glide"><a class="header" href="#glide">Glide</a></h2>
<p><a href="https://github.com/Masterminds/glide" title="glide">glide</a>æ˜¯ä¸€ä¸ªä½¿ç”¨æ¯”è¾ƒå¤šçš„ä¾èµ–ç®¡ç†å·¥å…·ã€‚</p>
<h3 id="å®‰è£…-1"><a class="header" href="#å®‰è£…-1">å®‰è£…</a></h3>
<p>åœ¨linuxä¸Šå¯ä»¥ç”¨ä¸‹é¢çš„æ–¹æ³•å®‰è£…ï¼š</p>
<pre><code class="language-bash">curl https://glide.sh/get | sh
</code></pre>
<p>Macä¸Šè¿˜å¯ä»¥ç”¨brewå®‰è£…ï¼š</p>
<pre><code class="language-bash">brew install glide
</code></pre>
<h3 id="ä½¿ç”¨-1"><a class="header" href="#ä½¿ç”¨-1">ä½¿ç”¨</a></h3>
<h4 id="glide-createåˆå§‹åŒ–"><a class="header" href="#glide-createåˆå§‹åŒ–">glide createåˆå§‹åŒ–</a></h4>
<p>åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸­æ‰§è¡Œ<code>glide create</code>å®Œæˆåˆå§‹åŒ–è®¾ç½®ã€‚</p>
<pre><code class="language-bash">$ glide create
[INFO]	Generating a YAML configuration file and guessing the dependencies
[INFO]	Attempting to import from other package managers (use --skip-import to skip)
[INFO]	Scanning code to look for dependencies
[INFO]	Writing configuration file (glide.yaml)
[INFO]	Would you like Glide to help you find ways to improve your glide.yaml configuration?
[INFO]	If you want to revisit this step you can use the config-wizard command at any time.
[INFO]	Yes (Y) or No (N)?
N
[INFO]	You can now edit the glide.yaml file. Consider:
[INFO]	--&gt; Using versions and ranges. See https://glide.sh/docs/versions/
[INFO]	--&gt; Adding additional metadata. See https://glide.sh/docs/glide.yaml/
[INFO]	--&gt; Running the config-wizard command to improve the versions in your configuration
</code></pre>
<p>å¦‚æœé¡¹ç›®ä¸­å·²ç»æœ‰ä»£ç ï¼Œä¼šå°†å·²æœ‰ä»£ç çš„ä¾èµ–å†™å…¥åˆ°glide.yamlä¸­ã€‚</p>
<p>ä¹‹åç›´æ¥ä½¿ç”¨<code>glide up --quick</code>å°†å·²æœ‰ä»£ç çš„ä¾èµ–æ”¶é›†åˆ°vendorç›®å½•ä¸­ã€‚</p>
<h4 id="glide-get-æ·»åŠ ä¾èµ–åŒ…"><a class="header" href="#glide-get-æ·»åŠ ä¾èµ–åŒ…">glide get æ·»åŠ ä¾èµ–åŒ…</a></h4>
<p>ä½¿ç”¨glideå®‰è£…ä¾èµ–åŒ…çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨æç¤ºç‰ˆæœ¬ã€‚ä¾‹å¦‚ç”¨glideçš„å‘½ä»¤å¼•å…¥<code>k8s.io/client-go</code>æ—¶ï¼š</p>
<pre><code class="language-bash">$ glide get k8s.io/client-go
[INFO]	Preparing to install 1 package.
[INFO]	Attempting to get package k8s.io/client-go
[INFO]	--&gt; Gathering release information for k8s.io/client-go
[INFO]	The package k8s.io/client-go appears to have Semantic Version releases (http://semver.org).
[INFO]	The latest release is v6.0.0. You are currently not using a release. Would you like
[INFO]	to use this release? Yes (Y) or No (N)
Y
[INFO]	The package k8s.io/client-go appears to use semantic versions (http://semver.org).
[INFO]	Would you like to track the latest minor or patch releases (major.minor.patch)?
[INFO]	The choices are:
[INFO]	 - Tracking minor version releases would use '&gt;= 6.0.0, &lt; 7.0.0' ('^6.0.0')
[INFO]	 - Tracking patch version releases would use '&gt;= 6.0.0, &lt; 6.1.0' ('~6.0.0')
[INFO]	 - Skip using ranges
[INFO]	For more information on Glide versions and ranges see https://glide.sh/docs/versions
[INFO]	Minor (M), Patch (P), or Skip Ranges (S)?
P
[INFO]	--&gt; Adding k8s.io/client-go to your configuration with the version ~6.0.0
[INFO]	Downloading dependencies. Please wait...
[INFO]	--&gt; Fetching updates for k8s.io/client-go
[INFO]	Resolving imports
[INFO]	Downloading dependencies. Please wait...
[INFO]	--&gt; Detected semantic version. Setting version for k8s.io/client-go to v6.0.0
[INFO]	Exporting resolved dependencies...
[INFO]	--&gt; Exporting k8s.io/client-go
[INFO]	Replacing existing vendor dependencies
</code></pre>
<p>å®‰è£…å®Œæˆä¹‹åç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre><code class="language-bash">$ tree -L 2
.
â”œâ”€â”€ glide.lock
â”œâ”€â”€ glide.yaml
â””â”€â”€ vendor
    â””â”€â”€ k8s.io
</code></pre>
<p><code>glide get</code>åœ¨glide.yamlå’Œglide.lockä¸­è®°å½•äº†ä¾èµ–çš„client-goçš„ç‰ˆæœ¬ã€‚</p>
<p>è¿™æ—¶ï¼Œä¾èµ–åŒ…å·²ç»å®‰è£…åˆ°äº†é¡¹ç›®æœ¬åœ°ï¼Œä½†æ˜¯ä¾èµ–åŒ…çš„ä¾èµ–åŒ…è¿˜éœ€è¦é€šè¿‡æ‰§è¡Œ<code>glide up</code>è¿›è¡Œå®‰è£…ã€‚</p>
<h4 id="glide-up-æ›´æ–°vendorç›®å½•"><a class="header" href="#glide-up-æ›´æ–°vendorç›®å½•">glide up æ›´æ–°vendorç›®å½•</a></h4>
<p>é¡¹ç›®çš„æºä»£ç ä¸­ç›´æ¥å¼•å…¥çš„<code>ä¸æ˜¯é€šè¿‡glideå‘½ä»¤å®‰è£…</code>çš„åŒ…ï¼Œä¹Ÿéœ€è¦æ‰§è¡Œ<code>glide up</code>å®‰è£…ã€‚</p>
<p><code>glide up</code>ä¼šåœ¨glide.lockä¸­è®°å½•ä¾èµ–åŒ…çš„ä¾èµ–åŒ…å’Œæºç å¼•ç”¨çš„ä¾èµ–åŒ…ï¼Œå¹¶å°†è¿™äº›ä¾èµ–åŒ…å®‰è£…åˆ°é¡¹ç›®æœ¬åœ°ã€‚</p>
<blockquote>
<p>âš ï¸  glide upå®‰è£…çš„ä¾èµ–åŒ…æ˜¯ç›´æ¥ä»githubæˆ–è€…å…¶å®ƒç½‘å€ä¸‹è½½çš„ï¼Œæ—¢ä¸ä¼šä½¿ç”¨ã€ä¹Ÿä¸ä¼šæ›´æ”¹$GOPATHä¸­çš„æºç ã€‚</p>
</blockquote>
<blockquote>
<p>âš ï¸  æ²¡æœ‰æŒ‡å®šç‰ˆæœ¬çš„ä¾èµ–åŒ…ï¼Œglide upæ¯æ¬¡æ‰§è¡Œçš„æ—¶å€™ï¼Œéƒ½ä¼šå»è·å–å®‰è£…æœ€æ–°çš„ä»£ç ã€‚</p>
</blockquote>
<blockquote>
<p>âš ï¸  glide upé»˜è®¤é€’å½’æœé›†ä¾èµ–ï¼Œå¯ä»¥ç”¨glide up --quick</p>
</blockquote>
<pre><code class="language-bash">$ glide up
[INFO]	Downloading dependencies. Please wait...
[INFO]	--&gt; Fetching updates for k8s.io/client-go
[INFO]	--&gt; Detected semantic version. Setting version for k8s.io/client-go to v5.0.1
[INFO]	Resolving imports
[INFO]	--&gt; Fetching github.com/lijiaocn/GoPkgs
[INFO]	Found Godeps.json file in /Users/lijiao/.glide/cache/src/https-k8s.io-apimachinery
[INFO]	--&gt; Parsing Godeps metadata...
...
[INFO]	--&gt; Exporting k8s.io/kube-openapi
[INFO]	--&gt; Exporting k8s.io/api
[INFO]	Replacing existing vendor dependencies
[INFO]	Project relies on 31 dependencies.

$ head glide.lock
hash: 1002f0b1fae48b0c9e90737a6071f892d98b6bd9016d55f91cca24d25672e4cb
updated: 2017-12-27T10:44:30.038822286+08:00
imports:
- name: github.com/davecgh/go-spew
  version: 782f4967f2dc4564575ca782fe2d04090b5faca8
  subpackages:
  - spew
- name: github.com/emicklei/go-restful
  version: ff4f55a206334ef123e4f79bbf348980da81ca46
  subpackages:
</code></pre>
<p>å¦‚æœè¦æ›´æ”¹ä¾èµ–åŒ…çš„ç‰ˆæœ¬ï¼Œä¿®æ”¹<code>glide.yaml</code>æ–‡ä»¶çš„versionåï¼Œä¹Ÿæ‰§è¡Œ<code>glide up</code>ã€‚</p>
<pre><code class="language-bash">$ cat glide.yaml
package: github.com/lijiaocn/handbook-go/codes/04-01-version/glide
import:
- package: k8s.io/client-go
  version: ~6.0.0
$ glide up -v
</code></pre>
<h3 id="ç®¡ç†"><a class="header" href="#ç®¡ç†">ç®¡ç†</a></h3>
<p>æŸ¥çœ‹ä¾èµ–åŒ…ï¼š</p>
<pre><code>glide list
</code></pre>
<p>åˆ é™¤ä¾èµ–åŒ…ï¼š</p>
<pre><code>glide rm
</code></pre>
<p>è®¾ç½®é•œåƒç«™ï¼š</p>
<pre><code>glide mirror
</code></pre>
<h3 id="å‘å¸ƒ-1"><a class="header" href="#å‘å¸ƒ-1">å‘å¸ƒ</a></h3>
<p>å‘å¸ƒçš„æ—¶å€™å°†<code>glide.lock</code>å’Œ<code>glide.yaml</code>åŒ…å«åˆ°é¡¹ç›®æºç åº“ä¸­ã€‚</p>
<p>è·å–åˆ°é¡¹ç›®ä»£ç åï¼Œé¡¹ç›®çš„æ ¹ç›®å½•ä¸­æ‰§è¡Œ<code>glide install</code>ä¸‹è½½é¡¹ç›®çš„ä¾èµ–åŒ…ã€‚</p>
<pre><code class="language-bash">$ glide install
[INFO]	Downloading dependencies. Please wait...
[INFO]	--&gt; Found desired version locally github.com/davecgh/go-spew 782f4967f2dc4564575ca782fe2d04090b5faca8!
[INFO]	--&gt; Found desired version locally github.com/emicklei/go-restful ff4f55a206334ef123e4f79bbf348980da81ca46!
[INFO]	--&gt; Found desired version locally github.com/emicklei/go-restful-swagger12 dcef7f55730566d41eae5db10e7d6981829720f6!
...
[INFO]	--&gt; Exporting gopkg.in/inf.v0
[INFO]	--&gt; Exporting k8s.io/client-go
[INFO]	--&gt; Exporting k8s.io/kube-openapi
[INFO]	Replacing existing vendor dependencies
</code></pre>
<h2 id="godep"><a class="header" href="#godep">Godep</a></h2>
<p>Goè¯­è¨€æ—©æœŸæ²¡æœ‰æä¾›ä¾èµ–åŒ…ç®¡ç†çš„åŠŸèƒ½ï¼Œ<a href="https://github.com/Masterminds/glide" title="glide">godep</a>æ˜¯ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„ç¬¬ä¸‰æ–¹ä¾èµ–ç®¡ç†å·¥å…·ã€‚</p>
<h3 id="å®‰è£…-2"><a class="header" href="#å®‰è£…-2">å®‰è£…</a></h3>
<p>å¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤å®‰è£…godepï¼š</p>
<pre><code>go get github.com/tools/godep
</code></pre>
<h3 id="ä¸‹è½½"><a class="header" href="#ä¸‹è½½">ä¸‹è½½</a></h3>
<p>godepä¸ä¼šè‡ªåŠ¨æ‹‰å–ä»£ç ï¼Œä½¿ç”¨å‰ï¼Œå…ˆè¦ç¡®è®¤ä¸­<code>$GOPATH</code>ä¸­çš„æºç çš„ç‰ˆæœ¬æ˜¯æ­£ç¡®çš„ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœè¦ä½¿ç”¨<code>k8s.io/client-go</code>çš„v6.0.0ç‰ˆæœ¬çš„ä»£ç ã€‚</p>
<p>å…ˆä¸‹è½½æºç ï¼š</p>
<pre><code>go get k8s.io/client-go/...
</code></pre>
<p>ç„¶åå°†ä¸‹è½½çš„client-goæºç åˆ‡æ¢åˆ°v6.0.0ï¼š</p>
<pre><code>cd $GOPATH/src/k8s.io/client-go
git checkout v6.0.0
</code></pre>
<p>å› ä¸ºclient-goè‡ªèº«ä¹Ÿä½¿ç”¨godepè¿›è¡Œäº†ä¾èµ–ç®¡ç†ï¼Œæ‰€ä»¥è¿˜éœ€è¦åœ¨client-goä¸­æ‰§è¡Œï¼š</p>
<pre><code>godep restore ./...
</code></pre>
<blockquote>
<p>æ‰§è¡Œrestoreçš„ç›®çš„ä¸‹è½½client-goçš„ä¾èµ–åŒ…ã€‚</p>
</blockquote>
<p>è¿™æ—¶å¯ä»¥ç›´æ¥åœ¨é¡¹ç›®ä¸­å¼•ç”¨ç›®æ ‡ç‰ˆæœ¬çš„ä»£ç ï¼Œä½†ä¾èµ–åŒ…çš„æ–‡ä»¶è¿˜æ˜¯åˆ°$GOPATHä¸­è¯»å–ã€‚</p>
<p>å¦‚æœå¦ä¸€ä¸ªé¡¹ç›®ä½¿ç”¨äº†åŒåä¾èµ–åŒ…çš„å¦ä¸€ä¸ªç‰ˆæœ¬ï¼Œä¸¤è€…å°±ä¼šå†²çªã€‚æ‰€ä»¥è¿˜éœ€è¦å°†é¡¹ç›®çš„ä¾èµ–ä¿¡æ¯ã€ä¾èµ–æ–‡ä»¶ä¿å­˜åˆ°é¡¹ç›®æœ¬åœ°ã€‚</p>
<h3 id="ä¿å­˜"><a class="header" href="#ä¿å­˜">ä¿å­˜</a></h3>
<p>é€šè¿‡ä»¥ä¸‹å‘½ä»¤ï¼Œå°†é¡¹ç›®å¼•ç”¨çš„ç¬¬ä¸‰æ–¹ä»£ç ä»¥åŠç‰ˆæœ¬ä¿¡æ¯ä¿å­˜åœ¨æœ¬åœ°:</p>
<pre><code>godep save          #ä¿å­˜å½“å‰ç›®å½•ä¸‹çš„goæ–‡ä»¶(ä¸éå†å­ç›®å½•)å¼•ç”¨çš„ç¬¬ä¸‰æ–¹ä»£ç 
godep save ./...    #ä¿å­˜å½“å‰ç›®å½•ä»¥åŠå­ç›®å½•ä¸‹çš„goæ–‡ä»¶å¼•ç”¨çš„ç¬¬ä¸‰æ–¹ä»£ç 
</code></pre>
<p>åœ¨Go1.5ä¹‹å‰ï¼Œgodepå°†ç‰ˆæœ¬ä¿¡æ¯å’Œç¬¬ä¸‰æ–¹ä»£ç ä¿å­˜çš„é¡¹ç›®çš„Godepsç›®å½•ä¸‹ã€‚å› æ­¤åœ¨go1.5ä¹‹å‰ï¼Œéœ€è¦é€šè¿‡godepè°ƒç”¨goå‘½ä»¤ï¼Œæ‰ä¼šä½¿ç”¨ä¿å­˜åœ¨é¡¹ç›®æœ¬åœ°çš„ä¾èµ–åŒ…ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code>godep go build
</code></pre>
<p>åœ¨Go1.5ä»¥åï¼Œgodepå°†ç‰ˆæœ¬ä¿¡æ¯ä¿å­˜åœ¨godepsç›®å½•ä¸­,å°†ä¾èµ–åŒ…ä¿å­˜åœ¨é¡¹ç›®æœ¬åœ°çš„vendorç›®å½•ä¸­ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨goå‘½ä»¤ã€‚</p>
<h3 id="å‘å¸ƒ-2"><a class="header" href="#å‘å¸ƒ-2">å‘å¸ƒ</a></h3>
<p>å¯ä»¥å°†é¡¹ç›®æœ¬åœ°çš„ä¾èµ–åŒ…ï¼Œå³Godepç›®å½•å’Œvendorç›®å½•æäº¤åˆ°é¡¹ç›®çš„ä»£ç åº“ä¸­ã€‚</p>
<p>ä¹Ÿå¯ä»¥åªå°†Godepç›®å½•æäº¤åˆ°é¡¹ç›®çš„ä»£ç åº“ä¸­ã€‚è¿™æ ·ä¸‹è½½äº†é¡¹ç›®ä»£ç åï¼Œéœ€è¦ç”¨restoreä¸‹è½½ä¾èµ–åŒ…ï¼š</p>
<pre><code>go restore
</code></pre>
<p>restoreä¼šå‘½ä»¤å°†$GOPATHä¸­çš„æºç æ›´æ–°ä¸º<code>Godeps/Godeps.json</code>ä¸­æŒ‡å®šçš„ç‰ˆæœ¬ï¼Œå› æ­¤æœ€å¥½è¿˜æ˜¯ä½¿ç”¨ç¬¬ä¸€ç§å‘å¸ƒæ–¹å¼ã€‚</p>
<p>ä¾‹å¦‚Godeps.jsonä¸­çš„æŒ‡å®šmetadataçš„ç‰ˆæœ¬ä¸º<code>3b1ae45394a234c385be014e9a488f2bb6eef821</code>ï¼š</p>
<pre><code class="language-json">{
    &quot;ImportPath&quot;: &quot;k8s.io/client-go&quot;,
    &quot;GoVersion&quot;: &quot;go1.9&quot;,
    &quot;GodepVersion&quot;: &quot;v79&quot;,
    &quot;Packages&quot;: [
        &quot;./...&quot;
    ],
    &quot;Deps&quot;: [
        {
            &quot;ImportPath&quot;: &quot;cloud.google.com/go/compute/metadata&quot;,
            &quot;Rev&quot;: &quot;3b1ae45394a234c385be014e9a488f2bb6eef821&quot;
        },
    ...(çœç•¥)...
</code></pre>
<p>æ‰§è¡Œrestoreå‘½ä»¤ä¹‹åï¼Œ<code>$GOPATH/cloud.google.com/go/compute/metadata</code>ä¸­çš„ç‰ˆæœ¬å°†ä¸ºå˜æˆæŒ‡å®šçš„ç‰ˆæœ¬ï¼š</p>
<pre><code class="language-bash">$ cd $GOPATH/cloud.google.com/go/compute/metadata
$ git log |head
commit 3b1ae45394a234c385be014e9a488f2bb6eef821
Author: Sarah Adams &lt;shadams@google.com&gt;
Date:   Thu Sep 8 15:39:53 2016 -0700

    datastore: adds support for loading entity values

    Adds support for conditionally loading either flattened fields or
    entity values into nested structs on read.

    Issue #75
</code></pre>
<h3 id="è®¾ç½®ä»£ç†"><a class="header" href="#è®¾ç½®ä»£ç†">è®¾ç½®ä»£ç†</a></h3>
<p>godepæ˜¯ç”¨goè¯­è¨€å¼€å‘ï¼Œgoè¯­è¨€å¼€å‘çš„ç¨‹åºéƒ½æ”¯æŒç¯å¢ƒå˜é‡<code>http_proxy</code>ã€‚</p>
<pre><code>$ http_proxy=127.0.0.1:53100 godep restore ./...
</code></pre>
<p>godepåœ¨åŠ è½½æºç æ—¶ï¼Œä¼šä½¿ç”¨gitç­‰ç‰ˆæœ¬ç®¡ç†å·¥å…·ï¼Œæ‰€ä»¥å¯èƒ½è¿˜éœ€è¦ç»™è¿™äº›ç‰ˆæœ¬ç®¡ç†è®¾ç½®ä»£ç†ã€‚</p>
<p>gitå¯ä»¥åœ¨~/.gitconfigä¸­è®¾ç½®:</p>
<pre><code class="language-ini">[https]
proxy = 127.0.0.1:53100
sslverify = false
[http]
proxy = 127.0.0.1:53100
</code></pre>
<h2 id="vendor"><a class="header" href="#vendor">Vendor</a></h2>
<p>vendoræ˜¯1.5ä¸­çš„ä¸€ä¸ªè¯•éªŒç‰¹æ€§ï¼Œåœ¨1.6ç‰ˆæœ¬ä¸­è¢«æ­£å¼å¼•å…¥ã€‚ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œä¼šå…ˆå¼•ç”¨vendorç›®å½•ä¸­çš„ä»£ç ã€‚</p>
<p>å¯¹äºåŒæ ·çš„ä»£ç main.go:</p>
<pre><code class="language-go">package main

import (
    &quot;github.com/lijiaocn/GoPkgs/version&quot;
)

func main() {
    version.Show()
}
</code></pre>
<p>æ²¡æœ‰vendorä¹‹å‰ï¼Œé¡¹ç›®vendor_testç›®å½•ç»“æ„å¦‚ä¸‹:</p>
<pre><code class="language-bash">â–¾ vendor_test/
  â–¾ main/
      main.go
</code></pre>
<p>main.goä¸­å¼•ç”¨çš„æ˜¯<code>$GOPATH/.../version</code>ä¸­çš„æ–‡ä»¶ã€‚</p>
<p>ä½¿ç”¨vendorä¹‹åï¼Œç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre><code class="language-bash">â–¾ vendor_test/
  â–¸ Godeps/
  â–¾ main/
      main.go
  â–¾ vendor/
    â–¾ github.com/
      â–¾ lijiaocn/
        â–¾ GoPkgs/
          â–¸ version/
            LICENSE
</code></pre>
<p>main.goä¸­å¼•ç”¨çš„æ˜¯æœ¬åœ°çš„<code>vendor/.../version</code>ä¸­çš„æ–‡ä»¶ã€‚</p>
<p>ä¸éœ€è¦å¯¹main.goåšä»»ä½•ä¿®æ”¹ã€‚</p>
<h2 id="å‚è€ƒ-21"><a class="header" href="#å‚è€ƒ-21">å‚è€ƒ</a></h2>
<ol>
<li><a href="https://github.com/tools/godep" title="godep">godep</a></li>
<li><a href="https://github.com/Masterminds/glide" title="glide">glide</a></li>
<li><a href="https://github.com/golang/dep" title="dep">dep</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="go-template-è¯­æ³•"><a class="header" href="#go-template-è¯­æ³•">Go Template è¯­æ³•</a></h1>
<p>Go è¯­è¨€æä¾›äº†ä¸€ä¸ªåä¸º <a href="https://golang.org/pkg/text/template/" title="Golang: Package template">text/template</a> åº“ï¼Œè¿™ä¸ªåº“å®šä¹‰å®ç°äº† go template è¯­è¨€ï¼Œå¯ä»¥ç”¨æ¥å†™ html æ¨¡æ¿ã€‚å¾ˆå¤šç”¨ go è¯­è¨€å®ç°çš„è½¯ä»¶ï¼Œè­¬å¦‚ dockerã€kubernetes æ”¯æŒç”¨ go template å®šä¹‰è¾“å‡ºçš„å†…å®¹æ ¼å¼ã€‚</p>
<p>åŸºæœ¬æ ·å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="language-go">{{ .structæˆå‘˜åç§° }}
</code></pre>
<p>è­¬å¦‚è¾“å‡º docker inspect ä¸­çš„æŒ‡å®šå­—æ®µï¼š</p>
<pre><code class="language-sh">$ docker inspect b579c6a6516b -f &quot;{{.NetworkSettings.Networks.bridge.IPAddress}}&quot;
172.17.0.3
</code></pre>
<h2 id="å‚è€ƒ-22"><a class="header" href="#å‚è€ƒ-22">å‚è€ƒ</a></h2>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h3 id="raw-string"><a class="header" href="#raw-string">raw string</a></h3>
<p>codes: </p>
<pre><code>package main

func main() {
    raw := `Hello,
World
    !`

    println(raw)
}
</code></pre>
<p>output: </p>
<pre><code>Hello,
World
	!
</code></pre>
<h3 id="same-string"><a class="header" href="#same-string">same string</a></h3>
<p>codes: </p>
<pre><code>package main

func main() {

    str1 := &quot;æ—¥æœ¬èª&quot;                                  // UTF-8 input text
    str2 := `æ—¥æœ¬èª`                                  // UTF-8 input text as a raw literal
    str3 := &quot;\u65e5\u672c\u8a9e&quot;                   // the explicit Unicode code points
    str4 := &quot;\U000065e5\U0000672c\U00008a9e&quot;       // the explicit Unicode code points
    str5 := &quot;\xe6\x97\xa5\xe6\x9c\xac\xe8\xaa\x9e&quot; // the explicit UTF-8 bytes

    println(str1)
    println(str2)
    println(str3)
    println(str4)
    println(str5)
}
</code></pre>
<p>output:</p>
<pre><code>æ—¥æœ¬èª
æ—¥æœ¬èª
æ—¥æœ¬èª
æ—¥æœ¬èª
æ—¥æœ¬èª
</code></pre>
<h3 id="constant-max-int"><a class="header" href="#constant-max-int">constant max int</a></h3>
<p>codes:</p>
<pre><code>package main

func main() {
    //2^256=115792089237316195423570985008687907853269984665640564039457584007913129639936
    i := 115792089237316195423570985008687907853269984665640564039457584007913129639936
}
</code></pre>
<p>output:</p>
<pre><code>./main.go:6: constant 115792089237316195423570985008687907853269984665640564039457584007913129639936 overflows int
</code></pre>
<h3 id="unamed-type"><a class="header" href="#unamed-type">unamed type</a></h3>
<p>codes:</p>
<pre><code>package main

type Student struct {
    name string
    age  int
}

func Display(s struct {
    name string
    age  int
}) {
    println(s.name)
    println(s.age)
}

func main() {
    alice := Student{
        name: &quot;alice&quot;,
        age:  16,
    }
    Display(alice)
}
</code></pre>
<p>output:</p>
<pre><code>alice
16
</code></pre>
<h3 id="method-sets"><a class="header" href="#method-sets">Method Sets</a></h3>
<p>codes:</p>
<pre><code>package main

type Str string

func (s Str) Show() {
    println(s)
}

func main() {
    str := Str(&quot;Hello World!&quot;)
    pstr := &amp;str
    pstr.Show()
}
</code></pre>
<p>output:</p>
<pre><code>Hello World!
</code></pre>
<h3 id="string-index"><a class="header" href="#string-index">String Index</a></h3>
<p>codes:</p>
<pre><code>package main

import (
    &quot;fmt&quot;
)

func main() {
    str := &quot;Hello World!&quot;
    fmt.Printf(&quot;%c\n&quot;, str[6])

    //not allow
    //ptr := &amp;str[6]

    //not allow
    //str[6] = 'w'
}
</code></pre>
<p>output:</p>
<pre><code>W
</code></pre>
<h3 id="create-slice-from-array"><a class="header" href="#create-slice-from-array">Create Slice from Array</a></h3>
<p>codes:</p>
<pre><code>package main

func main() {
    var array1 [30]int
    for i := 0; i &lt; len(array1); i++ {
        array1[i] = i
    }

    slice1 := array1[10:15]

    println(&quot;array's length: &quot;, len(array1))
    println(&quot;slice1's length: &quot;, len(slice1))
    println(&quot;slice1's capacity: &quot;, cap(slice1))

    for i := 0; i &lt; len(slice1); i++ {
        println(slice1[i])
    }
}
</code></pre>
<p>output:</p>
<pre><code>array's length:  30
slice1's length:  5
slice1's capacity:  20
10
11
12
13
14
</code></pre>
<h3 id="create-slice-by-make"><a class="header" href="#create-slice-by-make">Create Slice by make</a></h3>
<p>codes:</p>
<pre><code>package main

func main() {
    //not allow
    //slice1 := make([]int)
    //println(&quot;slice1ï¼Œ len is &quot;, len(slice1), &quot;capacity is &quot;, cap(slice1))

    slice2 := make([]int, 10)
    println(&quot;slice2ï¼Œ len is &quot;, len(slice2), &quot;capacity is &quot;, cap(slice2))

    slice3 := make([]int, 10, 20)
    println(&quot;slice3ï¼Œ len is &quot;, len(slice3), &quot;capacity is &quot;, cap(slice3))
}
</code></pre>
<p>output:</p>
<pre><code>slice2ï¼Œ len is  10 capacity is  10
slice3ï¼Œ len is  10 capacity is  20
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="go-è¯­è¨€æµ‹è¯•æ¡†æ¶-ginkgo-çš„ä½¿ç”¨æ–¹æ³•"><a class="header" href="#go-è¯­è¨€æµ‹è¯•æ¡†æ¶-ginkgo-çš„ä½¿ç”¨æ–¹æ³•">Go è¯­è¨€æµ‹è¯•æ¡†æ¶ GinkGo çš„ä½¿ç”¨æ–¹æ³•</a></h1>
<p>å­¦ä¹  <a href="https://www.lijiaocn.com/soft/k8s/ingress-nginx/" title="ingress-nginx çš„ä½¿ç”¨æ–¹æ³•">ingress-nginx</a> æ—¶ï¼Œæƒ³ä¿®æ”¹å®ƒçš„ä»£ç å¹¶å°†ä»£ç æäº¤åˆ°ç¤¾åŒºï¼Œäº†è§£ e2e æµ‹è¯•æ—¶ï¼Œé‡åˆ°äº† <a href="http://onsi.github.io/ginkgo/" title="ginkgo">GinkGo</a>ã€‚</p>
<h2 id="å­¦ä¹ ç¯å¢ƒ"><a class="header" href="#å­¦ä¹ ç¯å¢ƒ">å­¦ä¹ ç¯å¢ƒ</a></h2>
<p>è¿™é‡Œä½¿ç”¨çš„ go ç‰ˆæœ¬æ˜¯ go 1.13.3ã€‚</p>
<p>åˆ›å»ºå·¥ä½œç›®å½•ï¼Œå®‰è£… ginkgoï¼š</p>
<pre><code class="language-sh">$ go get github.com/onsi/ginkgo/ginkgo
$ go get github.com/onsi/gomega/...
$ ginkgo version
Ginkgo Version 1.10.2
</code></pre>
<p>å‡†å¤‡ä¸€ä¸ªå¾…æµ‹çš„ packageï¼š</p>
<pre><code class="language-sh">$ mkdir study-Ginkgo
$ cd study-Ginkgo
$ go mod init studyginkgo
</code></pre>
<p>åœ¨æ–‡ä»¶ target_funcs/target_funcs.go ä¸­å†™å‡ ä¸ªå¾…æµ‹çš„å‡½æ•°ï¼š</p>
<pre><code class="language-go">package target_funcs

func ReturnTrue() bool {
    return true
}

func ReturnFalse() bool {
    return false
}

func ReturnInt(v int) int {
    return v
}
</code></pre>
<h2 id="ginkgo-æµ‹è¯•ä»£ç çš„è¿è¡Œ"><a class="header" href="#ginkgo-æµ‹è¯•ä»£ç çš„è¿è¡Œ">ginkgo æµ‹è¯•ä»£ç çš„è¿è¡Œ</a></h2>
<p>ç”¨ ginkgo å‘½ä»¤ç”Ÿæˆæµ‹è¯•æ¨¡æ¿ï¼š</p>
<pre><code class="language-sh">$ cd target_funcs/
$ ginkgo bootstrap
Generating ginkgo test suite bootstrap for target_funcs in:
    target_funcs_suite_test.go
</code></pre>
<p>åˆšç”Ÿæˆçš„ target_funcs_suite_test.go ä¸­ç°åœ¨è¿˜æ²¡æœ‰ä»»ä½•æµ‹è¯•ä»£ç ï¼Œè¿è¡Œæ–¹æ³•ï¼š</p>
<p>æ–¹æ³•1ï¼Œç”¨ ginkgoï¼š</p>
<pre><code class="language-sh">$ ginkgo
Running Suite: TargetFuncs Suite
================================
Random Seed: 1571986734
Will run 0 of 0 specs


Ran 0 of 0 Specs in 0.001 seconds
SUCCESS! -- 0 Passed | 0 Failed | 0 Pending | 0 Skipped
PASS

Ginkgo ran 1 suite in 5.353367082s
Test Suite Passed
</code></pre>
<p>æ–¹æ³•2ï¼Œç”¨ go testï¼š</p>
<pre><code class="language-sh">go test
Running Suite: TargetFuncs Suite
================================
Random Seed: 1571986747
Will run 0 of 0 specs


Ran 0 of 0 Specs in 0.000 seconds
SUCCESS! -- 0 Passed | 0 Failed | 0 Pending | 0 Skipped
PASS
ok      studyginkgo/target_funcs    0.017s
</code></pre>
<p>æ–¹æ³•3ï¼Œç”ŸæˆäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œginkgo å¯ä»¥æµ‹è¯•ä»£ç ç¼–è¯‘åˆ°ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼š</p>
<pre><code class="language-sh">$ ginkgo build
Compiling target_funcs...
    compiled target_funcs.test
</code></pre>
<p>ç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶ target_funcs.test å¯ä»¥ç›´æ¥è¿è¡Œï¼š</p>
<pre><code class="language-sh">./target_funcs.test
Running Suite: TargetFuncs Suite
================================
Random Seed: 1571986954
Will run 0 of 0 specs


Ran 0 of 0 Specs in 0.000 seconds
SUCCESS! -- 0 Passed | 0 Failed | 0 Pending | 0 Skipped
PASS
</code></pre>
<h2 id="ginkgo-æµ‹è¯•ä»£ç çš„ç¼–å†™"><a class="header" href="#ginkgo-æµ‹è¯•ä»£ç çš„ç¼–å†™">ginkgo æµ‹è¯•ä»£ç çš„ç¼–å†™</a></h2>
<p>ä¸º target_funcs_suite_test.go ç”Ÿæˆå¯¹åº”çš„æµ‹è¯•ä»£ç æ–‡ä»¶ï¼š</p>
<pre><code class="language-sh">$ ginkgo generate target_funcs
</code></pre>
<p>ä¸Šé¢çš„å‘½ä»¤ç”Ÿæˆæµ‹è¯• target_funcs_test.goã€‚å¦‚æœä¸åœ¨ $GOPATH ç›®å½•ä¸‹ï¼Œå¯èƒ½ä¼šé‡åˆ°ä¸‹é¢çš„é”™è¯¯ï¼Œginkgo å¤§æ¦‚è¿˜æ²¡æœ‰æ”¯æŒ gomodï¼ˆ2019-10-25 15:23:23ï¼‰ã€‚è¿™ä¸ªé”™è¯¯ä¸å½±å“ä½¿ç”¨ï¼Œå°† target_funcs_test.go ä¸­çš„ UNKNOWN_PACKAGE_PATH ä¿®æ”¹æˆæ‰€åœ¨çš„ package å°±å¯ä»¥äº†ã€‚</p>
<pre><code>Couldn't identify package import path.

    ginkgo generate

Must be run within a package directory under $GOPATH/src/...
You're going to have to change UNKNOWN_PACKAGE_PATH in the generated file...

Generating ginkgo test for TargetFuncs in:
  target_funcs_test.go
</code></pre>
<p>target_funcs_test.go å†…å®¹å¦‚ä¸‹ï¼Œåœ¨ Describe ä¸­æ·»åŠ æµ‹è¯•å‡½æ•°ï¼š</p>
<pre><code class="language-go">package target_funcs_test

import (
    . &quot;github.com/onsi/ginkgo&quot;
    . &quot;github.com/onsi/gomega&quot;

    . &quot;studyginkgo/target_funcs&quot;
)

var _ = Describe(&quot;TargetFuncs&quot;, func() {

})
</code></pre>
<h2 id="ginkgo-æä¾›çš„-block"><a class="header" href="#ginkgo-æä¾›çš„-block">ginkgo æä¾›çš„ block</a></h2>
<p>ginkgo æä¾›äº†å¤šä¸ªç±»å‹çš„ blockï¼ˆå‡½æ•°ï¼‰ï¼Œä¸Šé¢çš„ Describe() å°±æ˜¯ä¸€ä¸ª blockã€‚</p>
<p>åœ¨ XX_suite_test.go ï¼ˆè¿™é‡Œæ˜¯ target_funcs_suite_test.goï¼‰ä¸­ä½¿ç”¨çš„ blockï¼š</p>
<pre><code class="language-sh">BeforeSuite()          :åœ¨æ•´ä¸ªæµ‹è¯•å¼€å§‹ä¹‹å‰æ‰§è¡Œçš„æ“ä½œ
AfterSuite()           :åœ¨æ•´ä¸ªæµ‹è¯•å®Œæˆä¹‹åæ‰§è¡Œçš„æ“ä½œ
</code></pre>
<p>åœ¨ XX_test.goï¼ˆè¿™é‡Œæ˜¯ target_funcs_test.goï¼‰ä¸­ä½¿ç”¨çš„ blockï¼š</p>
<pre><code class="language-sh">BeforeEach()           :æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹è¿è¡Œå‰æ‰§è¡Œçš„æ“ä½œï¼Œä½äº Describe ä¸­ï¼Œå¯ä»¥æœ‰å¤šä¸ª
JustBeforeEach()       :å’ŒBeforeEach()ç±»ä¼¼ï¼Œåœ¨æ‰€æœ‰çš„ BeforeEach()ä¹‹åå’ŒIt()ä¹‹å‰æ‰§è¡Œ
AfterEach()            :æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹è¿è¡Œåæ‰§è¡Œçš„æ“ä½œ
JustAfterEach()        :ç´§è·Ÿåœ¨It()ä¹‹åæ‰§è¡Œ

Describe()             :æœ€é¡¶å±‚çš„æµ‹è¯•ç”¨ä¾‹åŒ…è£¹å®¹å™¨ï¼ŒåŒä¸€ç›®æ ‡çš„æµ‹è¯•ç”¨ä¾‹ï¼Œå¯ä»¥åµŒå¥—
Context()              :æ¯” Describe ä½ä¸€çº§çš„æµ‹è¯•ç”¨ä¾‹åŒ…è£¹å®¹å™¨ï¼ŒåŒä¸€ä¸ªæ¡ä»¶ä¸‹çš„æµ‹è¯•ç”¨ä¾‹
It()                   :å•ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œä½äº Describe æˆ–è€… Context ä¸­
Specify()              :It()çš„åˆ«åï¼Œç”¨é€”å’Œ It() å®Œå…¨ç›¸åŒ
</code></pre>
<p>ä¸“ç”¨äºæ€§èƒ½æµ‹è¯•çš„ blockï¼Œä½¿ç”¨èŒƒå›´å’Œ It() ç›¸åŒï¼š</p>
<pre><code class="language-sh">Measure()              :ç”¨äºæ€§èƒ½æµ‹è¯•çš„ block()
</code></pre>
<p>Describeã€Contextã€It å’Œ Measure æ”¯æŒ P å’Œ X å‰ç¼€ï¼Œå¸¦æœ‰ P æˆ– X å‰ç¼€çš„è¿™å‡ ä¸ª block ä¸å‚ä¸æµ‹è¯•ã€‚</p>
<p>Describeã€Context å’Œ It æ”¯æŒ F å‰ç¼€ï¼Œå¦‚æœæœ‰å¸¦æœ‰ F å‰ç¼€çš„è¿™äº› blockï¼Œæµ‹è¯•æ—¶åªä¼šè¿è¡Œè¿™äº› block ä¸­çš„æµ‹è¯•ç”¨ä¾‹ã€‚</p>
<h2 id="ç»“æœåˆ¤æ–­"><a class="header" href="#ç»“æœåˆ¤æ–­">ç»“æœåˆ¤æ–­</a></h2>
<p>GinkGo æä¾›äº†å¤šä¸ªç”¨æ¥è¿›è¡Œæ•°å€¼åˆ¤æ–­çš„å‡½æ•°ã€‚</p>
<p>Expect(actual interface{}) ä¸ºä¼ å…¥å‚æ•°åˆ›å»ºä¸€ä¸ªæ–­è¨€ Assertionï¼ŒAssertion æ”¯æŒçš„ä»¥ä¸‹çš„åˆ¤æ–­æ–¹æ³•ï¼š</p>
<pre><code class="language-go">type Assertion interface {
    Should(matcher types.GomegaMatcher, optionalDescription ...interface{}) bool
    ShouldNot(matcher types.GomegaMatcher, optionalDescription ...interface{}) bool

    To(matcher types.GomegaMatcher, optionalDescription ...interface{}) bool
    ToNot(matcher types.GomegaMatcher, optionalDescription ...interface{}) bool
    NotTo(matcher types.GomegaMatcher, optionalDescription ...interface{}) bool
}
</code></pre>
<p>æ–­è¨€çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ matcherï¼Œåœ¨ github.com/onsi/gomega/matcher.go ä¸­å®šä¹‰ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="language-go">func BeNil() types.GomegaMatcher {
    return &amp;matchers.BeNilMatcher{}
}

//BeTrue succeeds if actual is true
func BeTrue() types.GomegaMatcher {
    return &amp;matchers.BeTrueMatcher{}
}
</code></pre>
<p>ä½¿ç”¨ä¸¾ä¾‹ï¼Œåˆ†é…æ£€æµ‹ err å’Œ svc çš„å€¼ï¼š</p>
<pre><code class="language-go">Expect(err).To(BeNil(), &quot;unexpected error obtaining ingress-nginx service&quot;)
Expect(svc).NotTo(BeNil(), &quot;expected a service but none returned&quot;)
</code></pre>
<h2 id="æµ‹è¯•ç¤ºä¾‹"><a class="header" href="#æµ‹è¯•ç¤ºä¾‹">æµ‹è¯•ç¤ºä¾‹</a></h2>
<p>target_funcs_suite_test.go å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code class="language-go">package target_funcs_test
import (
    &quot;testing&quot;

    . &quot;github.com/onsi/ginkgo&quot;
    . &quot;github.com/onsi/gomega&quot;
)
func TestTargetFuncs(t *testing.T) {
    RegisterFailHandler(Fail)
    RunSpecs(t, &quot;TargetFuncs Suite&quot;)
}
var _ = BeforeSuite(func() {
    println(&quot;BeforeSuite&quot;)
})
var _ = AfterSuite(func() {
    println(&quot;AfterSuite&quot;)
})
</code></pre>
<p>target_funcs_test.go çš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code class="language-go">package target_funcs_test
import (
    . &quot;github.com/onsi/ginkgo&quot;
    . &quot;github.com/onsi/gomega&quot;

    . &quot;studyginkgo/target_funcs&quot;
)

var _ = Describe(&quot;TargetFuncs&quot;, func() {
    BeforeEach(func() {
        println(&quot;BeforeEach-2&quot;)
    })
    BeforeEach(func() {
        println(&quot;BeforeEach-1&quot;)
    })
    JustBeforeEach(func() {
        println(&quot;JustBeforeEach-1&quot;)
    })
    JustBeforeEach(func() {
        println(&quot;JustBeforeEach-2&quot;)
    })
    JustAfterEach(func() {
        println(&quot;JustAfterEach-1&quot;)
    })
    JustAfterEach(func() {
        println(&quot;JustAfterEach-2&quot;)
    })
    AfterEach(func() {
        println(&quot;AfterEach-1&quot;)
    })
    AfterEach(func() {
        println(&quot;AfterEach-2&quot;)
    })
    Describe(&quot;ReturnInt&quot;, func() {
        Context(&quot;default&quot;, func() {
            var (
                input  int
                result int
            )
            BeforeEach(func() {
                println(&quot;BeforeEach in Context&quot;)
                input = 1
                result = 1
            })
            AfterEach(func() {
                println(&quot;AfterEach in Context&quot;)
                input = 0
                result = 0
            })
            It(&quot;return value&quot;, func() {
                println(&quot;Exec Test Case&quot;)
                v := ReturnInt(input)
                Expect(v).To(Equal(result))
            })
        })
    })
})
</code></pre>
<p>æ‰§è¡Œç»“æœï¼š</p>
<pre><code class="language-sh">$ go test
Running Suite: TargetFuncs Suite
================================
Random Seed: 1571998428
Will run 1 of 1 specs

BeforeSuite
BeforeEach-2
BeforeEach-1
BeforeEach in Context
JustBeforeEach-1
JustBeforeEach-2
Exec Test Case
JustAfterEach-1
JustAfterEach-2
AfterEach in Context
AfterEach-1
AfterEach-2
â€¢AfterSuite

Ran 1 of 1 Specs in 0.000 seconds
SUCCESS! -- 1 Passed | 0 Failed | 0 Pending | 0 Skipped
PASS
ok      studyginkgo/target_funcs    0.018s
</code></pre>
<h2 id="å‚è€ƒ-23"><a class="header" href="#å‚è€ƒ-23">å‚è€ƒ</a></h2>
<ol>
<li><a href="https://www.lijiaocn.com" title="æä½¶æ¾³çš„åšå®¢">æä½¶æ¾³çš„åšå®¢</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="go-è¯­è¨€æ·±å…¥ç†è§£"><a class="header" href="#go-è¯­è¨€æ·±å…¥ç†è§£">Go è¯­è¨€æ·±å…¥ç†è§£</a></h1>
<p>å‚è€ƒï¼š<a href="https://www.lijiaocn.com/%E7%BC%96%E7%A8%8B/2019/12/23/go-blog-10-years.html" title="Go è¯­è¨€å®˜æ–¹ 10 å¹´åšæ–‡">Go è¯­è¨€å®˜æ–¹ 10 å¹´åšæ–‡é˜…è¯»æŒ‡å¼•</a></p>
<p>Go è¯­è¨€æ·±åº¦å…¥é—¨æ‰‹å†Œï¼Œå¸®ä½ æ›´å¥½çš„ç†è§£ Go è¯­è¨€ï¼Œå†™å‡ºæ›´é«˜æ•ˆã€æ›´è§„èŒƒã€æ›´ä¸æ˜“å‡ºé”™çš„ä»£ç ã€‚</p>
<p>Go åœ¨ 2012 å¹´å‘å¸ƒ 1.0 ç‰ˆæœ¬ï¼Œè·ä»Šå·²ç» 8 å¹´äº†ã€‚å’Œå†å²æ‚ ä¹…è¿‘ä¹ä¸€æˆä¸å˜çš„ C ç­‰ç¼–ç¨‹è¯­è¨€ä¸åŒï¼Œ8 å¹´é‡Œä» 1.0 åˆ° 1.13ï¼ŒGo è¯­è¨€åœ¨ä¸€åˆ»ä¸åœåœ°è¿›åŒ–ã€‚ä»è¯­æ³•å¾®è°ƒåˆ°æ€§èƒ½å¤§å¹…ä¼˜åŒ–ï¼Œä»£ç çš„ç»„ç»‡æ–¹å¼å’Œé…å¥—å·¥å…·ç­‰ä¹Ÿå‡ ç»å˜åŒ–ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯¹ Go å¯¹è®¤çŸ¥éœ€è¦ä¸åœåœ°åˆ·æ–°ã€‚Go 2 çš„è®¾è®¡æ—©å·²æä¸Šæ—¥ç¨‹ï¼Œæ„å‘³ç€ Go 1 å¼€å§‹è¶‹ç¨³ï¼Œæ˜¯é‡æ–°æ•´ç†è®¤çŸ¥çš„å¥½æœºä¼šã€‚</p>
<p>å­¦ä¹  C è¯­è¨€çš„æ—¶å€™ï¼Œæ—é”åšå£«æ’°å†™çš„å°å†Œå­<a href="https://vrlab.org.cn/~zhuq/download/%E9%AB%98%E8%B4%A8%E9%87%8F%E7%BC%96%E7%A8%8B%E6%8C%87%E5%8D%97.pdf" title="æ—é”ï¼šã€Šé«˜è´¨é‡ C++/C ç¼–ç¨‹æŒ‡å—ã€‹">ã€Šé«˜è´¨é‡ C++/C ç¼–ç¨‹æŒ‡å—ã€‹</a>å¹¿ä¸ºæµä¼ ï¼š</p>
<p><img src="go/article/./img/c-linrui.png" alt="æ—é”ï¼šã€Šé«˜è´¨é‡ C++/C ç¼–ç¨‹æŒ‡å—ã€‹" /></p>
<p>è¿™æœ¬å°å†Œå­è®©æˆ‘æ„è¯†åˆ°ï¼ŒæŒæ¡è¯­æ³•å’Œèƒ½å†™å‡ºé«˜è´¨é‡çš„ä»£ç ï¼Œå®Œå…¨æ˜¯ä¸¤å›äº‹ã€‚å¯¹ Go è¯­è¨€æ¥è¯´åº”è¯¥æ˜¯ä¸€æ ·çš„ï¼ŒæŒæ¡äº†è¯­æ³•ä¸ç­‰äºèƒ½å†™å‡ºé«˜æ•ˆã€ä¸æ˜“å‡ºé”™çš„ä»£ç ã€‚å¹¶ä¸”é«˜çº§è¯­è¨€å¾€å¾€è®©æˆ‘ä»¬æœ‰ä¸€ç§é”™è§‰ï¼Œä»¥ä¸ºç”¨äº†å®ƒä»¥åä¸å†éœ€è¦ä»”ç»†è€ƒè™‘å¾ˆå¤šç»†èŠ‚ï¼Œå®é™…æƒ…å†µå´æ˜¯æˆ‘ä»¬éœ€è¦è€ƒè™‘æ›´å¤šæ–°çš„ç»†èŠ‚ï¼Œæ—§é—®é¢˜è£…è¿›äº†æ–°ç“¶å­ã€‚</p>
<blockquote>
<p>å†™çº¯ C ä»£ç æ—¶ä»æ¥æ²¡æœ‰æƒ³è¿‡åƒåœ¾å›æ”¶çš„é—®é¢˜ï¼Œå¾—çŸ¥ java ä»¥åŠæ—©æœŸçš„ go è¯­è¨€åœ¨ gc æ—¶å€™ä¼šå…¨å±€ pause æ—¶ï¼Œæ— æ¯”éœ‡æƒŠï¼ç«Ÿç„¶è¿˜æœ‰è¿™ç§äº‹......</p>
<p>è¿™æ–¹é¢çš„é—®é¢˜å¤æ‚åˆ°æœ‰ä¸€ä¸ªåä¸º International Symposium on Memory Management (ISMM) çš„ä¸“é—¨ç»„ç»‡ã€‚Go çš„æ ¸å¿ƒå¼€å‘äººå‘˜ Rick Hudson æ›¾ç»åœ¨è¯¥ç»„ç»‡ä»‹ç»è¿‡ Go gc çš„æ¼”å˜è¿‡ç¨‹ï¼š<a href="https://blog.golang.org/ismmkeynote" title="The Journey of Go's Garbage Collector">The Journey of Go's Garbage Collector</a>ã€‚</p>
</blockquote>
<p>Go ç½‘ç«™ä¸Šçš„ <a href="https://golang.org/doc/effective_go.html" title="Effective Go">ã€ŠEffective Goã€‹</a> å’Œ <a href="https://blog.golang.org/index" title="The Go Blog">Go Blog</a> ä¸Šçš„å¤§é‡æ–‡ç« ï¼Œæ— ç–‘æ˜¯æœ€å¥½çš„ Go é«˜è´¨é‡ç¼–ç¨‹æŒ‡å—ï¼Œä½†æ˜¯æ­£å¦‚å¾ˆéš¾é€šè¿‡ Go è¯­è¨€çš„è¯­æ³•å®šä¹‰<a href="https://golang.org/ref/spec" title="The Go Programming Language Specification">ã€ŠThe Go Programming Language Specificationã€‹</a> å­¦ä¹  Go ç¼–ç¨‹ï¼Œæ²¡æœ‰ä¸€å®šçš„çŸ¥è¯†å‚¨å¤‡ï¼Œä»ã€ŠEffective Goã€‹å’Œ Go Blog ä¸­æ±²å–è¥å…»ä¼šæ¯”è¾ƒåƒåŠ›ã€‚</p>
<p>æ‰€ä»¥ï¼Œä¸€æœ¬ã€Œå«è„šçŸ³ã€æ‰‹å†Œçš„å­˜åœ¨ä¼šå¾ˆæœ‰æ„ä¹‰ã€‚</p>
<p>è¿™æœ¬æ‰‹å†Œçš„å†…å®¹éå¸¸éå¸¸æµ…ï¼Œåƒã€ŒGo çš„è°ƒåº¦å™¨å¦‚ä½•è®¾è®¡ã€ä»¥åŠã€Œä¸‰è‰²æ ‡è®°ç®—æ³•ã€è¿™ç§æˆ‘ä¸ä¼šçš„é—®é¢˜ä¸ä¼šæ¶‰åŠã€‚è¿™é‡Œæ›´å…³æ³¨ä»£ç å¦‚ä½•ç»„ç»‡ï¼Œæµ‹è¯•ç”¨ä¾‹å¦‚ä½•å†™ï¼Œä»¥åŠä¼ å‚æ—¶åº”è¯¥æ³¨æ„çš„äº‹é¡¹ç­‰å¸¸è¯†æ€§å†…å®¹ã€‚ç›¸æ¯”ã€Œç¼–ç¨‹å…¥é—¨ã€ï¼Œå†…å®¹åˆæ¯”è¾ƒæ·±ï¼Œæ‰€ä»¥å«åšã€Œæ·±åº¦å…¥é—¨ã€ã€‚</p>
<blockquote>
<p>å¦‚æœè¦äº†è§£ Go çš„å®ç°ï¼Œè¿˜æœ‰æ¯”ã€Œé¢å‘ä¿¡ä»°ç¼–ç¨‹ã€å¤§ç¥çš„ <a href="https://draveness.me/golang/" title="Go è¯­è¨€è®¾è®¡ä¸å®ç°">ã€ŠGo è¯­è¨€è®¾è®¡ä¸å®ç°ã€‹</a>æ›´å¥½çš„å…¥é—¨èµ„æ–™å—ï¼Ÿ</p>
</blockquote>
<p>ç»å¤§éƒ¨åˆ†å†…å®¹æ¥è‡ª Go çš„åšå®¢ï¼ˆ<a href="https://www.lijiaocn.com/%E7%BC%96%E7%A8%8B/2019/12/23/go-blog-10-years.html" title="Go è¯­è¨€å®˜æ–¹ 10 å¹´åšæ–‡">Go è¯­è¨€å®˜æ–¹ 10 å¹´åšæ–‡é˜…è¯»æŒ‡å¼•</a>ï¼‰ï¼Œä¸èƒ½ä¿è¯è¿™é‡Œçš„å†…å®¹ã€Œæ°¸è¿œæ­£ç¡®ã€ï¼Œä¹Ÿä¸ä¿è¯æ›´æ–°é¢‘ç‡ï¼ŒGo çš„å®˜ç½‘æ‰åº”å½“æ˜¯ä½ æ°¸ç”Ÿçš„æŒšçˆ±ã€‚</p>
<blockquote>
<p>çœŸç›¸æ—¶åˆ»ï¼šæ‰€æœ‰ç»†èŠ‚éƒ½å¿˜äº†ï¼Œéœ€è¦é‡æ–°æ•´ç†...... ğŸ˜­ </p>
</blockquote>
<h2 id="å‚è€ƒ-24"><a class="header" href="#å‚è€ƒ-24">å‚è€ƒ</a></h2>
<ol>
<li><a href="https://www.lijiaocn.com" title="æä½¶æ¾³çš„åšå®¢">æä½¶æ¾³çš„åšå®¢</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="go-è¯­è¨€é¡¹ç›®çš„ä»£ç ç®¡ç†"><a class="header" href="#go-è¯­è¨€é¡¹ç›®çš„ä»£ç ç®¡ç†">Go è¯­è¨€é¡¹ç›®çš„ä»£ç ç®¡ç†</a></h1>
<p>ä¸ºä»€ä¹ˆæŠŠè¿™ä¸€èŠ‚æ”¾åœ¨æœ€å‰é¢ï¼Ÿå› ä¸ºè¿™å°±æ˜¯æœ€é¦–è¦çš„äº‹æƒ…ã€‚</p>
<p>Go é¡¹ç›®çš„æºä»£ç ç®¡ç†æ˜¯ä¸€ä¸ªè€å¤§éš¾çš„é—®é¢˜ï¼ŒRuss Cox åœ¨<a href="https://blog.golang.org/versioning-proposal" title="A Proposal for Package Versioning in Go">ã€ŠA Proposal for Package Versioning in Goã€‹</a>ä¸­è¯¦ç»†ä»‹ç»äº†æ•´ä¸ªè¿‡ç¨‹ï¼šæœ€å¼€å§‹æ¯«æ— åŠæ³•ï¼Œç„¶åé¼“åŠ±ç¤¾åŒºè‡ªå·±è§£å†³ï¼Œäºæ˜¯ godepã€glide ç­‰éåœ°å¼€èŠ±ï¼Œäººäººè‹¦æ¼ï¼Œæœ€å Russ Cox çµæœºä¸€åŠ¨ï¼Œè®¾è®¡äº† go moduleã€‚</p>
<p>ä» 1.13 å¼€å§‹ï¼ŒGOPATH ä¸å†æ˜¯å¿…é¡»çš„ï¼ŒGo çš„é¡¹ç›®ä»£ç å¯ä»¥ä½äºä»»æ„ä½ç½®ï¼Œåªè¦ä½¿ç”¨äº† go moduleã€‚Go blog ç”¨äº†æ•´æ•´ 4 ç¯‡åšå®¢ä»‹ç»å®ƒçš„ç”¨æ³•ï¼š</p>
<ul>
<li><a href="https://blog.golang.org/using-go-modules" title="Using Go Modules">Using Go Modules</a></li>
<li><a href="https://blog.golang.org/migrating-to-go-modules" title="Migrating to Go Modules">Migrating to Go Modules</a></li>
<li><a href="https://blog.golang.org/publishing-go-modules" title="Publishing Go Modules">Publishing Go Modules</a></li>
<li><a href="https://blog.golang.org/v2-go-modules" title="Go Modules: v2 and Beyond">Go Modules: v2 and Beyond</a></li>
</ul>
<p>æŠŠè¿™å››ç¯‡åšå®¢çœ‹å®Œï¼Œå°±å¯ä»¥å‘Šåˆ«æœ¬é¡µäº†ã€‚</p>
<h2 id="è¦è§£å†³çš„é—®é¢˜"><a class="header" href="#è¦è§£å†³çš„é—®é¢˜">è¦è§£å†³çš„é—®é¢˜</a></h2>
<p>æœ€æ—©çš„æ—¶å€™ go get ç›´æ¥ä» github æ‹‰å– master ä¸Šçš„æœ€æ–°ä»£ç ï¼Œé—®é¢˜ç‰¹åˆ«å¤§ï¼Œä»¥è‡³äºå¾ˆå¤šäººçš„è§£å†³æ–¹æ³•æ˜¯æŠŠæ•´ä¸ª GOPATH ç›®å½•ä½œä¸ºé¡¹ç›®ç›®å½•ï¼Œä¾èµ–ä»£ç çš„æ›´æ–°æˆä¸ºå™©æ¢¦ï¼Œä¸çŸ¥é“ä¾èµ–çš„æ˜¯å“ªä¸ªç‰ˆæœ¬ï¼Œè‡³äºä¾èµ–çš„ä¾èµ–é‚£å°±æ›´ !@#$%^&amp;*()......</p>
<p>åæ¥ godepã€glideã€depï¼Œä»¥åŠ vendor ç­‰åˆ†åˆ«è§£å†³äº†ä¾èµ–ä»£ç ç®¡ç†çš„é—®é¢˜ï¼Œä½†æ˜¯ä»…æ­¤è€Œå·²ã€‚åœ¨å¤§å‹é¡¹ç›®ä¸­ï¼Œå¸¸å¸¸ä¼šä½¿ç”¨ä¸€å¥—ä»£ç çš„ä¸åŒç‰ˆæœ¬ï¼Œè¿™æ—¶å€™å‰é¢çš„å„ç§å·¥å…·å°±ã€Œæ‘Šæ‰‹ã€äº†ã€‚</p>
<p>å¦å¤–ï¼Œé¡¹ç›®å¿…é¡»ä½äº GOPATH ä¸­ã€ä»£ç  repo è·å–ç¼“æ…¢å¹¶å ç”¨æœ¬åœ°ç©ºé—´ç­‰é—®é¢˜ä¹Ÿè®©äººçƒ¦æ¼ã€‚</p>
<h2 id="é—®é¢˜è§£å†³æ–¹æ³•"><a class="header" href="#é—®é¢˜è§£å†³æ–¹æ³•">é—®é¢˜è§£å†³æ–¹æ³•</a></h2>
<p>Russ Cox é€šè¿‡å¼•å…¥ç‰ˆæœ¬ç®¡ç†æ–¹æ³• <a href="https://semver.org/" title="Semantic Versioning 2.0.0">Semantic Versioning</a> é™å®šäº†é—®é¢˜ç©ºé—´ï¼Œç„¶åé‡æ–°è®¾è®¡äº†ä¾èµ–ä»£ç çš„ç´¢å¼•å’Œè·å–æ–¹æ³•ï¼Œä»¥åŠæœ¬åœ°ç¼“å­˜æœºåˆ¶ã€‚</p>
<p>ä¾èµ–ä»£ç ä»¥åŠæˆ‘ä»¬è‡ªå·±çš„ Go è¯­è¨€é¡¹ç›®éœ€è¦é‡‡ç”¨ Semantic ç‰ˆæœ¬å‘½åæ³•ï¼Œä¹Ÿå°±æ˜¯ <code>vMAJOR.MINOR.PATCH-suffix</code> ï¼Œçº¦å®šå¦‚ä¸‹ï¼š</p>
<ul>
<li>åªæœ‰ä¸å‘åå…¼å®¹çš„æ—¶å€™ï¼Œè­¬å¦‚ä¿®æ”¹äº† API æ—¶ï¼Œæ‰å¯ä»¥å˜æ›´ä¸»ç‰ˆæœ¬</li>
<li>åŒä¸€ä¸ªä¸»ç‰ˆæœ¬ä¸‹çš„å¤šä¸ªå­ç‰ˆæœ¬ï¼Œå¯¹ç”¨æˆ·è€Œè¨€å¯ä»¥æ— è„‘å‡çº§ï¼Œæ— éœ€é‡æ–°é€‚é…</li>
<li>v0.x.x ç‰ˆæœ¬æ˜¯æœ€è‡ªç”±çš„ç‰ˆæœ¬ï¼Œv1.x.x å¼€å§‹è¦å¯¹ç”¨æˆ·è´Ÿè´£</li>
</ul>
<p>ä½¿ç”¨ Semantic Versioning å¯¹ go module æ¥è¯´å¾ˆé‡è¦ï¼Œ å› ä¸ºå¤šç‰ˆæœ¬ä¾èµ–å»ºç«‹åœ¨è¯¥åŸºç¡€ä¸Šï¼š</p>
<ul>
<li>åŒä¸€å¥—ä»£ç çš„å¤šä¸ªä¸»ç‰ˆæœ¬é€šè¿‡ <code>/vX</code> åç¼€åŒºåˆ†ï¼ˆä» v2 å¼€å§‹éœ€è¦åç¼€ï¼‰</li>
<li>ä¸æ”¯æŒåŒæ—¶å¼•ç”¨åŒä¸€ä¸»ç‰ˆæœ¬çš„å¤šä¸ªå°ç‰ˆæœ¬</li>
</ul>
<p>ä¾‹å¦‚ï¼ŒåŒæ—¶ä¾èµ– rsc.io/quote çš„ v1 å’Œ v3 ç‰ˆæœ¬ï¼Œç”¨ä¸‹é¢çš„æ–¹æ³•ï¼š</p>
<pre><code class="language-go">import (
    &quot;rsc.io/quote&quot;
    quoteV3 &quot;rsc.io/quote/v3&quot;
)
</code></pre>
<p>è¿™ç§åšæ³•æœ‰ä¸€ä¸ªé—®é¢˜ï¼šä¸ºäº†å‘åå…¼å®¹ï¼Œå³å…¼å®¹æ²¡æœ‰ä½¿ç”¨ go module çš„é¡¹ç›®ï¼Œæ–°çš„ä¸»ç‰ˆæœ¬éœ€è¦ç‹¬å ä¸€ä¸ªç›®å½•ã€‚</p>
<p>ä¾‹å¦‚ä¸Šé¢çš„ <a href="https://github.com/rsc/quote" title="rsc.io/quote">rsc.io/quote</a>ï¼š</p>
<p><img src="go/article/../img/rscquote.png" alt="rsc.io/quote" /></p>
<p>v3 ä¸ä»…æ˜¯çœŸå®å­˜åœ¨çš„ç›®å½•ï¼Œè€Œä¸”æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ go moduleï¼Œå®ƒæœ‰è‡ªå·±çš„ v3/go.modï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code class="language-go">module rsc.io/quote/v3

require rsc.io/sampler v1.3.0
</code></pre>
<p>è¿™æ„å‘³ç€å¼€å‘ v3 çš„æ—¶å€™ï¼Œéœ€è¦æŠŠä»£ç æ‹·è´ä¸€ä»½ï¼Œä»£ç ä»“åº“ä¸­ä¼šæœ‰å¾ˆå¤šå†—ä½™ä»£ç ã€‚
å¦‚æœå¼•ç”¨ç«¯ä½¿ç”¨äº† go moduleï¼Œæ˜¯å¦å¯ä»¥é¿å…ä½¿ç”¨ç‹¬ç«‹çš„ä¸»ç‰ˆæœ¬ç›®å½•å‘¢ï¼Ÿä¸‹é¢é€šè¿‡è¯•éªŒéªŒè¯ï¼ŒåŒæ—¶æ¼”ç¤º go module çš„å¸¸è§„ç”¨æ³•ã€‚</p>
<h2 id="å‚è€ƒ-25"><a class="header" href="#å‚è€ƒ-25">å‚è€ƒ</a></h2>
<ol>
<li><a href="https://www.lijiaocn.com" title="æä½¶æ¾³çš„åšå®¢">æä½¶æ¾³çš„åšå®¢</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="go-module-å¤šç‰ˆæœ¬ä¾èµ–åŠŸèƒ½éªŒè¯"><a class="header" href="#go-module-å¤šç‰ˆæœ¬ä¾èµ–åŠŸèƒ½éªŒè¯">go module å¤šç‰ˆæœ¬ä¾èµ–åŠŸèƒ½éªŒè¯</a></h1>
<p>æˆ‘ä»¬è¿™é‡Œè¦åˆ›å»ºçš„ moduleï¼Œå®ƒçš„å¼•ç”¨æ–¹æ³•æ¯”è¾ƒç‰¹æ®Šåˆæ¯”è¾ƒå¸¸è§â€”â€”é€šè¿‡åˆ«åå¼•ç”¨ã€‚</p>
<h2 id="module-åˆå§‹åˆ›å»º"><a class="header" href="#module-åˆå§‹åˆ›å»º">module åˆå§‹åˆ›å»º</a></h2>
<p>åœ¨ç›®å½• go_mod_example_pkg ä¸­åˆ›å»ºåä¸º lijiaocn.com/go/example/mod çš„ moduleï¼š</p>
<pre><code class="language-sh">$ mkdir go_mod_example_pkg
$ cd go_mod_example_pkg
$ go mod init lijiaocn.com/go/example/mod
go: creating new go.mod: module lijiaocn.com/go/example/mod
</code></pre>
<p>åªåœ¨ version.go ä¸­å®ç°ä¸€ä¸ªæ‰“å°ç‰ˆæœ¬å·çš„å‡½æ•°ï¼Œç¬¬ä¸€ä¸ªç‰ˆæœ¬æ˜¯ v0.0.0ï¼š</p>
<pre><code class="language-go">package mod

func Version() {
    println(&quot;v0.0.0&quot;)
}
</code></pre>
<p>ä¸Šä¼ åˆ° github <a href="https://github.com/introclass/go_mod_example_pkg.git" title="introclass/go_mod_example_pkg">introclass/go_mod_example_pkg</a>ã€‚</p>
<p>ç„¶åå°† println(&quot;v0.0.0&quot;) ä¿®æ”¹ä¸º println(&quot;v1.0.0&quot;) ï¼Œå‘å¸ƒ v1 ç‰ˆæœ¬ï¼š</p>
<pre><code class="language-sh">$ git add .
$ git commit -m &quot;release v1.0.0&quot;
$ git push
$ git tag v1.0.0
$ git push origin v1.0.0
</code></pre>
<p>ç„¶åæŒ‰ç…§å…¼å®¹ GOPATH çš„æ–¹å¼ï¼Œåˆ›å»º v2 ç‰ˆæœ¬ï¼š</p>
<pre><code class="language-sh">$ mkdir v2
$ cd v2
$ go mod init lijiaocn.com/go/example/mod/v2
</code></pre>
<p>åœ¨ v2 ç›®å½•ä¸­é‡æ–°å®ç° version.goï¼š</p>
<pre><code class="language-go">package v2

func Version() {
    println(&quot;v2.0.0&quot;)
}
</code></pre>
<p>æäº¤ä»£ç ï¼Œæ‰“æ ‡ç­¾ï¼Œå‘å¸ƒ v2.0.0ï¼š</p>
<pre><code class="language-sh">$ git add .
$ git commit -m &quot;release v2.0.0&quot;
$ git push
$ git tag v2.0.0
$ git push origin v2.0.0
</code></pre>
<p>æœ€åä¸ºäº†éªŒè¯ä¸ä½¿ç”¨ç‹¬ç«‹ä¸»ç‰ˆæœ¬ç›®å½•çš„æ•ˆæœï¼Œç›´æ¥ä¿®æ”¹ version.goï¼Œå‘å¸ƒ v3.0.0 ç‰ˆæœ¬ï¼š</p>
<pre><code class="language-sh">$ git add .
$ git commit -m &quot;release v3.0.0&quot;
$ git push
$ git tag v3.0.0
$ git push origin v3.0.0
</code></pre>
<h2 id="module-åˆ«åè®¾ç½®"><a class="header" href="#module-åˆ«åè®¾ç½®">module åˆ«åè®¾ç½®</a></h2>
<p>ä¸Šé¢åˆ›å»ºçš„ module ç°åœ¨è¿˜ä¸èƒ½é€šè¿‡ lijiaocn.com/go/example/mod å¼•ç”¨ï¼Œéœ€è¦è¿›è¡Œé¢å¤–è®¾ç½®ã€‚</p>
<p>å¼•ç”¨ github ä¸Šçš„ä»£ç é€šå¸¸ä½¿ç”¨ &quot;import github.com/xxx/xxx&quot; çš„å½¢å¼ï¼Œimport æŒ‡ä»¤åé¢æ˜¯ repo è·¯å¾„ã€‚</p>
<p>ä½†æ˜¯ä½ ä¸€å®šé‡åˆ°è¿™ç§æƒ…å†µï¼Œé¡¹ç›®åœ¨ github ä¸Šï¼Œä½†æ˜¯ import ä½¿ç”¨çš„æ˜¯å¦ä¸€ä¸ªè·¯å¾„ï¼ˆåˆ«åï¼‰ã€‚
è­¬å¦‚ä¸Šä¸€èŠ‚ä¸­çš„ <a href="https://github.com/rsc/quote" title="rsc.io/quote">rsc.io/quote</a> ä»£ç è·¯å¾„æ˜¯ &quot;github.com/rsc/quote&quot;ï¼Œå¼•ç”¨æ—¶ç”¨çš„æ˜¯ &quot;rsc.io/quote&quot;ï¼š</p>
<pre><code class="language-go">import (
    &quot;rsc.io/quote&quot;
    quoteV3 &quot;rsc.io/quote/v3&quot;
)
</code></pre>
<p>è¿™æ˜¯æ€æ ·åšåˆ°çš„ï¼Ÿ</p>
<p>åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ <a href="https://rsc.io/quote">https://rsc.io/quote </a> ä¸ä¼šæœ‰ä»»ä½•æ”¶è·ï¼Œè¦ç”¨ä¸‹é¢çš„æ–¹æ³•æ‰èƒ½å‘ç°ç«¯å€ªï¼š</p>
<pre><code class="language-sh">$ curl  https://rsc.io/quote/v3 |grep go-import
&lt;meta name=&quot;go-import&quot; content=&quot;rsc.io/quote git https://github.com/rsc/quote&quot;&gt;
</code></pre>
<p>åä¸º go-import çš„ meta æ ‡ç­¾çš„ content ä¸­åŒ…å« git ä»“åº“åœ°å€ï¼Œè¿™æ˜¯ go get çš„èƒ½åŠ›ä¹‹ä¸€ï¼šä» meta ä¸­è·å– repo åœ°å€ï¼Œè¯¦æƒ…è§ <a href="https://golang.org/cmd/go/#hdr-Remote_import_paths" title="Remote import paths">Remote import paths</a>ã€‚</p>
<p>è¦é€šè¿‡ lijiaocn.com/go/example/mod åç§°å¼•ç”¨å‰é¢çš„ moduleï¼Œéœ€è¦åœ¨ç«™ç‚¹ lijiaocn.com ä¸­åˆ›å»ºä¸‹é¢çš„æ–‡ä»¶ï¼š</p>
<pre><code class="language-sh">$ mkdir -p go/example/mod
$ cat &lt;&lt;EOF &gt; go/example/mod/index.html
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;/&gt;
&lt;meta name=&quot;go-import&quot; content=&quot;lijiaocn.com/go/example/mod git https://github.com/introclass/go_mod_example_pkg&quot;&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;p&gt;codes at: &lt;a href=&quot;https://github.com/introclass/go_mod_example_pkg&quot;&gt;https://github.com/introclass/go_mod_example_pkg&lt;/a&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
EOF
</code></pre>
<h2 id="module-å¼•ç”¨æ•ˆæœ"><a class="header" href="#module-å¼•ç”¨æ•ˆæœ">module å¼•ç”¨æ•ˆæœ</a></h2>
<p>å‰æœŸå·¥ä½œå‡†å¤‡å®Œæˆï¼Œç°åœ¨éªŒè¯æ•ˆæœã€‚</p>
<pre><code class="language-sh">$ mkdir usemod
$ cd usemod 
$ go mod init usemod
</code></pre>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-go">package main

import &quot;lijiaocn.com/go/example/mod&quot;

func main() {
    mod.Version()
}
</code></pre>
<p>ä¸æŒ‡å®šç‰ˆæœ¬å·æ—¶ï¼š</p>
<pre><code class="language-sh">$ go get lijiaocn.com/go/example/mod
</code></pre>
<p>æ‰§è¡Œç»“æœä¸º v1.0.0ï¼š</p>
<pre><code class="language-sh">$ go run main.go 
v1.0.0
</code></pre>
<p>æ€€ç–‘ä¸æŒ‡å®šç‰ˆæœ¬å·æ—¶ï¼Œé»˜è®¤ä½¿ç”¨ v1 ä¸»ç‰ˆæœ¬çš„æœ€æ–°ç‰ˆæœ¬ï¼ŒæŒ‰ä¸Šä¸€èŠ‚çš„æ­¥éª¤åŠ ä¸€ä¸ª v1.1.0 ç‰ˆæœ¬åï¼š</p>
<pre><code class="language-sh">$ go get lijiaocn.com/go/example/mod
go: finding lijiaocn.com/go/example/mod v1.1.0
</code></pre>
<p>æœç„¶ï¼Œç›®æ ‡ module ä¸­çš„ v2.0.0 å’Œ v3.0.0 è¢«ç›´æ¥æ— è§†ï¼Œä½¿ç”¨çš„æ˜¯ v1 çš„æœ€æ–°ç‰ˆæœ¬ã€‚</p>
<p>å°è¯•å¼•ç”¨ v3.0.0 ç‰ˆæœ¬ï¼Œç»“æœå‡ºé”™ï¼Œå¿…é¡»è¦æœ‰ /v3 ï¼ˆ <strong>ç¬¬ä¸€ä¸ªç»“è®º</strong> ï¼‰ï¼š</p>
<pre><code class="language-sh">$ go get lijiaocn.com/go/example/mod@v3.0.0
go: finding lijiaocn.com/go/example/mod v3.0.0
go get lijiaocn.com/go/example/mod@v3.0.0: lijiaocn.com/go/example/mod@v3.0.0: invalid version: module contains a go.mod file, so major version must be compatible: should be v0 or v1, not v3
</code></pre>
<p>ä½¿ç”¨ v2 å’Œ v3 åç¼€ï¼Œéœ€è¦ä¸º v2 å’Œ v3 å‡†å¤‡ä¸€ä¸ª index.htmlï¼ˆ <strong>åŒä¸€ä¸ª repo ä¸éœ€è¦ä¿®æ”¹</strong> ï¼‰ï¼š</p>
<pre><code class="language-sh">$ mkdir go/example/mod/v3
$ cp go/example/mod/index.html go/example/mod/v2
$ cp go/example/mod/index.html go/example/mod/v3
</code></pre>
<p>åŒæ—¶å¼•ç”¨ v1 å’Œ v2ï¼š</p>
<pre><code class="language-go">package main

import &quot;lijiaocn.com/go/example/mod&quot;
import &quot;lijiaocn.com/go/example/mod/v2&quot;

func main() {
    mod.Version()
    v2.Version()
}
</code></pre>
<p>è¿è¡Œç»“æœï¼š</p>
<pre><code class="language-sh">$ go run main.go 
v1.1.0
v2.0.0
</code></pre>
<p>æœ€åæµ‹è¯•ä¸‹æ²¡æœ‰ç‹¬ç«‹ç›®å½•çš„ v3 æ˜¯å¦èƒ½å¼•ç”¨ï¼š</p>
<pre><code class="language-go">package main

import &quot;lijiaocn.com/go/example/mod&quot;
import &quot;lijiaocn.com/go/example/mod/v2&quot;
import &quot;lijiaocn.com/go/example/mod/v3&quot;

func main() {
    mod.Version()
    v2.Version()
    v3.Version()
}
</code></pre>
<p>ç»“è®ºæ˜¯ä¸å¯ä»¥ï¼Œå¿…é¡»è¦æœ‰ç‹¬ç«‹ç›®å½•ï¼š</p>
<pre><code class="language-sh">$ go run main.go 
go: finding lijiaocn.com/go/example/mod/v3 v3.0.0
build command-line-arguments: cannot load lijiaocn.com/go/example/mod/v3: 
    module lijiaocn.com/go/example/mod@latest (v1.1.0) found, 
    but does not contain package lijiaocn.com/go/example/mod/v3
</code></pre>
<p>ä¸Šä¸€èŠ‚æå‡ºçš„é—®é¢˜ç­”æ¡ˆï¼šv1 ä¹‹åçš„ä¸»ç‰ˆæœ¬éƒ½å¿…é¡»æœ‰ç‹¬ç«‹çš„ç›®å½•ï¼Œrepo ä¸­ä»£ç å†—ä½™ä¸å¯é¿å…ï¼Œè‡³å°‘ç°é˜¶æ®µ go 1.13 æ˜¯è¿™æ ·çš„ï¼ˆ2019-12-31 16:53:07ï¼‰ã€‚</p>
<h2 id="å‚è€ƒ-26"><a class="header" href="#å‚è€ƒ-26">å‚è€ƒ</a></h2>
<ol>
<li><a href="https://www.lijiaocn.com" title="æä½¶æ¾³çš„åšå®¢">æä½¶æ¾³çš„åšå®¢</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="æµ‹è¯•ç”¨ä¾‹çš„è¦†ç›–ç‡"><a class="header" href="#æµ‹è¯•ç”¨ä¾‹çš„è¦†ç›–ç‡">æµ‹è¯•ç”¨ä¾‹çš„è¦†ç›–ç‡</a></h1>
<p>Go è¯­è¨€åœ¨è®¾è®¡çš„æ—¶å€™å°±è€ƒè™‘åˆ°å·¥ç¨‹å®è·µï¼Œèå…¥äº†æ³¨é‡Šæ–‡æ¡£ã€å•å…ƒæµ‹è¯•å’ŒåŸºå‡†æµ‹è¯•ç­‰è½¯ä»¶å·¥ç¨‹ä¸­çš„æŠ€æœ¯ï¼Œä¸Šä¸€èŠ‚æåˆ°çš„ä»£ç ç»„ç»‡æ–¹æ³•ä¹Ÿæ˜¯è½¯ä»¶å·¥ç¨‹æ€æƒ³çš„ä½“ç°ã€‚åœ¨è¯­è¨€å±‚é¢ç»Ÿä¸€å·¥å…·å’Œæ–¹æ³•ï¼Œæå¤§åœ°æé«˜äº†åä½œæ•ˆç‡ã€‚</p>
<p>å•å…ƒæµ‹è¯•æ˜¯å·¥ä½œä»£ç ä¹‹å¤–æœ€é‡è¦çš„å†…å®¹ï¼Œ Go è¯­è¨€å¤©ç”Ÿæ”¯æŒã€‚æµ‹è¯•ç”¨ä¾‹çš„å†™æ³•åªè¦çœ‹å‡ ä¸ªä¾‹å­å°±å­¦ä¼šäº†ï¼Œè­¬å¦‚ä¸‹é¢è¿™ä¸ªæœ€ç®€å•å‡½æ•°åŠŸèƒ½æµ‹è¯•ã€‚</p>
<p><strong>ç›®æ ‡æ–‡ä»¶ funcs.goï¼š</strong></p>
<pre><code class="language-go">package testcase

func SumSlice(nums []int) int {
    sum := 0
    for _,v := range nums{
        sum=sum+v
    }
    return sum
}

func SumArray(nums [10]int) int{
    sum := 0
    for _,v := range nums{
        sum=sum+v
    }
    return sum
}
</code></pre>
<p><strong>æµ‹è¯•ç”¨ä¾‹ funcs_test.goï¼š</strong></p>
<pre><code class="language-go">package testcase

import (
    &quot;testing&quot;
)

func TestSumSlice(t *testing.T) {
    arrays := []int{0, 1, 2, 3, 4, 5, 6, 7, 8, 9}
    expect := 45
    sum := SumSlice(arrays[:])
    if sum != expect {
        t.Errorf(&quot;result is %d (should be %d)&quot;, sum, expect)
    }
}
</code></pre>
<p>ç„¶åé‡ç‚¹æ¥äº†ï¼Œæ‰§è¡Œ go test åªä¼šå‘ŠçŸ¥æµ‹è¯•æ˜¯å¦é€šè¿‡ï¼š</p>
<pre><code class="language-go">$ go test       
PASS
ok      go-code-example/testcase        0.806s
</code></pre>
<p>å¼ºå¤§çš„æ˜¯ -coverï¼Œå¯ä»¥å‘ŠçŸ¥æµ‹è¯•è¦†ç›–ç‡ï¼š</p>
<pre><code class="language-go">$ go test -cover
PASS
coverage: 50.0% of statements
ok      go-code-example/testcase        0.306s
</code></pre>
<p>ä¸Šé¢çš„æµ‹è¯•ç”¨ä¾‹è¦†ç›–ç‡åªæœ‰ 50%ï¼Œç”¨ä¸‹é¢çš„æ–¹æ³•æŸ¥çœ‹æ²¡æœ‰è¦†ç›–çš„ä»£ç ï¼š</p>
<pre><code class="language-go">$ go test -coverprofile=coverage.out 
$ go tool cover -html=coverage.out  
</code></pre>
<p><img src="go/article/../img/cover.png" alt="æµ‹è¯•è¦†ç›–æƒ…å†µ" /></p>
<p>æµ‹è¯•è¦†ç›–ç‡çš„è¯¦ç»†è¯´æ˜è§ <a href="https://blog.golang.org/cover" title="The cover story">The cover story</a>ã€‚</p>
<h2 id="å‚è€ƒ-27"><a class="header" href="#å‚è€ƒ-27">å‚è€ƒ</a></h2>
<ol>
<li><a href="https://www.lijiaocn.com" title="æä½¶æ¾³çš„åšå®¢">æä½¶æ¾³çš„åšå®¢</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="go-è¯­è¨€æŒ‰å€¼ä¼ é€’çš„å¼€é”€å¾ˆå¤§"><a class="header" href="#go-è¯­è¨€æŒ‰å€¼ä¼ é€’çš„å¼€é”€å¾ˆå¤§">Go è¯­è¨€æŒ‰å€¼ä¼ é€’çš„å¼€é”€å¾ˆå¤§</a></h1>
<p>Go è¯­è¨€æ‰€æœ‰çš„å‚æ•°éƒ½æ˜¯æŒ‰å€¼ä¼ é€’ï¼ŒGo è¯­è¨€ä¸­æ‰€æœ‰çš„å˜é‡éƒ½æ˜¯å€¼ï¼Œç‰¹åˆ«æ˜¯æ•°ç»„ä¹Ÿæ˜¯å€¼ã€‚</p>
<h2 id="æ•°ç»„ä¹ŸæŒ‰å€¼ä¼ é€’"><a class="header" href="#æ•°ç»„ä¹ŸæŒ‰å€¼ä¼ é€’">æ•°ç»„ä¹ŸæŒ‰å€¼ä¼ é€’</a></h2>
<p>å¦‚æœæŠŠä¸€ä¸ªæ•°ç»„ä½œä¸ºå‚æ•°ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°ç»„ä¼šè¢«å®Œæ•´çš„æ‹·è´ä¸€ä»½ï¼Œæ‰§è¡Œæ•ˆç‡ä¼šä¸¥é‡é™ä½ã€‚</p>
<p>ä»¥å‰é¢ç”¨åˆ°çš„ funcs.go ä¸ºä¾‹ï¼š</p>
<pre><code class="language-go">package testcase

func SumSlice(nums []int) int {
    sum := 0
    for _,v := range nums{
        sum=sum+v
    }
    return sum
}

func SumArray(nums [10]int) int{
    sum := 0
    for _,v := range nums{
        sum=sum+v
    }
    return sum
}
</code></pre>
<p>å†™ä¸¤ä¸ªåŸºå‡†æµ‹è¯•å‡½æ•°ï¼š</p>
<pre><code class="language-go">package testcase

import (
    &quot;testing&quot;
)

func TestSumSlice(t *testing.T) {
    arrays := [10]int{0, 1, 2, 3, 4, 5, 6, 7, 8, 9}
    expect := 45
    sum := SumSlice(arrays[:])
    if sum != expect {
        t.Errorf(&quot;result is %d (should be %d)&quot;, sum, expect)
    }
}

func BenchmarkSumSlice(b *testing.B) {
    arrays := [10]int{0, 1, 2, 3, 4, 5, 6, 7, 8, 9}
    s := arrays[:]
    for i := 0; i &lt; b.N; i++ {
        SumSlice(s)
    }
}

func BenchmarkSumArray(b *testing.B) {
    arrays := [10]int{0, 1, 2, 3, 4, 5, 6, 7, 8, 9}
    for i := 0; i &lt; b.N; i++ {
        SumArray(arrays)
    }
}
</code></pre>
<p>åŸºå‡†æµ‹è¯•ç»“æœå¦‚ä¸‹ç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code class="language-sh">goos: darwin
goarch: amd64
pkg: go-code-example/testcase
BenchmarkSumSlice-4   	161025976	         6.67 ns/op
BenchmarkSumArray-4   	90106534	        13.9 ns/op
</code></pre>
<p>å¯ä»¥çœ‹åˆ°åœ¨æ•°ç»„é•¿åº¦åªæœ‰ 10 çš„æƒ…å†µä¸‹ï¼Œ SumSlice å’Œ SumArray çš„æ‰§è¡Œæ•ˆç‡å°±å·²ç»ç›¸å·®æ‚¬æ®Šã€‚</p>
<h2 id="å‚è€ƒ-28"><a class="header" href="#å‚è€ƒ-28">å‚è€ƒ</a></h2>
<ol>
<li><a href="https://www.lijiaocn.com" title="æä½¶æ¾³çš„åšå®¢">æä½¶æ¾³çš„åšå®¢</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="go-å¹¶å‘ä¸æŒ‰å€¼ä¼ é€’å¼•å‘çš„è¡€æ¡ˆ"><a class="header" href="#go-å¹¶å‘ä¸æŒ‰å€¼ä¼ é€’å¼•å‘çš„è¡€æ¡ˆ">Go å¹¶å‘ä¸æŒ‰å€¼ä¼ é€’å¼•å‘çš„è¡€æ¡ˆ</a></h1>
<p>å‰æ®µæ—¶é—´å‡ºå»é¢è¯•çš„æ—¶å€™ï¼Œè¢«ä¸€é“é¢˜éš¾ä½äº†ï¼Œé—®ä¸‹é¢è¿™æ®µä»£ç çš„è¿è¡Œè¾“å‡ºæ˜¯ä»€ä¹ˆï¼š</p>
<pre><code class="language-go">func wg1() {
    wg := sync.WaitGroup{}

    for i := 0; i &lt; 10; i++ {
        go func(wg sync.WaitGroup) {
            wg.Add(1)
            println(i)
            wg.Done()
        }(wg)
    }
    wg.Wait()
}
</code></pre>
<p>å½“æ—¶æ²¡æœ‰ææ¸…æ¥š sync.WaitGroup çš„ç‰¹æ€§ï¼Œç»“æœå¾ˆå°´å°¬ã€‚é¢è¯•å®˜ç»™çš„ç­”æ¡ˆæ˜¯æ²¡æœ‰ä»»ä½•è¾“å‡ºï¼ŒåŸå› æ˜¯ wg æŒ‰å€¼ä¼ é€’ã€‚äº‹å®ä¸Šï¼Œæƒ…å†µä¸æ˜¯è¿™ä¹ˆç®€å•ï¼Œæ­£ç¡®çš„ç­”æ¡ˆæ˜¯ã€Œä¸ç¡®å®šã€ï¼Œå¯èƒ½æ²¡æœ‰è¾“å‡ºï¼Œå¯èƒ½æ‰“å°å°‘äº 10 ä¸ªæ•°å­—ï¼Œå¯èƒ½æ‰“å°äº†å‡ ä¸ªé‡å¤çš„æ•°å­—ã€‚</p>
<p>è¿™æ®µä»£ç çš„é—®é¢˜å¾ˆå¤§ï¼Œæ¶‰åŠæŒ‰å€¼ä¼ é€’ã€å¹¶å‘ï¼Œä»¥åŠå˜é‡ä½œç”¨åŸŸç­‰æ–¹é¢çš„å†…å®¹ï¼Œæ”¹äº†å‡ æ¬¡æ‰æ”¹å‡ºæ­£ç¡®çš„ä»£ç ã€‚</p>
<h2 id="wg2ä¸ä»…ä»…æ˜¯ä¼ å€¼çš„é—®é¢˜"><a class="header" href="#wg2ä¸ä»…ä»…æ˜¯ä¼ å€¼çš„é—®é¢˜">wg2()ï¼šä¸ä»…ä»…æ˜¯ä¼ å€¼çš„é—®é¢˜</a></h2>
<p>å¦‚æœåªæ˜¯æŒ‰å€¼ä¼ é€’çš„é—®é¢˜ï¼Œå³ wg è¢«å¤åˆ¶äº† 10 ä»½å¯¼è‡´ wg.Wait() æ²¡æœ‰ç­‰å¾…ï¼Œé‚£ä¹ˆæ¢ç”¨æŒ‡é’ˆåº”è¯¥èƒ½è§£å†³é—®é¢˜ï¼š</p>
<pre><code class="language-go">func wg2() {
    wg := sync.WaitGroup{}

    for i := 0; i &lt; 10; i++ {
        go func(wg *sync.WaitGroup) {
            wg.Add(1)
            println(i)
            wg.Done()
        }(&amp;wg)
    }
    wg.Wait()
}
</code></pre>
<p>ç»“è®ºæ˜¯ä¸è¡Œï¼è¿è¡Œç»“æœä¸ç¨³å®šï¼Œæ•°å­—æœ‰é‡å¤ï¼Œè€Œä¸”æœ‰æ—¶è¿˜ä¼š panicï¼š</p>
<pre><code class="language-sh">$ ./waitgroup
10
10
10
10
10

$ ./waitgroup
8
10
10
...

panic: sync: WaitGroup is reused before previous Wait has returned
</code></pre>
<h2 id="wg3ç®€åŒ–åœºæ™¯ç›´æ¥ä½¿ç”¨-wg"><a class="header" href="#wg3ç®€åŒ–åœºæ™¯ç›´æ¥ä½¿ç”¨-wg">wg3()ï¼šç®€åŒ–åœºæ™¯ç›´æ¥ä½¿ç”¨ wg</a></h2>
<p>å…ˆç®€åŒ–åœºæ™¯ï¼ŒæŠŠæŒ‰å€¼ä¼ é€’çš„é—®é¢˜æ’é™¤ï¼Œç›´æ¥ä½¿ç”¨ wgï¼š</p>
<pre><code class="language-go">func wg3() {
    wg := sync.WaitGroup{}

    for i := 0; i &lt; 10; i++ {
        go func() {
            wg.Add(1)
            println(i)
            wg.Done()
        }()
    }
    wg.Wait()
}
</code></pre>
<p><strong>å¤§å¤šæ•°æƒ…å†µä¸‹</strong> ä¼šæ‰“å° 10 ä¸ªæ•°å­—ï¼Œä½†æ˜¯æ•°å­—æœ‰é‡å¤ï¼š</p>
<pre><code class="language-go">$ ./waitgroup
4
4
4
10
10
10
10
10
10
10
</code></pre>
<p><strong>è¿™æ®µä»£ç åœ¨ goroutine æ–¹é¢è¿˜æ˜¯æœ‰é—®é¢˜çš„ï¼Œwg5() ä¸­è¯´æ˜</strong></p>
<h2 id="wg4i-é€šè¿‡å‚æ•°ä¼ é€’æ¶ˆé™¤é‡å¤"><a class="header" href="#wg4i-é€šè¿‡å‚æ•°ä¼ é€’æ¶ˆé™¤é‡å¤">wg4()ï¼ši é€šè¿‡å‚æ•°ä¼ é€’ï¼Œæ¶ˆé™¤é‡å¤</a></h2>
<p>wg3() æœ‰ä¸¤ä¸ªé—®é¢˜ï¼Œç¬¬ä¸€è¾“å‡ºçš„æ•°å­—é‡å¤ï¼Œç¬¬äºŒå¶å°”è¾“å‡ºçš„æ•°å­—ä¸è¶³ 10 ä¸ªï¼Œå…ˆè§£å†³æ•°å­—é‡å¤çš„é—®é¢˜ã€‚</p>
<p>æ•°å­—é‡å¤æ˜¯å› ä¸º goroutine ä¸­ç›´æ¥ä½¿ç”¨äº†å˜é‡ iï¼Œæ‰“å°çš„æ˜¯ goroutine æ‰§è¡Œæ—¶çš„ i å€¼ï¼Œè€Œä¸æ˜¯åˆ›å»º goroutine æ—¶çš„ i å€¼ã€‚</p>
<p>å°† i æ”¹ä¸ºå‚æ•°ä¼ é€’ï¼š</p>
<pre><code class="language-go">func wg4() {
    wg := sync.WaitGroup{}

    for i := 0; i &lt; 10; i++ {
        go func(i int) {
            wg.Add(1)
            println(i)
            wg.Done()
        }(i)
    }
    wg.Wait()
}
</code></pre>
<p>è¿™æ—¶å€™ï¼Œè¾“å‡ºç»“æœä¸­æ²¡æœ‰é‡å¤çš„æ•°å­—ï¼š</p>
<pre><code class="language-sh">$ ./waitgroup
1
6
5
7
0
4
2
8
3
9
</code></pre>
<p>ç¬¬äºŒä¸ªé—®é¢˜æ²¡æœ‰è§£å†³ï¼Œæœ‰æ—¶å€™è¾“å‡ºçš„æ•°å­—ä¸è¶³ 10 ä¸ªï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="language-sh">$ ./waitgroup
0
2
1
$ ./waitgroup
1%
</code></pre>
<h2 id="wg5å°†-wg-çš„æ“ä½œç§»å‡º-goroutine"><a class="header" href="#wg5å°†-wg-çš„æ“ä½œç§»å‡º-goroutine">wg5()ï¼šå°† wg çš„æ“ä½œç§»å‡º goroutine</a></h2>
<p>wg3() å’Œ wg4() ä¸­çš„ä¸»å‡½æ•°æœ‰å¯èƒ½åœ¨ goroutine ä¹‹å‰é€€å‡ºï¼Œå¯¼è‡´è¾“å‡ºçš„æ•°å­—ä¸è¶³ 10 ä¸ªã€‚ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Œwg.wait() æ— æ•ˆå—ï¼Ÿ</p>
<p>é—®é¢˜åœ¨äº wg.Add() çš„æ‰§è¡Œæ—¶æœºï¼Œä»”ç»†çœ‹ wg3() å’Œ wg4() ä¸­çš„ wg.Add()ï¼Œå®ƒæ˜¯åœ¨ goroutine ä¸­æ‰§è¡Œçš„ã€‚</p>
<p>å› ä¸º goroutine æ˜¯å¹¶å‘çš„ï¼Œwg.Add() è¿˜æ²¡æ‰§è¡Œ, ä¸»å‡½æ•°å¯èƒ½å°±æ‰§è¡Œåˆ°äº† wg.wait() ï¼Œä»è€Œç›´æ¥é€€å‡ºã€‚</p>
<p>éœ€è¦å°† wg.Add() ç§»å‡º goroutineï¼Œç¡®ä¿ wg.Wait() æœ‰æ•ˆï¼Œæ³¨æ„ wg.Done() ä¸èƒ½ç§»å‡ºï¼Œå¦åˆ™ä¸»å‡½æ•°åˆä¼šå…ˆäº goroutine é€€å‡ºï¼š</p>
<pre><code class="language-go">func wg5() {
    wg := sync.WaitGroup{}

    for i := 0; i &lt; 10; i++ {
        wg.Add(1)
        go func(i int) {
            println(i)
            wg.Done()
        }(i)
    }
    wg.Wait()
}
</code></pre>
<p>è¿™æ—¶å€™ç¨³å®šè¾“å‡º 10 ä¸ªä¸é‡å¤çš„æ•°å­—ï¼Œæ•°å­—ä¸æ˜¯é€’å¢æ’åˆ—ï¼Œå› ä¸º goroutine å¹¶å‘æ‰§è¡Œï¼Œé¡ºåºä¸å›ºå®šï¼š</p>
<pre><code class="language-go">1
0
4
3
5
6
9
7
8
2
</code></pre>
<h2 id="wg6é‡æ–°ç”¨æŒ‡é’ˆä¼ é€’"><a class="header" href="#wg6é‡æ–°ç”¨æŒ‡é’ˆä¼ é€’">wg6()ï¼šé‡æ–°ç”¨æŒ‡é’ˆä¼ é€’</a></h2>
<p>å›é¡¾ wg2()ï¼Œå› ä¸ºä¸ç¡®å®šæŒ‡é’ˆçš„æ•ˆç”¨ï¼Œwg3()~wg5() ä¸­æ²¡æœ‰ä½¿ç”¨æŒ‡é’ˆï¼Œåœ¨ç®€åŒ–çš„åœºæ™¯ä¸‹è§£å†³äº†å¹¶å‘å’Œæ•°å­—é‡å¤çš„é—®é¢˜ã€‚</p>
<p>ç°åœ¨éªŒè¯ä¸€ä¸‹ä½¿ç”¨æŒ‡é’ˆæ˜¯å¦å¯è¡Œï¼š</p>
<pre><code class="language-go">func wg6() {
    wg := sync.WaitGroup{}

    for i := 0; i &lt; 10; i++ {
        wg.Add(1)
        go func(i int, wg *sync.WaitGroup) {
            println(i)
            wg.Done()
        }(i, &amp;wg)
    }
    wg.Wait()
}
</code></pre>
<p>ç»“è®ºæ˜¯å¯ä»¥ï¼Œè€Œä¸”è¿™ç§æƒ…å†µä¸‹å¿…é¡»ä½¿ç”¨æŒ‡é’ˆï¼Œå¦‚æœä¸ç”¨æŒ‡é’ˆæ˜¯æœ‰é—®é¢˜çš„ã€‚</p>
<p>å¦‚æœä¸ç”¨æŒ‡é’ˆï¼Œgoroutine ä¸­çš„ wg.Done() æ˜¯æ— æ•ˆçš„ï¼Œå› ä¸º goroutine ä¸­çš„ wg æ˜¯ä¸€ä¸ªå‰¯æœ¬ï¼Œç»“æœä¼šæ˜¯è¿™æ ·ï¼š</p>
<pre><code class="language-sh">1
0
5
2
9
6
4
8
7
3
fatal error: all goroutines are asleep - deadlock!

goroutine 1 [semacquire]:
sync.runtime_Semacquire(0xc000068008)
	/Users/lijiao/Work/Bin/go-1.13/go/src/runtime/sema.go:56 +0x42
sync.(*WaitGroup).Wait(0xc000068000)
	/Users/lijiao/Work/Bin/go-1.13/go/src/sync/waitgroup.go:130 +0x64
main.wg7()
	/Users/lijiao/Work/go-code-example/waitgroup/waitgroup.go:97 +0xbb
main.main()
	/Users/lijiao/Work/go-code-example/waitgroup/waitgroup.go:107 +0x20

Process finished with exit code 2
</code></pre>
<h2 id="å‚è€ƒ-29"><a class="header" href="#å‚è€ƒ-29">å‚è€ƒ</a></h2>
<ol>
<li><a href="https://www.lijiaocn.com" title="æä½¶æ¾³çš„åšå®¢">æä½¶æ¾³çš„åšå®¢</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="go-è¯­è¨€ç¨‹åºè¿è¡Œæ—¶è·Ÿè¸ªè°ƒè¯•"><a class="header" href="#go-è¯­è¨€ç¨‹åºè¿è¡Œæ—¶è·Ÿè¸ªè°ƒè¯•">Go è¯­è¨€ç¨‹åºè¿è¡Œæ—¶è·Ÿè¸ªè°ƒè¯•</a></h1>
<p><a href="https://github.com/go-delve/delve" title="delve">delve</a> æ˜¯ç°é˜¶æ®µæœ€å¥½ç”¨çš„è·Ÿè¸ªè°ƒè¯•å·¥å…·ï¼Œæ”¯æŒ Linux å’Œ macOSï¼Œæ˜¯ GoLand ä½¿ç”¨çš„è°ƒè¯•å·¥å…·ã€‚</p>
<p>ï¼ˆ2020-01-01 19:27:25ï¼‰</p>
<p>macOS ä¸Šå®‰è£… delveï¼š</p>
<pre><code class="language-sh">$ xcode-select --install  # å¦‚æœå·²ç»å®‰è£…äº† xcode å·¥å…·ï¼Œè¿™ä¸€æ­¥ä¸éœ€è¦
$ go get -u github.com/go-delve/delve/cmd/dlv
</code></pre>
<pre><code class="language-sh">Usage:
  dlv [command]

Available Commands:
  attach      Attach to running process and begin debugging.
  connect     Connect to a headless debug server.
  core        Examine a core dump.
  debug       Compile and begin debugging main package in current directory, or the package specified.
  exec        Execute a precompiled binary, and begin a debug session.
  help        Help about any command
  run         Deprecated command. Use 'debug' instead.
  test        Compile test binary and begin debugging program.
  trace       Compile and begin tracing program.
  version     Prints version.
</code></pre>
<h2 id="ç›®æ ‡ç¨‹åº"><a class="header" href="#ç›®æ ‡ç¨‹åº">ç›®æ ‡ç¨‹åº</a></h2>
<p>å†™ä¸€ä¸ªè¶…çº§ç®€å•çš„å°ç¨‹åºä½œä¸ºè·Ÿè¸ªè°ƒè¯•ç›®æ ‡ï¼š</p>
<pre><code class="language-go">package main

import (
    &quot;fmt&quot;
    &quot;time&quot;
)

func Write(num int, c chan int) {
    for {
        c &lt;- num
    }
}

func main() {
    c := make(chan int)
    go Write(10, c)
    go Write(20, c)
    for {
        select {
        case v := &lt;-c:
            fmt.Printf(&quot;receive %d\n&quot;, v)
            time.Sleep(2 * time.Second)
        }
    }
}
</code></pre>
<h2 id="dlv-è°ƒè¯•"><a class="header" href="#dlv-è°ƒè¯•">dlv è°ƒè¯•</a></h2>
<p>ç”¨ dlv attach æ­£åœ¨è¿è¡Œä¸­çš„è¿›ç¨‹ï¼ˆattach åè¿›ç¨‹ä¼šè¢«æ¥ç®¡ï¼Œæš‚åœè¿è¡Œï¼‰ï¼š</p>
<pre><code class="language-sh">$ dlv attach  7282
Type 'help' for list of commands.
(dlv)
</code></pre>
<p>help æŸ¥çœ‹ dlv æ”¯æŒçš„è°ƒè¯•å‘½ä»¤ï¼š</p>
<p><img src="go/article/../img/dlv.png" alt="delveå‘½ä»¤-help" /></p>
<p>grs æ˜¾ç¤ºæ‰€æœ‰çš„ goroutineï¼š</p>
<p><img src="go/article/../img/grs.png" alt="delveå‘½ä»¤-grs" /></p>
<p>gr æ˜¾ç¤ºå½“å‰çš„ goroutine æˆ–è€…åˆ‡æ¢åˆ°æŒ‡å®šçš„ goroutineï¼š</p>
<p><img src="go/article/../img/gr.png" alt="delveå‘½ä»¤-gr" /></p>
<p>æ‰“æ–­ç‚¹ï¼š</p>
<p><img src="go/article/../img/break.png" alt="delveå‘½ä»¤-break" /></p>
<p>åˆ°æ–­ç‚¹ä½ç½®åï¼Œç”¨ gr æ‰“å°å½“å‰çš„ goroutineï¼Œä¼šå‘ç°åœ¨ 18 å’Œ 19 ä¸¤ä¸ª goroutine ä¹‹é—´åˆ‡æ¢ï¼š</p>
<pre><code class="language-sh">(dlv) c
......
(dlv) gr
Thread 120198 at /Users/lijiao/Work/go-code-example/debug/debug.go:10
Goroutine 19:
......
(dlv) c
......
(dlv) gr
Thread 120196 at /Users/lijiao/Work/go-code-example/debug/debug.go:10
Goroutine 18:
......
</code></pre>
<p>å•æ­¥æ‰§è¡Œ <code>n</code>ï¼Œè¿›å…¥è°ƒç”¨å‡½æ•° <code>s</code>ï¼ŒæŸ¥çœ‹è°ƒç”¨æ ˆ <code>bt</code>ï¼Œåˆ‡æ¢è°ƒç”¨æ ˆä½ç½® <code>frame POS</code> ç­‰æŒ‡ä»¤ä¸ gdb ä¸­çš„åŒåæŒ‡ä»¤ç”¨æ³•ç›¸ä¼¼ã€‚å…¶å®ƒæŒ‡ä»¤è¿™é‡Œä¸ç½—åˆ—äº†ï¼Œdlv çš„ help ä¸­éƒ½æœ‰ã€‚</p>
<p>Go 1.11 å’Œ Go 1.12 æŒç»­ä¼˜åŒ–äº† Go è¯­è¨€ç¨‹åºçš„è°ƒè¯•ä½“éªŒï¼Œè¯¦æƒ…è§ï¼š<a href="https://www.lijiaocn.com/%E7%BC%96%E7%A8%8B/2019/12/23/go-blog-10-years.html#%E8%B0%83%E8%AF%95%E8%B0%83%E4%BC%98" title="Go 1.12 è°ƒè¯•ä¼˜åŒ–">Go 1.12 è°ƒè¯•ä¼˜åŒ–</a>ã€‚</p>
<h2 id="å‚è€ƒ-30"><a class="header" href="#å‚è€ƒ-30">å‚è€ƒ</a></h2>
<ol>
<li><a href="https://www.lijiaocn.com" title="æä½¶æ¾³çš„åšå®¢">æä½¶æ¾³çš„åšå®¢</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="go-è¯­è¨€ç¨‹åºè¿è¡Œæ—¶çŠ¶æ€æŸ¥çœ‹"><a class="header" href="#go-è¯­è¨€ç¨‹åºè¿è¡Œæ—¶çŠ¶æ€æŸ¥çœ‹">Go è¯­è¨€ç¨‹åºè¿è¡Œæ—¶çŠ¶æ€æŸ¥çœ‹</a></h1>
<p>ä¸Šä¸€èŠ‚ç”¨ dlv è°ƒè¯•è¿è¡Œä¸­çš„ Go è¯­è¨€ç¨‹åºï¼Œdlv ä¼šæ‰“æ–­è¿›ç¨‹çš„è¿è¡Œï¼Œåœ¨å¼€å‘æµ‹è¯•æ—¶å¯ä»¥ç”¨ã€‚</p>
<p>å¯¹äºç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œçš„è¿›ç¨‹ï¼Œå¯ä»¥ç”¨ Go å†…ç½®çš„æ€§èƒ½åˆ†æå·¥å…· pprof çª¥æµ‹è¿›ç¨‹çš„å½“å‰çŠ¶å†µã€‚</p>
<p><a href="https://blog.golang.org/profiling-go-programs" title="Profiling Go Programs">Profiling Go Programs</a> å¾ˆå¥½åœ°æ¼”ç¤ºäº†ç”¨ pprof æ‰¾åˆ°æ€§èƒ½ç“¶é¢ˆçš„è¿‡ç¨‹ï¼Œè¿™é‡Œåªæ¼”ç¤ºç®€å•ç”¨æ³•ã€‚</p>
<h2 id="å¯ç”¨å®æ—¶çš„-pprof"><a class="header" href="#å¯ç”¨å®æ—¶çš„-pprof">å¯ç”¨å®æ—¶çš„ pprof</a></h2>
<p>å¯ç”¨å®æ—¶çš„ pprof éå¸¸ç®€å•ï¼Œåªéœ€è¦å¼•å…¥ &quot;net/http/pprof&quot;ï¼Œç„¶åå¯åŠ¨ http server å°±å¯ä»¥äº†ï¼š</p>
<pre><code class="language-go">import (
    &quot;fmt&quot;
    &quot;log&quot;
    &quot;net/http&quot;
    _ &quot;net/http/pprof&quot;
    &quot;time&quot;
)

func Write(num int, c chan int) {
    for {
        c &lt;- num
    }
}

func main() {
    go func() {
        log.Println(http.ListenAndServe(&quot;localhost:6060&quot;, nil))
    }()

    c := make(chan int)
    go Write(10, c)
    go Write(20, c)

    for {
        select {
        case v := &lt;-c:
            fmt.Printf(&quot;receive %d\n&quot;, v)
            time.Sleep(2 * time.Second)
        }
    }
}
</code></pre>
<p>ç›´æ¥ç”¨æµè§ˆå™¨æ‰“å¼€ http://127.0.0.1:6060/debug/pprof/ æŸ¥çœ‹ï¼š</p>
<p><img src="go/article/../img/pprof.png" alt="æµè§ˆå™¨æŸ¥çœ‹ pprof" /></p>
<p>å…¶ä¸­ debug/pprof/profile æ˜¯ cpu é‡‡æ ·æ–‡ä»¶ï¼Œè®¿é—®æ—¶è§¦å‘ï¼Œç”¨ seonds å‚æ•°æ§åˆ¶é‡‡é›†æŒç»­æ—¶é—´ï¼š</p>
<pre><code class="language-sh"># é»˜è®¤æ˜¯ 30 ç§’
http://localhost:6060/debug/pprof/profile?seconds=30
</code></pre>
<p>360 çš„ Zhou Yang åœ¨åˆ†äº« <a href="https://blog.golang.org/qihoo" title="Qihoo 360 and Go">Qihoo 360 and Go</a> ä¸­æåˆ°ï¼Œä»–ä»¬åŸºäº pprof åšäº†ä¸€å¥— web å±•ç¤ºï¼š</p>
<p><img src="go/article/../img/pprof2.png" alt="360 pprofå±•ç¤º" /></p>
<p>å¯¹äºéå¸¸é©»è¿è¡Œçš„ Go è¯­è¨€ç¨‹åºï¼Œå¯ä»¥åœ¨ç¨‹åºæ·»åŠ ä»£ç ï¼Œç» pprof ä¿¡æ¯å†™å…¥æ–‡ä»¶ä¸­ï¼š</p>
<pre><code class="language-go">var cpuprofile = flag.String(&quot;cpuprofile&quot;, &quot;&quot;, &quot;write cpu profile to file&quot;)

func main() {
    flag.Parse()
    if *cpuprofile != &quot;&quot; {
        f, err := os.Create(*cpuprofile)
        if err != nil {
            log.Fatal(err)
        }
        pprof.StartCPUProfile(f)
        defer pprof.StopCPUProfile()
    }
    ...
</code></pre>
<h2 id="å¦‚ä½•ä½¿ç”¨-pprof"><a class="header" href="#å¦‚ä½•ä½¿ç”¨-pprof">å¦‚ä½•ä½¿ç”¨ pprof</a></h2>
<p>å¦‚ä½•ä½¿ç”¨ pprof æ‰æ˜¯é‡ç‚¹ï¼Œé™¤äº† profile å’Œ trace ï¼Œå…¶å®ƒ url å¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹ï¼Œprofile å’Œ trace æ˜¯ä¸¤ä¸ªé‡‡æ ·æ–‡ä»¶è¦åˆ†åˆ«ç”¨ pprof å’Œ trace å·¥å…·æŸ¥çœ‹ã€‚</p>
<p>å¯¹äºç¦»çº¿æ–‡ä»¶ï¼š</p>
<pre><code class="language-sh">$ go tool pprof havlak1 havlak1.prof
Welcome to pprof!  For help, type 'help'.
(pprof)
</code></pre>
<p>å¯¹äºåœ¨çº¿åœ°å€ï¼Œä»¥ cpu é‡‡æ ·ä¸ºä¾‹ï¼ˆä¸ºäº†é‡‡é›†åˆ°æ•°æ®æŠŠä¸Šé¢ç¨‹åºä¸­çš„ sleep æ—¶é—´è°ƒæ•´ä¸º 0ï¼‰ï¼š</p>
<pre><code class="language-sh">$ go tool pprof http://localhost:6060/debug/pprof/profile   # 30-second CPU profile
</code></pre>
<p><img src="go/article/../img/cpuprofile.png" alt="pprof æŸ¥çœ‹ cpu é‡‡æ ·" /></p>
<p>web å‘½ä»¤ç»˜åˆ¶é‡‡æ ·å›¾å¹¶ç”¨æµè§ˆå™¨æ‰“å¼€ ï¼Œå¦‚æœé‡åˆ°ä¸‹é¢é”™è¯¯ï¼Œå®‰è£… graphvizï¼š</p>
<pre><code class="language-sh">(pprof) web
failed to execute dot. Is Graphviz installed? Error: exec: &quot;dot&quot;: executable file not found in $PATH
</code></pre>
<p>macOS ä¸Šå®‰è£…ï¼š </p>
<pre><code class="language-sh">$ brew install graphviz
</code></pre>
<p>ç»˜åˆ¶çš„é‡‡æ ·å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="go/article/../img/pprofx.png" alt="pprof é‡‡æ ·å›¾" /></p>
<p>å³é”®åœ¨å•ç‹¬çª—å£æ‰“å¼€åŸå§‹å›¾ç‰‡ï¼Œsvg æ ¼å¼ï¼Œå¯ç¼©å°æ”¾å¤§ï¼š<a href="go/article/../img/pprof001.svg">åŸå§‹å›¾ç‰‡</a></p>
<h2 id="trace-æŸ¥çœ‹"><a class="header" href="#trace-æŸ¥çœ‹">trace æŸ¥çœ‹</a></h2>
<p>trace è¦å°†æ–‡ä»¶ä¸‹è½½ä»¥åï¼Œç”¨ go tool trace æŸ¥çœ‹ï¼š</p>
<pre><code class="language-sh">$ wget http://localhost:6060/debug/pprof/trace
$ go tool trace trace
</code></pre>
<p>æ‰“å¼€æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="go/article/../img/trace.png" alt="go tool trace" /></p>
<h2 id="å‚è€ƒ-31"><a class="header" href="#å‚è€ƒ-31">å‚è€ƒ</a></h2>
<ol>
<li><a href="https://www.lijiaocn.com" title="æä½¶æ¾³çš„åšå®¢">æä½¶æ¾³çš„åšå®¢</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="æœ‰å¤§é‡ååºåˆ—åŒ–æ—¶ç›®æ ‡-struct-çš„æˆå‘˜ç”¨æŒ‡é’ˆ"><a class="header" href="#æœ‰å¤§é‡ååºåˆ—åŒ–æ—¶ç›®æ ‡-struct-çš„æˆå‘˜ç”¨æŒ‡é’ˆ">æœ‰å¤§é‡ååºåˆ—åŒ–æ—¶ï¼Œç›®æ ‡ Struct çš„æˆå‘˜ç”¨æŒ‡é’ˆ</a></h1>
<p><a href="https://www.lijiaocn.com/%E7%BC%96%E7%A8%8B/2019/12/23/go-blog-10-years.html#%E5%B8%B8%E8%A7%84%E7%BB%86%E8%8A%82" title="json åºåˆ—åŒ–å’Œååºåˆ—åŒ–">JSON and Go</a> ä¸­ä»‹ç»ååºåˆ—åŒ–æ—¶è¯´ï¼Œä»‹ç»äº†ç›®æ ‡ struct ä¸­æœ‰ Reference Type ç±»å‹æˆå‘˜æ—¶çš„å¤„ç†ï¼š</p>
<pre><code class="language-go">type FamilyMember struct {
    Name    string
    Age     int
    Parents []string
}

var m FamilyMember
err := json.Unmarshal(b, &amp;m)
</code></pre>
<p>FamilyMember çš„ Parents æ˜¯ä¸€ä¸ª Sliceï¼Œåœ¨ååºåˆ—åŒ–æ—¶å€™ï¼Œä¼šä¸ºå®ƒåˆ†é…ç©ºé—´ã€‚</p>
<p>é‡ç‚¹æ˜¯ï¼Œå¦‚æœç›®æ ‡å­—ç¬¦ä¸²ä¸­æ²¡æœ‰ Parentsï¼Œé‚£ä¹ˆ Parents æ˜¯ nilã€‚æ®æ­¤åˆ¤æ–­ï¼Œååºåˆ—åŒ–çš„ç›®æ ‡ struct ä¸­åº”å½“å°½å¯èƒ½çš„ä½¿ç”¨ Reference Typeï¼Œåœ¨æœ‰ç¼ºå¤±å­—æ®µæ—¶ï¼Œè¿™ç§æ–¹å¼æ›´é«˜æ•ˆä¸”èŠ‚çœå†…å­˜ã€‚</p>
<h2 id="ä¸¤ç§å®šä¹‰æ–¹å¼"><a class="header" href="#ä¸¤ç§å®šä¹‰æ–¹å¼">ä¸¤ç§å®šä¹‰æ–¹å¼</a></h2>
<p>Obj å®šä¹‰äº†é•¿åº¦ä¸º 100 çš„æ•°ç»„ï¼ŒObjP ä½¿ç”¨çš„æ˜¯ Sliceï¼š</p>
<pre><code class="language-go">package unmarshal

import &quot;encoding/json&quot;

type Obj struct {
    Value int
    Array [100]int
}

type ObjP struct {
    Value int
    Array []int
}

func UnmarshalObj(str []byte, v interface{}) {
    json.Unmarshal(str, v)
}

func UnmarshalObjP(str []byte, v interface{}) {
    json.Unmarshal(str, v)
}
</code></pre>
<h2 id="åŸºå‡†æµ‹è¯•ç»“æœ"><a class="header" href="#åŸºå‡†æµ‹è¯•ç»“æœ">åŸºå‡†æµ‹è¯•ç»“æœ</a></h2>
<p>åŸºå‡†æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼Œæ¨¡æ‹Ÿå®é™…åœºæ™¯ï¼Œæ¯æ¬¡ååºåˆ—åŒ–éƒ½ç”¨ä¸€ä¸ªæ–°çš„å˜é‡ï¼Œè®¾è®¡äº† Array æœ‰å’Œæ— ä¸¤ç§åœºæ™¯ï¼š</p>
<pre><code class="language-go">package unmarshal

import (
    &quot;testing&quot;
)

var objstr_noarray = []byte(`{&quot;Value&quot;:10}`)
var objstr_array = []byte(`{&quot;Value&quot;:10, &quot;Array&quot;:[1,2,3,4,5,7,8]}`)

func BenchmarkUnmarshalObjNoArray(b *testing.B) {
    for i := 0; i &lt; b.N; i++ {
        obj := &amp;Obj{}
        UnmarshalObj(objstr_noarray, obj)
    }
}

func BenchmarkUnmarshalObjPNoArray(b *testing.B) {
    for i := 0; i &lt; b.N; i++ {
        obj := &amp;ObjP{}
        UnmarshalObjP(objstr_noarray, obj)
    }
}

func BenchmarkUnmarshalObjArray(b *testing.B) {
    for i := 0; i &lt; b.N; i++ {
        obj := &amp;Obj{}
        UnmarshalObj(objstr_array, obj)
    }
}

func BenchmarkUnmarshalObjPArray(b *testing.B) {
    for i := 0; i &lt; b.N; i++ {
        obj := &amp;ObjP{}
        UnmarshalObjP(objstr_array, obj)
    }
}
</code></pre>
<p>åŸºå‡†æµ‹è¯•ç»“æœæ˜¾ç¤ºï¼Œæ‰§è¡Œæ•ˆç‡çš„å·®è·éå¸¸æ˜æ˜¾ï¼š</p>
<pre><code class="language-sh">goos: darwin
goarch: amd64
pkg: go-code-example/unmarshal
BenchmarkUnmarshalObjNoArray-4    	 1385480	       861 ns/op
BenchmarkUnmarshalObjPNoArray-4   	 1712936	       693 ns/op
BenchmarkUnmarshalObjArray-4      	  229220	      4899 ns/op
BenchmarkUnmarshalObjPArray-4     	  367184	      2883 ns/op
PASS
</code></pre>
<h2 id="å‚è€ƒ-32"><a class="header" href="#å‚è€ƒ-32">å‚è€ƒ</a></h2>
<ol>
<li><a href="https://www.lijiaocn.com" title="æä½¶æ¾³çš„åšå®¢">æä½¶æ¾³çš„åšå®¢</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="gin-æ¡†æ¶çš„å­¦ä¹ èµ„æ–™"><a class="header" href="#gin-æ¡†æ¶çš„å­¦ä¹ èµ„æ–™">Gin æ¡†æ¶çš„å­¦ä¹ èµ„æ–™</a></h1>
<p>Go å†…ç½®äº† http.Server çš„å®ç°ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-go">package main

import (
    &quot;log&quot;
    &quot;net/http&quot;
    &quot;time&quot;
)

type NewHandler struct{}

func (s *NewHandler) ServeHTTP(writer http.ResponseWriter, req *http.Request) {
    // æ ¹æ® req æŸ¥æ‰¾å¯¹åº”çš„ handler
    if req.URL.Path == &quot;/hello2&quot; {
        writer.Write([]byte(&quot;Hello2 World!&quot;))
    }
}

func newServer(addr string) {
    s := &amp;http.Server{
        Addr:              addr,
        Handler:           nil,
        TLSConfig:         nil,
        ReadTimeout:       0,
        ReadHeaderTimeout: 0,
        WriteTimeout:      0,
        IdleTimeout:       0,
        MaxHeaderBytes:    0,
        TLSNextProto:      nil,
        ConnState:         nil,
        ErrorLog:          nil,
        BaseContext:       nil,
        ConnContext:       nil,
    }
    s.Handler = &amp;NewHandler{}
    log.Fatal(s.ListenAndServe())
}

func main() {
    // $ curl 127.0.0.1:8082/hello2
    // Hello2 World!%
    go newServer(&quot;:8082&quot;)
    time.Sleep(1000 * time.Second)
}
</code></pre>
<p>å¯ä»¥çœ‹åˆ°å…³é”®æ˜¯ï¼šå½“ä¸€ä¸ª http è¯·æ±‚åˆ°è¾¾æ—¶ï¼ŒServerHTTP() æ€æ ·å¿«é€Ÿæ‰¾åˆ°å¯¹åº”çš„å¤„ç†å‡½æ•°è¿›è¡Œå“åº”ã€‚Gin æœ€ä¸»è¦åŠŸèƒ½å°±æ˜¯å®ç° request ä¸å¤„ç†å‡½æ•°ç›´æ¥æ˜ å°„ï¼Œä¹Ÿå°±æ˜¯ router ç®¡ç†ã€‚</p>
<pre><code class="language-go">package main

import (
    &quot;github.com/gin-gonic/gin&quot;
    &quot;net/http&quot;
    &quot;time&quot;
)

func main() {
    r := gin.Default()
    r.GET(&quot;/ping&quot;, func(c *gin.Context) {
        c.JSON(200, gin.H{
            &quot;message&quot;: &quot;pong&quot;,
        })
    })

    //r.Run() // listen and serve on 0.0.0.0:8080
    s := &amp;http.Server{
        Addr:           &quot;:8080&quot;,
        Handler:        r,
        ReadTimeout:    10 * time.Second,
        WriteTimeout:   10 * time.Second,
        MaxHeaderBytes: 1 &lt;&lt; 20,
    }
    s.ListenAndServe()
}
</code></pre>
<p>Gin é€‰ç”¨ <a href="https://en.wikipedia.org/wiki/Radix_tree" title="Radix_tree">Radix_tree</a> ç®¡ç†è·¯ç”±è¡¨ï¼ŒRadis_tree æ˜¯â€œæ ‘â€çš„ä¸€ç§ï¼Œå®ç°äº†ä¸å®šé•¿å­—ç¬¦ä¸²çš„æŸ¥æ‰¾ï¼Œå¶å­èŠ‚ç‚¹ä¸­å­˜æ”¾çš„ handler å‡½æ•°ï¼Œéå¶å­èŠ‚ç‚¹æŒ‡å‘å­èŠ‚ç‚¹ï¼Œå¹¶åœ¨â€œè¾¹â€ä¸­æ ‡è®°å‰ç¼€å­—ç¬¦ï¼š</p>
<p>å› ä¸ºæ¯æ¡è¾¹ä¸­åŒ…å«ä¸æ­¢ä¸€ä¸ªå­—ç¬¦ï¼Œæ‰€æœ‰ Radis_tree çš„é«˜åº¦é™ä½ï¼ŒæŸ¥æ‰¾æ•ˆç‡æé«˜ã€‚</p>
<p><img src="go/gin/../img/radis_tree.png" alt="radis_tree" /></p>
<h2 id="å‚è€ƒèµ„æ–™"><a class="header" href="#å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</a></h2>
<ol>
<li><a href="https://www.lijiaocn.com" title="æä½¶æ¾³çš„åšå®¢">æä½¶æ¾³çš„åšå®¢</a></li>
<li><a href="https://github.com/gin-gonic/gin" title="gin-gonic/gin">gin-gonic/gin</a></li>
<li><a href="https://gin-gonic.com/zh-cn/docs/" title="gin web framework">gin web framework</a></li>
<li><a href="https://en.wikipedia.org/wiki/Radix_tree" title="Radix_tree">Radix_tree</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="gin-å¿«é€Ÿå¼€å§‹"><a class="header" href="#gin-å¿«é€Ÿå¼€å§‹">Gin å¿«é€Ÿå¼€å§‹</a></h1>
<p>å»ºè®®ç›´æ¥ä½¿ç”¨ Go 1.13 ä»¥åŠä»¥ä¸Šç‰ˆæœ¬ï¼Œç”¨ go mod è¿›è¡Œä¾èµ–ç®¡ç†ï¼ˆ<a href="go/gin/../article/pkg.html">ä»£ç è¦å¦‚ä½•ç»„ç»‡?</a>)ã€‚</p>
<h2 id="ç¤ºèŒƒä»£ç "><a class="header" href="#ç¤ºèŒƒä»£ç ">ç¤ºèŒƒä»£ç </a></h2>
<p>ç¤ºèŒƒä»£ç ä¸‹è½½æ–¹æ³•ï¼š</p>
<pre><code class="language-sh">git clone https://github.com/introclass/go-code-example.git
</code></pre>
<p>ç„¶ååœ¨ IntelliJ IDEAã€goLand æˆ–å…¶å®ƒä¹ æƒ¯ä½¿ç”¨çš„ IDE ä¸­åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ï¼Œå¯¼å…¥ç›®å½• go-code-exampleï¼Œå¦‚æœæ˜¯ IntelliJ IDEAï¼Œæ³¨æ„å‹¾é€‰ go moduleã€‚</p>
<h2 id="ä½¿ç”¨-gin-ç”Ÿæˆçš„-handler"><a class="header" href="#ä½¿ç”¨-gin-ç”Ÿæˆçš„-handler">ä½¿ç”¨ Gin ç”Ÿæˆçš„ Handler</a></h2>
<p>åœ¨è¿™é‡Œ Gin å”¯ä¸€çš„ä½œç”¨å°±æ˜¯ä¸º http.Server æä¾›ä¸€ä¸ª Handlerï¼Œ<code>r := gin.Default()</code>ï¼Œåœ¨è¿™ä¸ª Handler ä¸­æ³¨å…¥äº†å¯¹åº”çš„ HandlerFuncï¼š</p>
<pre><code class="language-go">	r := gin.Default()
	r.GET(&quot;/ping&quot;, func(c *gin.Context) {
		c.JSON(200, gin.H{
			&quot;message&quot;: &quot;pong&quot;,
		})
	})

	//r.Run() // listen and serve on 0.0.0.0:8080
	s := &amp;http.Server{
		Addr:           &quot;:8080&quot;,
		Handler:        r,
		ReadTimeout:    10 * time.Second,
		WriteTimeout:   10 * time.Second,
		MaxHeaderBytes: 1 &lt;&lt; 20,
	}
	s.ListenAndServe()
</code></pre>
<p>å®Œæ•´ä»£ç ï¼š<a href="https://github.com/introclass/go-code-example/tree/master/ginusage/01quickstart">ginusage/01quickstart</a></p>
<h2 id="å‚è€ƒ-33"><a class="header" href="#å‚è€ƒ-33">å‚è€ƒ</a></h2>
<ol>
<li><a href="https://www.lijiaocn.com" title="æä½¶æ¾³çš„åšå®¢">æä½¶æ¾³çš„åšå®¢</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="gin-çš„-router-ç®¡ç†"><a class="header" href="#gin-çš„-router-ç®¡ç†">Gin çš„ router ç®¡ç†</a></h1>
<p>è¿™é‡Œæ‰€è¯´çš„è·¯ç”±å°±æ˜¯å°±æ˜¯ http è¯·æ±‚çš„ methodã€path ä¸å¤„ç†å‡½æ•°çš„å¯¹åº”å…³ç³»ã€‚</p>
<p>Gin çš„è·¯ç”±è®¾ç½®æ–¹æ³•éå¸¸ç®€å•ï¼Œå¤„ç†å‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼ˆåªæœ‰ä¸€ä¸ªä¼ å…¥å‚æ•°ï¼‰ï¼š</p>
<pre><code class="language-go">type HandlerFunc func(*Context)
</code></pre>
<p>ä¸‹é¢çš„ echo å°±æ˜¯ä¸€ä¸ªå¤„ç†å‡½æ•°ï¼Œå®ƒç”¨ c.JSON() å‘è¯·æ±‚ç«¯å‘é€äº†å“åº”æ•°æ®ã€‚</p>
<pre><code class="language-go">func echo(c *gin.Context) {
    c.JSON(200, gin.H{
        &quot;method&quot;: c.Request.Method,
        &quot;uri&quot;:    c.Request.URL.String(),
    })
}
</code></pre>
<h2 id="æŒ‰ç…§-method-è®¾ç½®"><a class="header" href="#æŒ‰ç…§-method-è®¾ç½®">æŒ‰ç…§ method è®¾ç½®</a></h2>
<pre><code class="language-go">router := gin.Default()

router.GET(&quot;/get&quot;, echo)
router.POST(&quot;/post&quot;, echo)
router.PUT(&quot;/put&quot;, echo)
router.DELETE(&quot;/delete&quot;, echo)
router.PATCH(&quot;/patch&quot;, echo)
router.HEAD(&quot;/head&quot;, echo)
router.OPTIONS(&quot;/option&quot;, echo)
</code></pre>
<h2 id="router-åˆ†ç»„"><a class="header" href="#router-åˆ†ç»„">router åˆ†ç»„</a></h2>
<p>ä¸Šé¢å¹³é“ºçš„è®¾ç½®æ–¹æ³•æœ‰æ—¶å€™ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€è¦ï¼Œè­¬å¦‚å½“ API æœ‰ç‰ˆæœ¬çš„æ—¶å€™ï¼Œ æˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿåˆ†ç»„å¤„ç†ï¼š</p>
<pre><code class="language-go">groupv1 := router.Group(&quot;/v1&quot;)
{
    groupv1.GET(&quot;/hello&quot;, echo)
}

groupv2 := router.Group(&quot;/v1&quot;)
{
    groupv2.GET(&quot;/hello&quot;, echo)
}
</code></pre>
<h2 id="å‚è€ƒ-34"><a class="header" href="#å‚è€ƒ-34">å‚è€ƒ</a></h2>
<ol>
<li><a href="https://www.lijiaocn.com" title="æä½¶æ¾³çš„åšå®¢">æä½¶æ¾³çš„åšå®¢</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="gin-çš„è¯·æ±‚å‚æ•°è·å–"><a class="header" href="#gin-çš„è¯·æ±‚å‚æ•°è·å–">Gin çš„è¯·æ±‚å‚æ•°è·å–</a></h1>
<p>http çš„è¯·æ±‚å‚æ•°é€šå¸¸é€šè¿‡ä»¥ä¸‹é›†ä¸­æ–¹å¼ä¼ å…¥ã€‚</p>
<ul>
<li>é™„åŠ åœ¨ url åé¢çš„ï¼ˆç”¨ ? åˆ†éš”ï¼‰çš„ query å‚æ•°ï¼Œè­¬å¦‚ä¸‹é¢çš„ name å’Œ ageï¼š</li>
</ul>
<pre><code class="language-sh">127.0.0.1:8080/query?name=XX&amp;age=11
</code></pre>
<ul>
<li>URI ä¸­ç‰¹å®šä½ç½®çš„å­—ç¬¦è®¤åšä¼ å…¥å‚æ•°ï¼š</li>
</ul>
<p>å‡è®¾è·¯å¾„å‚æ•°å®šä¹‰ä¸ºï¼š/user/NAME/ACTION</p>
<p>127.0.0.1:8080/user/xiaoming/run ä¼ å…¥çš„å‚æ•°å°±æ˜¯ NAME=xiaomingï¼ŒACTION=run</p>
<ul>
<li>
<p>åœ¨ HTTP Header ä¸­è®¾ç½®çš„å‚æ•°</p>
</li>
<li>
<p>é€šè¿‡ post æäº¤çš„ã€ä½äº http è¯·æ±‚ body ä¸­çš„æ•°æ®</p>
</li>
</ul>
<p>ä»¥ä¸Šå‚æ•°ä»¥åŠå…¶å®ƒæ‰€æœ‰çš„è¯·æ±‚ä¿¡æ¯ï¼Œéƒ½ä¼ å…¥çš„ *gin.Context è·å–ã€‚</p>
<h2 id="uri-query-å‚æ•°"><a class="header" href="#uri-query-å‚æ•°">URI query å‚æ•°</a></h2>
<p>URL çš„å¤šä¸ª query å‚æ•°ç”¨ &amp; é—´éš”ï¼Œç”¨ c.QueryXX æ–¹æ³•è¯»å–ï¼š</p>
<pre><code class="language-go">//åŒ¹é…ï¼š127.0.0.1:8080/query?name=xiaoming&amp;age=11
func query(c *gin.Context) {
    name := c.DefaultQuery(&quot;name&quot;, &quot;Guest&quot;)
    age := c.Query(&quot;age&quot;)

    c.String(http.StatusOK, &quot;%s is %s years\n&quot;, name, age)
}
</code></pre>
<p>åŒåçš„å‚æ•°è¢«è®¤ä¸ºæ˜¯æ•°ç»„ï¼š</p>
<pre><code class="language-go">//åŒ¹é…ï¼š&quot;127.0.0.1:8080/arr?ids=A&amp;ids=B&quot;
func queryArray(c *gin.Context) {
    ids := c.QueryArray(&quot;ids&quot;)
    c.JSON(http.StatusOK, gin.H{
        &quot;ids&quot;: ids,
    })
}
</code></pre>
<p>Map å‚æ•°çš„ä¼ é€’æ–¹æ³•ï¼š</p>
<pre><code class="language-go">//åŒ¹é…ï¼š&quot;127.0.0.1:8080/map?ids[a]=1234&amp;ids[b]=hello&quot;
func queryMap(c *gin.Context) {
    ids := c.QueryMap(&quot;ids&quot;)
    c.JSON(http.StatusOK, gin.H{
        &quot;ids&quot;: ids,
    })
}
</code></pre>
<p>é™¤äº†ä¸Šé¢çš„å‚æ•°è¯»å–æ–¹æ³•ï¼Œè¿˜å¯ä»¥é€šè¿‡ c.ShouldBindQuery ç›´æ¥å°†å‚æ•°è§£æåˆ°å˜é‡ä¸­ï¼š</p>
<pre><code class="language-go">type UserInfo struct {
	Name     string            `form:&quot;name&quot;`
	Age      int               `form:&quot;age&quot;`
	Message  []string          `form:&quot;message&quot;`
	MoreInfo map[string]string `form:&quot;moreinfo&quot;`
}

func queryBind(c *gin.Context) {
	var userInfo UserInfo
	c.BindQuery(&amp;userInfo)
	//gin 1.5 çš„ BindQuery ä¼¼ä¹ä¸æ”¯æŒ mapï¼Œå•ç‹¬è·å–
	userInfo.MoreInfo = c.QueryMap(&quot;moreinfo&quot;)
	c.JSON(http.StatusOK, userInfo)
}

</code></pre>
<h2 id="http-header"><a class="header" href="#http-header">Http Header</a></h2>
<p>ç”¨ c.GetHeader() è·å–ï¼š</p>
<pre><code class="language-go">func header(c *gin.Context) {
	token := c.GetHeader(&quot;TOKEN&quot;)
	c.JSON(http.StatusOK, gin.H{
		&quot;TOKEN&quot;: token,
	})
}
</code></pre>
<p>ç”¨ c.BindHeader ç›´æ¥è§£æåˆ°å˜é‡ä¸­ï¼š</p>
<pre><code class="language-go">type Token struct {
	Token string `header:&quot;token&quot;`
}

func headerBind(c *gin.Context) {
	var token Token
	c.BindHeader(&amp;token)
	c.JSON(http.StatusOK, token)
}
</code></pre>
<h2 id="uri-è·¯å¾„å‚æ•°"><a class="header" href="#uri-è·¯å¾„å‚æ•°">URI è·¯å¾„å‚æ•°</a></h2>
<p>è·¯å¾„å‚æ•°éœ€è¦å®šä¹‰è·¯ç”±æ—¶ï¼Œåœ¨è·¯å¾„ä¸­è¿›è¡Œæ³¨æ˜ï¼Œç”¨ c.Param() è¯»å–ï¼š</p>
<pre><code class="language-go">func userName(c *gin.Context) {
    name := c.Param(&quot;name&quot;)
    c.String(http.StatusOK, &quot;Hello %s\n&quot;, name)
}

func userNameAction(c *gin.Context) {
    name := c.Param(&quot;name&quot;)
    action := c.Param(&quot;action&quot;)
    c.String(http.StatusOK, &quot;%s is %s\n&quot;, name, action)
}

func main() {
    router := gin.Default()

    // curl  127.0.0.1:8080/user/xiaoming
    // :name å¿…é¡»å­˜åœ¨
    // åŒ¹é… /user/NAME
    // ä¸åŒ¹é… /user æˆ–è€… /user/
    router.GET(&quot;/user/:name&quot;, userName)

    // curl 127.0.0.1:8080/user/xiaoming/run
    // *action æ˜¯å¯é€‰çš„
    // åŒ¹é… /user/NAME/
    // åŒ¹é… /user/NAME/ACTION
    // å¦‚æœ /user/NAME æ²¡æœ‰å¯¹åº”çš„ routerï¼Œé‡å®šå‘åˆ° /user/NAME/
    router.GET(&quot;/user/:name/*action&quot;, userNameAction)

    // curl -X POST 127.0.0.1:8080/user/xiaoming/run
    // POST ä¹Ÿå¯ä»¥ä½¿ç”¨è·¯å¾„å‚æ•°
    router.POST(&quot;/user/:name/*action&quot;, userNameAction)

    router.Run()
}
</code></pre>
<p>ç”¨ c.BindUri ç›´æ¥è§£æåˆ°å˜é‡ä¸­ï¼š</p>
<pre><code class="language-go">type UserInfo struct {
	Name   string `uri:&quot;name&quot;`
	Action string `uri:&quot;action&quot;`
}

func bindURI(c *gin.Context) {
	var userInfo UserInfo
	c.BindUri(&amp;userInfo)
	c.JSON(http.StatusOK, userInfo)
}
</code></pre>
<h2 id="postform-è¡¨å•æ•°æ®"><a class="header" href="#postform-è¡¨å•æ•°æ®">POSTï¼šform è¡¨å•æ•°æ®</a></h2>
<p>post æäº¤çš„å‚æ•°ä½äº http è¯·æ±‚çš„ body ä¸­ï¼Œå¯ä»¥æ˜¯ä»»æ„å­—ç¬¦ï¼Œè¿™é‡Œä»¥ form è¡¨å•æ•°æ®ä¸ºä¾‹ã€‚</p>
<p>form è¡¨å•å‚æ•°ç”¨ c.PostXX è¯»å–ï¼Œæ ¼å¼ä¸ URL query å‚æ•°ç›¸åŒï¼Œä¹Ÿæ”¯æŒæ•°ç»„å’Œ mapã€‚</p>
<pre><code class="language-go">func postForm(c *gin.Context) {
    message := c.PostForm(&quot;message&quot;)
    name := c.DefaultPostForm(&quot;name&quot;, &quot;guest&quot;)
    c.String(http.StatusOK, &quot;%s %s&quot;, name, message)
}

func postFormMap(c *gin.Context) {
    ids := c.PostFormMap(&quot;ids&quot;)
    c.JSON(http.StatusOK, gin.H{
        &quot;ids&quot;: ids,
    })
}

func postFormArray(c *gin.Context) {
    ids := c.PostFormArray(&quot;ids&quot;)
    c.JSON(http.StatusOK, gin.H{
        &quot;ids&quot;: ids,
    })
}

func main() {
    router := gin.Default()

    // curl -XPOST 127.0.0.1:8080/form -d &quot;name=xiaoming&amp;message=welcome!&quot;
    router.POST(&quot;/form&quot;, postForm)

    // curl -XPOST 127.0.0.1:8080/map -d &quot;ids[first]=100&amp;ids[second]=200&quot;
    router.POST(&quot;/map&quot;, postFormMap)

    // curl -XPOST 127.0.0.1:8080/map -d &quot;ids=100&amp;ids=200&quot;
    router.POST(&quot;/arr&quot;, postFormArray)

    router.Run()
}
</code></pre>
<h2 id="postjsonxmlyaml"><a class="header" href="#postjsonxmlyaml">POSTï¼šjson/xml/yaml</a></h2>
<p>å‰é¢ä¾‹å­è¯»å–äº† form è¡¨å•å‚æ•°ï¼Œåœ¨å®é™…å¼€å‘ä¸­ï¼Œpost æäº¤çš„å‚æ•°è¿˜ç»å¸¸æ˜¯ jsonã€xml æ ¼å¼ã€‚</p>
<p>Gin å†…ç½®äº† jsonã€xml æ•°æ®çš„è§£ææ–¹æ³•ï¼Œä¸éœ€è¦é¢å¤–å†™è½¬æ¢ä»£ç ã€‚Gin å¯ä»¥æŠŠ form è¡¨å•ã€jsonã€xml æ•°æ®ç›´æ¥è§£æåˆ°å¯¹åº”çš„å˜é‡ä¸­ã€‚</p>
<p>åœ¨å®šä¹‰å˜é‡çš„ç±»å‹æ—¶ï¼Œéœ€è¦åœ¨ struct tag ä¸­æŒ‡å®šå¯¹åº”çš„å‚æ•°åï¼š</p>
<pre><code class="language-go">type Login struct {
    User     string `form:&quot;user&quot; json:&quot;user&quot; xml:&quot;user&quot; binding:&quot;required&quot;`
    Password string `form:&quot;password&quot; json:&quot;password&quot; xml:&quot;password&quot; binding:&quot;required&quot; `
}
</code></pre>
<p>è§£æ JSON æ•°æ®ï¼š</p>
<pre><code class="language-go">func bindXML(c *gin.Context) {
    var login Login
    if err := c.ShouldBindXML(&amp;login); err != nil {
        c.JSON(http.StatusBadRequest, gin.H{&quot;error&quot;: err.Error()})
        return
    }
    c.JSON(http.StatusOK, login)
}
</code></pre>
<p>è§£æ XML æ•°æ®ï¼š</p>
<pre><code class="language-go">func bindXML(c *gin.Context) {
    var login Login
    if err := c.ShouldBindXML(&amp;login); err != nil {
        c.JSON(http.StatusBadRequest, gin.H{&quot;error&quot;: err.Error()})
        return
    }
    c.JSON(http.StatusOK, login)
}
</code></pre>
<p>æ”¯æŒ yaml æ ¼å¼çš„æ•°æ®ï¼Œä½¿ç”¨ c.ShouldBindYAML()ã€‚</p>
<h2 id="poståŒæ—¶æ”¯æŒå¤šç§æ ¼å¼"><a class="header" href="#poståŒæ—¶æ”¯æŒå¤šç§æ ¼å¼">POSTï¼šåŒæ—¶æ”¯æŒå¤šç§æ ¼å¼</a></h2>
<p>c.ShouldBind() æ”¯æŒå¤šç§æ ¼å¼çš„æ•°æ®ï¼Œå¦‚æœè¯·æ±‚æ–¹æ³•æ˜¯ GETï¼Œé‚£ä¹ˆå®ƒæŒ‰ç…§ form è§„åˆ™è§£æ query å‚æ•°ï¼Œå¦‚æœè¯·æ±‚æ–¹æ³•æ˜¯ POSTï¼Œæ ¹æ®è¯·æ±‚å¤´ä¸­çš„ Content-Type è‡ªåŠ¨é€‰æ‹©å¯¹åº”çš„æ–¹æ³•ï¼š</p>
<pre><code class="language-go">func bindALL(c *gin.Context) {
    var login Login
    if err := c.ShouldBind(&amp;login); err != nil {
        c.JSON(http.StatusBadRequest, gin.H{&quot;error&quot;: err.Error()})
        return
    }
    c.JSON(http.StatusOK, login)
}
</code></pre>
<p>Gin æ”¯æŒçš„ Content-Typeï¼š</p>
<pre><code class="language-go">MIMEJSON              = &quot;application/json&quot;
MIMEHTML              = &quot;text/html&quot;
MIMEXML               = &quot;application/xml&quot;
MIMEXML2              = &quot;text/xml&quot;
MIMEPlain             = &quot;text/plain&quot;
MIMEPOSTForm          = &quot;application/x-www-form-urlencoded&quot;
MIMEMultipartPOSTForm = &quot;multipart/form-data&quot;
MIMEPROTOBUF          = &quot;application/x-protobuf&quot;
MIMEMSGPACK           = &quot;application/x-msgpack&quot;
MIMEMSGPACK2          = &quot;application/msgpack&quot;
MIMEYAML              = &quot;application/x-yaml&quot;
</code></pre>
<h2 id="å‚è€ƒ-35"><a class="header" href="#å‚è€ƒ-35">å‚è€ƒ</a></h2>
<ol>
<li><a href="https://www.lijiaocn.com" title="æä½¶æ¾³çš„åšå®¢">æä½¶æ¾³çš„åšå®¢</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="gin-å¦‚ä½•è¿”å›å“åº”æ•°æ®"><a class="header" href="#gin-å¦‚ä½•è¿”å›å“åº”æ•°æ®">Gin å¦‚ä½•è¿”å›å“åº”æ•°æ®</a></h1>
<p>Http è®¿é—®å°±æ˜¯â€œè¯·æ±‚-å“åº”â€ï¼ŒGin æä¾›äº†ä¸°å¯Œçš„è¿”å›å“åº”æ•°æ®çš„æ–¹æ³•ã€‚</p>
<h2 id="å‚è€ƒ-36"><a class="header" href="#å‚è€ƒ-36">å‚è€ƒ</a></h2>
<ol>
<li><a href="https://www.lijiaocn.com" title="æä½¶æ¾³çš„åšå®¢">æä½¶æ¾³çš„åšå®¢</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="luaç¼–ç¨‹é€ŸæŸ¥æ‰‹å†Œå¸¸ç”¨æ“ä½œ"><a class="header" href="#luaç¼–ç¨‹é€ŸæŸ¥æ‰‹å†Œå¸¸ç”¨æ“ä½œ">Luaç¼–ç¨‹é€ŸæŸ¥æ‰‹å†Œï¼ˆå¸¸ç”¨æ“ä½œ)</a></h1>
<p>è¿™é‡Œè®°å½•ä¸€äº›å¸¸ç”¨çš„luaæ“ä½œï¼Œåœ¨é•¿æ—¶é—´ä¸ç¼–ç¨‹åï¼Œå¯èƒ½ä¼šå¿˜è®°å¾ˆå¤šåŸºæœ¬çš„æ“ä½œï¼Œè¿™ä¸€ç« èŠ‚çš„å†…å®¹ç”¨äºå¸®åŠ©å¿«é€Ÿå›å¿†èµ·è¿™äº›åŸºæœ¬çš„æ“ä½œï¼Œä»æ‰‹å†·å¿«é€Ÿçƒ­èº«åˆ°æ‰‹çƒ­ã€‚</p>
<p>ä»¥å¾€çš„ç¬”è®°å¯¹ lua çš„å®‰è£…ã€ä»£ç ç®¡ç†ç­‰æœ‰æ¯”è¾ƒè¯¦ç»†çš„è®°å½•ï¼š</p>
<ul>
<li><a href="https://www.lijiaocn.com/%E7%BC%96%E7%A8%8B/2018/10/22/language-lua-study.html">ç¼–ç¨‹è¯­è¨€Luaï¼ˆä¸€ï¼‰ï¼šå…¥é—¨ä»‹ç»ã€å­¦ä¹ èµ„æ–™ã€é¡¹ç›®ç®¡ç†ä¸è°ƒè¯•æ–¹æ³•</a></li>
<li><a href="https://www.lijiaocn.com/%E7%BC%96%E7%A8%8B/2018/10/28/language-lua-02-syntax.html">ç¼–ç¨‹è¯­è¨€Luaï¼ˆäºŒï¼‰ï¼šåŸºæœ¬è¯­æ³•å­¦ä¹ </a></li>
<li><a href="https://www.lijiaocn.com/%E7%BC%96%E7%A8%8B/2018/11/02/language-lua-03-systax-detail.html">ç¼–ç¨‹è¯­è¨€Luaï¼ˆä¸‰ï¼‰ï¼šLuaçš„è¯­æ³•ç»†èŠ‚</a></li>
<li><a href="https://www.lijiaocn.com/%E7%BC%96%E7%A8%8B/2018/12/10/lua-programm-performance-tip.html">ä½¿ç”¨Luaç¼–ç¨‹æ—¶éœ€è¦æ³¨æ„çš„ä¸€äº›å½±å“æ€§èƒ½çš„æ“ä½œ</a></li>
</ul>
<p>Lua å®˜æ–¹æ–‡æ¡£ï¼š</p>
<ul>
<li><a href="https://www.lua.org/docs.html">Lua Documentation</a></li>
<li><a href="https://www.lua.org/gems/">Lua Programming Gems</a>ä¸­æ”¶é›†äº†ä¸€äº›Luaç¼–ç¨‹æ–‡ç« </li>
<li><a href="https://www.lua.org/gems/sample.pdf">Lua Performance Tips</a></li>
</ul>
<h2 id="ç¯å¢ƒå‡†å¤‡"><a class="header" href="#ç¯å¢ƒå‡†å¤‡">ç¯å¢ƒå‡†å¤‡</a></h2>
<p>å®‰è£… Luaï¼Œå¯ä»¥ç”¨ä¸‹é¢å‘½ä»¤å®‰è£…ï¼š</p>
<pre><code class="language-sh">$ brew install lua        # for mac
$ yum  install -y lua     # for centos
</code></pre>
<p>æˆ–è€…ç¼–è¯‘å®‰è£…ï¼š</p>
<pre><code class="language-sh">$ curl -R -O http://www.lua.org/ftp/lua-5.3.5.tar.gz
$ tar zxf lua-5.3.5.tar.gz
$ cd lua-5.3.5
$ make linux test    # for linux
$ make macosx test   # for mac
</code></pre>
<h2 id="lua-ä»£ç çš„è¿è¡Œ"><a class="header" href="#lua-ä»£ç çš„è¿è¡Œ">lua ä»£ç çš„è¿è¡Œ</a></h2>
<p>åœ¨å‘½ä»¤è¡Œäº¤äº’å¼è¿è¡Œï¼š</p>
<pre><code class="language-sh">$ lua
Lua 5.3.5  Copyright (C) 1994-2018 Lua.org, PUC-Rio
&gt; print(&quot;hello world!&quot;)
hello world!
&gt;
</code></pre>
<p>è¿è¡Œ lua ä»£ç æ–‡ä»¶ï¼š</p>
<pre><code class="language-lua">#! /usr/bin/env lua
--
-- 01-hello-world.lua
-- Copyright (C) 2018 lijiaocn &lt;lijiaocn@foxmail.com&gt;
--
-- Distributed under terms of the GPL license.

print(&quot;Hello World 1!&quot;)
</code></pre>
<pre><code class="language-sh">$ lua 01-hello-world.lua
Hello World 1!
</code></pre>
<h2 id="å‚è€ƒ-37"><a class="header" href="#å‚è€ƒ-37">å‚è€ƒ</a></h2>
<ol>
<li><a href="https://www.lijiaocn.com" title="æä½¶æ¾³çš„åšå®¢">æä½¶æ¾³çš„åšå®¢</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="luaçš„åŸºæœ¬æ•°æ®ç±»å‹"><a class="header" href="#luaçš„åŸºæœ¬æ•°æ®ç±»å‹">Luaçš„åŸºæœ¬æ•°æ®ç±»å‹</a></h1>
<p>Luaæ˜¯åŠ¨æ€ç±»å‹è¯­è¨€ï¼Œå‡½æ•°<code>type()</code>è¿”å›ä¸€ä¸ªå˜é‡æˆ–è€…ä¸€ä¸ªå€¼çš„ç±»å‹ï¼š</p>
<pre><code>$ lua5.1
Lua 5.1.5  Copyright (C) 1994-2012 Lua.org, PUC-Rio
&gt; print(type(&quot;hello world&quot;))
string
</code></pre>
<p>Luaçš„åŸºæœ¬ç±»å‹æœ‰ï¼š</p>
<pre><code>nil       ç©ºç±»å‹ï¼Œè¡¨ç¤ºæ— æ•ˆå€¼ï¼Œå˜é‡åœ¨è¢«èµ‹å€¼å‰éƒ½æ˜¯nilï¼Œå°†nilèµ‹ç»™ä¸€ä¸ªå…¨å±€å˜é‡ç­‰åŒå°†å…¶åˆ é™¤
boolean   å¸ƒå°”ç±»å‹ï¼Œå€¼ä¸ºtrue/falseï¼Œåªæœ‰nilå’Œfalseä¸ºâ€œå‡â€ï¼Œå…¶å®ƒå¦‚0å’Œ&quot;&quot;éƒ½æ˜¯çœŸï¼Œè¿™ä¸€ç‚¹è¦ç‰¹åˆ«ç‰¹åˆ«æ³¨æ„ï¼
number    æ•°å­—ï¼Œå€¼ä¸ºå®æ•°ï¼ŒLuaé»˜è®¤ä¸ºdoubleï¼ŒLuaJITä¼šæ ¹æ®ä¸Šä¸‹æ–‡é€‰æ‹©ç”¨æ•´å‹æˆ–è€…æµ®ç‚¹å‹å­˜å‚¨
string    å­—ç¬¦ä¸²ï¼Œæ”¯æŒå•å¼•å·ã€åŒå¼•å·å’Œé•¿æ‹¬å·çš„æ–¹å¼
table     è¡¨ï¼Œå…³è”æ•°ç»„
function  å‡½æ•°
userdata  ç”¨æ¥ä¿å­˜åº”ç”¨ç¨‹åºæˆ–è€…Cè¯­è¨€å†™çš„å‡½æ•°åº“åˆ›å»ºçš„æ–°ç±»å‹ã€‚
</code></pre>
<h2 id="nil"><a class="header" href="#nil">nil</a></h2>
<p>nilç±»å‹éœ€è¦æ³¨æ„çš„æ˜¯ï¼š å˜é‡åœ¨è¢«èµ‹å€¼å‰éƒ½æ˜¯nilï¼Œå°†nilèµ‹ç»™ä¸€ä¸ªå…¨å±€å˜é‡ç­‰åŒå°†å…¶åˆ é™¤ã€‚</p>
<h2 id="boolean"><a class="header" href="#boolean">boolean</a></h2>
<p>å¸ƒå°”ç±»å‹éœ€è¦æ³¨æ„çš„æ˜¯ï¼š åªæœ‰nilå’Œfalseä¸ºâ€œå‡â€ï¼Œå…¶å®ƒå¦‚0å’Œ&quot;&quot;éƒ½æ˜¯çœŸã€‚</p>
<h2 id="number"><a class="header" href="#number">number</a></h2>
<p>Luaé»˜è®¤ä¸ºdoubleï¼ŒLuaJITä¼šæ ¹æ®ä¸Šä¸‹æ–‡é€‰æ‹©æ•´å‹æˆ–è€…æµ®ç‚¹å‹ã€‚</p>
<p>æ•´æ•°å’Œæµ®ç‚¹æ•°çš„ç±»å‹éƒ½æ˜¯numberï¼š</p>
<blockquote>
<p>type(3)    --&gt; number
type(3.5)  --&gt; number
type(3.0)  --&gt; number</p>
</blockquote>
<p>å¦‚æœéè¦åŒºåˆ†æ•´å‹å’Œæµ®ç‚¹æ•°ï¼Œå¯ä»¥ç”¨mathä¸­çš„typeå‡½æ•°ï¼š</p>
<blockquote>
<p>math.type(3)     --&gt; integer
math.type(3.0)   --&gt; float</p>
</blockquote>
<h2 id="string"><a class="header" href="#string">string</a></h2>
<p>æ”¯æŒå•å¼•å·ã€åŒå¼•å·å’Œé•¿æ‹¬å·çš„æ–¹å¼ã€‚</p>
<p>é•¿æ‹¬å·çš„å½¢å¼è¦ç‰¹åˆ«è¯´æ˜ï¼Œé•¿æ‹¬å·æ˜¯åˆ†æ­£åçš„ï¼Œæ­£é•¿æ‹¬å·å°±æ˜¯ä¸¤ä¸ª<code>[</code>ä¸­é—´æœ‰ä»»æ„ä¸ªâ€œ=â€ï¼Œä¸€ä¸ªâ€œ=â€è¡¨ç¤ºä¸€çº§ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code>[[          0çº§æ­£é•¿æ‹¬å·
[=[         1çº§æ­£é•¿æ‹¬å·
[===[       3çº§æ­£é•¿æ‹¬å·
</code></pre>
<p>å®ƒä»¬åˆ†åˆ«å’Œåé•¿æ‹¬å·å¯¹åº”ï¼š</p>
<pre><code>]]          0çº§åé•¿æ‹¬å·
]=]         1çº§åé•¿æ‹¬å·
]===]       3çº§åé•¿æ‹¬å·
</code></pre>
<p>ä¸€ä¸ªå­—ç¬¦ä¸²å¯ä»¥ç”¨ä»»æ„çº§åˆ«çš„é•¿æ‹¬å·å¼€å§‹ï¼Œé‡åˆ°åŒçº§åˆ«çš„åé•¿æ‹¬å·æ—¶ç»“æŸï¼Œ<code>é•¿æ‹¬å·ä¸­çš„æ‰€æœ‰å­—ç¬¦ä¸è¢«è½¬ä¹‰</code>ï¼ŒåŒ…æ‹¬å…¶å®ƒçº§åˆ«çš„é•¿æ‹¬å·ï¼Œä¾‹å¦‚ï¼š</p>
<blockquote>
<p>print([==[ string have a [=[ in ]=] ]==])
string have a [=[ in ]=]</p>
</blockquote>
<p>Luaä¸­<code>å­—ç¬¦ä¸²ä¸èƒ½è¢«ä¿®æ”¹</code>ï¼Œå¦‚æœè¦ä¿®æ”¹åªèƒ½åœ¨åŸå€¼çš„åŸºç¡€ä¸Šæ–°å»ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¹Ÿ<code>ä¸èƒ½é€šè¿‡ä¸‹æ ‡è®¿é—®å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦</code>ã€‚æ“ä½œå­—ç¬¦ä¸²å¯ä»¥ç”¨<code>Stringæ¨¡å—</code>ä¸­çš„æ–¹æ³•ã€‚</p>
<p>æ‰€æœ‰çš„å­—ç¬¦ä¸²éƒ½å­˜æ”¾åœ¨ä¸€ä¸ªå…¨å±€çš„å“ˆå¸Œè¡¨ä¸­ï¼Œ<code>ç›¸åŒçš„å­—ç¬¦ä¸²åªä¼šå­˜å‚¨ä¸€ä»½</code>ï¼Œå› æ­¤åˆ›å»ºå¤šä¸ªå†…å®¹ç›¸åŒçš„å­—ç¬¦ä¸²ï¼Œä¸ä¼šå¤šå ç”¨å­˜å‚¨ç©ºé—´ï¼Œå­—ç¬¦ä¸²æ¯”è¾ƒæ˜¯O(1)çš„ã€‚</p>
<h2 id="table"><a class="header" href="#table">table</a></h2>
<p>tableæ˜¯Luaå”¯ä¸€æ”¯æŒçš„æ•°æ®ç»“æ„ï¼Œå®ƒæ˜¯ä¸€ä¸ª<code>å…³è”æ•°ç»„</code>ï¼Œä¸€ç§æœ‰ç‰¹æ®Šç´¢å¼•çš„æ•°ç»„ï¼Œç´¢å¼•å¯ä»¥æ˜¯nilä»¥å¤–çš„ä»»æ„ç±»å‹çš„å€¼ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªtableçš„å®šä¹‰å’Œä½¿ç”¨ï¼š</p>
<pre><code class="language-lua">local corp = {
    web = &quot;www.google.com&quot;,   --ç´¢å¼•æ˜¯å­—ç¬¦ä¸²ï¼Œkey = &quot;web&quot;, value = &quot;www.google.com&quot;
    staff = {&quot;Jack&quot;, &quot;Scott&quot;, &quot;Gary&quot;}, --ç´¢å¼•æ˜¯å­—ç¬¦ä¸²ï¼Œå€¼æ˜¯ä¸€ä¸ªtable
    100876,              --ç›¸å½“äº [1] = 100876ï¼Œç´¢å¼•ä¸ºæ•°å­—1ï¼Œkey = 1, value = 100876
    100191,              --ç›¸å½“äº [2] = 100191ï¼Œç´¢å¼•ä¸ºæ•°å­—2
    [10] = 360,          --æ˜ç¡®æŒ‡å®šæ•°å­—ç´¢å¼•10
    [&quot;city&quot;] = &quot;Beijing&quot; --ç´¢å¼•ä¸ºå­—ç¬¦ä¸²çš„å¦ä¸€ç§ä¹¦å†™å½¢å¼
}

print(corp.web)               --&gt;output:www.google.com
print(corp.staff[1])          --&gt;output:Jack
print(corp[2])                --&gt;output:100191
print(corp[10])               --&gt;output:360
print(corp[&quot;city&quot;])           --&gt;output:&quot;Beijing&quot;
</code></pre>
<p>Luaçš„tableå¯èƒ½æ˜¯ç”¨å“ˆå¸Œè¡¨å®ç°çš„ï¼Œä¹Ÿå¯èƒ½æ˜¯ç”¨æ•°ç»„å®ç°çš„ï¼Œæˆ–è€…ä¸¤è€…çš„æ··åˆï¼Œæ ¹æ®tableä¸­çš„æ•°å€¼å†³å®šã€‚</p>
<p>æ“ä½œtableçš„å‡½æ•°ï¼š</p>
<pre><code>table.remove
table.concat
</code></pre>
<h2 id="array"><a class="header" href="#array">array</a></h2>
<p>Luaè™½ç„¶åªæœ‰ä¸€ç§æ•°æ®ç»“æ„<code>table</code>ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ä¸ºtableæ·»åŠ æ•°å­—ç´¢å¼•çš„æ–¹å¼ï¼Œå®ç°æ•°ç»„ã€‚</p>
<p>ä¸€ä¸ªæ–°æ•°ç»„å°±æ˜¯ä¸€ä¸ªç©ºçš„tableï¼Œæ— æ³•æŒ‡å®šå¤§å°ï¼Œå¯ä»¥ä¸åœçš„å†™å…¥ï¼š</p>
<pre><code class="language-lua">local a = {}    -- new array
for i = 1, 1000 do
    a[i] = 0 end
end
</code></pre>
<p>é€šè¿‡<code>a[i]</code>çš„æ–¹å¼è¯»å–ï¼Œå¦‚æœiè¶…èŒƒå›´ï¼Œè¿”å›nilã€‚</p>
<p>é€šè¿‡<code>#</code>æ“ä½œç¬¦ï¼Œè·å¾—æ•°ç»„çš„é•¿åº¦ï¼š</p>
<pre><code class="language-lua">print(#a) --&gt; 1000
</code></pre>
<h2 id="function"><a class="header" href="#function">function</a></h2>
<p>å‡½æ•°Luaçš„åŸºæœ¬ç±»å‹ï¼Œå¯ä»¥å­˜å‚¨åœ¨å˜é‡ä¸­ã€‚</p>
<pre><code class="language-lua">local function foo()
    print(&quot;in the function&quot;)
    --dosomething()
    local x = 10
    local y = 20
    return x + y
end

local a = foo    --æŠŠå‡½æ•°èµ‹ç»™å˜é‡

print(a())
</code></pre>
<p><code>æœ‰åå‡½æ•°</code>å°±æ˜¯å°†ä¸€ä¸ªåŒ¿åå‡½æ•°èµ‹ç»™åŒåå˜é‡ï¼Œä¸‹é¢çš„å‡½æ•°å®šä¹‰ï¼š</p>
<pre><code class="language-lua">function foo()
end
</code></pre>
<p>ç­‰åŒäºï¼š</p>
<pre><code class="language-lua">foo = function ()
end
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="luaçš„å…³é”®å­—å’Œæ“ä½œç¬¦"><a class="header" href="#luaçš„å…³é”®å­—å’Œæ“ä½œç¬¦">Luaçš„å…³é”®å­—å’Œæ“ä½œç¬¦</a></h1>
<h2 id="å…³é”®å­—"><a class="header" href="#å…³é”®å­—">å…³é”®å­—</a></h2>
<p>LuaåŒºåˆ†å¤§å°å†™ï¼Œä¾‹å¦‚andæ˜¯ä¿ç•™å…³é”®å­—ï¼Œä½†æ˜¯Andã€ANDç­‰ä¸æ˜¯ï¼Œå¯ä»¥ä½œä¸ºæ ‡è®°ç¬¦ä½¿ç”¨ã€‚</p>
<pre><code>and       break     do        else      elseif
end       false     for       function  if
in        local     nil       not       or
repeat    return    then      true      until     while
</code></pre>
<h2 id="æ“ä½œç¬¦"><a class="header" href="#æ“ä½œç¬¦">æ“ä½œç¬¦</a></h2>
<pre><code>+     -     *     /     %     ^     #
==    ~=    &lt;=    &gt;=    &lt;     &gt;     =
(     )     {     }     [     ]
;     :     ,     .     ..    ...
</code></pre>
<h2 id="æ³¨é‡Šç¬¦"><a class="header" href="#æ³¨é‡Šç¬¦">æ³¨é‡Šç¬¦</a></h2>
<p>æ³¨é‡Šç”¨<code>--</code>æ ‡è®°ï¼Œä¸€ç›´ä½œç”¨åˆ°è¡Œå°¾ã€‚å¤šè¡Œæ³¨é‡Šï¼Œåœ¨<code>--</code>åé¢è·Ÿéš<code>[[</code>ï¼Œä¸€ç›´ä½œç”¨åˆ°<code>]]</code>ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="language-lua">--[[A multi-line
     long comment
]]
</code></pre>
<p>å¤šè¡Œæ³¨é‡Šé€šå¸¸é‡‡ç”¨ä¸‹é¢çš„æ ·å¼ï¼š</p>
<pre><code class="language-lua">--[[
    print(1)
    print(2)
    print(3)
--]]
</code></pre>
<h2 id="è¯­å¥åˆ†éš”ç¬¦"><a class="header" href="#è¯­å¥åˆ†éš”ç¬¦">è¯­å¥åˆ†éš”ç¬¦</a></h2>
<p>Luaè¯­å¥ä¹‹é—´å¯ä»¥ä½¿ç”¨â€œ;â€ä½œä¸ºåˆ†éš”ç¬¦ï¼Œä½†åˆ†éš”ç¬¦ä¸æ˜¯å¿…é¡»çš„ï¼Œå¯ä»¥æ²¡æœ‰ï¼Œå¦å¤–æ¢è¡Œç¬¦å¯¹luaæ¥è¯´ä¸å…·å¤‡è¯­æ³•ä¸Šçš„æ„ä¹‰ã€‚</p>
<pre><code class="language-lua">a = 1  b = a * 2    -- ugly, but valid
</code></pre>
<h2 id="ç®—æœ¯è¿ç®—ç¬¦"><a class="header" href="#ç®—æœ¯è¿ç®—ç¬¦">ç®—æœ¯è¿ç®—ç¬¦</a></h2>
<p>ç®—æœ¯è¿ç®—ç¬¦æœ‰ï¼š</p>
<pre><code>+  -  *  /  ^ï¼ˆæŒ‡æ•°ï¼‰  %ï¼ˆå–æ¨¡ï¼‰
</code></pre>
<p>éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯é™¤æ³•è¿ç®—ç¬¦<code>/</code>ï¼Œå®ƒçš„ç»“æœæ˜¯æµ®ç‚¹æ•°ï¼š</p>
<pre><code class="language-lua">print(5/10)      --ç»“æœæ˜¯0.2ï¼Œä¸æ˜¯0
</code></pre>
<p>Lua5.3å¼•å…¥äº†æ–°çš„ç®—æ•°è¿ç®—ç¬¦<code>//</code>ï¼Œå–æ•´é™¤æ³•ï¼ˆfloor divisionï¼‰ï¼Œç¡®ä¿è¿”å›çš„æ˜¯ä¸€ä¸ªæ•´æ•°ï¼š</p>
<blockquote>
<p>3 // 2        --&gt; 1
3.0 // 2      --&gt; 1.0
6 // 2        --&gt; 3
6.0 // 2.0    --&gt; 3.0
-9 // 2       --&gt; -5
1.5 // 0.5    --&gt; 3.0</p>
</blockquote>
<h2 id="å…³ç³»è¿ç®—ç¬¦"><a class="header" href="#å…³ç³»è¿ç®—ç¬¦">å…³ç³»è¿ç®—ç¬¦</a></h2>
<p>å…³ç³»è¿ç®—ç¬¦æœ‰ï¼š</p>
<pre><code>&lt;   &gt;  &lt;=  &gt;=  ==  ~=ï¼ˆä¸ç­‰äºï¼‰
</code></pre>
<p>ç‰¹åˆ«æ³¨æ„ï¼Œä¸ç­‰äºç”¨<code>~=</code>è¡¨ç¤ºã€‚</p>
<p>Luaä¸­çš„<code>==</code>å’Œ<code>~=</code>ï¼Œæ¯”è¾ƒçš„æ˜¯å˜é‡ç»‘å®šå¯¹è±¡æ˜¯å¦ç›¸åŒï¼Œè€Œä¸æ˜¯æ¯”è¾ƒç»‘å®šçš„å¯¹è±¡çš„å€¼ã€‚</p>
<p>ä¸‹é¢ä¸¤ä¸ªå˜é‡aã€bç»‘å®šçš„æ˜¯ä¸¤ä¸ªç›¸åŒå€¼çš„å¯¹è±¡ï¼Œaå’Œbæ˜¯ä¸ç­‰çš„ï¼š</p>
<pre><code class="language-lua">local a = { x = 1, y = 0}
local b = { x = 1, y = 0}
if a == b then
  print(&quot;a==b&quot;)
else
  print(&quot;a~=b&quot;)
end

---output:
a~=b
</code></pre>
<h2 id="é€»è¾‘è¿ç®—ç¬¦"><a class="header" href="#é€»è¾‘è¿ç®—ç¬¦">é€»è¾‘è¿ç®—ç¬¦</a></h2>
<p>é€»è¾‘è¿ç®—ç¬¦åŒ…æ‹¬ï¼š</p>
<pre><code>and   or   not
</code></pre>
<p>é€»è¾‘è¿ç®—ç¬¦<code>and</code>å’Œ<code>or</code>çš„ä¹Ÿéœ€è¦ç‰¹åˆ«æ³¨æ„ï¼Œå®ƒä»¬çš„ç»“æœä¸æ˜¯0å’Œ1ï¼Œä¹Ÿä¸æ˜¯trueå’Œfalseï¼Œè€Œæ˜¯è¿ç®—ç¬¦ä¸¤è¾¹çš„æ“ä½œæ•°ä¸­çš„ä¸€ä¸ªï¼š</p>
<pre><code class="language-lua">a and b       -- å¦‚æœ a ä¸º nilï¼Œåˆ™è¿”å› aï¼Œå¦åˆ™è¿”å› b;
a or b        -- å¦‚æœ a ä¸º nilï¼Œåˆ™è¿”å› bï¼Œå¦åˆ™è¿”å› aã€‚
</code></pre>
<p>æ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼šå¯¹äºandå’Œorï¼Œè¿”å›ç¬¬ä¸€ä¸ªä½¿è¡¨è¾¾å¼çš„ç»“æœç¡®å®šçš„æ“ä½œæ•°ã€‚</p>
<p>notçš„è¿”å›ç»“æœæ˜¯trueæˆ–è€…falseã€‚</p>
<h2 id="å­—ç¬¦ä¸²æ‹¼æ¥"><a class="header" href="#å­—ç¬¦ä¸²æ‹¼æ¥">å­—ç¬¦ä¸²æ‹¼æ¥</a></h2>
<p>å­—ç¬¦ä¸²æ‹¼æ¥è¿ç®—ç¬¦æ˜¯<code>..</code>ï¼Œå¦‚æœä¸€ä¸ªæ“ä½œæ•°æ˜¯æ•°å­—ï¼Œæ•°å­—è¢«è½¬æ¢æˆå­—ç¬¦ä¸²ã€‚</p>
<p>éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯<code>..</code>æ¯æ‰§è¡Œä¸€æ¬¡ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ã€‚</p>
<p>å¦‚æœè¦å°†å¤šä¸ªå­—ç¬¦ä¸²æ‹¼æ¥èµ·æ¥ï¼Œä¸ºäº†é«˜æ•ˆï¼Œåº”å½“æŠŠå®ƒä»¬å†™åœ¨ä¸€ä¸ªtableä¸­ï¼Œç„¶åç”¨<code>table.concat()</code>æ–¹æ³•æ‹¼æ¥ã€‚</p>
<pre><code class="language-lua">local pieces = {}
for i, elem in ipairs(my_list) do
    pieces[i] = my_process(elem)
end
local res = table.concat(pieces)
</code></pre>
<h2 id="è¿ç®—ç¬¦ä¼˜å…ˆçº§"><a class="header" href="#è¿ç®—ç¬¦ä¼˜å…ˆçº§">è¿ç®—ç¬¦ä¼˜å…ˆçº§</a></h2>
<p>ä¼˜å…ˆçº§å¦‚ä¸‹ï¼Œç”±é«˜åˆ°åº•æ’åºï¼ŒåŒä¸€è¡Œçš„ä¼˜å…ˆçº§ç›¸åŒï¼š</p>
<pre><code>^
not  #  â€ƒ-
* â€ƒ  / â€ƒ %
+ â€ƒ  -
..
&lt;â€ƒ&gt;â€ƒ &lt;=â€ƒ &gt;= â€ƒ==â€ƒ ~=
and
or
</code></pre>
<h2 id="å†’å·è¯­æ³•ç³–"><a class="header" href="#å†’å·è¯­æ³•ç³–">å†’å·è¯­æ³•ç³–</a></h2>
<p>æ¨¡å—Accountä¸­å®ç°äº†ä¸€ä¸ªå‡½æ•°withdrawï¼š</p>
<pre><code class="language-lua">Account = {balance = 0}
function Account.withdraw (v)
  Account.balance = Account.balance - v
end
</code></pre>
<p>è¿™ä¸ªwithdraw()å‡½æ•°ä¸­æ“ä½œçš„æ˜¯Account.balanceï¼Œç»‘æ­»äº†Accountï¼Œè¿™ä¸ªæ–¹æ³•åªæœ‰Accountèƒ½ç”¨ã€‚</p>
<p>å®ç°ä¸€ä¸ªèƒ½å¤Ÿæ“ä½œä»»æ„è°ƒç”¨è€…ä¸­çš„balanceå˜é‡çš„æ–¹æ³•ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„æ–¹æ³•ï¼š</p>
<pre><code class="language-lua">function Account.withdraw (self, v)
    self.balance = self.balance - v
end
</code></pre>
<p>å¯ä»¥ç”¨&quot;:&quot;è¯­æ³•ç³–è¿›è¡Œç®€åŒ–ï¼Œçœå»selfï¼š</p>
<pre><code class="language-lua">function Account:withdraw (v)
    self.balance = self.balance - v
end
</code></pre>
<p>å†’å·è¯­æ³•ç³–è‡ªåŠ¨æ·»åŠ ä¸€ä¸ªselfå½¢å‚ï¼ŒæŒ‡å‘å½“å‰çš„è°ƒç”¨è€…ã€‚</p>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="luaçš„æ¡ä»¶è¯­å¥æ§åˆ¶ç»“æ„"><a class="header" href="#luaçš„æ¡ä»¶è¯­å¥æ§åˆ¶ç»“æ„">Luaçš„æ¡ä»¶è¯­å¥æ§åˆ¶ç»“æ„</a></h1>
<p>Luaæ”¯æŒä¸‹åˆ—æ§åˆ¶ç»“æ„ï¼š</p>
<pre><code>if
while
repeat
for
break
return
</code></pre>
<h2 id="if"><a class="header" href="#if">if</a></h2>
<p><code>if-then-end</code>:</p>
<pre><code class="language-lua">x = 10
if x &gt; 0 then
    print(&quot;x is a positive number&quot;)
end
</code></pre>
<p><code>if-then-else-end</code>ï¼š</p>
<pre><code class="language-lua">x = 10
if x &gt; 0 then
    print(&quot;x is a positive number&quot;)
else
    print(&quot;x is a non-positive number&quot;)
end
</code></pre>
<p><code>if-then-[elseif-then...]-else-end</code>ï¼š</p>
<pre><code class="language-lua">score = 90
if score == 100 then
    print(&quot;Very good!Your score is 100&quot;)
elseif score &gt;= 60 then
    print(&quot;Congratulations, you have passed it,your score greater or equal to 60&quot;)
--æ­¤å¤„å¯ä»¥æ·»åŠ å¤šä¸ªelseif
else
    print(&quot;Sorry, you do not pass the exam! &quot;)
end
</code></pre>
<h2 id="while"><a class="header" href="#while">while</a></h2>
<p>æ³¨æ„Luaä¸­æ²¡æœ‰<code>continue</code>è¯­å¥ï¼Œ åªæœ‰<code>break</code>è¯­å¥å¯ä»¥åœ¨å¾ªç¯ç»“æ„ä¸­ä½¿ç”¨ã€‚</p>
<pre><code class="language-lua">x = 1
sum = 0

while x &lt;= 5 do
    sum = sum + x
    x = x + 1
end
print(sum)  --&gt;output 15
</code></pre>
<h2 id="repeat"><a class="header" href="#repeat">repeat</a></h2>
<p>å¯ä»¥åœ¨å¾ªç¯ç»“æ„ä¸­ä½¿ç”¨<code>break</code>ï¼š</p>
<pre><code class="language-lua">x = 10
repeat
    print(x)
until false    -- ä¸€ç›´falseï¼Œæ­»å¾ªç¯
</code></pre>
<h2 id="for"><a class="header" href="#for">for</a></h2>
<p>foråˆ†æ•°å€¼forï¼ˆnumeric forï¼‰å’ŒèŒƒå‹forï¼ˆgeneric forï¼‰ã€‚</p>
<h3 id="numeric-for"><a class="header" href="#numeric-for">numeric for</a></h3>
<p>æ•°å€¼forï¼Œå°±æ˜¯è®¾å®šä¸€ä¸ªå¼€å§‹æ•°å€¼ï¼ŒæŒ‰ç…§æŒ‡å®šçš„è·¨åº¦é€’å¢ï¼Œç›´åˆ°ç»“æŸå€¼ï¼š</p>
<pre><code class="language-lua">for i = 1, 5 do       -- ä»1å¢é•¿åˆ°5ï¼Œé»˜è®¤æ¯æ¬¡å¢åŠ 1
  print(i)
end

for i = 1, 10, 2 do   -- ä»1å¢é•¿åˆ°10ï¼Œæ˜ç¡®è®¾ç½®æ¯æ¬¡å¢åŠ 2
  print(i)
end
</code></pre>
<p>å¦‚æœè·¨åº¦æ˜¯è´Ÿæ•°ï¼Œåˆ™é€’å‡ï¼š</p>
<pre><code class="language-lua">for i = 10, 1, -1 do  -- ä»10é€’å‡åˆ°1ï¼Œæ¯ä¸€æ¬¡å‡å»1
  print(i)
end
</code></pre>
<h3 id="generic-for"><a class="header" href="#generic-for">generic for</a></h3>
<p>èŒƒå‹forï¼Œå°±æ˜¯ç”¨äºè¿­ä»£å™¨ï¼ˆiteratorï¼‰ï¼š</p>
<pre><code class="language-lua">local a = {&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;}
for i, v in ipairs(a) do
  print(&quot;index:&quot;, i, &quot; value:&quot;, v)
end
</code></pre>
<p><code>ipairs()</code>æ˜¯éå†æ•°ç»„çš„è¿­ä»£å™¨å‡½æ•°ï¼Œiæ˜¯ç´¢å¼•å€¼ï¼Œvæ˜¯ç´¢å¼•å¯¹åº”çš„æ•°å€¼ã€‚</p>
<p>foræ”¯æŒçš„è¿­ä»£å™¨è¿˜æœ‰ï¼š</p>
<pre><code>io.lines         è¿­ä»£æ¯è¡Œ
paris            è¿­ä»£table
ipairs           è¿­ä»£æ•°ç»„å…ƒç´ 
string.gmatch    è¿­ä»£å­—ç¬¦ä¸²ä¸­çš„å•è¯
</code></pre>
<p><a href="https://www.lua.org/manual/5.3/manual.html#pdf-ipairs">ipairs</a>æ˜¯ç›´æ¥è¿­ä»£ï¼Œè€Œ<a href="https://www.lua.org/manual/5.3/manual.html#pdf-pairs">pairs</a>æ˜¯è°ƒç”¨å…ƒæ–¹æ³•<code>__pairs</code>ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®è¯¥åŸæ–¹æ³•ï¼Œåˆ™ç”¨nextå‡½æ•°å–ä¸‹ä¸€ä¸ªæ•°å€¼ã€‚</p>
<blockquote>
<p>åœ¨ LuaJIT 2.1 ä¸­ï¼Œipairs() å‡½æ•°æ˜¯å¯ä»¥è¢« JIT ç¼–è¯‘æ‰§è¡Œçš„ï¼Œè€Œ pairs() åˆ™åªèƒ½è¢«è§£é‡Šæ‰§è¡Œã€‚</p>
</blockquote>
<h2 id="break"><a class="header" href="#break">break</a></h2>
<p>breakç”¨äºç»ˆæ­¢å¾ªç¯ã€‚</p>
<h2 id="return"><a class="header" href="#return">return</a></h2>
<p>returnç”¨äºä»å‡½æ•°ä¸­è¿”å›ç»“æœï¼Œåœ¨å‡½æ•°ä¸­ä½¿ç”¨returnçš„æ—¶å€™ï¼Œéœ€è¦ç”¨<code>do-end</code>ï¼š</p>
<pre><code class="language-lua">local function foo()
    print(&quot;before&quot;)
    do return end
    print(&quot;after&quot;)  -- è¿™ä¸€è¡Œè¯­å¥æ°¸è¿œä¸ä¼šæ‰§è¡Œåˆ°
end
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="luaçš„å‡½æ•°å®šä¹‰ä¼ å‚æ³¨æ„äº‹é¡¹å’Œè¿”å›å€¼"><a class="header" href="#luaçš„å‡½æ•°å®šä¹‰ä¼ å‚æ³¨æ„äº‹é¡¹å’Œè¿”å›å€¼">Luaçš„å‡½æ•°å®šä¹‰ï¼Œä¼ å‚æ³¨æ„äº‹é¡¹å’Œè¿”å›å€¼</a></h1>
<h2 id="å¸¸ç”¨å†…ç½®å‡½æ•°"><a class="header" href="#å¸¸ç”¨å†…ç½®å‡½æ•°">å¸¸ç”¨å†…ç½®å‡½æ•°</a></h2>
<p><a href="https://www.lua.org/manual/5.3/manual.html#pdf-table.insert">table.insert</a>ï¼š å°† value æ’å…¥ list[pos]ï¼ŒåŒæ—¶å°†åé¢çš„æ•°å€¼å‘åç§»åŠ¨ä¸€ä½ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®š pos æ·»åŠ åˆ° list å°¾éƒ¨ï¼Œpost é»˜è®¤ä¸º #list+1ã€‚</p>
<pre><code class="language-lua">table.insert (list, [pos,] value)
</code></pre>
<p><a href="https://www.lua.org/manual/5.3/manual.html#pdf-ipairs">ipairs (t)</a>ï¼šè¿­ä»£å™¨ï¼Œéå†æ•°ç»„ï¼š</p>
<pre><code class="language-lua">for i,v in ipairs(t) do body end  -- ipaires(t) è¿”å›  (1,t[1]), (2,t[2]), ...,
</code></pre>
<p><a href="https://www.lua.org/manual/5.3/manual.html#pdf-next">next</a>ï¼šè¿”å› table ä¸­æŒ‡å®šä½ç½®çš„å…ƒç´ ã€‚</p>
<pre><code class="language-sh">next (table [, index])
</code></pre>
<h2 id="å£°æ˜å®šä¹‰"><a class="header" href="#å£°æ˜å®šä¹‰">å£°æ˜å®šä¹‰</a></h2>
<p>å‡½æ•°ç”¨å…³é”®å­—<code>function</code>å®šä¹‰ï¼Œé»˜è®¤ä¸ºå…¨å±€çš„ã€‚</p>
<p>å…¨å±€å‡½æ•°ä¿å­˜åœ¨å…¨å±€å˜é‡ä¸­ï¼Œä¼šå¢åŠ æ€§èƒ½æŸè€—ï¼Œåº”å½“å°½é‡ä½¿ç”¨å±€éƒ¨å‡½æ•°ï¼Œå‰é¢åŠ ä¸Šlocalï¼š</p>
<pre><code class="language-lua">local function function_name (arc)
  -- body
end
</code></pre>
<p>å‡½æ•°è¦å®šä¹‰åæ‰èƒ½ä½¿ç”¨ï¼Œå®šä¹‰ä»£ç åœ¨å‰é¢çš„ã€‚</p>
<p>å¯ä»¥å‡½æ•°å®šä¹‰æ—¶ï¼Œç›´æ¥è®¾ç½®ä¸ºtableçš„æˆå‘˜ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-lua">function foo.bar(a, b, c)
    -- body ...
end
</code></pre>
<p>ç­‰åŒäºï¼š</p>
<pre><code class="language-lua">foo.bar = function (a, b, c)
    print(a, b, c)
end
</code></pre>
<h2 id="å‚æ•°ä¼ é€’"><a class="header" href="#å‚æ•°ä¼ é€’">å‚æ•°ä¼ é€’</a></h2>
<p>étableç±»å‹çš„å‚æ•°æ˜¯<code>æŒ‰å€¼ä¼ é€’</code>çš„ï¼Œtableç±»å‹çš„å‚æ•°ä¼ é€’çš„æ˜¯å¼•ç”¨ã€‚</p>
<p>è°ƒç”¨å‡½æ•°æ—¶ï¼Œå¦‚æœä¼ å…¥çš„å‚æ•°è¶…è¿‡å‡½æ•°å®šä¹‰ä¸­çš„å½¢å‚ä¸ªæ•°ï¼Œå¤šå‡ºçš„å®å‚è¢«å¿½ç•¥ï¼Œå¦‚æœä¼ å…¥çš„å‚æ•°å°‘äºå®šä¹‰ä¸­çš„å½¢å‚ä¸ªæ•°ï¼Œæ²¡æœ‰è¢«å®å‚åˆå§‹åŒ–çš„å½¢å‚é»˜è®¤ä¸ºnilã€‚</p>
<p>å˜é•¿å‚æ•°ç”¨<code>...</code>è¡¨ç¤ºï¼Œè®¿é—®çš„æ—¶å€™ä¹Ÿä½¿ç”¨<code>...</code>ï¼š</p>
<pre><code class="language-lua">local function func( ... )                -- å½¢å‚ä¸º ... ,è¡¨ç¤ºå‡½æ•°é‡‡ç”¨å˜é•¿å‚æ•°

   local temp = {...}                     -- è®¿é—®çš„æ—¶å€™ä¹Ÿè¦ä½¿ç”¨ ...
   local ans = table.concat(temp, &quot; &quot;)    -- ä½¿ç”¨ table.concat åº“å‡½æ•°å¯¹æ•°
                                          -- ç»„å†…å®¹ä½¿ç”¨ &quot; &quot; æ‹¼æ¥æˆå­—ç¬¦ä¸²ã€‚
   print(ans)
end
</code></pre>
<p>tableç±»å‹çš„å‚æ•°æŒ‰å¼•ç”¨ä¼ é€’ï¼Œå¯ä»¥åœ¨å‡½æ•°ä¿®æ”¹å®ƒçš„å€¼ï¼š</p>
<pre><code class="language-lua">local function change(arg)             --changeå‡½æ•°ï¼Œæ”¹å˜é•¿æ–¹å½¢çš„é•¿å’Œå®½ï¼Œä½¿å…¶å„å¢é•¿ä¸€å€
  arg.width = arg.width * 2      --è¡¨argä¸æ˜¯è¡¨rectangleçš„æ‹·è´ï¼Œä»–ä»¬æ˜¯åŒä¸€ä¸ªè¡¨
  arg.height = arg.height * 2
end                              -- æ²¡æœ‰returnè¯­å¥äº†

local rectangle = { width = 20, height = 15 }

change(rectangle)
</code></pre>
<h2 id="å‡½æ•°è¿”å›å€¼"><a class="header" href="#å‡½æ•°è¿”å›å€¼">å‡½æ•°è¿”å›å€¼</a></h2>
<p>å‡½æ•°æ˜¯å¤šå€¼è¿”å›çš„ï¼š</p>
<pre><code class="language-lua">local function swap(a, b)   -- å®šä¹‰å‡½æ•° swapï¼Œå®ç°ä¸¤ä¸ªå˜é‡äº¤æ¢å€¼
   return b, a              -- æŒ‰ç›¸åé¡ºåºè¿”å›å˜é‡çš„å€¼
end

local x = 1
local y = 20
x, y = swap(x, y)    
</code></pre>
<p>æ¥æ”¶è¿”å›å€¼çš„å˜é‡æ•°é‡å°‘äºå‡½æ•°è¿”å›çš„å€¼çš„æ•°é‡æ—¶ï¼Œå¤šå‡ºçš„è¿”å›å€¼è¢«å¿½ç•¥ï¼Œå¤§äºçš„æ—¶å€™ï¼Œå¤šå‡ºçš„æ¥æ”¶å˜é‡è¢«è®¾ç½®ä¸ºnilã€‚</p>
<p>åœ¨å¤šå˜é‡èµ‹å€¼çš„åˆ—è¡¨è¡¨è¾¾å¼ä¸­ï¼Œå¦‚æœå¤šå€¼è¿”å›çš„å‡½æ•°ä¸åœ¨æœ€åä¸€ä¸ªï¼Œé‚£ä¹ˆåªæœ‰å®ƒçš„ç¬¬ä¸€ä¸ªè¿”å›å€¼ä¼šè¢«æ¥æ”¶ï¼š</p>
<pre><code class="language-lua">local function init()       -- init å‡½æ•° è¿”å›ä¸¤ä¸ªå€¼ 1 å’Œ &quot;lua&quot;
    return 1, &quot;lua&quot;
end

local x, y, z = init(), 2   -- init å‡½æ•°çš„ä½ç½®ä¸åœ¨æœ€åï¼Œæ­¤æ—¶åªè¿”å› 1
print(x, y, z)              -- output  1  2  nil

local a, b, c = 2, init()   -- init å‡½æ•°çš„ä½ç½®åœ¨æœ€åï¼Œæ­¤æ—¶è¿”å› 1 å’Œ &quot;lua&quot;
print(a, b, c)              -- output  2  1  lua
</code></pre>
<p>æ³¨æ„å‡½æ•°çš„ä¼ å…¥å‚æ•°ä¹Ÿæ˜¯åˆ—è¡¨è¡¨è¾¾å¼ï¼Œéµå¾ªåŒæ ·çš„è§„åˆ™ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-lua">local function init()
    return 1, &quot;lua&quot;
end

print(init(), 2)   --&gt;output  1  2
print(2, init())   --&gt;output  2  1  lua
</code></pre>
<p>åˆ—è¡¨è¡¨è¾¾å¼ä¸­ï¼Œå¦‚æœè¦ç¡®ä¿å‡½æ•°åªè¿”å›ä¸€ä¸ªå€¼ï¼Œç”¨æ‹¬å·å°†å‡½æ•°åŒ…è£¹ï¼š</p>
<pre><code class="language-lua">local function init()
    return 1, &quot;lua&quot;
end

print((init()), 2)   --&gt;output  1  2
print(2, (init()))   --&gt;output  2  1
</code></pre>
<h2 id="å‡½æ•°å›è°ƒ"><a class="header" href="#å‡½æ•°å›è°ƒ">å‡½æ•°å›è°ƒ</a></h2>
<p>å‡½æ•°å›è°ƒæ—¶ï¼Œç”¨unpackå¤„ç†ä¼ å…¥çš„å˜é•¿å‚æ•°ï¼š</p>
<pre><code class="language-lua">local function run(x, y)
    print('run', x, y)
end

local function attack(targetId)
    print('targetId', targetId)
end

local function do_action(method, ...)
    local args = {...} or {}
    method(unpack(args, 1, table.maxn(args)))
end

do_action(run, 1, 2)         -- output: run 1 2
do_action(attack, 1111)      -- output: targetId    1111
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="luaçš„ä»£ç ç»„ç»‡æ–¹å¼æ¨¡å—"><a class="header" href="#luaçš„ä»£ç ç»„ç»‡æ–¹å¼æ¨¡å—">Luaçš„ä»£ç ç»„ç»‡æ–¹å¼ï¼šæ¨¡å—</a></h1>
<p>æ¨¡å—åœ¨[ç¼–ç¨‹è¯­è¨€Luaï¼ˆä¸€ï¼‰ï¼šå…¥é—¨ä»‹ç»ã€å­¦ä¹ èµ„æ–™ã€é¡¹ç›®ç®¡ç†ä¸è°ƒè¯•æ–¹æ³•-Lua Module][2]ä¸­æœ‰ä»‹ç»ã€‚</p>
<p>Luaåˆ›å»ºä¸€ä¸ªæ¨¡å—æœ€ç®€å•çš„æ–¹æ³•æ˜¯ï¼šåˆ›å»ºä¸€ä¸ªtableï¼Œå¹¶å°†æ‰€æœ‰éœ€è¦å¯¼å‡ºçš„å‡½æ•°æ”¾å…¥å…¶ä¸­ï¼Œè¿”å›è¿™ä¸ªtableã€‚</p>
<p>ä¾‹å¦‚æ¨¡å—myå¯¹åº”çš„my.luaæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code class="language-lua">local foo={}

local function getname()
    return &quot;Lucy&quot;
end

function foo.greeting()
    print(&quot;hello &quot; .. getname())
end

return foo
</code></pre>
<p>æ¨¡å—myçš„greetingå‡½æ•°å¯ä»¥è¢«è°ƒç”¨ï¼š</p>
<pre><code class="language-lua">local fp = require(&quot;my&quot;)
fp.greeting()     --&gt;output: hello Lucy
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="luaçš„å…ƒè¡¨ä½¿ç”¨"><a class="header" href="#luaçš„å…ƒè¡¨ä½¿ç”¨">Luaçš„å…ƒè¡¨ä½¿ç”¨</a></h1>
<p>Lua5.1ä¸­ï¼Œå…ƒè¡¨ç›¸å½“äºé‡æ–°å®šä¹‰æ“ä½œç¬¦ï¼Œç±»ä¼¼äºC++ä¸­çš„æ“ä½œç¬¦é‡è½½ã€‚</p>
<h2 id="å…ƒæ–¹æ³•"><a class="header" href="#å…ƒæ–¹æ³•">å…ƒæ–¹æ³•</a></h2>
<p>å…ƒè¡¨æ˜¯ä¸€ç»„<code>å…ƒæ–¹æ³•</code>ç»„æˆçš„tableï¼Œä¸€äº›å‡½æ•°æˆ–æ¨¡å—çš„å®ç°ä¸­è°ƒç”¨çš„æ˜¯å…ƒæ–¹æ³•ï¼Œå¯ä»¥å®ç°ä¸åŒçš„å…ƒæ–¹æ³•å®ç°ä¸åŒçš„è¡Œä¸ºï¼Œè€Œä¸æ›´æ”¹è°ƒç”¨è¿™äº›å…ƒæ–¹æ³•çš„å‡½æ•°æˆ–è€…æ¨¡å—çš„å®ç°ä»¥åŠä½¿ç”¨æ–¹å¼ã€‚</p>
<p>å…ƒæ–¹æ³•æœ‰ç‚¹ç±»ä¼¼äºâ€œæ¥å£â€ï¼Œluaæ”¯æŒä»¥ä¸‹å…ƒæ–¹æ³•ï¼š</p>
<pre><code>&quot;__add&quot;         + æ“ä½œ
&quot;__sub&quot;         - æ“ä½œ å…¶è¡Œä¸ºç±»ä¼¼äº &quot;add&quot; æ“ä½œ
&quot;__mul&quot;         * æ“ä½œ å…¶è¡Œä¸ºç±»ä¼¼äº &quot;add&quot; æ“ä½œ
&quot;__div&quot;         / æ“ä½œ å…¶è¡Œä¸ºç±»ä¼¼äº &quot;add&quot; æ“ä½œ
&quot;__mod&quot;         % æ“ä½œ å…¶è¡Œä¸ºç±»ä¼¼äº &quot;add&quot; æ“ä½œ
&quot;__pow&quot;         ^ ï¼ˆå¹‚ï¼‰æ“ä½œ å…¶è¡Œä¸ºç±»ä¼¼äº &quot;add&quot; æ“ä½œ
&quot;__unm&quot;         ä¸€å…ƒ - æ“ä½œ
&quot;__concat&quot;      .. ï¼ˆå­—ç¬¦ä¸²è¿æ¥ï¼‰æ“ä½œ
&quot;__len&quot;         # æ“ä½œ
&quot;__eq&quot;          == æ“ä½œ å‡½æ•° getcomphandler å®šä¹‰äº† Lua æ€æ ·é€‰æ‹©ä¸€ä¸ªå¤„ç†å™¨æ¥ä½œæ¯”è¾ƒæ“ä½œ ä»…åœ¨ä¸¤ä¸ªå¯¹è±¡ç±»å‹ç›¸åŒä¸”æœ‰å¯¹åº”æ“ä½œç›¸åŒçš„å…ƒæ–¹æ³•æ—¶æ‰èµ·æ•ˆ
&quot;__lt&quot;          &lt; æ“ä½œ
&quot;__le&quot;          &lt;= æ“ä½œ
&quot;__index&quot;       å–ä¸‹æ ‡æ“ä½œç”¨äºè®¿é—® table[key]
&quot;__newindex&quot;    èµ‹å€¼ç»™æŒ‡å®šä¸‹æ ‡ table[key] = value
&quot;__tostring&quot;    è½¬æ¢æˆå­—ç¬¦ä¸²
&quot;__call&quot;        å½“ Lua è°ƒç”¨ä¸€ä¸ªå€¼æ—¶è°ƒç”¨
&quot;__mode&quot;        ç”¨äºå¼±è¡¨(week table)
&quot;__metatable&quot;   ç”¨äºä¿æŠ¤metatableä¸è¢«è®¿é—®
</code></pre>
<p><code>å…ƒæ–¹æ³•</code>ä¸­ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯<code>self</code>ï¼Œä¸‹é¢æ˜¯åŒ…å«__indexå…ƒæ–¹æ³•çš„å…ƒè¡¨ï¼š</p>
<pre><code class="language-lua">{__index = function(self, key)            --å…ƒè¡¨ä¸­é‡æ–°å®ç°äº†__index
    if key == &quot;key2&quot; then
      return &quot;metatablevalue&quot;
    end
  end
}
</code></pre>
<h2 id="è®¾ç½®å…ƒè¡¨"><a class="header" href="#è®¾ç½®å…ƒè¡¨">è®¾ç½®å…ƒè¡¨</a></h2>
<p>å…ƒè¡¨è¦ç»‘å®šåˆ°tableå˜é‡ï¼Œç”¨å‡½æ•°<code>setmetatable(table, metatable)</code>è®¾ç½®ï¼Œä»¥è®¾ç½®__indexå…ƒæ–¹æ³•ä¸ºä¾‹ï¼š</p>
<pre><code class="language-lua">mytable = setmetatable({key1 = &quot;value1&quot;},   --åŸå§‹è¡¨
  {__index = function(self, key)            --å…ƒè¡¨ä¸­é‡æ–°å®ç°äº†__index
    if key == &quot;key2&quot; then
      return &quot;metatablevalue&quot;
    end
  end
})
</code></pre>
<p>print(mytable.key1,mytable.key2)            --&gt; outputï¼švalue1 metatablevalue</p>
<p><code>__index</code>å…ƒæ–¹æ³•æœ‰ç‚¹ç‰¹æ®Šï¼Œå®ƒå¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªtableï¼š</p>
<pre><code class="language-lua">t = setmetatable({[1] = &quot;hello&quot;}, {__index = {[2] = &quot;world&quot;}})
print(t[1], t[2])   --&gt;hello world
</code></pre>
<p>ä¸Šé¢åä¸ºtçš„tableä¸­,t[2]æ˜¯å­˜æ”¾åœ¨å…ƒæ–¹æ³•<code>__index</code>ä¸­çš„ï¼Œå½“åœ¨tä¸­æ‰¾ä¸åˆ°å¯¹åº”çš„keyæ—¶ï¼Œåˆ°<code>__index</code>ä¸­æŸ¥æ‰¾ã€‚
è¿™ä¸ªç‰¹æ€§åœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹ç”¨åˆ°ã€‚</p>
<p>å‡½æ•°<code>getmetatable(table)</code>å¯ä»¥è¯»å–tableçš„å…ƒè¡¨ã€‚</p>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="luaçš„é¢å‘å¯¹è±¡è®¾è®¡æ–¹æ³•"><a class="header" href="#luaçš„é¢å‘å¯¹è±¡è®¾è®¡æ–¹æ³•">Luaçš„é¢å‘å¯¹è±¡è®¾è®¡æ–¹æ³•</a></h1>
<p>Luaçš„é¢å‘å¯¹è±¡è®¾è®¡æ–¹æ³•å¾ˆä¸ç›´è§‚ï¼ŒLuaä¸­çš„ç±»å°±æ˜¯æ¨¡å—ï¼Œå€ŸåŠ©å…ƒè¡¨ä½¿æ¨¡å—å…·æœ‰äº†ç±»çš„å±æ€§ï¼Œèƒ½å¤Ÿå®ä¾‹åŒ–ã€‚</p>
<h2 id="ç±»çš„å®ç°"><a class="header" href="#ç±»çš„å®ç°">ç±»çš„å®ç°</a></h2>
<p>Luaä¸­ç±»çš„å®ç°æ–¹æ³•ï¼Œä¸€ä¸ªæ¨¡å—æ–‡ä»¶account.luaå†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code class="language-lua">local _M = {}

local mt = { __index = _M }

function _M.deposit (self, v)
    self.balance = self.balance + v
end

function _M.withdraw (self, v)
    if self.balance &gt; v then
        self.balance = self.balance - v
    else
        error(&quot;insufficient funds&quot;)
    end
end

function _M.new (self, balance)
    balance = balance or 0
    return setmetatable({balance = balance}, mt)
end

return _M
</code></pre>
<p>ç±»çš„æ–¹æ³•åœ¨<code>_M</code>è¡¨ä¸­ï¼Œè€Œ_Mè¡¨åˆè¢«èµ‹ç»™äº†å…ƒæ–¹æ³•<code>__index</code>ï¼ŒåŒ…å«__indexæ–¹æ³•çš„å…ƒè¡¨mtè¢«ç»‘å®šåˆ°ç±»å®ä¾‹åŒ–æ—¶åˆ›å»ºçš„tableå˜é‡ï¼Œç»‘å®šäº†å…ƒè¡¨mtçš„tableå˜é‡å°±æ˜¯ç±»çš„å¯¹è±¡ã€‚</p>
<p>æ¨¡å—account.luaè¿”å›çš„æ˜¯<code>_M</code>ï¼Œè°ƒç”¨_Mä¸­çš„newæ–¹æ³•çš„æ—¶å€™ï¼Œæ¨¡å—ä¸­çš„å…ƒè¡¨mtç»‘å®šåˆ°åˆ°ä¸€ä¸ªæ–°çš„tableå˜é‡ï¼Œä¼ å…¥çš„å‚æ•°ä¹Ÿè¢«å†™å…¥äº†è¿™ä¸ªæ–°çš„tableå˜é‡ä¸­ï¼ˆ{balance = balance}ï¼‰ï¼Œè¿”å›çš„tableå°±å¯ä»¥è°ƒç”¨mtä¸­çš„æ–¹æ³•å’Œä¼ å…¥çš„å‚æ•°ã€‚</p>
<pre><code class="language-lua">local account = require(&quot;account&quot;)

local a = account:new()
a:deposit(100)

local b = account:new()
b:deposit(50)

print(a.balance)  --&gt; output: 100
print(b.balance)  --&gt; output: 50
</code></pre>
<p>æ€»ç»“ä¸€ä¸‹ï¼Œåœ¨Luaä¸­ç±»çš„å®ç°æ–¹æ³•ï¼š</p>
<pre><code>1. åˆ›å»ºä¸€ä¸ªæ¨¡å—
2. åœ¨æ¨¡å—ä¸­åˆ›å»ºä¸€ä¸ªå…ƒè¡¨ï¼Œ__indexå…ƒæ–¹æ³•å°±æ˜¯æ¨¡å—æœ¬èº«
3. åœ¨æ¨¡å—ä¸­åˆ›å»ºä¸€ä¸ªnew()å‡½æ•°ï¼Œè¿”å›ç»‘å®šäº†æ¨¡å—ä¸­çš„å…ƒè¡¨çš„tableç±»å‹çš„å˜é‡ã€‚
</code></pre>
<h2 id="ç»§æ‰¿"><a class="header" href="#ç»§æ‰¿">ç»§æ‰¿</a></h2>
<p>ç»§æ‰¿çš„å®ç°å°±æ›´éº»çƒ¦äº†....</p>
<p>å®ç°ä¸€ä¸ªçˆ¶ç±»ï¼Œå°±æ˜¯ä¸€ä¸ªæ™®é€šçš„ç±»ï¼Œå®ç°äº†æ–¹æ³•<code>upper()</code>ï¼š</p>
<pre><code class="language-lua">-- çˆ¶ç±» s_base.lua
local _M = {}

local mt = { __index = _M }

function _M.upper (s)
    return string.upper(s)
end

return _M
</code></pre>
<p>å­ç±»çš„å®ç°ï¼Œå­ç±»å¼•ç”¨çˆ¶ç±»æ‰€åœ¨çš„æ¨¡å—ï¼Œå°†çˆ¶ç±»ä½œä¸ºå­ç±»__indexå…ƒæ–¹æ³•ï¼Œå­ç±»åªå®ç°äº†æ–¹æ³•<code>lower()</code>ï¼š</p>
<pre><code class="language-lua">--å­ç±» s_more.luaï¼Œå¼•å…¥äº†çˆ¶ç±»å¯¹åº”çš„æ¨¡å—
local s_base = require(&quot;s_base&quot;)

local _M = {}
_M = setmetatable(_M, { __index = s_base })


function _M.lower (s)
    return string.lower(s)
end

return _M
</code></pre>
<p>å­ç±»çš„å¯¹è±¡æ—¢èƒ½ä½¿ç”¨å­ç±»ä¸­çš„<code>lower()</code>ï¼Œä¹Ÿèƒ½ä½¿ç”¨çˆ¶ç±»ä¸­çš„<code>upper()</code>ã€‚</p>
<pre><code class="language-lua">local s_more = require(&quot;s_more&quot;)

print(s_more.upper(&quot;Hello&quot;))   -- output: HELLO
print(s_more.lower(&quot;Hello&quot;))   -- output: hello
</code></pre>
<h2 id="ç§æœ‰æˆå‘˜"><a class="header" href="#ç§æœ‰æˆå‘˜">ç§æœ‰æˆå‘˜</a></h2>
<p>ç§æœ‰æˆå‘˜çš„å®ç°éå¸¸trickï¼Œä¸‹é¢çš„ä¾‹å­ä¸­å®ç°äº†ç§æœ‰æˆå‘˜balanceï¼š</p>
<pre><code class="language-lua">function newAccount (initialBalance)
    local self = {balance = initialBalance}
    local withdraw = function (v)
        self.balance = self.balance - v
    end
    local deposit = function (v)
        self.balance = self.balance + v
    end
    local getBalance = function () return self.balance end
    return {
        withdraw = withdraw,
        deposit = deposit,
        getBalance = getBalance
    }
end

a = newAccount(100)
a.deposit(100)
print(a.getBalance()) --&gt; 200
print(a.balance)      --&gt; nil
</code></pre>
<p>newAccount()è¿”å›çš„tableä¸­åªæœ‰<code>withdraw</code>ã€<code>deposit</code>å’Œ<code>getBalance</code>ï¼Œè¿™ä¸‰ä¸ªæ–¹æ³•éƒ½æ“ä½œåŒä¸€ä¸ªéšè—çš„tableï¼Œè¿™ä¸ªéšè—çš„tableä¸­çš„æˆå‘˜å°±æ˜¯ç§æœ‰æˆå‘˜ã€‚æ„Ÿè§‰å¾ˆä¸ç›´è§‚ï¼Œä½†æ˜¯ä¼¼ä¹æ­ç¤ºäº†é¢å‘å¯¹è±¡çš„æœ¬è´¨...</p>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="luaçš„æ ‡å‡†è¾“å‡º"><a class="header" href="#luaçš„æ ‡å‡†è¾“å‡º">Luaçš„æ ‡å‡†è¾“å‡º</a></h1>
<p>åœ¨å†™ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œç‰¹åˆ«æ˜¯å¼€å§‹å­¦ä¹ ä¸€é—¨è¯­è¨€çš„æ—¶å€™ï¼Œæœ€å¸¸ç”¨çš„åŠŸèƒ½å°±æ˜¯â€œæ ‡å‡†è¾“å‡ºâ€ï¼šå°†å˜é‡çš„æ•°å€¼æˆ–è€…ç±»å‹ç­‰ï¼Œæ‰“å°åˆ°å±å¹•ä¸Šæˆ–è€…æ—¥å¿—ä¸­ï¼Œçœ‹ä¸€ä¸‹æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚</p>
<p>ä¸‹é¢çš„ä½¿ç”¨å‡½æ•°å¤§å¤šæ•°éƒ½åœ¨ç¬¬ä¸€æ¬¡å‡ºç°çš„æ—¶å€™ï¼Œè®¾ç½®äº†è¶…é“¾æ¥ï¼Œè¿æ¥åˆ° <a href="https://www.lua.org/manual/5.3/">Lua5.3 Reference Manual</a>ï¼Œå¦‚æœä½ ä½¿ç”¨çš„Luaç‰ˆæœ¬æ˜¯5.1ï¼Œå¯ä»¥åˆ° <a href="https://www.lua.org/manual/5.1/">Lua 5.1 Reference Manual</a> ä¸­æŸ¥æ‰¾è¿™äº›å‡½æ•°çš„è¯´æ˜ã€‚</p>
<h2 id="ç›´æ¥è¾“å‡º"><a class="header" href="#ç›´æ¥è¾“å‡º">ç›´æ¥è¾“å‡º</a></h2>
<p><a href="https://www.lua.org/manual/5.3/manual.html#pdf-print">print(Â·Â·Â·)</a> å‡½æ•°æ˜¯æœ€ç®€å•çš„æ ‡å‡†è¾“å‡ºå‡½æ•°ï¼Œå®ƒå°†æ‰€æœ‰å‡ºå…¥å‚æ•°æ‰“å°å‡ºæ¥ï¼Œå‚æ•°å¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼Œprintå‡½æ•°ç”¨ <a href="https://www.lua.org/manual/5.3/manual.html#pdf-tostring">tostring</a> å‡½æ•°å°†è¾“å…¥å‚æ•°è½¬æ¢æˆå­—ç¬¦ä¸²ã€‚</p>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯printå‡½æ•°ä¸æ”¯æŒæ ¼å¼åŒ–è¾“å‡ºã€‚</p>
</blockquote>
<p>ä¸‹é¢è¿™æ®µä»£ç å±•ç¤ºäº†Luaä¸­çš„ä¸åŒç±»å‹çš„å˜é‡ï¼Œç”¨printè¾“å‡ºæ˜¯çš„æ•ˆæœï¼š</p>
<pre><code class="language-lua">local number=0.2
local string=&quot;this is a string&quot;
local table = {first=&quot;value1&quot;,second=&quot;value2&quot;}
local array = {&quot;a&quot;,&quot;b&quot;,&quot;c&quot;}

print(&quot;parameter is nil(&quot;, type(nil),&quot;)&quot;,nil)
print(&quot;parameter is boolen(&quot;, type(true),&quot;)&quot;,true)
print(&quot;parameter is number(&quot;, type(number),&quot;)&quot;, number)
print(&quot;parameter is string(&quot;, type(string),&quot;)&quot;, string)
print(&quot;parameter is function(&quot;, type(print),&quot;)&quot;,print)
print(&quot;parameter is userdata(&quot;, type(io.stdin),&quot;)&quot;, io.stdin)
print(&quot;parameter is table(&quot;, type(table),&quot;)&quot;, table)
print(&quot;parameter is array(&quot;, type(array),&quot;)&quot;, array)
</code></pre>
<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<pre><code class="language-sh">parameter is nil(	nil	)	nil
parameter is boolen(	boolean	)	true
parameter is number(	number	)	0.2
parameter is string(	string	)	this is a string
parameter is table(	table	)	table: 0x7f828ec08860
parameter is array(	table	)	table: 0x7f828ec08930
parameter is function(	function	)	function: 0x7f828ec03e70
parameter is userdata(	userdata	)	file (0x7fffaa221110)
</code></pre>
<p>arrayæ˜¯ä¸€ç§ç‰¹æ®Šçš„tableï¼Œå®ƒä»¬çš„åŒºåˆ«åœ¨æ•°æ®ç»“æ„ç« èŠ‚è®²è§£ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯<code>table</code>ã€<code>function</code>å’Œ<code>userdata</code>ç±»å‹ï¼Œè¾“å‡ºçš„éƒ½æ˜¯åœ°å€ã€‚</p>
<h2 id="æ ¼å¼åŒ–è¾“å‡º"><a class="header" href="#æ ¼å¼åŒ–è¾“å‡º">æ ¼å¼åŒ–è¾“å‡º</a></h2>
<p><a href="https://www.lua.org/manual/5.3/manual.html#pdf-string.format">string.format</a>å‡½æ•°ï¼Œä¸ISO Cçš„sprintfå‡½æ•°çš„ç”¨æ³•åŸºæœ¬ç›¸åŒï¼Œä½†æ˜¯ä¸æ”¯æŒä¿®é¥°ç¬¦<code>*</code>ã€<code>h</code>ã€ <code>L</code>ã€ <code>l</code>ã€ <code>n</code>ã€ <code>p</code>ï¼Œå¢åŠ äº†ä¸€ä¸ªæ–°çš„ä¿®é¥°ç¬¦<code>q</code>ã€‚</p>
<p><code>q</code>ä¿®é¥°ç¬¦è¡¨ç¤ºä¸ºå­—ç¬¦ä¸²ä¸­å­—ç¬¦æ·»åŠ è½¬ä¹‰å­—ç¬¦ï¼Œè½¬æ¢æˆå¯ä»¥è¢«luaå®‰å…¨è¯»å–çš„æ ·å¼ï¼š</p>
<pre><code class="language-lua">print(&quot;-- format output&quot;)
v = string.format('%q', 'a string with &quot;quotes&quot; and \n new line')
print(v)
</code></pre>
<p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code>-- format output
&quot;a string with \&quot;quotes\&quot; and \
 new line&quot;
</code></pre>
<h2 id="tableçš„è¾“å‡º"><a class="header" href="#tableçš„è¾“å‡º">tableçš„è¾“å‡º</a></h2>
<p>å¯¹äºtableç±»å‹ï¼Œæˆ‘ä»¬æ›´å¸Œæœ›çœ‹åˆ°çš„æ˜¯å®ƒé‡Œé¢å­˜æ”¾çš„å€¼ï¼Œè€Œä¸æ˜¯å®ƒæœ¬èº«çš„åœ°å€ã€‚åœ¨Luaä¸­è¾“å‡ºtableçš„å†…å®¹æ¯”è¾ƒéº»çƒ¦ï¼Œéœ€è¦ç”¨ <a href="https://www.lua.org/manual/5.3/manual.html#pdf-pairs">pairs</a> å‡½æ•°éå†ã€‚</p>
<p><code>pairs(t)</code>å‡½æ•°è°ƒç”¨ä¼ å…¥å‚æ•°çš„åä¸º<code>__pairs</code>çš„å…ƒæ–¹æ³•éå†tableä¸­çš„æˆå‘˜ï¼Œpairså¯ä»¥éå†æ‰€æœ‰ç±»å‹çš„tableï¼Œå¦ä¸€ä¸ªéå†å‡½æ•° <a href="https://www.lua.org/manual/5.3/manual.html#pdf-ipairs">ipairs</a> åªèƒ½éå†æ•°ç»„ç±»å‹çš„tableã€‚</p>
<p>ç”¨pairså’Œipairséå†tableï¼š</p>
<pre><code class="language-lua">local table = {first=&quot;value1&quot;,second=&quot;value2&quot;}

print(&quot;--- iterate table by pairs  &quot;)
for i, v in pairs(table) do
    print(i ,v)
end

print(&quot;--- iterate table by ipairs  &quot;)
for i, v in ipairs(table) do
    print(i ,v)
end
</code></pre>
<p>ç»“æœå¦‚ä¸‹ï¼Œipairsæ²¡æœ‰éå†è¾“å‡ºï¼š</p>
<pre><code>--- iterate table by pairs
second	value2
first	value1
--- iterate table by ipairs
</code></pre>
<p>ç”¨pairså’Œipairséå†arrayç±»å‹çš„tableï¼š</p>
<pre><code class="language-lua">	local array = {&quot;a&quot;,&quot;b&quot;,&quot;c&quot;}
	
	print(&quot;--- iterate array by pairs &quot;)
	for i, v in pairs(array) do
	    print(i ,v)
	end
	
	print(&quot;--- iterate array by ipairs &quot;)
	for i, v in ipairs(array) do
	    print(i ,v)
	end
</code></pre>
<p>ç»“æœå¦‚ä¸‹ï¼Œè¾“å‡ºç›¸åŒï¼š</p>
<pre><code>--- iterate array by pairs 
1	a
2	b
3	c
--- iterate array by ipairs 
1	a
2	b
3	c
</code></pre>
<p>ipairsäº‹å®æ˜¯åœ¨ç”¨ä»1å¼€å§‹çš„ä¸‹æ ‡ï¼Œå–å‡ºarrayç±»å‹tableä¸­çš„æˆå‘˜ã€‚</p>
<h2 id="è½¬æ¢æˆjsonå­—ç¬¦ä¸²è¾“å‡º"><a class="header" href="#è½¬æ¢æˆjsonå­—ç¬¦ä¸²è¾“å‡º">è½¬æ¢æˆjsonå­—ç¬¦ä¸²è¾“å‡º</a></h2>
<p>luaæœ‰å¾ˆå¤šä¸ª<a href="http://lua-users.org/wiki/JsonModules">jsonæ¨¡å—</a>ï¼Œå¯ä»¥è€ƒè™‘å°†tableç­‰ç±»å‹çš„å˜é‡è½¬æ¢æˆjsonå­—ç¬¦ä¸²åè¾“å‡ºã€‚</p>
<p><a href="http://lua-users.org/wiki/JsonModules">jsonæ¨¡å—</a>ä¸­çš„å¤šä¸ªjsonæ¨¡å—ï¼Œä»¥åŠç”¨luarockså‘½ä»¤æ‰¾åˆ°çš„å¤šä¸ªjsonæ¨¡å—ï¼Œå­°ä¼˜å­°ç•¥ï¼Œæˆ‘ä¸èƒ½åˆ¤å®šï¼Œ</p>
<pre><code class="language-bash">$ luarocks search json
json - Search results for Lua 5.1:
==================================

Rockspecs and source rocks:
---------------------------

dkjson
   2.5-2 (rockspec) - https://luarocks.org

...(çœç•¥)...
</code></pre>
<p>ä¸‹é¢åªæ¼”ç¤º&quot;luajson&quot;çš„ç”¨ï¼Œå®‰è£…æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="language-bash">$ luarocks install luajson
Installing https://luarocks.org/luajson-1.3.4-1.src.rock
...(çœç•¥)...
</code></pre>
<p>ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="language-lua">local json = require &quot;json&quot;

local table={first=&quot;value1&quot;, second=&quot;value2&quot;}
v = json.encode(table)
print(v)

local array={&quot;a&quot;,&quot;b&quot;,&quot;c&quot;,1,2,3}
v = json.encode(array)
print(v)
</code></pre>
<p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code class="language-json">{&quot;second&quot;:&quot;value2&quot;,&quot;first&quot;:&quot;value1&quot;}
[&quot;a&quot;,&quot;b&quot;,&quot;c&quot;,1,2,3]
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="luaçš„å­—ç¬¦ä¸²æ“ä½œ"><a class="header" href="#luaçš„å­—ç¬¦ä¸²æ“ä½œ">Luaçš„å­—ç¬¦ä¸²æ“ä½œ</a></h1>
<p>æ“ä½œå­—ç¬¦ä¸²ï¼Œå¤§æ¦‚æ˜¯æ¯”â€œæ ‡å‡†è¾“å‡ºâ€æ›´å¸¸ç”¨çš„æ“ä½œï¼Œæœ´ç´ åœ°è®²ï¼Œå†™ä»£ç å°±æ˜¯åœ¨å¤„ç†æ•°å­—å’Œå­—ç¬¦ä¸²ã€‚</p>
<p>Luaæœ‰ä¸€ä¸ªåä¸º<code>string</code>çš„æ ‡å‡†åº“ï¼š<a href="https://www.lua.org/manual/5.3/manual.html#6.4" title="Lua 5.3: String Manipulation">String Manipulation</a>ã€‚</p>
<p>åœ¨OpenRestyä¸­ï¼Œé™¤äº†å¯ä»¥ä½¿ç”¨Luaçš„æ ‡å‡†åº“ï¼Œè¿˜å¯ä»¥ä½¿ç”¨<a href="https://github.com/openresty/lua-nginx-module#nginx-api-for-lua">Nginx API for Lua</a>ä¸­çš„<code>ngx.re.match</code>ã€<code>ngx.re.find</code>ã€<code>ngx.re.gmatch</code>ã€<code>ngx.re.sub</code>å’Œ<code>ngx.re.gsub</code>ã€‚</p>
<h2 id="luaçš„æ­£åˆ™è¡¨è¾¾å¼è¯­æ³•"><a class="header" href="#luaçš„æ­£åˆ™è¡¨è¾¾å¼è¯­æ³•">Luaçš„æ­£åˆ™è¡¨è¾¾å¼è¯­æ³•</a></h2>
<p>æ­£åˆ™è¡¨è¾¾å¼ä¸æ˜¯ä¸€ç§æ ‡å‡†çš„è¡¨ç¤ºæ–¹æ³•ï¼Œä¸åŒè¯­è¨€ã€ä¸åŒå·¥å…·çš„æ­£åˆ™è¡¨è¾¾å¼è¯­æ³•å¯èƒ½æœ‰å·®å¼‚ã€‚</p>
<p>Luaçš„<a href="https://www.lua.org/manual/5.3/manual.html#6.4" title="Lua 5.3: String Manipulation">stringæ ‡å‡†åº“</a>ä½¿ç”¨çš„æ­£åˆ™è¡¨è¾¾å¼çš„è¯­æ³•åœ¨<a href="https://www.lua.org/manual/5.3/manual.html#6.4.1" title="Lua 5.3: Patterns">6.4.1 Patterns</a>ä¸­æœ‰è¯¦ç»†è¯´æ˜ã€‚</p>
<p>Luaçš„æ­£åˆ™è¡¨è¾¾å¼æ”¯æŒä»¥ä¸‹å­—ç¬¦é›†åˆï¼ˆCharacter Classï¼‰ï¼š</p>
<pre><code>^$()%.[]*+-?   è¿™äº›å­—ç¬¦ä»¥å¤–çš„å­—ç¬¦åŒ¹é…çš„éƒ½æ˜¯å­—ç¬¦è‡ªèº«
.              åŒ¹é…æ‰€æœ‰å­—ç¬¦
%a             åŒ¹é…æ‰€æœ‰å­—æ¯
%c             åŒ¹é…æ‰€æœ‰æ§åˆ¶å­—ç¬¦
%d             åŒ¹é…æ‰€æœ‰æ•°å­—
%g             åŒ¹é…ç©ºç™½å­—ç¬¦ä»¥å¤–çš„æ‰€æœ‰å¯æ‰“å°å­—ç¬¦
%l             åŒ¹é…æ‰€æœ‰çš„å°å†™å­—æ¯
%p             åŒ¹é…æ‰€æœ‰çš„æ ‡ç‚¹ç¬¦å·
%s             åŒ¹é…æ‰€æœ‰çš„ç©ºç™½å­—ç¬¦
%u             åŒ¹é…æ‰€æœ‰çš„å¤§å†™å­—æ¯
%w             åŒ¹é…æ‰€æ¬²çš„å­—æ¯å’Œæ•°å­—
%x             åŒ¹é…æ‰€æœ‰çš„åå…­è¿›åˆ¶æ•°å­—
%x             å¦‚æœxä¸æ˜¯å­—æ¯å’Œæ•°å­—ï¼Œé‚£ä¹ˆåŒ¹é…xæœ¬èº«ï¼Œå¯ä»¥ç”¨è¿™ç§æ–¹å¼åŒ¹é…å…·æœ‰ç‰¹æ®Šå«ä¹‰çš„å­—ç¬¦
[set]          åŒ¹é…setä¸­å‡ºç°è¿‡çš„å­—ç¬¦ï¼Œsetä¸­å¯ä»¥å‰é¢çš„å­—ç¬¦åŒ¹é…ï¼Œä¾‹å¦‚%aç­‰        
[^set]         åŒ¹é…setä»¥å¤–çš„å­—ç¬¦ï¼Œ[set]å­—ç¬¦é›†åˆçš„è¡¥é›†
</code></pre>
<p>å¯¹äºç”¨<code>%å°å†™å­—æ¯</code>è¡¨ç¤ºçš„å­—ç¬¦é›†åˆï¼Œå¯¹åº”çš„<code>%å¤§å†™å­—æ¯</code>æ˜¯å¯¹åº”å­—ç¬¦é›†åˆçš„è¡¥é›†ã€‚</p>
<p>Luaçš„æ­£åˆ™è¡¨è¾¾å¼æ”¯æŒä¸‹é¢çš„æ¨¡å¼å•ä½ï¼ˆPattern Itemï¼‰ï¼š</p>
<pre><code>*              å‰é¢çš„å­—ç¬¦å‡ºç°0æ¬¡ä»¥ä¸Šï¼Œæœ€é•¿åŒ¹é… 
+              å‰é¢çš„å­—ç¬¦å‡ºç°1æ¬¡ä»¥ä¸Šï¼Œæœ€é•¿åŒ¹é…
-              å‰é¢çš„å­—ç¬¦å‡ºç°0æ¬¡ä»¥ä¸Šï¼Œæœ€çŸ­åŒ¹é…
?              å‰é¢çš„å­—ç¬¦å‡ºç°1æ¬¡
%n             nä¸º1-9çš„æ•°å­—ï¼Œåˆ†åˆ«è¡¨ç¤ºç¬¬nä¸ªæ•è·çš„å†…å®¹
%bxy           x,yä¸ºä¸åŒçš„å­—ç¬¦ï¼ŒåŒ¹é…ä»¥xå¼€å¤´ä»¥yç»“å°¾çš„å­—ç¬¦ä¸²ï¼Œxå’Œyæ˜¯é…å¯¹å‡ºç°çš„ï¼Œæ¯”å¦‚%b()
%f[set]        åŒ¹é…setä¸­çš„å­—ç¬¦ç¬¬ä¸€æ¬¡å‡ºç°çš„åœ°æ–¹
</code></pre>
<p>ä¸€ä¸ªæˆ–å¤šä¸ªæ¨¡å¼å•ä½ç»„åˆæˆæ¨¡å¼ï¼ˆPatternï¼‰ï¼Œç”¨<code>^</code>è¡¨ç¤ºç›®æ ‡å­—ç¬¦ä¸²çš„å¼€å§‹ä½ç½®ï¼Œç”¨<code>$</code>è¡¨ç¤ºç›®æ ‡å­—ç¬¦ä¸²çš„ç»“æŸä½ç½®ã€‚</p>
<p>æ­£åˆ™è¡¨è¾¾å¼ä¸­å¯ä»¥åµŒå¥—æ­£åˆ™ï¼ŒåµŒå¥—çš„æ­£åˆ™ä½äº<code>()</code>ä¸­ï¼Œè¢«åµŒå¥—çš„æ­£åˆ™åŒ¹é…çš„å†…å®¹å¯ä»¥è¢«æ•è·(Captures)ï¼Œå¯ä»¥ç”¨%næå–ç¬¬nä¸ª<code>(</code>å¯¹åº”çš„åµŒå¥—æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„å†…å®¹ã€‚</p>
<p>ä¾‹å¦‚<code>(a*(.)%w(%s*))</code>ï¼Œ%1æ˜¯<code>a*(.)%w(%s*)</code>åŒ¹é…çš„å†…å®¹ï¼Œ%2æ˜¯<code>(.)</code>åŒ¹é…çš„å†…å®¹ï¼Œ%3æ˜¯<code>(%s*)</code>åŒ¹é…çš„å†…å®¹ã€‚</p>
<h2 id="å­—ç¬¦ä¸²æ­£åˆ™åŒ¹é…"><a class="header" href="#å­—ç¬¦ä¸²æ­£åˆ™åŒ¹é…">å­—ç¬¦ä¸²æ­£åˆ™åŒ¹é…</a></h2>
<p><a href="https://www.lua.org/manual/5.3/manual.html#pdf-string.gmatch" title="Lua 5.3: string.gmatch">string.gmatch</a>ç”¨æ¥å¯¹å­—ç¬¦ä¸²åšå…¨å±€åŒ¹é…ï¼Œä¼šå¯¹åŒ¹é…åå‰©ä½™çš„å­—ç¬¦ä¸²ç»§ç»­åŒ¹é…ï¼Œç›´åˆ°å­—ç¬¦ä¸²ç»“æŸï¼Œä»¥è¿­ä»£å™¨çš„æ–¹å¼è¿”å›æ¯æ¬¡åŒ¹é…ä¸­æ•è·çš„å­—ç¬¦ä¸²ï¼Œå¦‚æœæ­£åˆ™è¡¨è¾¾å¼ä¸­æ²¡æœ‰æ•è·ï¼Œè¿”å›æ•´ä¸ªæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„å†…å®¹ã€‚</p>
<p>ä¸‹é¢çš„ä»£ç ï¼Œæ­£åˆ™ä¸­æ²¡æœ‰æœ‰åµŒå¥—çš„æ­£åˆ™ï¼š</p>
<pre><code class="language-lua">print(&quot;-- single capature&quot;)
s = &quot;hello world from Lua&quot;
for w in string.gmatch(s, &quot;%a+&quot;) do
    print(w)
end
</code></pre>
<p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code>-- single capature
hello
world
from
Lua
</code></pre>
<p>æ­£åˆ™è¡¨è¾¾å¼ä¸­æœ‰åµŒå¥—çš„æ­£åˆ™ï¼Œè¿­ä»£å™¨æ¯æ¬¡è¿”å›æ•è·çš„å­—ç¬¦ä¸²ï¼š</p>
<pre><code class="language-lua">print(&quot;-- multi capature&quot;)
s = &quot;from=world, to=Lua, abc=1&quot;
for k, v in string.gmatch(s, &quot;(%w+)=(%w+)&quot;) do
    print(k,v)
end
</code></pre>
<p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code>-- multi capature
from	world
to	Lua
abc	1
</code></pre>
<p>ä¸<a href="https://www.lua.org/manual/5.3/manual.html#pdf-string.gmatch" title="Lua 5.3: string.gmatch">string.gmatch</a>ç›¸å¯¹çš„æ˜¯<a href="https://www.lua.org/manual/5.3/manual.html#pdf-string.match" title="Lua 5.3: string.match">string.match</a>ï¼Œ<code>string.match (s, pattern [, init])</code>åªåŒ¹é…ä¸€æ¬¡ï¼Œä¸å¯¹å‰©ä½™çš„å­—ç¬¦ä¸²ç»§ç»­åŒ¹é…ï¼Œå¯ä»¥é€šè¿‡ç¬¬ä¸‰ä¸ªå‚æ•°æŒ‡å®šå¼€å§‹æŸ¥æ‰¾åŒ¹é…çš„ä½ç½®ã€‚</p>
<pre><code class="language-lua">print(&quot;-- match at pos 5&quot;)
s= &quot;123456789&quot;
v=string.match(s,&quot;%d*&quot;, 5)
print(v)
</code></pre>
<p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code>-- match at pos 5
56789
</code></pre>
<h2 id="å­—ç¬¦ä¸²æ­£åˆ™æ›¿æ¢"><a class="header" href="#å­—ç¬¦ä¸²æ­£åˆ™æ›¿æ¢">å­—ç¬¦ä¸²æ­£åˆ™æ›¿æ¢</a></h2>
<p><a href="https://www.lua.org/manual/5.3/manual.html#pdf-string.gsub" title="Lua 5.3: string.gsub">string.gsub</a>ï¼Œ<code>string.gsub (s, pattern, repl [, n])</code>ï¼Œå°†sä¸­å…¨éƒ¨æˆ–è€…å‰nä¸ªåŒ¹é…äº†patternçš„å­—ç¬¦ä¸²ç”¨replæ›¿æ¢ï¼Œå¹¶ä½œä¸ºä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²è¿”å›ã€‚</p>
<p>replå¯ä»¥æ˜¯å­—ç¬¦ä¸²ï¼Œå­—ç¬¦ä¸²ä¸­å¯ä»¥ä½¿ç”¨<code>%n</code>æŒ‡ä»£æ•è·çš„å†…å®¹ï¼Œ<code>%0</code>è¡¨ç¤ºå®Œæ•´åŒ¹é…ï¼Œ<code>%%</code>å°†%è½¬ä¹‰æˆæ™®é€šå­—ç¬¦ã€‚</p>
<p>replå¯ä»¥æ˜¯tableï¼Œè¿™æ—¶å€™æ›¿æ¢çš„å†…å®¹ï¼Œæ˜¯ä»¥æ•è·çš„å­—ç¬¦ä¸²ä¸ºkeyï¼Œä»replä¸­è¯»å–å‡ºæ¥çš„å†…å®¹ã€‚</p>
<p>replå¯ä»¥æ˜¯functionï¼Œè¿™æ—¶å€™æ›¿æ¢çš„å†…å®¹ï¼Œæ˜¯ä»¥æ•è·çš„å­—ç¬¦ä¸²ä¸ºå‚æ•°æ—¶ï¼ŒreplæŒ‡ä»£çš„å‡½æ•°çš„è¿”å›ç»“æœã€‚</p>
<p>replæ˜¯tableæˆ–è€…functionæ—¶ï¼Œå¦‚æœå¾—åˆ°çš„æ›¿æ¢å†…å®¹æ˜¯falseæˆ–nilï¼Œåˆ™ä¸æ›¿æ¢ã€‚</p>
<p>replæ˜¯å­—ç¬¦ä¸²æ—¶ï¼š</p>
<pre><code class="language-lua">print(&quot;-- repeat each word&quot;)
x = string.gsub(&quot;hello world&quot;, &quot;(%w+)&quot;, &quot;%1 , %1 |&quot;)
print(x)

print(&quot;-- repeat first word&quot;)
x = string.gsub(&quot;hello world&quot;, &quot;(%w+)&quot;, &quot;%1 , %1 |&quot;,1 )
print(x)
</code></pre>
<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code>-- repeat each word
hello , hello | world , world |
-- repeat first word
hello , hello | world
</code></pre>
<p>repleæ˜¯tableæ—¶ï¼š</p>
<pre><code class="language-lua">	print(&quot;-- repel is table&quot;)
	local t = {name=&quot;lua&quot;, version=&quot;5.3&quot;}
	x = string.gsub(&quot;$name-$version.tar.gz&quot;, &quot;%$(%w+)&quot;, t)
	print(x)
</code></pre>
<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code>-- reple is table
lua-5.3.tar.gz
</code></pre>
<p>replæ˜¯å‡½æ•°æ—¶ï¼š</p>
<pre><code class="language-lua">print(&quot;-- repel is a function&quot;)
x = string.gsub(&quot;home = $HOME, user = $USER&quot;, &quot;%$(%w+)&quot;, os.getenv)
print(x)
</code></pre>
<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code>-- repel is a function
home = /Users/lijiao, user = lijiao
</code></pre>
<p>éœ€è¦æ³¨æ„çš„æ˜¯<a href="https://www.lua.org/manual/5.3/manual.html#pdf-string.sub" title="Lua 5.3: string.sub">string.sub</a>å’Œè¿™é‡Œçš„<a href="https://www.lua.org/manual/5.3/manual.html#pdf-string.gsub" title="Lua 5.3: string.gsub">string.gsub</a>ä¸æ˜¯ç›¸å¯¹çš„å…³ç³»ï¼Œ<code>string.sub (s, i [, j])</code>æ˜¯å–å‡ºsçš„ç¬¬iä¸ªåˆ°ç¬¬jä¸ªå­—ç¬¦ã€‚</p>
<h2 id="å–å­—ç¬¦ä¸²çš„å­ä¸²"><a class="header" href="#å–å­—ç¬¦ä¸²çš„å­ä¸²">å–å­—ç¬¦ä¸²çš„å­ä¸²</a></h2>
<p><a href="https://www.lua.org/manual/5.3/manual.html#pdf-string.sub" title="Lua 5.3: string.sub">string.sub</a>ï¼Œ<code>string.sub (s, i [, j])</code>å–å‡ºå­—ç¬¦ä¸²sçš„ç¬¬iåˆ°jä¸ªå­—ç¬¦ï¼Œä¸‹æ ‡æ˜¯ä»1å¼€å§‹è®¡æ•°çš„ï¼Œjé»˜è®¤æ˜¯-1 è¡¨ç¤ºå­—ç¬¦ä¸²çš„å®Œæ•´é•¿åº¦ï¼Œiå¦‚æœæ˜¯è´Ÿæ•°ï¼Œè¡¨ç¤ºå­—ç¬¦ä¸²çš„å|i|ä¸ªå­—ç¬¦ï¼š</p>
<pre><code class="language-lua">print(&quot;-- sub string 0-3, 1-3, 2-3&quot;)
s=&quot;123456789&quot;
v=string.sub(s,0,3)
print(v)
v=string.sub(s,1,3)
print(v)
v=string.sub(s,2,3)
print(v)
v=string.sub(s,2,-1)
print(v)
v=string.sub(s,-2)
print(v)
</code></pre>
<p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code>-- sub string 0-3, 1-3, 2-3
123
123
23
23456789
89
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="luaç¼–ç¨‹æ—¶æ€§èƒ½æ–¹é¢çš„æ³¨æ„äº‹é¡¹"><a class="header" href="#luaç¼–ç¨‹æ—¶æ€§èƒ½æ–¹é¢çš„æ³¨æ„äº‹é¡¹">Luaç¼–ç¨‹æ—¶æ€§èƒ½æ–¹é¢çš„æ³¨æ„äº‹é¡¹</a></h1>
<p><a href="https://www.lua.org/gems/sample.pdf">Lua Performance Tips</a>ç»™å‡ºäº†å¾ˆé‡è¦çš„æ€§èƒ½ä¼˜åŒ–å»ºè®®ï¼Œè¿™äº›å»ºè®®éƒ½æ˜¯ç”¨Luaç¼–ç¨‹æ—¶éœ€è¦æ³¨æ„çš„äº‹é¡¹ã€‚</p>
<ul>
<li><a href="lua/chapter1/03-lua-performance-local-var.html">å±€éƒ¨å˜é‡æ¯”å…¨å±€å˜é‡å¿«30%</a></li>
<li><a href="lua/chapter1/03-lua-performance-load-dynamic.html">åŠ¨æ€åŠ è½½ä»£ç éå¸¸æ…¢</a></li>
<li><a href="lua/chapter1/03-lua-performance-table-space.html">tableçš„è‡ªåŠ¨æ‰©å®¹ä»£ä»·å¾ˆé«˜</a></li>
<li><a href="lua/chapter1/03-lua-performance-table-space-1.html">æ¸…ç†æ“ä½œä¸ä¼šè§¦å‘rehash</a></li>
<li><a href="lua/chapter1/03-lua-performance-string.html">æ…ç”¨å­—ç¬¦ä¸²æ‹¼æ¥</a></li>
<li><a href="lua/chapter1/03-lua-performance-less-var.html">å°½é‡å°‘åˆ›å»ºå˜é‡</a></li>
<li><a href="lua/chapter1/03-lua-performance-cache-result.html">ç¼“å­˜è¿ç®—ç»“æœ</a></li>
<li><a href="lua/chapter1/03-lua-performance-garbage-collect.html">ä¸»åŠ¨æ§åˆ¶åƒåœ¾å›æ”¶</a></li>
</ul>
<h2 id="å‚è€ƒ-38"><a class="header" href="#å‚è€ƒ-38">å‚è€ƒ</a></h2>
<ol>
<li><a href="https://www.lijiaocn.com/nginx/">Nginxã€OpenRestyã€Luaä¸Kong</a></li>
<li><a href="https://stackoverflow.com/questions/154672/what-can-i-do-to-increase-the-performance-of-a-lua-program">What can I do to increase the performance of a Lua program?</a></li>
<li><a href="http://www.lua.org/gems/sample.pdf">Lua Performance Tips</a></li>
<li><a href="http://lua-users.org/wiki/OptimisationTips">Lua Optimisation Tips</a></li>
<li><a href="https://www.cnblogs.com/zwywilliam/p/5992737.html">luajitå®˜æ–¹æ€§èƒ½ä¼˜åŒ–æŒ‡å—å’Œæ³¨è§£</a></li>
<li><a href="http://wiki.luajit.org/Numerical-Computing-Performance-Guide">Numerical Computing Performance Guide</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="luaçš„å±€éƒ¨å˜é‡æ¯”å…¨å±€å˜é‡å¿«30"><a class="header" href="#luaçš„å±€éƒ¨å˜é‡æ¯”å…¨å±€å˜é‡å¿«30">Luaçš„å±€éƒ¨å˜é‡æ¯”å…¨å±€å˜é‡å¿«30%</a></h1>
<p>Luaä»£ç æ˜¯è¢«è§£é‡Šæ‰§è¡Œçš„ï¼ŒLuaä»£ç è¢«è§£é‡ŠæˆLuaè™šæ‹Ÿæœºçš„æŒ‡ä»¤ï¼Œäº¤ä»˜ç»™Luaè™šæ‹Ÿæœºæ‰§è¡Œã€‚</p>
<p>Luaè™šæ‹Ÿæœºä¸æ˜¯å¯¹å¸¸è§çš„ç‰©ç†è®¡ç®—æœºçš„æ¨¡æ‹Ÿï¼Œè€Œæ˜¯å®Œå…¨å®šä¹‰äº†è‡ªå·±çš„è§„åˆ™ã€‚Luaè™šæ‹Ÿæœºä¸­è™šæ‹Ÿäº†å¯„å­˜å™¨ï¼Œä½†æ˜¯å®ƒçš„å¯„å­˜å™¨æ˜¯å’Œå‡½æ•°ç»‘å®šçš„ä¸€èµ·çš„ï¼Œå¹¶ä¸”æ¯ä¸ªå‡½æ•°å¯ä»¥ä½¿ç”¨é«˜è¾¾250ä¸ªè™šæ‹Ÿå¯„å­˜å™¨ï¼ˆä½¿ç”¨æ ˆçš„æ–¹å¼å®ç°çš„ï¼‰ã€‚</p>
<p>æ“ä½œå±€éƒ¨å˜é‡æ—¶ï¼Œä½¿ç”¨çš„æŒ‡ä»¤éå¸¸å°‘ï¼Œä¾‹å¦‚<code>a=a+b</code>åªéœ€è¦ä¸€æ¡æŒ‡ä»¤<code>ADD 0 0 1</code>ã€‚</p>
<p>å¦‚æœ<code>a</code>å’Œ<code>b</code>æ˜¯å…¨å±€å˜é‡ï¼Œåˆ™éœ€è¦å››æ¡æŒ‡ä»¤ï¼š</p>
<pre><code>GETGLOBAL       0 0     ; a
GETGLOBAL       1 1     ; b
ADD             0 0 1
SETGLOBAL       0 0     ; a
</code></pre>
<p>ä¸‹é¢ä¸¤æ®µä»£ç var_global.luaå’Œvar_local.luaæ€§èƒ½ç›¸å·®30%ï¼š</p>
<p>var_global.luaï¼š</p>
<pre><code class="language-lua">for i = 1, 1000000 do
local x = math.sin(i)
end
</code></pre>
<p>var_local.luaï¼š</p>
<pre><code class="language-lua">local sin = math.sin
for i = 1, 1000000 do
local x = sin(i)
end
</code></pre>
<p>è¿è¡Œè€—æ—¶å æ¯”ï¼š</p>
<pre><code class="language-bash">âœ  03-performance git:(master) âœ— time lua5.1 ./var_global.lua
lua5.1 ./var_global.lua  8.02s user 0.01s system 99% cpu 8.036 total

âœ  03-performance git:(master) âœ— time lua5.1 ./var_local.lua
lua5.1 ./var_local.lua  6.01s user 0.01s system 99% cpu 6.026 total
</code></pre>
<p>å› æ­¤åœ¨é˜…è¯»ä½¿ç”¨luaä»£ç æ—¶ï¼Œç»å¸¸çœ‹åˆ°ä¸‹é¢çš„åšæ³•ï¼Œå°†å…¶å®ƒåŒ…ä¸­çš„å˜é‡èµ‹å€¼ç»™æœ¬åœ°å˜é‡ï¼š</p>
<pre><code class="language-lua">local sin = math.sin
function foo (x)
  for i = 1, 1000000 do
    x = x + sin(i)
  end
  return x
end

print(foo(10))
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="åœ¨luaç¨‹åºä¸­åŠ¨æ€åŠ è½½ä»£ç éå¸¸æ…¢"><a class="header" href="#åœ¨luaç¨‹åºä¸­åŠ¨æ€åŠ è½½ä»£ç éå¸¸æ…¢">åœ¨Luaç¨‹åºä¸­åŠ¨æ€åŠ è½½ä»£ç éå¸¸æ…¢</a></h1>
<p>Luaä¸­å¯ä»¥ç”¨<a href="http://www.lua.org/manual/5.1/manual.html#pdf-load">load</a>ã€<a href="http://www.lua.org/manual/5.1/manual.html#pdf-loadfile">load</a>å’Œ<a href="http://www.lua.org/manual/5.1/manual.html#pdf-loadstring">loadstring</a>åŠ¨æ€åŠ è½½ä»£ç å¹¶æ‰§è¡Œã€‚åº”å½“å°½é‡é¿å…è¿™ç§ç”¨æ³•ï¼ŒåŠ¨æ€åŠ è½½ä»£ç éœ€è¦è¢«ç«‹å³ç¼–è¯‘ï¼Œç¼–è¯‘å¼€é”€å¾ˆå¤§ã€‚</p>
<p>load_dynamic.luaï¼š</p>
<pre><code class="language-lua">local lim = 10000000
local a = {}
for i = 1, lim do
	a[i] = loadstring(string.format(&quot;return %d&quot;, i))
end
print(a[10]())  --&gt; 10
</code></pre>
<p>load_static.luaï¼š</p>
<pre><code class="language-lua">function fk (k)
	return function () return k end
end

local lim = 10000000
local a = {}
for i = 1, lim do
	a[i] = fk(i)
end

print(a[10]())  --&gt; 10
</code></pre>
<p>ä¸Šé¢ä¸¤æ®µä»£ç çš„æ€§èƒ½å®Œå…¨ä¸åŒï¼Œåè€…è€—æ—¶åªæœ‰å‰è€…çš„ååˆ†ä¹‹ä¸€ï¼š</p>
<pre><code class="language-bash">âœ  03-performance git:(master) âœ— time lua-5.1 ./load_dynamic.lua
10
lua-5.1 ./load_dynamic.lua  47.99s user 3.81s system 99% cpu 52.069 total

âœ  03-performance git:(master) âœ— time lua-5.1 ./load_static.lua
10
lua-5.1 ./load_static.lua  4.66s user 0.62s system 99% cpu 5.308 total
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="luaä¸­tableç±»å‹å˜é‡çš„å®¹é‡æ‰©å¢ä»£ä»·å¾ˆé«˜"><a class="header" href="#luaä¸­tableç±»å‹å˜é‡çš„å®¹é‡æ‰©å¢ä»£ä»·å¾ˆé«˜">Luaä¸­tableç±»å‹å˜é‡çš„å®¹é‡æ‰©å¢ä»£ä»·å¾ˆé«˜</a></h1>
<p>Luaçš„tableæ˜¯ç”±<code>æ•°ç»„éƒ¨åˆ†ï¼ˆarray partï¼‰</code>å’Œ<code>å“ˆå¸Œéƒ¨åˆ†ï¼ˆhash partï¼‰</code>ç»„æˆã€‚æ•°ç»„éƒ¨åˆ†ç´¢å¼•çš„keyæ˜¯1~nçš„æ•´æ•°ï¼Œå“ˆå¸Œéƒ¨åˆ†æ˜¯ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼ˆopen address tableï¼‰ã€‚</p>
<p>å‘tableä¸­æ’å…¥æ•°æ®æ—¶ï¼Œå¦‚æœå·²ç»æ»¡äº†ï¼ŒLuaä¼šé‡æ–°è®¾ç½®æ•°æ®éƒ¨åˆ†æˆ–å“ˆå¸Œè¡¨çš„å¤§å°ï¼Œå®¹é‡æ˜¯æˆå€å¢åŠ çš„ï¼Œå“ˆå¸Œéƒ¨åˆ†è¿˜è¦å¯¹å“ˆå¸Œè¡¨ä¸­çš„æ•°æ®è¿›è¡Œæ•´ç†ã€‚</p>
<p>éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ²¡æœ‰èµ‹åˆå§‹å€¼çš„tableï¼Œæ•°ç»„å’Œéƒ¨åˆ†å“ˆå¸Œéƒ¨åˆ†é»˜è®¤å®¹é‡ä¸º0ã€‚</p>
<pre><code class="language-lua">local a = {}     --å®¹é‡ä¸º0
a[1] = true      --é‡è®¾æ•°ç»„éƒ¨åˆ†çš„sizeä¸º1
a[2] = true      --é‡è®¾æ•°ç»„éƒ¨åˆ†çš„sizeä¸º2
a[3] = true      --é‡è®¾æ•°ç»„éƒ¨åˆ†çš„sizeä¸º4

local b = {}     --å®¹é‡ä¸º0
b.x = true       --é‡è®¾å“ˆå¸Œéƒ¨åˆ†çš„sizeä¸º1
b.y = true       --é‡è®¾å“ˆå¸Œéƒ¨åˆ†çš„sizeä¸º2
b.z = true       --é‡è®¾å“ˆå¸Œéƒ¨åˆ†çš„sizeä¸º4
</code></pre>
<p>å› ä¸ºå®¹é‡æ˜¯æˆå€å¢åŠ çš„ï¼Œå› æ­¤è¶Šæ˜¯å®¹é‡å°çš„tableè¶Šå®¹æ˜“å—åˆ°å½±å“ï¼Œæ¯æ¬¡å¢åŠ çš„å®¹é‡å¤ªå°‘ï¼Œå¾ˆå¿«åˆæ»¡ã€‚</p>
<p>å¯¹äºå­˜æ”¾å°‘é‡æ•°æ®çš„tableï¼Œè¦åœ¨åˆ›å»ºtableå˜é‡æ—¶ï¼Œå°±è®¾ç½®å®ƒçš„å¤§å°ï¼Œä¾‹å¦‚ï¼š</p>
<p>table_size_predefined.luaï¼š</p>
<pre><code class="language-lua">for i = 1, 1000000 do
  local a = {true, true, true}   -- tableå˜é‡açš„sizeåœ¨åˆ›å»ºæ˜¯ç¡®å®š
  a[1] = 1; a[2] = 2; a[3] = 3   -- ä¸ä¼šè§¦å‘å®¹é‡é‡è®¾
end
</code></pre>
<p>å¦‚æœåˆ›å»ºç©ºçš„tableå˜é‡ï¼Œæ’å…¥æ•°æ®æ—¶ï¼Œä¼šè§¦å‘å®¹é‡é‡è®¾ï¼Œä¾‹å¦‚ï¼š</p>
<p>table_size_undefined.luaï¼š</p>
<pre><code class="language-lua">for i = 1, 1000000 do
  local a = {}                   -- tableå˜é‡açš„sizeä¸º0
  a[1] = 1; a[2] = 2; a[3] = 3   -- è§¦å‘3æ¬¡å®¹é‡é‡è®¾
end
</code></pre>
<p>åè€…è€—æ—¶å‡ ä¹æ˜¯å‰è€…çš„ä¸¤å€ï¼š</p>
<pre><code class="language-bash">âœ  03-performance git:(master) âœ— time lua-5.1 table_size_predefined.lua
lua-5.1 table_size_predefined.lua  4.17s user 0.01s system 99% cpu 4.190 total

âœ  03-performance git:(master) âœ— time lua-5.1 table_size_undefined.lua
lua-5.1 table_size_undefined.lua  7.63s user 0.01s system 99% cpu 7.650 total
</code></pre>
<p>å¯¹äºå“ˆå¸Œéƒ¨åˆ†ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œç”¨ä¸‹é¢çš„æ–¹å¼åˆå§‹åŒ–:</p>
<pre><code>local b = {x = 1, y = 2, z = 3}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="åªæœ‰å‘tableæ’å…¥æ•°æ®æ—¶æ‰æœ‰å¯èƒ½è§¦å‘rehash"><a class="header" href="#åªæœ‰å‘tableæ’å…¥æ•°æ®æ—¶æ‰æœ‰å¯èƒ½è§¦å‘rehash">åªæœ‰å‘tableæ’å…¥æ•°æ®æ—¶ï¼Œæ‰æœ‰å¯èƒ½è§¦å‘rehash</a></h1>
<p>tableåªæœ‰åœ¨æ»¡çš„æƒ…å†µä¸‹ï¼Œç»§ç»­æ’å…¥çš„æ•°æ®çš„æ—¶å€™ï¼Œæ‰ä¼šè§¦å‘rehashã€‚å¦‚æœå°†ä¸€ä¸ªtableä¸­çš„æ•°æ®å…¨éƒ¨è®¾ç½®ä¸ºnilï¼Œåç»­æ²¡æœ‰æ’å…¥æ“ä½œï¼Œè¿™ä¸ªtableçš„å¤§å°ä¼šç»§ç»­ä¿æŒåŸçŠ¶ï¼Œä¸ä¼šæ”¶ç¼©ï¼Œå ç”¨çš„å†…å­˜ä¸ä¼šé‡Šæ”¾ã€‚
é™¤éä¸åœåœ°å‘tableä¸­å†™å…¥nilï¼Œå†™å…¥è¶³å¤Ÿå¤šçš„æ¬¡æ•°åï¼Œé‡æ–°è§¦å‘rehashï¼Œæ‰ä¼šå‘ç”Ÿæ”¶ç¼©ï¼š</p>
<pre><code class="language-lua">a = {}
lim = 10000000

for i = 1, lim do a[i] = i end            --  create a huge table
print(collectgarbage(&quot;count&quot;))            --&gt; 196626

for i = 1, lim do a[i] = nil end          --  erase all its elements
print(collectgarbage(&quot;count&quot;))            --&gt; 196626ï¼Œä¸ä¼šæ”¶ç¼©

for i = lim + 1, 2*lim do a[i] = nil end  --  create many nil element
print(collectgarbage(&quot;count&quot;))            --&gt; 17ï¼Œæ·»åŠ è¶³å¤Ÿå¤šnilä¹‹åæ‰ä¼šè§¦å‘rehash
</code></pre>
<p><strong>ä¸è¦ç”¨è¿™ç§æ–¹å¼è§¦å‘rehash</strong>ï¼Œå¦‚æœæƒ³è¦é‡Šæ”¾å†…å­˜ï¼Œå°±ç›´æ¥é‡Šæ”¾æ•´ä¸ªtableï¼Œä¸è¦é€šè¿‡æ¸…ç©ºå®ƒåŒ…å«çš„æ•°æ®çš„æ–¹å¼è¿›è¡Œã€‚</p>
<p>å°†tableä¸­çš„æˆå‘˜è®¾ç½®ä¸ºnilçš„æ—¶å€™ï¼Œä¸è§¦å‘rehashï¼Œæ˜¯ä¸ºäº†æ”¯æŒä¸‹é¢çš„ç”¨æ³•ï¼š</p>
<pre><code class="language-lua">for k, v in pairs(t) do
  if some_property(v) then
    t[k] = nil    -- erase that element
  end
end
</code></pre>
<p>å¦‚æœæ¯æ¬¡è®¾ç½®niléƒ½è§¦å‘rehashï¼Œé‚£ä¹ˆä¸Šé¢çš„æ“ä½œå°±æ˜¯ä¸€ä¸ªç¾éš¾ã€‚</p>
<h2 id="æ¸…ç†tableä¸­çš„æ‰€æœ‰æ•°æ®æ—¶ç”¨pairsä¸è¦ç”¨next"><a class="header" href="#æ¸…ç†tableä¸­çš„æ‰€æœ‰æ•°æ®æ—¶ç”¨pairsä¸è¦ç”¨next">æ¸…ç†tableä¸­çš„æ‰€æœ‰æ•°æ®æ—¶ï¼Œç”¨pairsï¼Œä¸è¦ç”¨next</a></h2>
<p>å¦‚æœè¦åœ¨ä¿ç•™tableå˜é‡çš„å‰æä¸‹ï¼Œæ¸…ç†tableä¸­çš„æ‰€æœ‰æ•°æ®ï¼Œä¸€å®šè¦ç”¨<a href="http://www.lua.org/manual/5.1/manual.html#pdf-pairs">pairs()</a>å‡½æ•°ï¼Œä¸èƒ½ç”¨<a href="http://www.lua.org/manual/5.1/manual.html#pdf-next">next()</a>ã€‚</p>
<p>next()å‡½æ•°æ˜¯è¿”å›ä¸­çš„tableç¬¬ä¸€ä¸ªæˆå‘˜ï¼Œå¦‚æœä½¿ç”¨ä¸‹é¢æ–¹å¼ï¼Œnext()æ¯æ¬¡ä»å¤´å¼€å§‹æŸ¥æ‰¾ç¬¬ä¸€ä¸ªénilçš„æˆå‘˜ï¼š</p>
<pre><code class="language-lua">while true do
	local k = next(t)
	if not k then break end
	t[k] = nil
end
</code></pre>
<p>æ­£ç¡®çš„åšæ³•æ˜¯ç”¨<code>pairs</code>ï¼š</p>
<pre><code class="language-lua">for k in pairs(t) do
	t[k] = nil
end
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="luaç¼–ç¨‹æ—¶æ…ç”¨å­—ç¬¦ä¸²æ‹¼æ¥"><a class="header" href="#luaç¼–ç¨‹æ—¶æ…ç”¨å­—ç¬¦ä¸²æ‹¼æ¥">Luaç¼–ç¨‹æ—¶æ…ç”¨å­—ç¬¦ä¸²æ‹¼æ¥</a></h1>
<p>Luaä¸­çš„å­—ç¬¦ä¸²æ˜¯éå¸¸ä¸åŒçš„ï¼Œå®ƒä»¬å…¨éƒ¨æ˜¯å†…ç½®çš„ï¼ˆinternalizedï¼‰ï¼Œæˆ–è€…è¯´æ˜¯å…¨å±€çš„ï¼Œå˜é‡ä¸­å­˜æ”¾çš„æ˜¯å­—ç¬¦ä¸²çš„åœ°å€ï¼Œå¹¶ä¸”æ¯ä¸ªå˜é‡ç´¢å¼•çš„éƒ½æ˜¯å…¨å±€çš„å­—ç¬¦ä¸²ï¼Œæ²¡æœ‰è‡ªå·±çš„å­˜æ”¾ç©ºé—´ã€‚</p>
<p>ä¾‹å¦‚ä¸‹é¢çš„ä»£ç ï¼Œä¸ºå˜é‡aå’Œå˜é‡bè®¾ç½®äº†åŒæ ·çš„å†…å®¹çš„å­—ç¬¦ä¸²&quot;abc&quot;ï¼Œ&quot;abc&quot;åªæœ‰ä¸€ä»½å­˜åœ¨ï¼Œaå’Œbå¼•ç”¨çš„æ˜¯åŒä¸€ä¸ªï¼š</p>
<pre><code>local a = &quot;abc&quot;
local b = &quot;abc&quot;
</code></pre>
<p>å¦‚æœè¦ä¸ºaç´¢å¼•çš„å­—ç¬¦ä¸²è¿½åŠ å†…å®¹ï¼Œé‚£ä¹ˆä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å…¨å±€å­—ç¬¦ä¸²ï¼š</p>
<pre><code>a = &quot;abc&quot; .. &quot;def&quot;
</code></pre>
<p>åˆ›å»ºå…¨å±€å­—ç¬¦ä¸²çš„å¼€é”€æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œåœ¨luaä¸­æ…ç”¨å­—ç¬¦ä¸²æ‹¼æ¥ã€‚</p>
<p>å¦‚æœä¸€å®šè¦æ‹¼æ¥ï¼Œå°†å®ƒä»¬å†™å…¥tableï¼Œç„¶åç”¨<code>table.contat()</code> è¿æ¥èµ·æ¥ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-lua">local t = {}
for line in io.lines() do
  t[#t + 1] = line
end

s = table.concat(t, &quot;\n&quot;)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="luaç¼–ç¨‹æ—¶å°½é‡å°‘åˆ›å»ºå˜é‡"><a class="header" href="#luaç¼–ç¨‹æ—¶å°½é‡å°‘åˆ›å»ºå˜é‡">Luaç¼–ç¨‹æ—¶å°½é‡å°‘åˆ›å»ºå˜é‡</a></h1>
<p>å‡è®¾è¦å­˜æ”¾å¤šè¾¹å½¢çš„å¤šä¸ªé¡¶ç‚¹ï¼Œæ¯ä¸ªé¡¶ç‚¹ä¸€ä¸ªxåæ ‡ï¼Œä¸€ä¸ªyåæ ‡ã€‚</p>
<p>æ–¹å¼ä¸€ï¼Œæ¯ä¸ªé¡¶ç‚¹åˆ†é…ä¸€ä¸ªtableå˜é‡ï¼š</p>
<pre><code class="language-lua">polyline = { { x = 10.3, y = 98.5 },
             { x = 10.3, y = 18.3 },
             { x = 15.0, y = 98.5 },
             ...
           }
</code></pre>
<p>æ–¹å¼äºŒï¼Œæ¯ä¸ªé¡¶ç‚¹åˆ†é…ä¸€ä¸ªæ•°ç»„å˜é‡ï¼Œå¼€é”€è¦æ¯”ç¬¬ä¸€ç§æ–¹å¼å°‘ï¼š</p>
<pre><code class="language-lua">polyline = { { 10.3, 98.5 },
             { 10.3, 18.3 },
             { 15.0, 98.5 },
             ...
           }
</code></pre>
<p>æ–¹å¼ä¸‰ï¼Œå°†xåæ ‡å’Œyåæ ‡åˆ†åˆ«å­˜æ”¾åˆ°ä¸¤ä¸ªæ•°ç»„çš„ä¸­ï¼Œä¸€å…±åªéœ€è¦ä¸¤ä¸ªæ•°ç»„å˜é‡ï¼Œå¼€é”€æ›´å°‘ï¼š</p>
<pre><code class="language-lua">polyline = { x = { 10.3, 10.3, 15.0, ...},
             y = { 98.5, 18.3, 98.5, ...}
           }
</code></pre>
<p>è¦æœ‰æ„æ€çš„çš„ä¼˜åŒ–ä»£ç ï¼Œå°½é‡å°‘åˆ›å»ºå˜é‡ã€‚</p>
<h2 id="åœ¨å¾ªç¯å¤–éƒ¨åˆ›å»ºå˜é‡"><a class="header" href="#åœ¨å¾ªç¯å¤–éƒ¨åˆ›å»ºå˜é‡">åœ¨å¾ªç¯å¤–éƒ¨åˆ›å»ºå˜é‡</a></h2>
<p>å¦‚æœåœ¨å¾ªç¯å†…åˆ›å»ºå˜é‡ï¼Œé‚£ä¹ˆæ¯æ¬¡å¾ªç¯éƒ½ä¼šåˆ›å»ºå˜é‡ï¼Œå¯¼è‡´ä¸å¿…è¦çš„åˆ›å»ºã€å›æ”¶ï¼š</p>
<p>åœ¨å¾ªç¯å†…åˆ›å»ºå˜é‡ï¼Œvar_inloop.luaï¼š</p>
<pre><code class="language-lua">function foo ()
	for i = 1, 10000000 do
		local t = {0}
		t[1]=i
	end
end

foo()

</code></pre>
<p>åœ¨å¾ªç¯å¤–åˆ›å»ºå˜é‡ï¼Œvar_outloop.luaï¼š</p>
<pre><code class="language-lua">local t={0}
function foo ()
	for i = 1, 10000000 do
		t[1] = i
	end
end

foo()
</code></pre>
<p>è¿™ä¸¤æ®µä»£ç çš„è¿è¡Œæ—¶é—´ä¸æ˜¯ä¸€ä¸ªæ•°é‡çº§çš„ï¼š</p>
<pre><code class="language-bash">âœ  03-performance git:(master) âœ— time lua-5.1 var_inloop.lua
lua-5.1 var_inloop.lua  3.41s user 0.01s system 99% cpu 3.425 total

âœ  03-performance git:(master) âœ— time lua-5.1 var_outloop.lua
lua-5.1 var_outloop.lua  0.22s user 0.00s system 99% cpu 0.224 total
	
</code></pre>
<p>å˜é‡æ˜¯è¿™æ ·çš„ï¼Œå‡½æ•°ä¹Ÿæ˜¯å¦‚æ­¤ï¼š</p>
<pre><code class="language-lua">local function aux (num)
	num = tonumber(num)
	if num &gt;= limit then return tostring(num + delta) end
end
	
for line in io.lines() do
	line = string.gsub(line, &quot;%d+&quot;, aux)
	io.write(line, &quot;\n&quot;)
end
</code></pre>
<p>ä¸è¦ç”¨ä¸‹é¢çš„è¿™ç§æ–¹å¼ï¼š</p>
<pre><code class="language-lua">for line in io.lines() do
	line = string.gsub(line, &quot;%d+&quot;, 
	     function (num)
	         num = tonumber(num)
	         if num &gt;= limit then return tostring(num + delta) 
	     end
	)
	io.write(line, &quot;\n&quot;)
end
</code></pre>
<h2 id="å°½é‡åœ¨å­—ç¬¦ä¸²ä¸Šåˆ›å»ºåˆ†ç‰‡"><a class="header" href="#å°½é‡åœ¨å­—ç¬¦ä¸²ä¸Šåˆ›å»ºåˆ†ç‰‡">å°½é‡åœ¨å­—ç¬¦ä¸²ä¸Šåˆ›å»ºåˆ†ç‰‡</a></h2>
<p>èƒ½ç”¨åˆ†ç‰‡è¡¨ç¤ºå­—ç¬¦ä¸²ï¼Œå°±ä¸è¦åˆ›å»ºæ–°çš„å­—ç¬¦ä¸²ã€‚</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ç¼“å­˜è¿è¡Œç»“æœå‡å°‘è¿ç®—"><a class="header" href="#ç¼“å­˜è¿è¡Œç»“æœå‡å°‘è¿ç®—">ç¼“å­˜è¿è¡Œç»“æœï¼Œå‡å°‘è¿ç®—</a></h1>
<pre><code class="language-lua">function memoize (f)
    local mem = {}                       -- memoizing table
    setmetatable(mem, {__mode = &quot;kv&quot;})   -- make it weak
    return function (x)       -- new version of â€™fâ€™, with memoizing
        local r = mem[x]
        if r == nil then      -- no previous result?
            r = f(x)          -- calls original function
            mem[x] = r        -- store result for reuse
        end
        return r
    end
end
</code></pre>
<p>ç”¨<code>memoize()</code>åˆ›å»ºçš„å‡½æ•°çš„è¿ç®—ç»“æœå¯ä»¥è¢«ç¼“å­˜ï¼š</p>
<pre><code class="language-lua">loadstring = memoize(loadstring)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ä¸»åŠ¨æ§åˆ¶luaçš„åƒåœ¾å›æ”¶è¿‡ç¨‹"><a class="header" href="#ä¸»åŠ¨æ§åˆ¶luaçš„åƒåœ¾å›æ”¶è¿‡ç¨‹">ä¸»åŠ¨æ§åˆ¶Luaçš„åƒåœ¾å›æ”¶è¿‡ç¨‹</a></h1>
<p>å¯ä»¥é€šè¿‡<code>collectgarbage</code>å¹²é¢„åƒåœ¾å›æ”¶è¿‡ç¨‹ï¼Œé€šè¿‡collectgarbageå¯ä»¥åœæ­¢å’Œé‡æ–°å¯åŠ¨åƒåœ¾å›æ”¶ã€‚</p>
<p>å¯ä»¥åœ¨éœ€è¦è¢«å¿«é€Ÿè¿è¡Œå®Œæˆçš„åœ°æ–¹ï¼Œå…³é—­åƒåœ¾å›æ”¶ï¼Œç­‰è¿ç®—å®Œæˆåå†é‡å¯åƒåœ¾å›æ”¶ã€‚</p>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="python3-ç¼–ç¨‹é€ŸæŸ¥æ‰‹å†Œ"><a class="header" href="#python3-ç¼–ç¨‹é€ŸæŸ¥æ‰‹å†Œ">Python3 ç¼–ç¨‹é€ŸæŸ¥æ‰‹å†Œ</a></h1>
<p>Python2 é©¬ä¸Šä¸è¢«æ”¯æŒäº†ï¼Œç°åœ¨ï¼ˆ2019-08-06 22:28:10ï¼‰æœ€å¥½åšæŒç”¨ python3ã€‚</p>
<p>ä¸»è¦å‚è€ƒèµ„æ–™ï¼ŒPython å®˜ç½‘ä¸Šçš„å…¥é—¨æ•™ç¨‹ï¼š<a href="https://docs.python.org/3/tutorial/index.html" title="å®˜æ–¹æ–‡æ¡£ï¼šThe Python Tutorial">The Python Tutorial</a>ï¼Œèœé¸Ÿæ•™ç¨‹ï¼š<a href="https://www.runoob.com/python3/python3-tutorial.html" title="èœé¸Ÿæ•™ç¨‹ï¼šPython 3 æ•™ç¨‹">Python 3 æ•™ç¨‹</a>ã€‚å‰è€…æ›´å¥½ä¸€äº›ï¼Œåè€…æ˜¯ä¸­æ–‡æ˜“è¯»ä¸€äº›ã€‚<a href="https://docs.python.org/3/reference/" title="The Python Language Reference">The Python Language Reference</a> æ˜¯ä¸€ä»½é«˜éš¾åº¦ï¼Œä½†æ˜¯ä¿¡æ¯æœ€å®Œæ•´å…¨é¢çš„æ–‡æ¡£ï¼Œå®ƒæ˜¯ python è¯­è¨€çš„è®¾è®¡æ‰‹å†Œã€‚</p>
<p>å­¦ä¹ èµ„æ–™ï¼š</p>
<ul>
<li><a href="https://docs.python.org/3/tutorial/index.html" title="å®˜æ–¹æ–‡æ¡£ï¼šThe Python Tutorial">å®˜æ–¹æ–‡æ¡£ï¼šThe Python Tutorial</a></li>
<li><a href="https://docs.python.org/3/library/index.html#library-index" title="The Python Standard Library">The Python Standard Library</a></li>
<li><a href="https://docs.python.org/3/reference/index.html#reference-index" title="The Python Language Reference">The Python Standard Library</a></li>
<li><a href="https://docs.python.org/3/extending/index.html#extending-index" title="Extending and Embedding the Python Interpreter">Extending and Embedding the Python Interpreter</a></li>
<li><a href="https://docs.python.org/3/c-api/index.html#c-api-index" title="Python/C API Reference Manual">Python/C API Reference Manual</a></li>
<li><a href="https://www.runoob.com/python3/python3-tutorial.html" title="èœé¸Ÿæ•™ç¨‹ï¼šPython 3 æ•™ç¨‹">èœé¸Ÿæ•™ç¨‹ï¼šPython 3 æ•™ç¨‹</a></li>
</ul>
<h2 id="å‚è€ƒ-39"><a class="header" href="#å‚è€ƒ-39">å‚è€ƒ</a></h2>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="python2ä»£ç è½¬æ¢æˆpython3ä»£ç "><a class="header" href="#python2ä»£ç è½¬æ¢æˆpython3ä»£ç ">Python2ä»£ç è½¬æ¢æˆPython3ä»£ç </a></h1>
<p>Pythonæä¾›äº†ä¸€ä¸ªåä¸º<a href="https://docs.python.org/2/library/2to3.html">2to3</a>çš„å‘½ä»¤ï¼Œå°†pyton2ä»£ç è½¬æ¢æˆpython3ä»£ç ã€‚</p>
<pre><code>$ 2to3 -w example.py
</code></pre>
<p>å‚æ•°<code>-w</code>è¡¨ç¤ºæ”¹å†™åŸæ–‡ä»¶ï¼Œä¼ å…¥çš„å‚æ•°å¯ä»¥æ˜¯æ–‡ä»¶åï¼Œä¹Ÿå¯ä»¥æ˜¯ç›®å½•ã€‚å¦‚æœç›®å½•ï¼Œ2to3ä¼šéå†æ•´ä¸ªç›®å½•ä»¥åŠå­ç›®å½•ã€‚</p>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="pyhont3-çš„è¿è¡Œç¯å¢ƒä¸ä¾èµ–ç®¡ç†"><a class="header" href="#pyhont3-çš„è¿è¡Œç¯å¢ƒä¸ä¾èµ–ç®¡ç†">Pyhont3 çš„è¿è¡Œç¯å¢ƒä¸ä¾èµ–ç®¡ç†</a></h1>
<h2 id="virtualenv"><a class="header" href="#virtualenv">virtualenv</a></h2>
<p>ç”¨ virtualenv åˆ›å»ºç‹¬ç«‹çš„ python è¿è¡Œç¯å¢ƒæ˜¯ä¸€ä¸ªéå¸¸å¥½çš„åšæ³•ï¼Œä¸å¹²æ‰°æœ¬åœ°çš„ python ç¯å¢ƒä¹Ÿä¸å—æœ¬åœ° python ç¯å¢ƒå½±å“ã€‚</p>
<p>å®‰è£… virutalenvï¼š</p>
<pre><code class="language-sh">pip install virtualenv
</code></pre>
<p>åˆ›å»º python è¿è¡Œç¯å¢ƒï¼š</p>
<pre><code class="language-sh">virtualenv -p python3 env  # åˆ›å»ºä¸€ä¸ªåä¸ºenvçš„ç›®å½•ï¼Œå­˜æ”¾pythonæ–‡ä»¶
                           # -p æŒ‡å®š python çš„ç‰ˆæœ¬
</code></pre>
<p>è¿›å…¥ç‹¬ç«‹çš„ python ç¯å¢ƒï¼š</p>
<pre><code class="language-sh">source bin/activate
</code></pre>
<p>è¿™æ—¶åœ¨å½“å‰ shell çª—å£ç”¨ pip å®‰è£…çš„ python åŒ…éƒ½è¢«å­˜æ”¾åœ¨ env ç›®å½•ä¸­ï¼Œå®Œå…¨ä¸å½±å“æœ¬åœ°çš„ python ç¯å¢ƒã€‚</p>
<p>é€€å‡ºæ—¶ï¼Œè¾“å…¥ä¸‹é¢çš„å‘½ä»¤å³å¯ï¼š</p>
<pre><code class="language-sh">deactivate
</code></pre>
<h2 id="ä¾èµ–åŒ…ç®¡ç†"><a class="header" href="#ä¾èµ–åŒ…ç®¡ç†">ä¾èµ–åŒ…ç®¡ç†</a></h2>
<p>ä¾èµ–åŒ…è®°å½•åˆ° requirements.txt æ–‡ä»¶ä¸­ã€‚</p>
<p>å¯¼å‡ºå½“å‰é¡¹ç›®ä¾èµ–çš„ python åŒ…ï¼š</p>
<pre><code class="language-sh">pip freeze &gt; requirements.txt
</code></pre>
<p>å®‰è£…ä¾èµ–çš„ python åŒ…ï¼š</p>
<pre><code class="language-sh">pip install -r requirements.txt
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="python3-ä»£ç æ–‡ä»¶"><a class="header" href="#python3-ä»£ç æ–‡ä»¶">Python3 ä»£ç æ–‡ä»¶</a></h1>
<p>Python çš„ä»£ç æ–‡ä»¶é»˜è®¤æ˜¯ UTF-8 ç¼–ç ï¼Œå¯ä»¥ç”¨åœ¨ python ä»£ç æ–‡ä»¶çš„ç¬¬ä¸€è¡Œæ·»åŠ æ³¨é‡Šçš„æ–¹å¼æ›´ç»™é»˜è®¤ç¼–ç ï¼Œä¾‹å¦‚ ä½¿ç”¨ windows-1252  ç¼–ç ï¼š</p>
<pre><code class="language-python"># -*- coding: cp1252 -*-
</code></pre>
<p>ç¼–ç å£°æ˜æ³¨é‡Šéœ€è¦ä½äºæ–‡ä»¶çš„ç¬¬ä¸€è¡Œï¼Œé™¤éç¬¬ä¸€è¡Œæ˜¯æŒ‡å®šè§£é‡Šå™¨çš„æ³¨é‡Šï¼š</p>
<pre><code class="language-python">#!/usr/bin/env python3
# -*- coding: cp1252 -*-
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="python3-çš„åŸºæœ¬æ•°æ®ç»“æ„"><a class="header" href="#python3-çš„åŸºæœ¬æ•°æ®ç»“æ„">Python3 çš„åŸºæœ¬æ•°æ®ç»“æ„</a></h1>
<p><a href="https://docs.python.org/3/library/stdtypes.html" title="Python3: Built-in Types">Python3: Built-in Types</a> ä»‹ç»äº† Python3 æ”¯æŒçš„æ‰€æœ‰æ•°æ®ç±»å‹ï¼Œä»¥åŠé€‚ç”¨çš„æ“ä½œç¬¦ï¼š</p>
<pre><code class="language-sh">boolean
numeric         --&gt; intã€floatã€complex
iterator        --&gt; generator
sequence        --&gt; listã€tupleã€range
text sequence   --&gt; str
binary sequence --&gt; bytesã€bytearrayã€memoryview
set             --&gt; setã€frozenset
map             --&gt; dict
</code></pre>
<p>stringã€numeric ç­‰åŸºæœ¬ç±»å‹çš„å®šä¹‰è¯­æ³•è§ <a href="https://docs.python.org/3/reference/lexical_analysis.html#literals" title="Python3: Literals">Python3: Literals</a>ã€‚</p>
<p>æœ€å¸¸å…³æ³¨å’Œä½¿ç”¨çš„æ˜¯ <a href="https://docs.python.org/3/library/stdtypes.html#typesseq" title="Sequence Types â€” list, tuple, range">sequence</a> ç±»å‹çš„æ•°æ®ç»“æ„ï¼š</p>
<ul>
<li>listï¼ˆåˆ—è¡¨/æ•°ç»„ï¼‰</li>
<li>tupleï¼ˆå…ƒç»„ï¼‰</li>
<li>sequenceï¼ˆåºåˆ—ï¼‰</li>
<li>set ï¼ˆé›†åˆï¼‰</li>
<li>dictionary ï¼ˆå­—å…¸/mapï¼‰</li>
</ul>
<h2 id="å‚è€ƒ-40"><a class="header" href="#å‚è€ƒ-40">å‚è€ƒ</a></h2>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="python3-çš„æ•°æ®ç»“æ„list-åˆ—è¡¨"><a class="header" href="#python3-çš„æ•°æ®ç»“æ„list-åˆ—è¡¨">Python3 çš„æ•°æ®ç»“æ„ï¼šList åˆ—è¡¨</a></h1>
<p>List æ˜¯å¯ä»¥ä¿®æ”¹çš„æ•°ç»„ï¼Œæ”¯æŒåµŒå¥—ã€‚</p>
<h2 id="list-çš„åˆ›å»º"><a class="header" href="#list-çš„åˆ›å»º">List çš„åˆ›å»º</a></h2>
<pre><code class="language-python">list1 = ['orange', 'apple', 'pear', 'banana', 'kiwi', 'apple', 'banana']
list2 = []
</code></pre>
<p>ç”¨ä¸‹é¢çš„æ–¹å¼åˆ›å»º list æ—¶éœ€è¦ä¸€ä¸ªå‘½åå˜é‡ xï¼š</p>
<pre><code class="language-python">&gt;&gt;&gt; squares = []
&gt;&gt;&gt; for x in range(10):
...     squares.append(x**2)
...
&gt;&gt;&gt; squares
[0, 1, 4, 9, 16, 25, 36, 49, 64, 81]
</code></pre>
<p>å¯ä»¥ç”¨ä¸‹é¢ä¸¤ç§æ–¹å¼æ¶ˆé™¤å‘½åå˜é‡ xï¼š</p>
<pre><code class="language-python">squares = list(map(lambda x: x**2, range(10)))
squares = [x**2 for x in range(10)]
</code></pre>
<p><code>[]</code> æ”¯æŒå¤šä¸ª for å¾ªç¯å’Œæ¡ä»¶åˆ¤æ–­ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="language-python">&gt;&gt;&gt; [(x, y) for x in [1,2,3] for y in [3,1,4] if x != y]
[(1, 3), (1, 4), (2, 3), (2, 1), (2, 4), (3, 1), (3, 4)]
</code></pre>
<p>ç­‰åŒäºï¼š</p>
<pre><code class="language-python">&gt;&gt;&gt; combs = []
&gt;&gt;&gt; for x in [1,2,3]:
...     for y in [3,1,4]:
...         if x != y:
...             combs.append((x, y))
...
&gt;&gt;&gt; combs
[(1, 3), (1, 4), (2, 3), (2, 1), (2, 4), (3, 1), (3, 4)]
</code></pre>
<h2 id="list-æ”¯æŒçš„æ–¹æ³•"><a class="header" href="#list-æ”¯æŒçš„æ–¹æ³•">List æ”¯æŒçš„æ–¹æ³•</a></h2>
<p>list æ”¯æŒä¸‹é¢çš„æ–¹æ³•ï¼š</p>
<pre><code class="language-sh">list.append(x)         # è¿½åŠ å•ä¸ªæˆå‘˜
list.extend(iterable)  # å°†è¿­ä»£å™¨ä¸­æˆå‘˜å…¨éƒ¨è¿½åŠ åˆ° list
list.insert(i, x)      # åœ¨æŒ‡å®šä¸ºæœªçŸ¥æ’å…¥æˆå‘˜ï¼Œi ä» 0 å¼€å§‹
list.remove(x)         # åˆ é™¤ list çš„ç¬¬ä¸€ä¸ªæˆå‘˜ï¼Œå¦‚æœä¸ºç©ºï¼ŒæŠ›å¼‚å¸¸ ValueError
list.pop([i])          # åˆ é™¤æŒ‡å®šä½ç½®çš„æˆå‘˜å¹¶å°†å…¶è¿”å›ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®š i æ“ä½œæœ€åä¸€ä¸ªæˆå‘˜
list.clear()           # æ¸…ç©º
list.index(x,[start, [end])   # è¿”å›ç›¸å¯¹äº start çš„ç¬¬ x ä¸ªæˆå‘˜ï¼Œä» 0 å¼€å§‹ç¼–å·ï¼Œend æ˜¯æŸ¥æ‰¾ç»“æŸçš„ä½ç½®
list.count(x)          # è¿”å› x åœ¨åˆ—è¡¨ä¸­å‡ºç°çš„æ¬¡æ•°
list.sort(key=Noneï¼Œreverse=False)  # åˆ—è¡¨åŸåœ°æ’åº
list.reverse()         # åˆ—è¡¨åŸåœ°åè½¬
list.copy()            # å¤åˆ¶åˆ—è¡¨
</code></pre>
<p>del è¯­å¥ä¹Ÿèƒ½åˆ é™¤ list çš„æˆå‘˜ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="language-sh">del a[0]    # åˆ é™¤ index ä¸º 0 çš„æˆå‘˜
del a[2:4]  # åˆ é™¤ index ä¸º 2ã€3ã€4 çš„æˆå‘˜
del a[:]    # æ¸…ç©º list
</code></pre>
<h2 id="éå†-list"><a class="header" href="#éå†-list">éå† list</a></h2>
<p>è·å– ç´¢å¼•å’Œå€¼ï¼Œä½¿ç”¨ enumerate()ï¼š</p>
<pre><code class="language-python">&gt;&gt;&gt; for i, v in enumerate(['tic', 'tac', 'toe']):
...     print(i, v)
</code></pre>
<p>åŒæ—¶éå†ä¸¤ä¸ª listï¼Œç”¨ zip()ï¼š</p>
<pre><code class="language-python">&gt;&gt;&gt; questions = ['name', 'quest', 'favorite color']
&gt;&gt;&gt; answers = ['lancelot', 'the holy grail', 'blue']
&gt;&gt;&gt; for q, a in zip(questions, answers):
...     print('What is your {0}?  It is {1}.'.format(q, a))
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="python3-çš„æ•°æ®ç»“æ„tuple-å…ƒç»„"><a class="header" href="#python3-çš„æ•°æ®ç»“æ„tuple-å…ƒç»„">Python3 çš„æ•°æ®ç»“æ„ï¼šTuple å…ƒç»„</a></h1>
<p>Tupleï¼Œå…ƒç»„ï¼Œç±»ä¼¼äº listï¼Œæ˜¯ç”¨é€—å·åˆ†éš”çš„ä¸€ç»„å€¼ï¼Œåœ¨è¾“å‡ºæ—¶ï¼Œtuple æ˜¯ç”¨ () åŒ…è£¹çš„ä¸€ç»„å€¼ã€‚Tuple ä¸ List éå¸¸ç›¸ä¼¼ï¼Œä½†æ˜¯ tuple æ—¶ä¸å¯æ”¹å†™çš„ï¼Œé€šå¸¸ç”¨æ¥å­˜æ”¾ä¸åŒç±»å‹çš„æ•°æ®ï¼Œlist é€šå¸¸ç”¨æ¥å­˜æ”¾ç›¸åŒç±»å‹çš„æ•°æ®ï¼ˆåªæ˜¯ä¹ æƒ¯åšæ³•ï¼Œè¯­æ³•ä¸Šæ²¡æœ‰å¼ºåˆ¶è¦æ±‚ï¼‰ã€‚</p>
<p>tuple çš„å£°æ˜ï¼š</p>
<pre><code class="language-python">t = 12345, 54321, 'hello!'
empty = ()
singleton = 'hello',
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="python3-æ•°æ®ç»“æ„set"><a class="header" href="#python3-æ•°æ®ç»“æ„set">Python3 æ•°æ®ç»“æ„ï¼šset</a></h1>
<p>Set æ˜¯ä¸€ç»„æ²¡æœ‰é¡ºåºå¹¶ä¸”æ²¡æœ‰é‡å¤çš„å€¼ï¼Œæ”¯æŒäº¤é›†ã€å¹¶é›†ã€å·®é›†ã€å¯¹ç§°å·®é›†è¿ç®—ã€‚</p>
<p>Set åˆ›å»ºï¼š</p>
<pre><code class="language-python">basket = {'apple', 'orange', 'apple', 'pear', 'orange', 'banana'}
a = set('abracadabra')
b = {x for x in 'abracadabra' if x not in 'abc'}
</code></pre>
<p>Set è¿ç®—ï¼š</p>
<pre><code class="language-python">a - b       # å·®é›†
a | b       # å¹¶é›†
a &amp; b       # äº¤é›†
a ^ b       # å¯¹ç§°å·®é›†ï¼Œå»æ‰åŒæ—¶ä½äº a å’Œ b ä¸­çš„æˆå‘˜åå‰©ä½™çš„æˆå‘˜
</code></pre>
<p>éå†æ’åºçš„ set ï¼š</p>
<pre><code class="language-python">&gt;&gt;&gt; basket = ['apple', 'orange', 'apple', 'pear', 'orange', 'banana']
&gt;&gt;&gt; for f in sorted(set(basket)):
...     print(f)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="python-æ•°æ®ç»“æ„dictionary"><a class="header" href="#python-æ•°æ®ç»“æ„dictionary">Python æ•°æ®ç»“æ„ï¼šdictionary</a></h1>
<p>Dictionaryï¼Œå°±æ˜¯ mapï¼Œkey-value å¯¹ã€‚</p>
<p>å­—å…¸çš„åˆ›å»ºï¼š</p>
<pre><code class="language-python">dic1 = {'jack': 4098, 'sape': 4139}
dic2 = dict([('sape', 4139), ('guido', 4127), ('jack', 4098)])
dic3 = {x: x**2 for x in (2, 4, 6)}
dic4 = dict(sape=4139, guido=4127, jack=4098)
</code></pre>
<p>å¯ä»¥ç”¨ list åˆ—å‡ºå­—å…¸ä¸­çš„æ‰€æœ‰ key ï¼Œå¦‚æœéœ€è¦æ’åºç”¨ sortedï¼š</p>
<pre><code class="language-python">&gt;&gt;&gt; list(tel)
['jack', 'guido', 'irv']
&gt;&gt;&gt; sorted(tel)
['guido', 'irv', 'jack']
</code></pre>
<p>åˆ¤æ–­ä¸€ä¸ª key æ˜¯å¦å­˜åœ¨ç”¨ inï¼š</p>
<pre><code class="language-python">&gt;&gt;&gt; 'guido' in tel
True

&gt;&gt;&gt; 'jack' not in tel
False
</code></pre>
<p>éå†å­—å…¸æ—¶ï¼Œä½¿ç”¨ items() è·å–  key-valueï¼š</p>
<pre><code class="language-python">&gt;&gt;&gt; knights = {'gallahad': 'the pure', 'robin': 'the brave'}
&gt;&gt;&gt; for k, v in knights.items():
...     print(k, v)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="python3-å­—ç¬¦ä¸²å¤„ç†æ–¹æ³•"><a class="header" href="#python3-å­—ç¬¦ä¸²å¤„ç†æ–¹æ³•">Python3 å­—ç¬¦ä¸²å¤„ç†æ–¹æ³•</a></h1>
<h2 id="å­—ç¬¦ä¸²å¤„ç†-1"><a class="header" href="#å­—ç¬¦ä¸²å¤„ç†-1">å­—ç¬¦ä¸²å¤„ç†</a></h2>
<p>List æ‹¼æ¥æˆå­—ç¬¦ä¸²ï¼š</p>
<pre><code class="language-python">list = ['a','b','c']
','.join(list)
</code></pre>
<p>å­—ç¬¦ä¸²å†…å®¹æ›¿æ¢ï¼š</p>
<pre><code class="language-python">str = 'abc123 / / 123'
str.replace('/',' ')
</code></pre>
<p>å­—ç¬¦ä¸²æ­£åˆ™æ›¿æ¢ï¼š</p>
<pre><code class="language-python">import re
...

str = 'abc123 / / 123'
res.sub('/s+',' ',str)
</code></pre>
<p>æ­£åˆ™æå–ï¼š</p>
<pre><code class="language-python">content = &quot;ã€helloã€‘world&quot;
match = re.match('ã€(.*)ã€‘', content, re.UNICODE)
if match:
	print match.group(1)
</code></pre>
<h2 id="å­—ç¬¦ä¸²è½¬æ¢"><a class="header" href="#å­—ç¬¦ä¸²è½¬æ¢">å­—ç¬¦ä¸²è½¬æ¢</a></h2>
<p>å­—ç¬¦ä¸²è½¬æ¢æˆ byte æ•°ç»„ï¼š</p>
<pre><code class="language-python">s = &quot;Hello, world!&quot;   # str object 

print('str --&gt; bytes')
print(bytes(s, encoding=&quot;utf8&quot;))

b = b&quot;Hello, world!&quot;  # bytes object
print('\nbytes --&gt; str')
print(str(b, encoding=&quot;utf-8&quot;))
</code></pre>
<h2 id="json-å­—ç¬¦ä¸²å¤„ç†"><a class="header" href="#json-å­—ç¬¦ä¸²å¤„ç†">json å­—ç¬¦ä¸²å¤„ç†</a></h2>
<p>åºåˆ—åŒ–ä¸º json å­—ç¬¦ä¸²ï¼š</p>
<pre><code class="language-python">import json
di = dict(name='BOb', age=20, score=93)
json.dumps(di)
</code></pre>
<p>json å­—ç¬¦ä¸²ååºåˆ—åŒ–ï¼š</p>
<pre><code class="language-python">import json
json_str = '{&quot;name&quot;: &quot;BOb&quot;, &quot;age&quot;: 20, &quot;score&quot;: 93}'
json.loads(json_str)
</code></pre>
<h2 id="å‚è€ƒ-41"><a class="header" href="#å‚è€ƒ-41">å‚è€ƒ</a></h2>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="python-çš„æ—¶é—´å¤„ç†"><a class="header" href="#python-çš„æ—¶é—´å¤„ç†">Python çš„æ—¶é—´å¤„ç†</a></h1>
<h2 id="ç§’è½¬åŒ–æˆæ—¥æœŸ"><a class="header" href="#ç§’è½¬åŒ–æˆæ—¥æœŸ">ç§’è½¬åŒ–æˆæ—¥æœŸ</a></h2>
<pre><code class="language-python">import time

def Second2Date(seconds):
    t = time.localtime(seconds)
    return time.strftime(&quot;%Y-%m-%d %H:%M:%S&quot;,t)

if __name__ == &quot;__main__&quot;:
    print(Second2Date(1567672240))
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="python3-çš„æ•°å€¼å¤„ç†"><a class="header" href="#python3-çš„æ•°å€¼å¤„ç†">Python3 çš„æ•°å€¼å¤„ç†</a></h1>
<h2 id="å­—ç¬¦ä¸²è½¬åŒ–æˆæ•°å€¼"><a class="header" href="#å­—ç¬¦ä¸²è½¬åŒ–æˆæ•°å€¼">å­—ç¬¦ä¸²è½¬åŒ–æˆæ•°å€¼</a></h2>
<pre><code class="language-python">def String2Num(str):
    return int(str)

if __name__ == &quot;__main__&quot;:
    print(String2Num(&quot;123456&quot;))
</code></pre>
<h2 id="å‚è€ƒ-42"><a class="header" href="#å‚è€ƒ-42">å‚è€ƒ</a></h2>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="python3-çš„å†…ç½®å‡½æ•°"><a class="header" href="#python3-çš„å†…ç½®å‡½æ•°">Python3 çš„å†…ç½®å‡½æ•°</a></h1>
<p>Python3 çš„å†…ç½®å‡½æ•°è§ <a href="https://docs.python.org/3/library/functions.html" title="Python3: Built-in Functions">Python3: Built-in Functions</a>ã€‚</p>
<p>å†…ç½®çš„ç‰¹æ®Šå±æ€§è§ï¼š<a href="https://docs.python.org/3/library/stdtypes.html#special-attributes" title="Python3: Special Attributes">Python3: Special Attributes</a>ã€‚</p>
<p>Python3 å†…ç½®çš„æ“ä½œç¬¦å·è§ <a href="https://docs.python.org/3/reference/lexical_analysis.html#operators" title="Python3ï¼šOperators">Python3ï¼šOperators</a>ï¼š</p>
<pre><code>+       -       *       **      /       //      %      @
&lt;&lt;      &gt;&gt;      &amp;       |       ^       ~
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="python-çš„ä½œç”¨åŸŸ"><a class="header" href="#python-çš„ä½œç”¨åŸŸ">Python çš„ä½œç”¨åŸŸ</a></h1>
<p>Python çš„å‘½åç©ºé—´ï¼ˆnamespaceï¼‰åŒ…æ‹¬ï¼š</p>
<ol>
<li>å†…ç½®çš„å‘½åæ¡†æ¶ï¼ŒåŒ…å«å†…ç½®çš„å‡½æ•°ã€å˜é‡ã€å†…ç½®çš„å¼‚å¸¸</li>
<li>module çš„ global namespace </li>
<li>å‡½æ•°çš„å±€éƒ¨ namespace</li>
</ol>
<h2 id="å˜é‡çš„ä½œç”¨åŸŸ"><a class="header" href="#å˜é‡çš„ä½œç”¨åŸŸ">å˜é‡çš„ä½œç”¨åŸŸ</a></h2>
<p>ä½œç”¨åŸŸï¼ˆscopeï¼‰ æ˜¯å…·ä½“çš„ä»£ç æ®µï¼Œnamespace æŠ•å°„åˆ° scopeï¼Œ</p>
<p>å¦‚æœè¦ä½¿ç”¨ä¸Šå±‚ä½œç”¨åŸŸçš„å˜é‡ï¼Œéœ€è¦ç”¨ nonlocal å£°æ˜ï¼Œå¦åˆ™åªæ˜¯åœ¨å½“å‰ä½œç”¨åŸŸåˆ›å»ºä¸€ä¸ªåŒåå˜é‡ï¼Œå£°æ˜å…¨å±€å˜é‡ä½¿ç”¨ globalï¼š</p>
<pre><code class="language-python">spam = &quot;&quot;       # å½“å‰ä½œç”¨åŸŸä¸­çš„å˜é‡
nonlocal spam   # ä¸Šå±‚ä½œç”¨åŸŸä¸­çš„å˜é‡
global span     # å…¨å±€ä½œç”¨åŸŸä¸­çš„å˜é‡
</code></pre>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="language-python">def scope_test():
    def do_local():
        spam = &quot;local spam&quot;

    def do_nonlocal():
        nonlocal spam
        spam = &quot;nonlocal spam&quot;

    def do_global():
        global spam
        spam = &quot;global spam&quot;

    spam = &quot;test spam&quot;
    do_local()
    print(&quot;After local assignment:&quot;, spam)
    do_nonlocal()
    print(&quot;After nonlocal assignment:&quot;, spam)
    do_global()
    print(&quot;After global assignment:&quot;, spam)

scope_test()
print(&quot;In global scope:&quot;, spam)
</code></pre>
<p>è¿è¡Œè¾“å‡ºä¸ºï¼š</p>
<pre><code>After local assignment: test spam
After nonlocal assignment: nonlocal spam
After global assignment: nonlocal spam
In global scope: global spam
</code></pre>
<h2 id="ç±»ä¸­å˜é‡çš„ä½œç”¨åŸŸ"><a class="header" href="#ç±»ä¸­å˜é‡çš„ä½œç”¨åŸŸ">ç±»ä¸­å˜é‡çš„ä½œç”¨åŸŸ</a></h2>
<p>ç±»å±æ€§çš„ä½œç”¨åŸŸæ˜¯ç±»ï¼Œè¯¥ç±»çš„æ‰€æœ‰å®ä¾‹ä½¿ç”¨åŒä¸€ä»½ç±»å±æ€§ï¼Œå®ä¾‹å±æ€§ä½œç”¨åŸŸæ˜¯å•ä¸ªå®ä¾‹ï¼Œæ¯ä¸ªå®ä¾‹ä¸€ä»½ã€‚</p>
<p>ä¾‹å¦‚ä¸‹é¢çš„ kind æ˜¯ç±»å±æ€§ï¼Œname æ˜¯å®ä¾‹å±æ€§ï¼š</p>
<pre><code class="language-python3">class Dog:

    kind = 'canine'         # class variable shared by all instances

    def __init__(self, name):
        self.name = name    # instance variable unique to each instance

&gt;&gt;&gt; d = Dog('Fido')
&gt;&gt;&gt; e = Dog('Buddy')
&gt;&gt;&gt; d.kind                  # shared by all dogs
'canine'
&gt;&gt;&gt; e.kind                  # shared by all dogs
'canine'
&gt;&gt;&gt; d.name                  # unique to d
'Fido'
&gt;&gt;&gt; e.name                  # unique to e
'Buddy'
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="python3-çš„å‘½ä»¤è¡Œå‚æ•°è¯»å–"><a class="header" href="#python3-çš„å‘½ä»¤è¡Œå‚æ•°è¯»å–">Python3 çš„å‘½ä»¤è¡Œå‚æ•°è¯»å–</a></h1>
<p>å‘½ä»¤è¡Œå‚æ•°ä» sys.argv[] ä¸­è¯»å–ï¼Œsys.argv[0] æ˜¯æ–‡ä»¶åï¼Œsys.arg[1] æ˜¯ç¬¬ä¸€ä¸ªå‘½ä»¤è¡Œå‚æ•°ï¼Œä»¥æ­¤ç±»æ¨ï¼š</p>
<pre><code class="language-python">import sys

if __name__ == &quot;__main__&quot;:
    print(&quot;%d %s %s&quot; % (sys.argv.__len__(), sys.argv[0], sys.argv[1]))
</code></pre>
<ul>
<li>å¦‚æœæ–‡ä»¶åæ˜¯ <code>-</code> ï¼ˆæ ‡æ³¨è¾“å…¥ï¼‰ï¼Œsys.argv[0] æ˜¯ <code>-</code>ï¼›</li>
<li>å¦‚æœä½¿ç”¨äº† -c å‚æ•°ï¼Œsys.argv[0] æ˜¯ -cï¼›</li>
<li>å¦‚æœä½¿ç”¨äº† -m å‚æ•°ï¼Œsys.argv[0] æ˜¯ -m æŒ‡å®šçš„ module çš„å®Œæ•´åç§°</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="python3-çš„æ¨¡å—"><a class="header" href="#python3-çš„æ¨¡å—">Python3 çš„æ¨¡å—</a></h1>
<p>Python3 çš„ä»£ç ä»¥æ¨¡å—æ–¹å¼ç»„ç»‡ï¼Œä¸€ä¸ªæ¨¡å—å¯¹åº”ä¸€ä¸ªä»¥æ¨¡å—åå‘½åçš„ py æ–‡ä»¶ï¼Œå½“å‰æ¨¡å—åå­˜æ”¾åœ¨å…¨å±€éå† <code>__name__</code> ä¸­ã€‚</p>
<h2 id="æ¨¡å—çš„åˆå§‹åŒ–"><a class="header" href="#æ¨¡å—çš„åˆå§‹åŒ–">æ¨¡å—çš„åˆå§‹åŒ–</a></h2>
<p>æ¨¡å—ä¸­åŒ…å«ç›´æ¥æ‰§è¡Œçš„è¯­å¥å’Œå‡½æ•°å®šä¹‰ï¼Œç›´æ¥æ‰§è¡Œçš„è¯­å¥åœ¨æ¨¡å—ç¬¬ä¸€æ¬¡å¯¼å…¥çš„æ—¶å€™æ‰§è¡Œï¼Œç›¸å½“äºæ¨¡å—çš„åˆå§‹åŒ–ä»£ç ã€‚</p>
<p>æ¨¡å—æœ‰å•ç‹¬ç§æœ‰ç¬¦å·è¡¨ï¼Œæ¨¡å—çš„ç§æœ‰çš„ç¬¦å·è¡¨è¢«æ¨¡å—å†…çš„å‡½æ•°å½“ä½œå…¨å±€çš„ç¬¦å·è¡¨ã€‚</p>
<p>å¯¼å…¥æ¨¡å—ï¼š</p>
<pre><code class="language-python">from fibo import fib, fib2
from fibo import *
import fibo as fib
from fibo import fib as fibonacci
</code></pre>
<h2 id="æ¨¡å—çš„ç›´æ¥è¿è¡Œ"><a class="header" href="#æ¨¡å—çš„ç›´æ¥è¿è¡Œ">æ¨¡å—çš„ç›´æ¥è¿è¡Œ</a></h2>
<p>ç›´æ¥æ‰§è¡Œæ¨¡å—æ–‡ä»¶æ—¶ï¼Œä»ä¸‹é¢çš„ if æ¡ä»¶ä¹‹åçš„è¯­å¥å¼€å§‹æ‰§è¡Œï¼š</p>
<pre><code class="language-python">if __name__ == &quot;__main__&quot;:
    import sys
    fib(int(sys.argv[1]))
</code></pre>
<h2 id="æ¨¡å—çš„æŸ¥æ‰¾è·¯å¾„"><a class="header" href="#æ¨¡å—çš„æŸ¥æ‰¾è·¯å¾„">æ¨¡å—çš„æŸ¥æ‰¾è·¯å¾„</a></h2>
<p>python3 è§£æå™¨é‡åˆ°å¯¼å…¥æ¨¡å—çš„è¯­å¥æ—¶ï¼Œé¦–å…ˆæŸ¥çœ‹å¯¼å…¥çš„æ¨¡å—æ˜¯å¦æ˜¯ python3 çš„å†…ç½®æ¨¡å—ï¼Œç„¶ååˆ°å˜é‡ sys.path æŒ‡å®šçš„ç›®å½•ä¸­æŸ¥æ‰¾ã€‚</p>
<p>sys.path ä¸­åŒ…å«å¤šä¸ªç›®å½•ï¼Œé»˜è®¤ç›®å½•é¡ºåºæ˜¯ï¼š</p>
<ul>
<li>å½“å‰æ¨¡å—æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•</li>
<li>ç¯å¢ƒå˜é‡ PYTHONPATH æŒ‡å®šçš„è·¯å¾„ï¼Œé»˜è®¤æ˜¯ prefix/lib/pythonversionï¼Œprefix æ˜¯ python çš„å®‰è£…è·¯å¾„</li>
<li>python çš„å®‰è£…è·¯å¾„</li>
</ul>
<p>å½“å‰ç›®å½•ä¸­çš„æ¨¡å—å¦‚æœä¸ python æ ‡å‡†åº“ä¸­çš„æ¨¡å—é‡åï¼Œåè€…è¢«å‰è€…è¦†ç›–ã€‚</p>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="python3-çš„-package-ç”¨æ³•"><a class="header" href="#python3-çš„-package-ç”¨æ³•">Python3 çš„ Package ç”¨æ³•</a></h1>
<p>Package ç”±ä¸€ç»„ä½äºåŒä¸€ç›®å½•ä¸‹çš„ module ç»„æˆï¼Œè¿™äº› module çº³å…¥ Package çš„ namespace ä¸­ã€‚ä¸åŒ Package ä¸­çš„åŒåæ¨¡å—å› ä¸ºä½äºä¸åŒçš„ namespace ä¸­ï¼Œæ‰€ä»¥èƒ½å¤Ÿè¢«åŒºåˆ†ã€‚</p>
<h2 id="package-çš„åˆ›å»º"><a class="header" href="#package-çš„åˆ›å»º">Package çš„åˆ›å»º</a></h2>
<p>Package çš„ç›®å½•ä¸­å¿…é¡»æœ‰  <code>__init__.py</code> æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ç¡®ä¿ Package ç›®å½•ä¸ä¼šè¢«å½“ä½œæ™®é€šç›®å½•å¤„ç†ï¼š</p>
<pre><code class="language-sh">sound/                          Top-level package
      __init__.py               Initialize the sound package
      formats/                  Subpackage for file format conversions
              __init__.py
              wavread.py
              wavwrite.py
              aiffread.py
              aiffwrite.py
              auread.py
              auwrite.py
              ...
      effects/                  Subpackage for sound effects
              __init__.py
              echo.py
              surround.py
              reverse.py
              ...
      filters/                  Subpackage for filters
              __init__.py
              equalizer.py
              vocoder.py
              karaoke.py
              ...
</code></pre>
<p><code>__init__.py</code> æ–‡ä»¶å†…å®¹å¯ä»¥ä¸ºç©ºï¼Œä¹Ÿå¯ä»¥è®¾ç½® <code>__all__</code> å˜é‡ï¼Œå¯¼å…¥ package æ—¶å¦‚æœä½¿ç”¨ <code>*</code>ï¼Œå¯¼å…¥çš„æ˜¯ <code>__all__</code> ä¸­çš„ç¬¦å·ï¼š</p>
<pre><code class="language-python">__all__ = [&quot;echo&quot;, &quot;surround&quot;, &quot;reverse&quot;]
</code></pre>
<h2 id="å¯¼å…¥-package"><a class="header" href="#å¯¼å…¥-package">å¯¼å…¥ Package</a></h2>
<p>Package çš„å¯¼å…¥æ–¹æ³•å’Œ module ç›¸åŒï¼š</p>
<pre><code class="language-python">import sound.effects.echo
from sound.effects import echo
from sound.effects.echo import echofilter
from sound.effects import *

from . import echo
from .. import formats
from ..filters import equalizer
</code></pre>
<p><code>import *</code> å¯¼å…¥çš„æ˜¯ sound.effects ç›®å½•ä¸­ <code>__init__.py</code> ä¸­çš„ <code>__all__</code> å˜é‡é‡Œçš„å†…å®¹ã€‚</p>
<h2 id="é€šè¿‡-__path__-å±æ€§è·¨ç›®å½•"><a class="header" href="#é€šè¿‡-__path__-å±æ€§è·¨ç›®å½•">é€šè¿‡ <code>__path__</code> å±æ€§è·¨ç›®å½•</a></h2>
<p><code>__path__</code> å±æ€§åˆå§‹å€¼æ˜¯åŒ…å« <code>__init__.py</code> æ–‡ä»¶çš„ package ç›®å½•ï¼Œä¿®æ”¹è¿™ä¸ªå±æ€§ï¼Œå¯ä»¥å½±å“åç»­çš„ module å’Œ package çš„æŸ¥æ‰¾èŒƒå›´ã€‚</p>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="python3-çš„-io-æ“ä½œ--æ ¼å¼åŒ–è¾“å‡º"><a class="header" href="#python3-çš„-io-æ“ä½œ--æ ¼å¼åŒ–è¾“å‡º">Python3 çš„ IO æ“ä½œ â€”â€” æ ¼å¼åŒ–è¾“å‡º</a></h1>
<p>Python3 æ”¯æŒå¤šç§æ ¼å¼åŒ–è¾“å‡ºæ–¹æ³•ã€‚</p>
<h2 id="æ ¼å¼å­—ç¬¦ä¸²"><a class="header" href="#æ ¼å¼å­—ç¬¦ä¸²">æ ¼å¼å­—ç¬¦ä¸²</a></h2>
<p>ä»¥ f æˆ–è€… F å¼€å¤´çš„å­—ç¬¦ä¸²ä¸­å¯ä»¥ä½¿ç”¨ python è¡¨è¾¾å¼ï¼š</p>
<pre><code class="language-sh">&gt;&gt;&gt; year = 2016
&gt;&gt;&gt; event = 'Referendum'
&gt;&gt;&gt; f'Results of the {year} {event}'
'Results of the 2016 Referendum'
</code></pre>
<h2 id="strformat"><a class="header" href="#strformat">str.format()</a></h2>
<p>str.format() å¯ä»¥ç”¨äºæ ¼å¼åŒ–è¾“å‡ºï¼š</p>
<pre><code class="language-sh">&gt;&gt;&gt; yes_votes = 42_572_654
&gt;&gt;&gt; no_votes = 43_132_495
&gt;&gt;&gt; percentage = yes_votes / (yes_votes + no_votes)
&gt;&gt;&gt; '{:-9} YES votes  {:2.2%}'.format(yes_votes, percentage)
' 42572654 YES votes  49.67%'
</code></pre>
<h2 id="å˜é‡è½¬æ¢æˆå­—ç¬¦ä¸²"><a class="header" href="#å˜é‡è½¬æ¢æˆå­—ç¬¦ä¸²">å˜é‡è½¬æ¢æˆå­—ç¬¦ä¸²</a></h2>
<p>str() å’Œ repr() å¯ä»¥å°†ä»»æ„å˜é‡è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œå‰è€…è½¬æ¢æˆå¯è¯»çš„å­—ç¬¦ä¸²ï¼Œåè€…è½¬æ¢æˆå¯ä»¥è¢« è§£ææ‰§è¡Œçš„å­—ç¬¦ä¸²ï¼š</p>
<pre><code class="language-python">&gt;&gt;&gt; s = 'Hello, world.'
&gt;&gt;&gt; str(s)
'Hello, world.'
&gt;&gt;&gt; repr(s)
&quot;'Hello, world.'&quot;
</code></pre>
<p>str() çš„è¾“å‡ºæ ¼å¼æ˜¯  <code>__str__</code> å±æ€§å†³å®šçš„ï¼š</p>
<pre><code class="language-python">&gt;&gt;&gt; class Point:
...     def __init__(self, x, y):
...         self.x, self.y = x, y
...     def __str__(self):
...         return 'Point({self.x}, {self.y})'.format(self=self)
...
&gt;&gt;&gt; str(Point(4, 2))
'Point(4, 2)'
</code></pre>
<h2 id="ä½¿ç”¨-"><a class="header" href="#ä½¿ç”¨-">ä½¿ç”¨ %</a></h2>
<p>%  çš„æ•ˆæœç±»ä¼¼äº sprintfï¼š</p>
<pre><code class="language-python">&gt;&gt;&gt; import math
&gt;&gt;&gt; print('The value of pi is approximately %5.3f.' % math.pi)
The value of pi is approximately 3.142.
</code></pre>
<p>% æ”¯æŒçš„å ä½ç¬¦è§ <a href="https://docs.python.org/3/library/stdtypes.html#old-string-formatting" title="printf-style String Formatting">printf-style String Formatting</a>ï¼š</p>
<h2 id="æ ¼å¼åŒ–å­—ç¬¦ä¸²ä½¿ç”¨çš„å ä½ç¬¦"><a class="header" href="#æ ¼å¼åŒ–å­—ç¬¦ä¸²ä½¿ç”¨çš„å ä½ç¬¦">æ ¼å¼åŒ–å­—ç¬¦ä¸²ä½¿ç”¨çš„å ä½ç¬¦</a></h2>
<p>f å­—ç¬¦ä¸²å’Œ str.format() éƒ½ç”¨åˆ°{XX} æ ·å¼çš„å ä½ç¬¦ï¼Œpython3 çš„å ä½ç¬¦è¯­æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="language-sh">format_spec     ::=  [[fill]align][sign][#][0][width][grouping_option][.precision][type]
fill            ::=  &lt;any character&gt;
align           ::=  &quot;&lt;&quot; | &quot;&gt;&quot; | &quot;=&quot; | &quot;^&quot;
sign            ::=  &quot;+&quot; | &quot;-&quot; | &quot; &quot;
width           ::=  digit+
grouping_option ::=  &quot;_&quot; | &quot;,&quot;
precision       ::=  digit+
type            ::=  &quot;b&quot; | &quot;c&quot; | &quot;d&quot; | &quot;e&quot; | &quot;E&quot; | &quot;f&quot; | &quot;F&quot; | &quot;g&quot; | &quot;G&quot; | &quot;n&quot; | &quot;o&quot; | &quot;s&quot; | &quot;x&quot; | &quot;X&quot; | &quot;%&quot;
</code></pre>
<p>å ä½ç¬¦ç”¨æ³•æ¯”è¾ƒå¤šï¼ˆè¯¦æƒ…è§ <a href="https://docs.python.org/3/library/string.html#formatspec" title="Format Specification Mini-Language">Format Specification Mini-Language</a>ï¼‰ï¼Œä¸‹é¢æ˜¯å‡ ä¸ªä¾‹å­ï¼š</p>
<p>å˜é‡åŒ¹é…ï¼š</p>
<pre><code class="language-python">&gt;&gt;&gt; '{0}, {1}, {2}'.format('a', 'b', 'c')
'a, b, c'

&gt;&gt;&gt; '{}, {}, {}'.format('a', 'b', 'c')  # 3.1+ only
'a, b, c'

&gt;&gt;&gt; '{2}, {1}, {0}'.format('a', 'b', 'c')
'c, b, a'

&gt;&gt;&gt; '{2}, {1}, {0}'.format(*'abc')      # unpacking argument sequence
'c, b, a'

&gt;&gt;&gt; '{0}{1}{0}'.format('abra', 'cad')   # arguments' indices can be repeated
'abracadabra'

&gt;&gt;&gt; coord = (3, 5)
&gt;&gt;&gt; 'X: {0[0]};  Y: {0[1]}'.format(coord)
'X: 3;  Y: 5'

&gt;&gt;&gt; 'Coordinates: {latitude}, {longitude}'.format(latitude='37.24N', longitude='-115.81W')
'Coordinates: 37.24N, -115.81W'

&gt;&gt;&gt; coord = {'latitude': '37.24N', 'longitude': '-115.81W'}
&gt;&gt;&gt; 'Coordinates: {latitude}, {longitude}'.format(**coord)
'Coordinates: 37.24N, -115.81W'

&gt;&gt;&gt; c = 3-5j
&gt;&gt;&gt; ('The complex number {0} is formed from the real part {0.real} '
...  'and the imaginary part {0.imag}.').format(c)
'The complex number (3-5j) is formed from the real part 3.0 and the imaginary part -5.0.'

&gt;&gt;&gt; &quot;repr() shows quotes: {!r}; str() doesn't: {!s}&quot;.format('test1', 'test2')
&quot;repr() shows quotes: 'test1'; str() doesn't: test2&quot;
</code></pre>
<p>å¯¹é½å¡«å……ï¼š</p>
<pre><code class="language-python">&gt;&gt;&gt;{:&lt;30}'.format('left aligned')
'left aligned                '

&gt;&gt;&gt; '{:&lt;30}'.format('left aligned')
'left aligned                  '

&gt;&gt;&gt; '{:&gt;30}'.format('right aligned')
'                 right aligned'

&gt;&gt;&gt; '{:^30}'.format('centered')
'           centered           '

&gt;&gt;&gt; '{:*^30}'.format('centered')  # use '*' as a fill char
'***********centered***********'
</code></pre>
<p>æ˜¾ç¤ºç²¾åº¦ï¼š</p>
<pre><code class="language-python">&gt;&gt;&gt; '{:+f}; {:+f}'.format(3.14, -3.14)  # show it always
'+3.140000; -3.140000'
&gt;&gt;&gt; '{: f}; {: f}'.format(3.14, -3.14)  # show a space for positive numbers
' 3.140000; -3.140000'
&gt;&gt;&gt; '{:-f}; {:-f}'.format(3.14, -3.14)  # show only the minus -- same as '{:f}; {:f}'
'3.140000; -3.140000'
</code></pre>
<p>æ ¼å¼è½¬æ¢ï¼š</p>
<pre><code class="language-python">&gt;&gt;&gt; # format also supports binary numbers
&gt;&gt;&gt; &quot;int: {0:d};  hex: {0:x};  oct: {0:o};  bin: {0:b}&quot;.format(42)
'int: 42;  hex: 2a;  oct: 52;  bin: 101010'

&gt;&gt;&gt; # with 0x, 0o, or 0b as prefix:
&gt;&gt;&gt; &quot;int: {0:d};  hex: {0:#x};  oct: {0:#o};  bin: {0:#b}&quot;.format(42)
'int: 42;  hex: 0x2a;  oct: 0o52;  bin: 0b101010'

&gt;&gt;&gt; '{:,}'.format(1234567890)
'1,234,567,890'

&gt;&gt;&gt; import datetime
&gt;&gt;&gt; d = datetime.datetime(2010, 7, 4, 12, 15, 58)
&gt;&gt;&gt; '{:%Y-%m-%d %H:%M:%S}'.format(d)
'2010-07-04 12:15:58'
</code></pre>
<h2 id="å‚è€ƒ-43"><a class="header" href="#å‚è€ƒ-43">å‚è€ƒ</a></h2>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="python3-çš„-io-æ“ä½œ--æ–‡ä»¶è¯»å†™"><a class="header" href="#python3-çš„-io-æ“ä½œ--æ–‡ä»¶è¯»å†™">Python3 çš„ IO æ“ä½œ â€”â€” æ–‡ä»¶è¯»å†™</a></h1>
<p>Python3 å†…ç½®çš„ open() å‡½æ•°æ‰“å¼€æŒ‡å®šæ–‡ä»¶ï¼Œå¹¶è¿”å›æ–‡ä»¶å¯¹è±¡ã€‚</p>
<h2 id="open-å»ºè®®ç”¨æ³•"><a class="header" href="#open-å»ºè®®ç”¨æ³•">open() å»ºè®®ç”¨æ³•</a></h2>
<p>open() å‡½æ•°å»ºè®®å’Œ with ä¸€èµ·ä½¿ç”¨ï¼Œä½¿ç”¨ with æ—¶ï¼Œæ–‡ä»¶ä¼šåœ¨è¯»å†™å®Œæˆåè‡ªåŠ¨å…³é—­ï¼š</p>
<pre><code class="language-python">&gt;&gt;&gt; with open('workfile') as f:
...     read_data = f.read()
&gt;&gt;&gt; f.closed
True
</code></pre>
<h2 id="æ–‡ä»¶å¯¹è±¡æ”¯æŒçš„æ–¹æ³•"><a class="header" href="#æ–‡ä»¶å¯¹è±¡æ”¯æŒçš„æ–¹æ³•">æ–‡ä»¶å¯¹è±¡æ”¯æŒçš„æ–¹æ³•</a></h2>
<p>æ–‡ä»¶å¯¹è±¡æ”¯æŒçš„æ–¹æ³•:</p>
<pre><code class="language-python">f.read()
f.readline()

for line in f:
    print(line, end='')

f.write('This is a test\n')
f.seek(5)      # Go to the 6th byte in the file
f.read(1)
f.seek(-3, 2)  # Go to the 3rd byte before the end
f.tell()       # è¿”å›å½“å‰ä½ç½®
</code></pre>
<h2 id="json-æ ¼å¼å†…å®¹å†™å…¥åŠ è½½"><a class="header" href="#json-æ ¼å¼å†…å®¹å†™å…¥åŠ è½½">json æ ¼å¼å†…å®¹å†™å…¥åŠ è½½</a></h2>
<p>json.dump(x,f) å°† x åºåˆ—åŒ–åå†™å…¥æ–‡ä»¶ fï¼Œjson.load(f) å°†æ–‡ä»¶ f ä¸­çš„ json å­—ç¬¦ä¸²åŠ è½½å¹¶ååºåˆ—åŒ–ï¼š</p>
<pre><code class="language-python">import json
json.dump(x, f)
x = json.load(f)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="python3-çš„é”™è¯¯å’Œå¼‚å¸¸å¤„ç†æ–¹æ³•"><a class="header" href="#python3-çš„é”™è¯¯å’Œå¼‚å¸¸å¤„ç†æ–¹æ³•">Python3 çš„é”™è¯¯å’Œå¼‚å¸¸å¤„ç†æ–¹æ³•</a></h1>
<p>Python3 çš„è¿è¡Œé”™è¯¯ä»¥å¼‚å¸¸çš„æ–¹å¼æŠ›å‡ºã€‚</p>
<h2 id="æ•è·å¼‚å¸¸"><a class="header" href="#æ•è·å¼‚å¸¸">æ•è·å¼‚å¸¸</a></h2>
<p>ç”¨ try...except...except...else...finally  æ•è·å¼‚å¸¸ï¼Œæ”¯æŒåŒæ—¶å¤„ç†å¤šç§ç±»å‹çš„å¼‚å¸¸ï¼š</p>
<pre><code class="language-python">import sys

try:
    f = open('myfile.txt')
    s = f.readline()
    i = int(s.strip())
except OSError as err:
    print(&quot;OS error: {0}&quot;.format(err))
except ValueError:
    print(&quot;Could not convert data to an integer.&quot;)
except:
    print(&quot;Unexpected error:&quot;, sys.exc_info()[0])
    raise
</code></pre>
<p>else åé¢çš„è¯­å¥æ˜¯åœ¨æ²¡æœ‰å¼‚å¸¸æ—¶æ‰§è¡Œçš„è¯­å¥ï¼Œè¯¥è¯­å¥å¿…é¡»åœ¨ except ä¹‹åï¼š</p>
<pre><code class="language-python">for arg in sys.argv[1:]:
    try:
        f = open(arg, 'r')
    except OSError:
        print('cannot open', arg)
    else:
        print(arg, 'has', len(f.readlines()), 'lines')
        f.close()
</code></pre>
<p>finally ä¸­çš„è¯­å¥æ— è®ºæ˜¯å¦å‘ç”Ÿå¼‚å¸¸ï¼Œéƒ½è¦åœ¨ç¦»å¼€ try è¯­å¥å‰æ‰§è¡Œï¼Œé€šå¸¸æ˜¯æ¸…ç†æ“ä½œï¼š</p>
<pre><code class="language-python">&gt;&gt;&gt; try:
...     raise KeyboardInterrupt
... finally:
...     print('Goodbye, world!')
...
Goodbye, world!
KeyboardInterrupt
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 2, in &lt;module&gt;
</code></pre>
<h2 id="æŠ›å‡ºå¼‚å¸¸"><a class="header" href="#æŠ›å‡ºå¼‚å¸¸">æŠ›å‡ºå¼‚å¸¸</a></h2>
<p>ç”¨ raise ä¸»åŠ¨æŠ›å‡ºå¼‚å¸¸ï¼ŒæŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œå¯ä»¥ä¼ å…¥å‚æ•°ï¼Œä¹‹åé€šè¿‡å¼‚å¸¸å˜é‡çš„ args è·å–ï¼š</p>
<pre><code class="language-python">try:
    raise Exception('spam', 'eggs')
except Exception as inst:
    print(type(inst))    # the exception instance
    print(inst.args)     # arguments stored in .args
    print(inst)          # __str__ allows args to be printed directly,
                         # but may be overridden in exception subclasses
    x, y = inst.args     # unpack args
    print('x =', x)
    print('y =', y)
</code></pre>
<h2 id="å¼‚å¸¸çš„ç§ç±»"><a class="header" href="#å¼‚å¸¸çš„ç§ç±»">å¼‚å¸¸çš„ç§ç±»</a></h2>
<p>æ‰€æœ‰çš„å¼‚å¸¸æºè‡ª <a href="https://docs.python.org/3/library/exceptions.html#Exception" title="exception Exception">Exception</a> ç±»ï¼Œå¯ä»¥è‡ªå®šä¹‰å¼‚å¸¸ï¼š</p>
<pre><code class="language-python">class InputError(Error):
    &quot;&quot;&quot;Exception raised for errors in the input.

    Attributes:
        expression -- input expression in which the error occurred
        message -- explanation of the error
    &quot;&quot;&quot;

    def __init__(self, expression, message):
        self.expression = expression
        self.message = message
</code></pre>
<h2 id="å¸¦æœ‰è‡ªåŠ¨æ¸…ç†çš„å˜é‡"><a class="header" href="#å¸¦æœ‰è‡ªåŠ¨æ¸…ç†çš„å˜é‡">å¸¦æœ‰è‡ªåŠ¨æ¸…ç†çš„å˜é‡</a></h2>
<p>æœ‰ä¸€äº›å˜é‡å…·æœ‰è‡ªæˆ‘æ¸…ç†åŠŸèƒ½ï¼Œé…åˆ with ä½¿ç”¨ï¼Œä¾‹å¦‚ä¸‹é¢çš„æ–‡ä»¶å¯¹è±¡ f ä¼šè‡ªåŠ¨å…³é—­ï¼š</p>
<pre><code class="language-python">with open(&quot;myfile.txt&quot;) as f:
    for line in f:
        print(line, end=&quot;&quot;)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="python3-çš„ç±»çš„ä½¿ç”¨"><a class="header" href="#python3-çš„ç±»çš„ä½¿ç”¨">Python3 çš„ç±»çš„ä½¿ç”¨</a></h1>
<p>å’Œå…¶å®ƒè¯­è¨€ä¸€æ ·ï¼ŒClass æ˜¯ Python3 ä¸­è¯­æ³•æœ€å¤æ‚çš„ç±»å‹ã€‚</p>
<p>ç±»çš„å®šä¹‰ç§°ä¸º Classï¼Œç±»çš„å®ä¾‹ç§°ä¸º Instanceã€‚</p>
<p>Python3 çš„å†…ç½®å‡½æ•° isinstance() å’Œ issubclass() åˆ†åˆ«ç”¨æ¥æ£€æŸ¥å¯¹è±¡ä¸ç±»çš„å…³ç³»ã€ç±»çš„ç»§æ‰¿å…³ç³»ï¼ˆå¯¹è±¡æ‰€å±çš„ç±»è®°å½•åœ¨ <code>__class__</code> å±æ€§ä¸­ï¼‰ã€‚</p>
<h2 id="ç±»çš„å®šä¹‰"><a class="header" href="#ç±»çš„å®šä¹‰">ç±»çš„å®šä¹‰</a></h2>
<p><code>__init__</code> æ–¹æ³•ç›¸å½“äºæ„é€ å‡½æ•°ï¼Œ</p>
<pre><code class="language-python">class MyClass:
    &quot;&quot;&quot;A simple example class&quot;&quot;&quot;
    i = 12345

    def f(self):
        return 'hello world'

    def __init__(self, realpart, imagpart):
        self.r = realpart
        self.i = imagpart
</code></pre>
<p>ç±»çš„å®ä¾‹åŒ–ï¼š</p>
<pre><code class="language-python">x = MyClass(3.0, -4.5)
</code></pre>
<h2 id="ç±»å±æ€§"><a class="header" href="#ç±»å±æ€§">ç±»å±æ€§</a></h2>
<p>ç›´æ¥åœ¨ç±»ä¸­å®šä¹‰çš„å±æ€§å±äºç±»å˜é‡ï¼š</p>
<pre><code class="language-python3">class Dog:

    kind = 'canine'         # class variable shared by all instances

    def __init__(self, name):
        self.name = name    # instance variable unique to each instance

&gt;&gt;&gt; d = Dog('Fido')
&gt;&gt;&gt; e = Dog('Buddy')
&gt;&gt;&gt; d.kind                  # shared by all dogs
'canine'
&gt;&gt;&gt; e.kind                  # shared by all dogs
'canine'
&gt;&gt;&gt; d.name                  # unique to d
'Fido'
&gt;&gt;&gt; e.name                  # unique to e
'Buddy'
</code></pre>
<h2 id="ç±»çš„ç»§æ‰¿"><a class="header" href="#ç±»çš„ç»§æ‰¿">ç±»çš„ç»§æ‰¿</a></h2>
<p>Python3 ä¸­çš„ç±»æ”¯æŒå¤šé‡ç»§æ‰¿ï¼š</p>
<pre><code class="language-python">class DerivedClassName(Base1, Base2, Base3):
    &lt;statement-1&gt;
    .
    .
    .
    &lt;statement-N&gt;
</code></pre>
<p>åœ¨å­ç±»ä¸­ï¼Œç”¨ <a href="https://docs.python.org/3/library/functions.html#super" title="super">super()</a> æ–¹æ³•è°ƒç”¨çˆ¶ç±»çš„å±æ€§ï¼š</p>
<pre><code class="language-python">class C(B):
    def __init__(self,url):
        super().__init__(url)
    def method(self, arg):
        super().method(arg)    # This does the same thing as:
                               # super(C, self).method(arg)
</code></pre>
<p><a href="https://rhettinger.wordpress.com/2011/05/26/super-considered-super/" title="Pythonâ€™s super() considered super!">Pythonâ€™s super() considered super!</a> å¯¹ super æœ‰æ›´å¤šä»‹ç»ã€‚</p>
<h2 id="è¿­ä»£å™¨"><a class="header" href="#è¿­ä»£å™¨">è¿­ä»£å™¨</a></h2>
<p>ç±»çš„è¿­ä»£å™¨è¡Œä¸ºåœ¨ <code>__iter__</code> å’Œ <code>__next__</code> ä¸­å®šä¹‰ï¼Œ<code>__iter__</code> è¿”å›å¸¦æœ‰ <code>__next__</code>
çš„è¿­ä»£å™¨å¯¹è±¡ï¼Œ<code>__next__</code> è¿”å›ä¸‹ä¸€ä¸ªå¯¹è±¡ï¼š</p>
<pre><code class="language-python">class Reverse:
    &quot;&quot;&quot;Iterator for looping over a sequence backwards.&quot;&quot;&quot;
    def __init__(self, data):
        self.data = data
        self.index = len(data)

    def __iter__(self):
        return self

    def __next__(self):
        if self.index == 0:
            raise StopIteration
        self.index = self.index - 1
        return self.data[self.index]
</code></pre>
<h2 id="å‚è€ƒ-44"><a class="header" href="#å‚è€ƒ-44">å‚è€ƒ</a></h2>
<div style="break-before: page; page-break-before: always;"></div><h1 id="python3-çš„ç”Ÿæˆå™¨"><a class="header" href="#python3-çš„ç”Ÿæˆå™¨">Python3 çš„ç”Ÿæˆå™¨</a></h1>
<p>ä½¿ç”¨ yield è¯­å¥æ„é€ çš„ Generator å¯ä»¥è¢«è¿­ä»£ï¼š</p>
<pre><code class="language-python">def reverse(data):
    for index in range(len(data)-1, -1, -1):
        yield data[index]
</code></pre>
<p>Generator æ‰§è¡Œåˆ° yield è¯­å¥æ—¶ä¼šæš‚åœï¼Œç›´åˆ°é‡åˆ°è¿­ä»£æ—¶ç»§ç»­æ‰§è¡Œåˆ°ä¸‹ä¸€ä¸ª yield è¯­å¥å¤„æš‚åœï¼š</p>
<pre><code class="language-python">&gt;&gt;&gt; for char in reverse('golf'):
...     print(char)
...
f
l
o
g
</code></pre>
<p>Python3 çš„å†…ç½®å‡½æ•° range()ã€zip() æ˜¯ç”Ÿæˆå™¨ï¼š</p>
<pre><code class="language-python">&gt;&gt;&gt; sum(i*i for i in range(10))                 # sum of squares
285

&gt;&gt;&gt; xvec = [10, 20, 30]
&gt;&gt;&gt; yvec = [7, 5, 3]
&gt;&gt;&gt; sum(x*y for x,y in zip(xvec, yvec))         # dot product
260
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="python3-çˆ¬è™«å¼€å‘"><a class="header" href="#python3-çˆ¬è™«å¼€å‘">Python3 çˆ¬è™«å¼€å‘</a></h1>
<p>Python2 é©¬ä¸Šå°±è¦ä¸ç»´æŠ¤äº†ï¼Œç°åœ¨è¦å°½é‡ä½¿ç”¨ Python3ï¼Œæ­£å¥½<code>å´”åº†æ‰</code>å†™äº†ä¸€æœ¬<a href="https://union-click.jd.com/jdc?e=&amp;p=AyIGZRtYFAcXBFIZWR0yEgRXGVkRBxM3EUQDS10iXhBeGlcJDBkNXg9JHU4YDk5ER1xOGRNLGEEcVV8BXURFUFdfC0RVU1JRUy1OVxUBEAVXH14UMlYDHU8Sd19AYigcI0NLSQEKezN3QmILWStaJQITBlQbWRUHEwJlK1sSMkBpja3tzaejG4Gx1MCKhTdUK1sRBRcOXR1dHQsQAlYrXBULIkUQXw5dbFdZA08eTFZRN2UrWCUyIgdlGGtXbBpVBk4JHAARDgBMDhALRQMGGA4RCkIDVkxYRwEQU1dJaxcDEwNc" title="å´”åº†æ‰ï¼šã€ŠPython 3ç½‘ç»œçˆ¬è™«å¼€å‘å®æˆ˜ ã€‹">ã€ŠPython 3ç½‘ç»œçˆ¬è™«å¼€å‘å®æˆ˜ã€‹</a>ï¼Œä»‹ç»äº† Requestsã€Seleniumã€PhantomJSã€Beautiful Soup ç­‰ python åº“çš„ç”¨æ³•ã€‚</p>
<p>ç”¨ virtualenv åˆ›å»ºçš„ python è¿è¡Œç¯å¢ƒï¼ŒæŒ‡å®šç”¨ python3ï¼Œå¹¶å®‰è£…è¦ç”¨åˆ°çš„åº“ï¼š</p>
<pre><code class="language-sh">pip install virtualenv
mkdir spider3
cd spider3

virtualenv -p python3 env
source env/bin/activate
pip3 install django mysqlclient requests beautifulsoup4
</code></pre>
<p>éšæ—¶å°†ä¾èµ–çš„ python åŒ…æ›´æ–°åˆ° requirements.txt æ–‡ä»¶ä¸­ï¼š</p>
<pre><code class="language-sh">pip3 freeze &gt; requirements.txt
</code></pre>
<h2 id="å‚è€ƒ-45"><a class="header" href="#å‚è€ƒ-45">å‚è€ƒ</a></h2>
<ol>
<li><a href="https://www.lijiaocn.com" title="æä½¶æ¾³çš„åšå®¢">æä½¶æ¾³çš„åšå®¢</a></li>
<li><a href="https://cuiqingcai.com/5052.html" title="Python3ç½‘ç»œçˆ¬è™«å¼€å‘å®æˆ˜æ•™ç¨‹">Python3ç½‘ç»œçˆ¬è™«å¼€å‘å®æˆ˜æ•™ç¨‹</a></li>
<li><a href="https://www.seleniumhq.org/" title="What is Selenium?">What is Selenium?</a></li>
<li><a href="https://union-click.jd.com/jdc?e=&amp;p=AyIGZRtYFAcXBFIZWR0yEgRXGVkRBxM3EUQDS10iXhBeGlcJDBkNXg9JHU4YDk5ER1xOGRNLGEEcVV8BXURFUFdfC0RVU1JRUy1OVxUBEAVXH14UMlYDHU8Sd19AYigcI0NLSQEKezN3QmILWStaJQITBlQbWRUHEwJlK1sSMkBpja3tzaejG4Gx1MCKhTdUK1sRBRcOXR1dHQsQAlYrXBULIkUQXw5dbFdZA08eTFZRN2UrWCUyIgdlGGtXbBpVBk4JHAARDgBMDhALRQMGGA4RCkIDVkxYRwEQU1dJaxcDEwNc" title="å´”åº†æ‰ï¼šã€ŠPython 3ç½‘ç»œçˆ¬è™«å¼€å‘å®æˆ˜ ã€‹">å´”åº†æ‰ï¼šã€ŠPython 3ç½‘ç»œçˆ¬è™«å¼€å‘å®æˆ˜ã€‹</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="python3çˆ¬è™«å¼€å‘----è¯·æ±‚åº“"><a class="header" href="#python3çˆ¬è™«å¼€å‘----è¯·æ±‚åº“">Python3çˆ¬è™«å¼€å‘ -- è¯·æ±‚åº“</a></h1>
<p>è¯·æ±‚åº“ç”¨æ¥å‘é€ http è¯·æ±‚ï¼Œè·å–ç›®æ ‡é¡µé¢ã€‚</p>
<h2 id="urllib"><a class="header" href="#urllib">urllib</a></h2>
<p><a href="https://docs.python.org/3/library/urllib.html">urllib</a> æ˜¯ Python3 å†…ç½®çš„ HTTP è¯·æ±‚åº“ã€‚</p>
<p>GET è¯·æ±‚ï¼š</p>
<pre><code class="language-python">import urllib.request as request

if __name__ == &quot;__main__&quot;:
    try:
        resp = request.urlopen(url=&quot;http://www.baidu.com&quot;)
    except Exception as e:
        print(str(e))
    else:
        print(type(resp))
        print(resp.info())
        if resp.readable:
            data = resp.read()
            print(type(data))
            print(&quot;%s&quot; % data.decode(&quot;utf-8&quot;))
        resp.close()
    finally:
        None
</code></pre>
<p>POST è¯·æ±‚ï¼Œå¸¦æœ‰ dataï¼š</p>
<pre><code class="language-python">pagesize=1
result = ''
url = 'http://irm.cninfo.com.cn/ircs/index/search'
data = f'pageNo=0&amp;pageSize={pagesize}&amp;searchTypes=1%2C11%2C&amp;keyWord=&amp;market=&amp;industry=&amp;stockCode='
try:
    resp = request.urlopen(url=url, data=bytes(data,encoding=&quot;utf8&quot;))
except Exception as e:
   print(str(e))
else:
    if resp.readable:
        result = json.loads(resp.read())
    resp.close()
finally:
   return result
</code></pre>
<p>Post è¯·æ±‚çš„æ—¶å€™ï¼Œdata éœ€è¦æ˜¯ bytes æ•°ç»„ï¼Œä¸èƒ½æ˜¯å­—ç¬¦ä¸²ï¼š</p>
<pre><code>POST data should be bytes, an iterable of bytes, or a file object. It cannot be of type str.
</code></pre>
<h2 id="requests"><a class="header" href="#requests">Requests</a></h2>
<p><a href="https://github.com/requests/requests">Requests</a> æ˜¯ä¸€ä¸ªå‘é€ http è¯·æ±‚çš„ python åº“ï¼Œ<a href="https://2.python-requests.org/en/master/">è‹±æ–‡æ–‡æ¡£</a>ï¼Œ<a href="http://2.python-requests.org/zh_CN/latest/">ä¸­æ–‡æ–‡æ¡£</a>ï¼š</p>
<pre><code>pip3 install requests
</code></pre>
<h2 id="selenium"><a class="header" href="#selenium">Selenium</a></h2>
<p><a href="https://github.com/SeleniumHQ/selenium/tree/master/py">Selenium</a> æ˜¯ä¸€ä¸ªç”¨äº Web è‡ªåŠ¨åŒ–æµ‹è¯•çš„æµè§ˆå™¨ï¼Œèƒ½å¤Ÿç”¨ä»£ç æ§åˆ¶æµè§ˆå™¨å†…æ“ä½œçš„ç‰¹æ€§ä½¿ Selenium å…·æœ‰æ›´å¹¿é˜”çš„åº”ç”¨ç©ºé—´ï¼Œ<a href="https://selenium-python.readthedocs.io/">è‹±æ–‡æ–‡æ¡£</a>ã€<a href="https://selenium-python-zh.readthedocs.io/en/latest/">ä¸­æ–‡æ–‡æ¡£</a>ï¼š</p>
<pre><code>pip3 install selenium
</code></pre>
<h2 id="chrome-driver"><a class="header" href="#chrome-driver">Chrome Driver</a></h2>
<p><a href="https://sites.google.com/a/chromium.org/chromedriver">Chrome Driver</a> å’Œ <a href="https://github.com/mozilla/geckodriver">Gecko Driver</a> æ˜¯é…åˆ Selenium ä½¿ç”¨çš„ï¼Œåˆ†åˆ«ç”¨æ¥é©±åŠ¨ Chrome æµè§ˆå™¨å’Œ Firefox æµè§ˆå™¨ï¼Œå®‰è£…æ–¹æ³•è§ï¼š<a href="https://cuiqingcai.com/5135.html">chromedriver</a> å’Œ <a href="https://cuiqingcai.com/5153.html">geckodriver</a> ã€‚</p>
<h2 id="phantomjs"><a class="header" href="#phantomjs">Phantomjs</a></h2>
<p><a href="http://phantomjs.org">Phantomjs</a> æ˜¯æ— ç•Œé¢çš„ WebKit æµè§ˆå™¨ï¼Œæ— ç•Œé¢è¿è¡Œæ•ˆç‡é«˜ï¼Œéœ€è¦ <a href="https://phantomjs.org/download.html">ä¸‹è½½å®‰è£…</a> ã€‚å¯ä»¥è¢« Selenium é©±åŠ¨ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-python">from selenium import webdriver
browser = webdriver.PhantomJS()
browser.get('https://www.baidu.com')
print(browser.current_url)
</code></pre>
<h2 id="aiohttp"><a class="header" href="#aiohttp">aiohttp</a></h2>
<p><a href="https://github.com/aio-libs/aiohttp">aiohttp</a> æ˜¯ä¸€ä¸ªå¼‚æ­¥å‘é€ http è¯·æ±‚çš„ python åº“ï¼Œ<a href="https://aiohttp.readthedocs.io/en/stable/">è‹±æ–‡æ–‡æ¡£</a>ï¼Œé‡‡ç”¨å¼‚æ­¥æœºåˆ¶ï¼Œæ•ˆç‡å¤§å¤§æé«˜ã€‚</p>
<pre><code>pip3 install aiohttp
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="python3çˆ¬è™«å¼€å‘----è§£æåº“"><a class="header" href="#python3çˆ¬è™«å¼€å‘----è§£æåº“">Python3çˆ¬è™«å¼€å‘ -- è§£æåº“</a></h1>
<p><a href="https://github.com/lxml/lxml">lxml</a> æ”¯æŒ HTMLã€XML è§£æï¼Œæ”¯æŒ XPath è§£ææ–¹å¼ã€‚</p>
<pre><code>pip3 install lxml
</code></pre>
<p><a href="https://www.crummy.com/software/BeautifulSoup/bs4/doc">Beautiful Soup</a> æ”¯æŒ HTMLã€XML è§£æï¼ŒAPI å¼ºå¤§ï¼Œè§£ææ–¹æ³•å¤šï¼Œä¾èµ–å‰é¢çš„ lxmlã€‚</p>
<pre><code>pip3 install beautifulsoup4
</code></pre>
<pre><code class="language-python">import urllib.request as request
from bs4 import BeautifulSoup

if __name__ == &quot;__main__&quot;:
    try:
        resp = request.urlopen(url=&quot;http://www.btbtdy.me/hot/month/&quot;)
        resp = request.urlopen(url=&quot;http://www.baidu.com&quot;)
    except Exception as e:
        print(str(e))
    else:
        if not resp.readable:
            resp.close()
            exit(0)

        data = resp.read()
        soup = BeautifulSoup(data,features=&quot;html.parser&quot;)
        print(&quot;%s&quot; % soup.title)

    finally:
        None
</code></pre>
<p><a href="https://github.com/gawel/pyquery">pyquery</a> ä½¿ç”¨ç±»ä¼¼ jQuery çš„è¯­æ³•è§£æ HTMLã€‚</p>
<pre><code>pip3 install pyquery
</code></pre>
<p><a href="https://github.com/sirfz/tesserocr">tesserocr</a>  æ˜¯ä¸€ä¸ª OCR è¯†åˆ«åº“ <a href="https://github.com/tesseract-ocr/tesseract">tesserac</a> çš„ Python APIï¼Œå¯ä»¥ç”¨æ¥è¯†åˆ«å›¾ç‰‡ä¸­çš„æ–‡å­—ã€‚</p>
<pre><code>yum install -y tesseract
pip3 install tesserocr pillow
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="python3çˆ¬è™«å¼€å‘----ç§»åŠ¨ç«¯å·¥å…·"><a class="header" href="#python3çˆ¬è™«å¼€å‘----ç§»åŠ¨ç«¯å·¥å…·">Python3çˆ¬è™«å¼€å‘ -- ç§»åŠ¨ç«¯å·¥å…·</a></h1>
<p>ç”¨äºå¯¹æ¥ Mysqlã€Redis ç­‰å­˜å‚¨ç³»ç»Ÿçš„ Python åº“å°±ä¸æäº†ï¼Œé‡ç‚¹ä»‹ç»å‡ ä¸ªæŠ“åŒ…å’Œç§»åŠ¨ç«¯å·¥å…·ï¼Œé€šè¿‡è¿™äº›æŠ“åŒ…å·¥å…·å¯ä»¥æŠ“å– APP çš„é€šä¿¡æ•°æ®ï¼Œä»è€Œåˆ†æå‡ºåè®®è§„åˆ™ã€‚</p>
<p><a href="https://www.charlesproxy.com">Charles</a> æ˜¯ä¸€æ¬¾ç›¸å½“å¼ºå¤§çš„æŠ“åŒ…å·¥å…·ï¼Œå…·å¤‡ä»£ç†åŠŸèƒ½ï¼Œ <a href="https://www.lijiaocn.com/%E6%8A%80%E5%B7%A7/2018/02/05/pkt-capture.html">ç”¨charleså’ŒFiddleræŠ“å–ã€ç ´è§£ã€æ”¹å†™ï¼ˆè¯·æ±‚æ‹¦æˆªï¼‰PCç«¯ã€æ‰‹æœºç§»åŠ¨ç«¯é€šä¿¡æ•°æ®</a> ä¸­æœ‰ç®€å•ä»‹ç»ã€‚</p>
<p><a href="https://github.com/mitmproxy/mitmproxy">mitmproxy</a> æ˜¯ä¸€ä¸ªæ”¯æŒ HTTP å’Œ HTTPS æŠ“åŒ…çš„æ§åˆ¶å°å·¥å…·ã€‚</p>
<p><a href="htttps://github.com/appium/appium">Appium</a> æ˜¯ç§»åŠ¨ç«¯çš„è‡ªåŠ¨åŒ–å·¥å…·ï¼Œç›¸å½“äºç§»åŠ¨ç«¯ Seleniumï¼Œå¯ä»¥é©±åŠ¨ Androidã€iOS ç­‰ç§»åŠ¨è®¾å¤‡ï¼Œæ¨¡æ‹Ÿç‚¹å‡»ã€æ»‘åŠ¨ã€è¾“å…¥ç­‰æ“ä½œï¼Œéå¸¸å¼ºå¤§ã€‚</p>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="python3çˆ¬è™«å¼€å‘----çˆ¬è™«æ¡†æ¶"><a class="header" href="#python3çˆ¬è™«å¼€å‘----çˆ¬è™«æ¡†æ¶">Python3çˆ¬è™«å¼€å‘ -- çˆ¬è™«æ¡†æ¶</a></h1>
<p>çˆ¬è™«æ¡†æ¶é›†æˆäº†å¿…é¡»çš„çˆ¬å–ã€è§£æã€æå–ã€å­˜æ”¾å·¥å…·ï¼ŒæŒ‰ç…§æ¡†æ¶è§„åˆ™å¡«å†™ä»£ç å³å¯ã€‚</p>
<p><a href="https://github.com/binux/pyspider">pyspider</a> å›½äººå¼€å‘çš„å¸¦æœ‰ Web é¡µé¢çš„å¼€æºçˆ¬è™«æ¡†æ¶ã€‚</p>
<p><a href="https://github.com/scrapy/scrapy">Scrapy</a> æ˜¯ä¸€ä¸ªå¼ºå¤§çš„çˆ¬è™«æ¡†æ¶ï¼Œ<a href="https://docs.scrapy.org/en/master/intro/overview.html">è‹±æ–‡æ–‡æ¡£</a>ã€<a href="https://scrapy-chs.readthedocs.io/zh_CN/0.24/intro/overview.html0">ä¸­æ–‡æ–‡æ¡£</a>ã€‚</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="djangoå¼€å‘æ‰‹å†Œ"><a class="header" href="#djangoå¼€å‘æ‰‹å†Œ">Djangoå¼€å‘æ‰‹å†Œ</a></h1>
<p><a href="https://www.lijiaocn.com/%E7%BC%96%E7%A8%8B/2014/12/05/Python.html#virutalenv">Pythonç¼–ç¨‹å…¥é—¨</a></p>
<p><a href="https://www.djangoproject.com/start/">Getting started with Django</a></p>
<p><a href="https://docs.djangoproject.com/en/2.2/intro/install/">Quick install guide</a></p>
<p><a href="https://docs.djangoproject.com/en/2.2/intro/tutorial01/">Writing your first Django app, part 1</a></p>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="djangoç¯å¢ƒå®‰è£…"><a class="header" href="#djangoç¯å¢ƒå®‰è£…">Djangoç¯å¢ƒå®‰è£…</a></h1>
<p>ç¡®ä¿æœ‰pythonå‘½ä»¤å’Œpipå‘½ä»¤ï¼Œpythonåˆ†ä¸ºpython2å’Œpython3ï¼Œå»ºè®®ç›´æ¥ä¸Šæ‰‹<a href="https://docs.python.org/3/contents.html">python3</a>ï¼Œpython2.7æ˜¯python2çš„æœ€åä¸€ä¸ªç‰ˆæœ¬ã€‚</p>
<p><a href="https://wiki.python.org/moin/Python2orPython3">Should I use Python 2 or Python 3 for my development activity?</a></p>
<p><a href="https://www.digitalocean.com/community/tutorials/how-to-port-python-2-code-to-python-3">How To Port Python 2 Code to Python 3 </a></p>
<p>å®‰è£…virtualenvï¼š</p>
<pre><code>pip install virtualenv
</code></pre>
<p>ç”¨virtualenvåˆ›å»ºpythonè¿è¡Œç¯å¢ƒï¼š</p>
<pre><code>mkdir django-py3
cd django-py3
virtualenv  -p python3 env
</code></pre>
<p>è¿›å…¥virtualenvåˆ›å»ºçš„pythonè¿è¡Œç¯å¢ƒï¼š</p>
<pre><code>source env/bin/activate
</code></pre>
<p>ç”¨pipå®‰è£…djangoï¼š</p>
<pre><code>pip install Django
</code></pre>
<p>ä¹Ÿå¯ä»¥ä¸‹è½½djangoæºä»£ç å®‰è£…ï¼š</p>
<pre><code>git clone https://github.com/django/django.gi
pip install -e django/
</code></pre>
<p>éªŒè¯djangoç¯å¢ƒï¼š</p>
<blockquote>
<blockquote>
<blockquote>
<p>import django
print(django.get_version())
2.2</p>
</blockquote>
</blockquote>
</blockquote>
<p>æˆ–è€…ï¼š</p>
<pre><code>$python -m django --version
2.2
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="ç¬¬ä¸€ä¸ªdjangoé¡¹ç›®"><a class="header" href="#ç¬¬ä¸€ä¸ªdjangoé¡¹ç›®">ç¬¬ä¸€ä¸ªDjangoé¡¹ç›®</a></h1>
<p><a href="https://docs.djangoproject.com/en/2.2/intro/tutorial01/">Writing your first Django app, part 1</a></p>
<h2 id="djangoé¡¹ç›®çš„åˆ›å»ºä¸ç›®å½•ç»“æ„"><a class="header" href="#djangoé¡¹ç›®çš„åˆ›å»ºä¸ç›®å½•ç»“æ„">Djangoé¡¹ç›®çš„åˆ›å»ºä¸ç›®å½•ç»“æ„</a></h2>
<p>åˆ›å»ºé¡¹ç›®ï¼Œæ³¨æ„é¡¹ç›®åç§°ä¸èƒ½æ˜¯djangoå’Œtestï¼Œé¿å…å¼•å‘å‘½åå†²çª:</p>
<pre><code>django-admin startproject mysite
</code></pre>
<p>è‡ªåŠ¨ç”Ÿæˆçš„é¡¹ç›®æ–‡ä»¶ï¼š</p>
<pre><code class="language-sh">(env) lijiaos-mbp:django-py3 lijiao$ tree mysite/
mysite/
â”œâ”€â”€ manage.py
â””â”€â”€ mysite
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ settings.py
    â”œâ”€â”€ urls.py
    â””â”€â”€ wsgi.py

1 directory, 5 files
</code></pre>
<p><a href="https://docs.djangoproject.com/en/2.2/ref/django-admin/">manage.py</a>æ˜¯ç”¨æ¥ç®¡ç†djangoé¡¹ç›®çš„å‘½ä»¤ã€‚</p>
<p><code>mysite/mysite</code>ï¼šé¡¹ç›®çš„ä»£ç ç›®å½•ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ ‡å‡†çš„python packageã€‚</p>
<p><code>__init__.py</code>ï¼šä¸€ä¸ªç©ºæ–‡ä»¶ï¼Œè¡¨ç¤ºæ‰€åœ¨ç›®å½•ä¸ºpython packageï¼Œ<a href="https://docs.python.org/3/tutorial/modules.html#tut-packages">python packageè¯´æ˜</a>ã€‚</p>
<p><code>settings.py</code>ï¼šDjangoé¡¹ç›®çš„é…ç½®æ–‡ä»¶, <a href="https://docs.djangoproject.com/en/2.2/topics/settings/">Django settings</a>ã€‚</p>
<p><code>urls.py</code>ï¼šDjangoé¡¹ç›®çš„urlå£°æ˜ï¼Œ<a href="https://docs.djangoproject.com/en/2.2/topics/http/urls/">URL dispatcher</a>ã€‚</p>
<p><code>wsgi.py</code>ï¼šé¢å‘ä½¿ç”¨WSGIçš„web serverçš„å…¥å£ï¼Œ<a href="https://docs.djangoproject.com/en/2.2/howto/deployment/wsgi/">How to deploy with WSGI</a>ã€‚</p>
<h2 id="å¯åŠ¨å¼€å‘æ¨¡å¼ä¸‹çš„django-server"><a class="header" href="#å¯åŠ¨å¼€å‘æ¨¡å¼ä¸‹çš„django-server">å¯åŠ¨å¼€å‘æ¨¡å¼ä¸‹çš„Django Server</a></h2>
<p>å¼€å‘æ¨¡å¼ä¸‹ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„æ–¹æ³•å¯åŠ¨Django Serverï¼š</p>
<pre><code>cd mysite
python ./manage.py runserver 0:8080
</code></pre>
<p>è¿™ç§æ–¹å¼å¯åŠ¨çš„serverä¼šè‡ªåŠ¨åŠ è½½æœ€æ–°çš„ä»£ç ï¼Œä»£ç å˜æ›´åä¸éœ€è¦é‡æ–°å¯åŠ¨ã€‚</p>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="ç¬¬ä¸€ä¸ªdjangoåº”ç”¨"><a class="header" href="#ç¬¬ä¸€ä¸ªdjangoåº”ç”¨">ç¬¬ä¸€ä¸ªDjangoåº”ç”¨</a></h1>
<p>å‰é¢åˆ›å»ºäº†ä¸€ä¸ªDjangoé¡¹ç›®ï¼Œæ¥ä¸‹æ¥åœ¨é¡¹ç›®ä¸­åˆ›å»ºDjangoåº”ç”¨ã€‚</p>
<h2 id="åˆ›å»ºä¸€ä¸ªåä¸ºpollçš„åº”ç”¨"><a class="header" href="#åˆ›å»ºä¸€ä¸ªåä¸ºpollçš„åº”ç”¨">åˆ›å»ºä¸€ä¸ªåä¸ºpollçš„åº”ç”¨</a></h2>
<p>åœ¨Djangoé¡¹ç›®ç›®å½•ä¸­è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š</p>
<pre><code>python manage.py startapp polls
</code></pre>
<p>è‡ªåŠ¨ç”Ÿæˆçš„pollsåº”ç”¨ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-sh">(env) lijiaos-mbp:mysite lijiao$ tree polls/
polls/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ admin.py
â”œâ”€â”€ apps.py
â”œâ”€â”€ migrations
â”‚Â Â  â””â”€â”€ __init__.py
â”œâ”€â”€ models.py
â”œâ”€â”€ tests.py
â””â”€â”€ views.py

1 directory, 7 files
</code></pre>
<h2 id="å¼€å‘åº”ç”¨çš„è§†å›¾"><a class="header" href="#å¼€å‘åº”ç”¨çš„è§†å›¾">å¼€å‘åº”ç”¨çš„è§†å›¾</a></h2>
<p><code>views.py</code>ä¸­æ˜¯åº”ç”¨çš„è§†å›¾ï¼ˆviews)ï¼Œè§†å›¾æ˜¯ä¸urlä¸€ä¸€å¯¹åº”çš„ã€‚</p>
<p>ä¾‹å¦‚åœ¨views.pyä¸­æ·»åŠ ä¸€ä¸ªåä¸ºindexçš„è§†å›¾ï¼Œå®ƒçš„ä¼ å…¥å‚æ•°å°±æ˜¯ç”¨æˆ·çš„è¯·æ±‚ï¼š</p>
<pre><code class="language-python">from django.shortcuts import render

# Create your views here.

from django.http import HttpResponse

def index(request):
    return HttpResponse(&quot;Hello, world. You're at the polls index.&quot;)
</code></pre>
<p>requestçš„ç±»å‹æ˜¯<a href="https://docs.djangoproject.com/en/2.2/ref/request-response/">HttpRequest</a>ã€‚</p>
<p>éœ€è¦åˆ›å»º<code>polls/urls.py</code>æ–‡ä»¶ï¼Œå¹¶åœ¨å…¶ä¸­æ·»åŠ ä¸‹é¢çš„å†…å®¹ï¼š</p>
<pre><code class="language-python">from django.urls import path

from . import views

urlpatterns = [
    path('', views.index, name='index'),
]
</code></pre>
<p>æœ€ååœ¨djangoé¡¹ç›®æ–‡ä»¶<code>mysite/urls.py</code>ä¸­è®¾ç½®pollsåº”ç”¨çš„urlï¼š</p>
<pre><code class="language-python">from django.contrib import admin
from django.urls import include, path

urlpatterns = [
    path('polls/', include('polls.urls')),
    path('admin/', admin.site.urls),
]
</code></pre>
<p>ä¸Šé¢è®¾ç½®çš„å«ä¹‰æ˜¯<code>/polls/XX</code>æ ·å¼çš„è¯·æ±‚è¢«è½¬å‘ç»™pollsåº”ç”¨å¤„ç†ï¼Œåœ¨polls/urls.pyä¸­æ‰¾åˆ°å¯¹åº”çš„å¤„ç†å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯viewã€‚</p>
<p>pathå‡½æ•°çš„å®šä¹‰ï¼š<a href="https://docs.djangoproject.com/en/2.2/ref/urls/#django.urls.path">path(route, view, kwargs=None, name=None)</a></p>
<h2 id="è®¿é—®åº”ç”¨è§†å›¾"><a class="header" href="#è®¿é—®åº”ç”¨è§†å›¾">è®¿é—®åº”ç”¨è§†å›¾</a></h2>
<p>ç”¨python ./manage.py runserver å¯åŠ¨é¡¹ç›®åï¼Œè®¿é—®pollsåº”ç”¨çš„è§†å›¾<code>/polls/</code>ï¼š</p>
<pre><code class="language-sh">$ curl http://127.0.0.1:8000/polls/
Hello, world. You're at the polls index.
</code></pre>
<p>ç°åœ¨åº”ç”¨pollsä¹‹åä¸€ä¸ªè§†å›¾ï¼Œå¦‚æœä½¿ç”¨å…¶å®ƒçš„urlä¼šè¿”å›404ï¼Œå³é¡µé¢æ²¡æ‰¾åˆ°çš„é”™è¯¯ï¼š</p>
<pre><code>Page not found (404)
Request Method:	GET
Request URL:	http://127.0.0.1:8000/polls/ab
Using the URLconf defined in mysite.urls, Django tried these URL patterns, in this order:

admin/
polls/ [name='index']
The current path, polls/ab, didn't match any of these.

You're seeing this error because you have DEBUG = True in your Django settings file. Change that to False, and Django will display a standard 404 page.
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="djangoå¯¹æ¥æ•°æ®åº“"><a class="header" href="#djangoå¯¹æ¥æ•°æ®åº“">Djangoå¯¹æ¥æ•°æ®åº“</a></h1>
<p><a href="https://docs.djangoproject.com/en/2.2/ref/settings/">settings.py</a>æ˜¯é¡¹ç›®çš„é…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ•°æ®åº“ç›¸å…³çš„é…ç½®ã€‚</p>
<h2 id="é…ç½®é¡¹ç›®çš„æ•°æ®åº“"><a class="header" href="#é…ç½®é¡¹ç›®çš„æ•°æ®åº“">é…ç½®é¡¹ç›®çš„æ•°æ®åº“</a></h2>
<p>é¡¹ç›®çš„æ•°æ®åº“åœ¨é¡¹ç›®ç›®å½•ä¸­çš„settings.pyä¸­è®¾ç½®ï¼Œæ•°æ®åº“ç›¸å…³çš„<a href="https://docs.djangoproject.com/en/2.2/ref/settings/#databases">é…ç½®æ ·å¼</a>å¦‚ä¸‹ï¼š</p>
<pre><code class="language-python"># Database
# https://docs.djangoproject.com/en/2.2/ref/settings/#databases

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': os.path.join(BASE_DIR, 'db.sqlite3'),
    }
}
</code></pre>
<p><code>ENGINE</code>æ˜¯æ•°æ®åº“ç±»å‹ï¼ŒDjangoæ”¯æŒä»¥ä¸‹å››ç§æ•°æ®åº“ï¼š</p>
<pre><code>'django.db.backends.postgresql'
'django.db.backends.mysql'
'django.db.backends.sqlite3'
'django.db.backends.oracle'
</code></pre>
<p>é»˜è®¤ä½¿ç”¨sqliteï¼Œè¿™æ˜¯ä¸€ä¸ªæ–‡ä»¶æ•°æ®åº“ï¼Œåªéœ€è¦åœ¨<code>NAME</code>å‚æ•°æŒ‡å®šæ•°æ®åº“æ–‡ä»¶ï¼Œå¦‚æœç”¨å…¶å®ƒç±»å‹çš„æ•°æ®åº“è¿˜éœ€è¦æŒ‡å®š<code>NAME</code>ã€<code>USER</code>ã€<code>PASSWORD</code>ç­‰å‚æ•°ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="language-python">DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': 'mydatabase',
        'USER': 'mydatabaseuser',
        'PASSWORD': 'mypassword',
        'HOST': '127.0.0.1',
        'PORT': '5432',
    }
}
</code></pre>
<p>æ•°æ®åº“éœ€è¦æå‰éƒ¨ç½²åˆ›å»ºï¼Œæ ¹æ®è‡ªå·±çš„å®é™…æƒ…å†µé€‰æ‹©åˆé€‚çš„æ•°æ®åº“ã€‚åªéœ€è¦åˆ›å»ºæ•°æ®åº“ä¸éœ€è¦åˆ›å»ºè¡¨ï¼Œæ•°æ®åº“è¡¨åœ¨ä¸‹ä¸€èŠ‚ä¸­ç”¨Djangoä»£ç å®šä¹‰ï¼Œå¹¶è‡ªåŠ¨å®Œæˆåˆ›å»ºã€‚</p>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="djangoæ•°æ®åº“åˆå§‹åŒ–"><a class="header" href="#djangoæ•°æ®åº“åˆå§‹åŒ–">Djangoæ•°æ®åº“åˆå§‹åŒ–</a></h1>
<p>Django æ”¯æŒç›´æ¥åœ¨ä»£ç ä¸­å®šä¹‰æ•°æ®åº“çš„è¡¨ç»“æ„ï¼Œç„¶åç”¨ django å‘½ä»¤å®Œæˆæ•°æ®åº“çš„åˆå§‹åŒ–ï¼Œä¸éœ€è¦å†™ sql è¯­å¥ã€‚åœ¨ Django ä¸­ä¸€ä¸ªæ•°æ®åº“è¡¨å¯¹åº”ä¸€ä¸ª Modelã€‚</p>
<h2 id="åˆ›å»º-model"><a class="header" href="#åˆ›å»º-model">åˆ›å»º Model</a></h2>
<p>Model çš„å®šä¹‰æ–‡ä»¶ models.py ä½äº Django åº”ç”¨ç›®å½•ä¸­ï¼Œåœ¨ models.py ä¸­ä¸ºæ¯å¼ æ•°æ®åº“è¡¨åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„ç±»ï¼š</p>
<pre><code class="language-python">from django.db import models

class Question(models.Model):
    question_text = models.CharField(max_length=200)
    pub_date = models.DateTimeField('date published')

class Choice(models.Model):
    question = models.ForeignKey(Question, on_delete=models.CASCADE)
    choice_text = models.CharField(max_length=200)
    votes = models.IntegerField(default=0)
</code></pre>
<p>ä¸Šé¢çš„åˆ›å»ºçš„ä¸¤ä¸ªç±» Question å’Œ Choiceï¼Œåˆ†åˆ«å¯¹åº”åŒåçš„æ•°æ®åº“è¡¨ï¼Œç±»æˆå‘˜å¯¹åº”è¡¨ä¸­çš„å­—æ®µã€‚</p>
<p>éœ€è¦ç‰¹åˆ«å…³æ³¨çš„æ˜¯æ¯ä¸ªå­—æ®µçš„ç±»å‹ï¼Œ<code>models.IntegerField</code>ã€<code>models.CharField</code>åˆ†åˆ«å¯¹åº”ä¸åŒçš„æ•°æ®åº“è¡¨å­—æ®µç±»å‹ï¼Œå¹¶ä¸”é€šè¿‡ä¼ å…¥å‚æ•°æ§åˆ¶å­—æ®µçš„ç‰¹æ€§ã€‚</p>
<p>Models å¯ä»¥è¯´æ˜¯ Django ä¸­æœ€é‡è¦çš„éƒ¨åˆ†ï¼ŒDjango æ–‡æ¡£ä¸­æœ‰ <a href="https://docs.djangoproject.com/en/2.2/topics/db/models/">Models çš„ä¸“é¢˜ä»‹ç»</a>ï¼Œå†…å®¹æ¯”è¾ƒå¤šã€‚</p>
<h2 id="ç±»å‹æˆå‘˜ç±»å‹ä¸æ•°æ®åº“å­—æ®µç±»å‹"><a class="header" href="#ç±»å‹æˆå‘˜ç±»å‹ä¸æ•°æ®åº“å­—æ®µç±»å‹">ç±»å‹æˆå‘˜ç±»å‹ä¸æ•°æ®åº“å­—æ®µç±»å‹</a></h2>
<pre><code class="language-python"># å®šé•¿å­—ç¬¦ä¸²
stock = models.CharField(max_length=20)

# ä¸å®šé•¿å­—ç¬¦ä¸²
main_content = models.TextField()

# æ•´æ•°
votes = models.IntegerField(default=0)

# æ—¶é—´
update_date = models.TimeField(null=False)
</code></pre>
<h2 id="field-options"><a class="header" href="#field-options">Field Options</a></h2>
<p>Field Options æ˜¯åœ¨å£°æ˜ç±»æˆå‘˜æ—¶ä¼ å…¥çš„å‚æ•°ï¼ˆä¾‹å¦‚ max_length=20ï¼‰ï¼Œ<a href="https://docs.djangoproject.com/en/2.2/topics/db/models/#field-options" title="Django Model Field options">Django Model Field options</a> åˆ—å‡ºäº† Django æ”¯æŒçš„æ‰€æœ‰ Field Optionsã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="language-python"># å£°æ˜ä¸ºä¸»é”®
index_id = models.CharField(max_length=40,null=False, primary_key=True)
</code></pre>
<h2 id="åœ¨-meta-ä¸­è®¾ç½®è”åˆä¸»é”®ç­‰å±æ€§"><a class="header" href="#åœ¨-meta-ä¸­è®¾ç½®è”åˆä¸»é”®ç­‰å±æ€§">åœ¨ Meta ä¸­è®¾ç½®è”åˆä¸»é”®ç­‰å±æ€§</a></h2>
<p>åœ¨ Model çš„å­ç±»ä¸­ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢ Question ç­‰ç±»ä¸­ï¼Œæ·»åŠ ä¸€ä¸ª Meta ç±»ï¼Œè¦†ç›–çˆ¶ç±»ä¸­çš„å¯¹åº”è®¾ç½®ã€‚Meta ç±»çš„å±æ€§åœ¨ <a href="https://docs.djangoproject.com/en/2.2/ref/models/options/">Model Meta options</a> ä¸­å¯ä»¥æ‰¾åˆ°ï¼Œå…¶ä¸­ <a href="https://docs.djangoproject.com/en/2.2/ref/models/options/#unique-together">unique-together</a> æ˜¯ç”¨æ¥è®¾ç½®è”åˆä¸»é”®çš„ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-python">class Movie(models.Model):
    name = models.CharField(max_length=200)
    site = models.CharField(max_length=50)
    page_url = models.TextField()
    cover_url = models.TextField()
    description = models.TextField()
    description_extra = models.TextField()
    date = models.CharField(max_length=50)
    class Meta:
        unique_together = ['name', 'site']
</code></pre>
<h2 id="æ¿€æ´»-model"><a class="header" href="#æ¿€æ´»-model">æ¿€æ´» Model</a></h2>
<blockquote>
<p>è¿™é‡Œä»¥ Django åº”ç”¨ poll ä¸ºä¾‹ï¼Œå®ƒåœ¨ <a href="django/./first-app.html">ç¬¬ä¸€ä¸ªDjangoåº”ç”¨</a> ä¸­åˆ›å»ºã€‚</p>
</blockquote>
<p>å¦‚æœä½¿ç”¨çš„æ˜¯ mysql æ•°æ®åº“ï¼Œéœ€è¦å®‰è£… mysqlclientï¼ˆå®‰è£…æ—¶å¦‚æœæŠ¥é”™ ld: library not found for -lssl...command 'clang' failed with exit status 1ï¼Œæ˜¯å› ä¸ºæ²¡æœ‰æ‰¾åˆ° ssl è¿æ¥åº“ï¼‰ï¼š</p>
<pre><code class="language-sh">export LDFLAGS=&quot;-L/usr/local/opt/openssl/lib&quot;
export CPPFLAGS=&quot;-I/usr/local/opt/openssl/include&quot;
pip install mysqlclient
</code></pre>
<p>åœ¨ models.py ä¸­å®šä¹‰çš„ Model ä¸ä¼šç«‹å³ç”Ÿæ•ˆï¼Œé¦–å…ˆè¦åœ¨é¡¹ç›®çš„ settings.py ä¸­å¼•å…¥åº”ç”¨çš„é…ç½®ï¼š</p>
<pre><code class="language-python">INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'polls.apps.PollsConfig',
]
</code></pre>
<p>ç„¶åè¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå°†åº”ç”¨ polls ä¸­å®šä¹‰çš„ Model åˆ·åˆ°æ•°æ®åº“ä¸­ï¼Œå³åˆ›å»ºå¯¹åº”çš„æ•°æ®åº“è¡¨ï¼š</p>
<pre><code class="language-sh">python manage.py makemigrations polls
python manage.py migrate
</code></pre>
<p>å¦‚æœæ²¡æœ‰åœ¨ settings.py ä¸­å¼•å…¥åº”ç”¨ pollsï¼Œä¼šé‡åˆ°ä¸‹é¢çš„é”™è¯¯ï¼š</p>
<pre><code class="language-sh">(env) lijiaos-mbp:mysite lijiao$ python manage.py makemigrations polls
No installed app with label 'polls'.
</code></pre>
<p>æ¿€æ´»æ—¶ä½¿ç”¨çš„ç¬¬ä¸€ä¸ªå‘½ä»¤æ˜¯ <code>makemigrations polls</code>ï¼Œç”Ÿæˆå¯¹åº”çš„æ•°æ®åº“åˆå§‹åŒ–æ–‡ä»¶ polls/migrations/0001_initial.pyï¼š</p>
<pre><code class="language-sh">(env) 192:mysite lijiao$ python manage.py makemigrations polls
Migrations for 'polls':
  polls/migrations/0001_initial.py
    - Create model Question
    - Create model Choice
</code></pre>
<p>ç¬¬äºŒä¸ªå‘½ä»¤<code>migrate</code>æ˜¯å°†æ‰€æœ‰è¿˜æ²¡æœ‰åº”ç”¨åˆ°æ•°æ®åº“ä¸­å˜æ›´åˆ·åˆ°æ•°æ®åº“ä¸­ï¼š</p>
<pre><code class="language-sh">(env) 192:mysite lijiao$ python manage.py migrate
Operations to perform:
  Apply all migrations: admin, auth, contenttypes, polls, sessions
Running migrations:
  Applying contenttypes.0001_initial... OK
  Applying auth.0001_initial... OK
  Applying admin.0001_initial... OK
  Applying admin.0002_logentry_remove_auto_add... OK
  Applying admin.0003_logentry_add_action_flag_choices... OK
  Applying contenttypes.0002_remove_content_type_name... OK
  Applying auth.0002_alter_permission_name_max_length... OK
  Applying auth.0003_alter_user_email_max_length... OK
  Applying auth.0004_alter_user_username_opts... OK
  Applying auth.0005_alter_user_last_login_null... OK
  Applying auth.0006_require_contenttypes_0002... OK
  Applying auth.0007_alter_validators_add_error_messages... OK
  Applying auth.0008_alter_user_username_max_length... OK
  Applying auth.0009_alter_user_last_name_max_length... OK
  Applying auth.0010_alter_group_name_max_length... OK
  Applying auth.0011_update_proxy_permissions... OK
  Applying polls.0001_initial... OK
  Applying sessions.0001_initial... OK
</code></pre>
<p>å¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹å¯¹åº”çš„SQLè¯­å¥ï¼š</p>
<pre><code class="language-sh">python manage.py sqlmigrate polls 0001
</code></pre>
<h2 id="æ›´æ–°-model"><a class="header" href="#æ›´æ–°-model">æ›´æ–° Model</a></h2>
<p>åœ¨ models.py ä¸­ä¿®æ”¹äº† Model çš„å®šä¹‰ä¹‹åï¼Œé‡æ–°æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå°±ä¼šå°†æœ€æ–°çš„å®šä¹‰åˆ·æ–°åˆ°æ•°æ®åº“ä¸­ï¼š</p>
<pre><code class="language-sh">python manage.py makemigrations polls
python manage.py migrate
</code></pre>
<h2 id="å‚è€ƒ-46"><a class="header" href="#å‚è€ƒ-46">å‚è€ƒ</a></h2>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="djangoæ•°æ®åº“æŸ¥è¯¢å†™å…¥"><a class="header" href="#djangoæ•°æ®åº“æŸ¥è¯¢å†™å…¥">Djangoï¼šæ•°æ®åº“æŸ¥è¯¢å†™å…¥</a></h1>
<p>å†™å…¥æ–°çš„è®°å½•ï¼š</p>
<pre><code class="language-python">from movie.models import Movie
...
m = Movie()
m.XXX = XXX
m.save()
</code></pre>
<p>æŸ¥è¯¢è®°å½•ï¼š</p>
<pre><code class="language-python">m = Movie.objects.get(name=i.name,site=i.site)
m = Movie.objects.get(name=i.name,site=i.site)
</code></pre>
<p>æ¡ä»¶æŸ¥è¯¢ï¼Œ<a href="https://docs.djangoproject.com/en/2.2/ref/models/querysets/" title="Django: QuerySet API reference">QuerySet API reference</a>ï¼š</p>
<pre><code class="language-python">items = Movie.objects.filter()
items = Movie.objects.filter().order_by('name')
</code></pre>
<p>æŸ¥è¯¢ç»“æœæ’åºï¼š</p>
<pre><code class="language-python">from django.db.models.functions import Coalesce

items = Question.objects.filter(market=&quot;sz&quot;).order_by(Coalesce('stock_code', 'answer_date').desc())
</code></pre>
<h2 id="å‚è€ƒ-47"><a class="header" href="#å‚è€ƒ-47">å‚è€ƒ</a></h2>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="åœ¨å‘½ä»¤è¡Œæ“ä½œæ•°æ®åº“"><a class="header" href="#åœ¨å‘½ä»¤è¡Œæ“ä½œæ•°æ®åº“">åœ¨å‘½ä»¤è¡Œæ“ä½œæ•°æ®åº“</a></h1>
<p>Djangoæä¾›äº†ä¸€ä¸ª<a href="https://docs.djangoproject.com/en/2.2/intro/tutorial02/#playing-with-the-api">shellå‘½ä»¤</a>ï¼Œå¯ä»¥ç›´æ¥å’Œæ•°æ®åº“äº¤äº’ï¼š</p>
<pre><code class="language-sh">python manage.py shell
</code></pre>
<p>è¿™ä¸ªå‘½ä»¤å®é™…ä¸Šæ˜¯å¯åŠ¨äº†pythonï¼Œå¹¶å¯¼å…¥äº†djangoé¡¹ç›®ï¼Œä»è€Œå¯ä»¥ç›´æ¥å¼•ç”¨Djangoçš„é¡¹ç›®ä»£ç ï¼Œå°½è¿›è¡Œæ“ä½œï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="language-sh">(env) 192:mysite lijiao$ python manage.py shell
Python 3.7.2 (default, Feb 12 2019, 08:15:36)
[Clang 10.0.0 (clang-1000.11.45.5)] on darwin
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
(InteractiveConsole)
&gt;&gt;&gt; from polls.models import Choice, Question
&gt;&gt;&gt; Question.objects.all()
&lt;QuerySet []&gt;
&gt;&gt;&gt; from django.utils import timezone
&gt;&gt;&gt; q = Question(question_text=&quot;What's new?&quot;, pub_date=timezone.now())
&gt;&gt;&gt; q.save()
&gt;&gt;&gt; q.id
1
&gt;&gt;&gt; q.question_text
&quot;What's new?&quot;
&gt;&gt;&gt; q.pub_date
datetime.datetime(2019, 4, 5, 7, 20, 13, 842645, tzinfo=&lt;UTC&gt;)
&gt;&gt;&gt; q.question_text = &quot;What's up?&quot;
&gt;&gt;&gt; q.save()
&gt;&gt;&gt; Question.objects.all()
&lt;QuerySet [&lt;Question: Question object (1)&gt;]&gt;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="djangoåˆ›å»ºç«™ç‚¹ç®¡ç†åå°"><a class="header" href="#djangoåˆ›å»ºç«™ç‚¹ç®¡ç†åå°">Djangoåˆ›å»ºç«™ç‚¹ç®¡ç†åå°</a></h1>
<p>Djangoæä¾›äº†<a href="https://docs.djangoproject.com/en/2.2/intro/tutorial02/#creating-an-admin-user">åå°ç®¡ç†æ¨¡ç‰ˆ</a>ï¼Œå¯ä»¥ç›´æ¥åˆ›å»ºç½‘ç«™åå°ï¼Œå‡å°‘å¼€å‘å·¥ä½œ.</p>
<h2 id="åˆ›å»ºç®¡ç†å‘˜è´¦å·"><a class="header" href="#åˆ›å»ºç®¡ç†å‘˜è´¦å·">åˆ›å»ºç®¡ç†å‘˜è´¦å·</a></h2>
<p>åœ¨å‰é¢è®¾ç½®ç¬¬ä¸€ä¸ªåº”ç”¨pollsçš„æ—¶å€™ï¼Œåº”è¯¥æ³¨æ„åˆ°é¡¹ç›®ç›®å½•çš„urls.pyä¸­æ˜¯æœ‰ä¸€ä¸ªadmin/è·¯å¾„çš„ï¼Œè®¿é—®è¯¥è·¯å¾„æ—¶ï¼ˆ<code>http://127.0.0.1:8000/admin/</code>ï¼‰ï¼Œä¼šçœ‹åˆ°ä¸€ä¸ª<code>Django administration</code>çš„ç™»å½•é¡µé¢ã€‚</p>
<p>è¿˜æ²¡æœ‰ç®¡ç†å‘˜è´¦å·çš„æ—¶å€™éœ€è¦ç”¨manager.pyåˆ›å»ºä¸€ä¸ªï¼š</p>
<pre><code class="language-sh">python manage.py createsuperuser
</code></pre>
<p>è®¾ç½®è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<pre><code class="language-sh">(env) 192:mysite lijiao$ python manage.py createsuperuser
Username (leave blank to use 'lijiao'): admin
Email address: admin@example.com
Password:   # è¿™é‡Œè¾“å…¥å¯†ç 
Password (again):
This password is too short. It must contain at least 8 characters.
This password is too common.
This password is entirely numeric.
Bypass password validation and create user anyway? [y/N]: y
Superuser created successfully.
</code></pre>
<p>ç„¶åå°±å¯ä»¥ç”¨æ–°åˆ›å»ºçš„ç”¨æˆ·åå’Œå¯†ç ç™»å½•Djangoåå°äº†ã€‚</p>
<h2 id="åœ¨åå°ä¸­æ·»åŠ åº”ç”¨é¡µé¢"><a class="header" href="#åœ¨åå°ä¸­æ·»åŠ åº”ç”¨é¡µé¢">åœ¨åå°ä¸­æ·»åŠ åº”ç”¨é¡µé¢</a></h2>
<p>Djangoçš„åå°å…¶å®å°±æ˜¯ä¸€ä¸ªæ•°æ®åº“ç½‘é¡µï¼Œå¯ä»¥åœ¨é‡Œé¢ç›´æ¥æ“ä½œæ•°æ®åº“ä¸­çš„æ•°æ®ï¼Œé»˜è®¤æƒ…å†µä¸‹é‡Œé¢åªæœ‰äº†Groupså’ŒUsersçš„æ•°æ®ï¼Œåº”ç”¨çš„æ•°æ®ä¸åœ¨å…¶ä¸­ã€‚</p>
<p>å¦‚æœè¦åœ¨Djangoåå°ä¸­ç®¡ç†åº”ç”¨ï¼Œéœ€è¦åœ¨åº”ç”¨çš„admin.pyä¸­æ³¨å†Œå¯¹åº”çš„Modelï¼Œä¾‹å¦‚åœ¨polls/admin.pyä¸­æ³¨å†ŒQuestionï¼š</p>
<pre><code class="language-python">from django.contrib import admin

# Register your models here.

from .models import Question

admin.site.register(Question)
</code></pre>
<p>ä»£ç æ·»åŠ ä¹‹åï¼Œåˆ·æ–°åå°å°±ä¼šçœ‹åˆ°å¤šå‡ºäº†ä¸€ä¸ªQuestioné¡µé¢ï¼Œå¯ä»¥æŸ¥çœ‹ç¼–è¾‘é‡Œé¢çš„æ•°æ®ã€‚</p>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="djangoä¸­viewçš„åˆ›å»º"><a class="header" href="#djangoä¸­viewçš„åˆ›å»º">Djangoä¸­viewçš„åˆ›å»º</a></h1>
<p>viewå°±æ˜¯ä¸€ä¸ªä¸€ä¸ªé¡µé¢ï¼Œå‰é¢åœ¨åˆ›å»ºåº”ç”¨çš„æ—¶å€™åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„index viewã€‚è¿™é‡Œæ¼”ç¤ºæ›´å¤šviewçš„ç”¨æ³•ã€‚æ¯ä¸ªviewæœ‰ä¸€ä¸ªç‹¬ç«‹æ— äºŒçš„urlï¼Œå¯¹åº”ä¸€ä¸ªpythonå‡½æ•°ï¼Œè¿™ä¸ªpythonå‡½æ•°è´Ÿè´£æ¸²æŸ“é¡µé¢å¹¶è¿”å›ç»™è¯·æ±‚ç«¯ã€‚</p>
<p>urlså’Œviewsçš„å¯¹åº”å…³ç³»ç”¨<a href="https://docs.djangoproject.com/en/2.2/topics/http/urls/">URL dispatcher</a>æè¿°ã€‚</p>
<h2 id="å¸¦è·¯å¾„å‚æ•°çš„views"><a class="header" href="#å¸¦è·¯å¾„å‚æ•°çš„views">å¸¦è·¯å¾„å‚æ•°çš„views</a></h2>
<p>åœ¨Djangoåº”ç”¨pollsçš„views.pyä¸­åˆ›å»ºå‡ ä¸ªå¸¦æœ‰ä¼ å…¥å‚æ•°çš„viewsï¼š</p>
<pre><code class="language-python">def detail(request, question_id):
    return HttpResponse(&quot;You're looking at question %s.&quot; % question_id)

def results(request, question_id):
    response = &quot;You're looking at the results of question %s.&quot;
    return HttpResponse(response % question_id)

def vote(request, question_id):
    return HttpResponse(&quot;You're voting on question %s.&quot; % question_id)
</code></pre>
<p>æ³¨æ„è¿™å‡ ä¸ªviewsçš„ä¼ å…¥å‚æ•°é™¤äº†requestï¼Œè¿˜æœ‰ä¸€ä¸ªquestion_idï¼Œquestion_idæ˜¯ä»urlä¸­è§£æå‡ºæ¥çš„ï¼Œæ˜¯åœ¨è®¾ç½®urlså’Œviewsçš„å¯¹åº”å…³ç³»æ˜¯è®¾å®šçš„ï¼Œä¾‹å¦‚ï¼Œåœ¨polls/urls.pyä¸­è®¾ç½®å¦‚ä¸‹ï¼š</p>
<pre><code class="language-python">from django.urls import path

from . import views

urlpatterns = [
    # ex: /polls/
    path('', views.index, name='index'),
    # ex: /polls/5/
    path('&lt;int:question_id&gt;/', views.detail, name='detail'),
    # ex: /polls/5/results/
    path('&lt;int:question_id&gt;/results/', views.results, name='results'),
    # ex: /polls/5/vote/
    path('&lt;int:question_id&gt;/vote/', views.vote, name='vote'),
]
</code></pre>
<p>urlsä¸­çš„<code>&lt;int:question_id&gt;</code>å°±æ˜¯è§£æç»™question_idçš„æ•°å€¼ï¼Œç±»å‹æ˜¯intã€‚</p>
<p>åœ¨urlä¸­å¸¦çš„å‚æ•°ï¼Œè¢«è§£æç»™viewçš„å‚æ•°ï¼Œç„¶ååœ¨viewçš„å¤„ç†å‡½æ•°ä¸­è¢«è¿”å›ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code>$ curl 127.0.0.1:8000/polls/3/
You're looking at question 3.

$ curl 127.0.0.1:8000/polls/3/results/
You're looking at the results of question 3.

$ curl 127.0.0.1:8000/polls/3/vote/
You're voting on question 3.
</code></pre>
<h2 id="viewsä¸­çš„å‡†å¤‡å“åº”æ•°æ®"><a class="header" href="#viewsä¸­çš„å‡†å¤‡å“åº”æ•°æ®">viewsä¸­çš„å‡†å¤‡å“åº”æ•°æ®</a></h2>
<p>viewsæœ€ç»ˆè¦è¿”å›ä¸€ä¸ªHttpResponseç±»å‹çš„å˜é‡æˆ–è€…æŠ›å‡ºHttp404ç­‰å¼‚å¸¸ï¼Œåœ¨viewså¯¹åº”çš„å‡½æ•°ä¸­ï¼Œå¯ä»¥ç”¨å„ç§æ–¹å¼ç”Ÿæˆè¦è¿”å›çš„æ•°æ®ï¼Œè­¬å¦‚è¯»å–æ•°æ®åº“ã€é€šè¿‡è¿ç®—è®¡ç®—å‡ºç­‰ã€‚</p>
<p>ä¾‹å¦‚æŠŠindexçš„viewè¿›è¡Œæ‰©å±•ï¼Œè¿”å›ä»æ•°æ®åº“ä¸­æŸ¥è¯¢åˆ°æ•°æ®ï¼š</p>
<pre><code class="language-python">from .models import Question

def index(request):
    latest_question_list = Question.objects.order_by('-pub_date')[:5]
    output = ', '.join([q.question_text for q in latest_question_list])
    return HttpResponse(output)
</code></pre>
<p>è¿™ä¸ªviewsæ–¹æ³•çš„å®ç°åŒæ—¶æ¼”ç¤ºäº†åœ¨Djangoä¸­å¦‚ä½•å¼•ç”¨modelsï¼Œå¹¶é€šè¿‡modelsæŸ¥è¯¢æ•°æ®åº“ã€‚</p>
<h2 id="viewsä¸­ä½¿ç”¨é¡µé¢æ¨¡ç‰ˆ"><a class="header" href="#viewsä¸­ä½¿ç”¨é¡µé¢æ¨¡ç‰ˆ">viewsä¸­ä½¿ç”¨é¡µé¢æ¨¡ç‰ˆ</a></h2>
<p>å‰é¢çš„å‡ ä¸ªviewséƒ½æ˜¯ç¡¬ç¼–ç äº†è¿”å›çš„æ•°æ®ï¼Œæ²¡æœ‰æ•°æ®å’Œæ ·å¼åˆ†å¼€ï¼Œè¿™æ ·ä¼šå¯¼è‡´è¦ä¿®æ”¹è¿”å›çš„æ•°æ®çš„æ ·å¼æ—¶ï¼Œå¿…é¡»ä¿®æ”¹ä»£ç ã€‚å¯ä»¥ç”¨é¡µé¢æ¨¡ç‰ˆ(templates)åŠŸèƒ½å°†æ•°æ®å’Œæ ·å¼åˆ†å¼€ã€‚</p>
<p>Djangoé¡¹ç›®çš„<a href="https://docs.djangoproject.com/en/2.2/ref/settings/#std:setting-TEMPLATES">settings.py</a>ä¸­é…ç½®äº†é¡µé¢æ¨¡ç‰ˆç±»å‹ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="language-python">TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'APP_DIRS': True,
    },
]
</code></pre>
<p>Djangoæ”¯æŒçš„é¡µé¢æ¨¡ç‰ˆæœ‰ï¼š</p>
<pre><code>'django.template.backends.django.DjangoTemplates'
'django.template.backends.jinja2.Jinja2'
</code></pre>
<p>é¡µé¢æ¨¡ç‰ˆæ–‡ä»¶é»˜è®¤ä½äºDjangoåº”ç”¨çš„templatesç›®å½•ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªé¡µé¢æ¨¡ç‰ˆæ–‡ä»¶polls/templates/polls/index.htmlï¼š</p>
<pre><code class="language-django">{% if latest_question_list %}
    &lt;ul&gt;
    {% for question in latest_question_list %}
        &lt;li&gt;&lt;a href=&quot;/polls/{{ question.id }}/&quot;&gt;{{ question.question_text }}&lt;/a&gt;&lt;/li&gt;
    {% endfor %}
    &lt;/ul&gt;
{% else %}
    &lt;p&gt;No polls are available.&lt;/p&gt;
{% endif %}
</code></pre>
<p>é¡µé¢æ¨¡ç‰ˆæ–‡ä»¶ä¸­å¯ä»¥è¿›è¡Œé€»è¾‘åˆ¤æ–­ï¼Œæ ¹æ®ä¼ å…¥çš„å‚æ•°å€¼ç”Ÿæˆä¸åŒçš„å†…å®¹ã€‚</p>
<p>ç„¶ååœ¨viewsä¸­åŠ è½½é¡µé¢æ¨¡ç‰ˆæ–‡ä»¶ï¼Œå¹¶åœ¨æ¸²æŸ“åè¿”å›ï¼š</p>
<pre><code class="language-python">from django.http import HttpResponse
from django.template import loader

from .models import Question


def index(request):
    latest_question_list = Question.objects.order_by('-pub_date')[:5]
    template = loader.get_template('polls/index.html')
    context = {
        'latest_question_list': latest_question_list,
    }
    return HttpResponse(template.render(context, request))
</code></pre>
<p>è¿™æ—¶å€™è¯·æ±‚index viewï¼Œè¿”å›ä¸‹é¢çš„æ•°æ®ï¼š</p>
<pre><code class="language-sh">$ curl http://127.0.0.1:8000/polls/

    &lt;ul&gt;

        &lt;li&gt;&lt;a href=&quot;/polls/1/&quot;&gt;What&amp;#39;s up?&lt;/a&gt;&lt;/li&gt;

    &lt;/ul&gt;
</code></pre>
<p>å¯ä»¥ç”¨render()å‡½æ•°ç®€åŒ–viewsä¸­çš„ä»£ç ï¼š</p>
<pre><code class="language-python">from django.shortcuts import render

from .models import Question


def index(request):
    latest_question_list = Question.objects.order_by('-pub_date')[:5]
    context = {'latest_question_list': latest_question_list}
    return render(request, 'polls/index.html', context)
</code></pre>
<h2 id="viewsä¸­æŠ›å‡º404å¼‚å¸¸"><a class="header" href="#viewsä¸­æŠ›å‡º404å¼‚å¸¸">viewsä¸­æŠ›å‡º404å¼‚å¸¸</a></h2>
<p>å½“æ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„æ•°æ®æ—¶ï¼ŒæŠ›å‡º404å¼‚å¸¸ï¼š</p>
<pre><code class="language-python">from django.http import Http404
from django.shortcuts import render

from .models import Question

def detail(request, question_id):
    try:
        question = Question.objects.get(pk=question_id)
    except Question.DoesNotExist:
        raise Http404(&quot;Question does not exist&quot;)
    return render(request, 'polls/detail.html', {'question': question})
</code></pre>
<p>å¯ä»¥ç”¨<code>get_object_or_404()</code>å‡½æ•°ç®€åŒ–ä»£ç ï¼š</p>
<pre><code class="language-python">from django.shortcuts import get_object_or_404, render

from .models import Question
# ...
def detail(request, question_id):
    question = get_object_or_404(Question, pk=question_id)
    return render(request, 'polls/detail.html', {'question': question})
</code></pre>
<p>å¯¹åº”çš„æ¨¡ç‰ˆæ–‡ä»¶polls/detail.htmlï¼š</p>
<pre><code class="language-django">&lt;h1&gt;{{ question.question_text }}&lt;/h1&gt;
&lt;ul&gt;
{% for choice in question.choice_set.all %}
    &lt;li&gt;{{ choice.choice_text }}&lt;/li&gt;
{% endfor %}
&lt;/ul&gt;
</code></pre>
<h2 id="å»æ‰æ¨¡ç‰ˆæ–‡ä»¶ä¸­ç¡¬ç¼–ç "><a class="header" href="#å»æ‰æ¨¡ç‰ˆæ–‡ä»¶ä¸­ç¡¬ç¼–ç ">å»æ‰æ¨¡ç‰ˆæ–‡ä»¶ä¸­ç¡¬ç¼–ç </a></h2>
<p>å‰é¢ä½¿ç”¨çš„æ¨¡ç‰ˆæ–‡ä»¶ä¸­ï¼Œæœ‰å¯¹urlçš„ç¡¬ç¼–ç ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="language-django">&lt;li&gt;&lt;a href=&quot;/polls/{{ question.id }}/&quot;&gt;{{ question.question_text }}&lt;/a&gt;&lt;/li&gt;
</code></pre>
<p>è¿™æ ·ä¼šé™ä½æ¨¡ç‰ˆæ–‡ä»¶çš„è‡ªé€‚åº”èƒ½åŠ›ï¼Œå¯ä»¥ç”¨urls.pyä¸­çš„å®šä¹‰åŠ¨æ€ç”Ÿæˆè·¯å¾„ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="language-django">&lt;li&gt;&lt;a href=&quot;{% url 'detail' question.id %}&quot;&gt;{{ question.question_text }}&lt;/a&gt;&lt;/li&gt;
</code></pre>
<p>hrefçš„å€¼æ˜¯åä¸ºdetailçš„viewå¯¹åº”çš„urlï¼Œurlè·¯å¾„å‚æ•°çš„å€¼æ˜¯question.idã€‚</p>
<p>è¿™æ ·ä¸€æ¥ï¼Œæ›´æ”¹viewå¯¹åº”çš„urlæ—¶ï¼Œåªéœ€è¦åœ¨urls.pyä¸­ä¿®æ”¹ï¼Œä¸éœ€è¦æ”¹å˜é¡µé¢æ¨¡ç‰ˆæ–‡ä»¶ã€‚</p>
<h2 id="ä¸ºurlè®¾ç½®namespace"><a class="header" href="#ä¸ºurlè®¾ç½®namespace">ä¸ºurlè®¾ç½®namespace</a></h2>
<p>Djangoé¡¹ç›®ä¸­å¯èƒ½æœ‰å¤šä¸ªDjangoåº”ç”¨ï¼Œæ¯ä¸ªåº”ç”¨éƒ½ä¼šå®šä¹‰è‡ªå·±çš„viewsï¼Œä»¥åŠå¯¹åº”çš„urlsï¼Œä¸åŒDjangoåº”ç”¨çš„viewå¯èƒ½é‡åï¼Œé‚£ä¹ˆè¦æ€æ ·åœ¨é¡µé¢å¯¹é‡åçš„viewsè¿›è¡ŒåŒºåˆ†ï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯åœ¨æ¯ä¸ªåº”ç”¨çš„urls.pyä¸­ï¼Œå®šä¹‰ä¸€ä¸ªåä¸ºapp_nameçš„å˜é‡ï¼Œè¿™ä¸ªå˜é‡ä¸ºurlsä¸­æ·»åŠ äº†ä¸€ä¸ªå‘½åç©ºé—´ï¼Œä¾‹å¦‚polls/urls.pyï¼š</p>
<pre><code class="language-python">from django.urls import path

from . import views

app_name = 'polls'
urlpatterns = [
    path('', views.index, name='index'),
    path('&lt;int:question_id&gt;/', views.detail, name='detail'),
    path('&lt;int:question_id&gt;/results/', views.results, name='results'),
    path('&lt;int:question_id&gt;/vote/', views.vote, name='vote'),
]

</code></pre>
<p>ä¸Šé¢çš„ä»£ç å®šä¹‰äº†urlçš„å‘½åç©ºé—´pollsï¼Œåœ¨é¡µé¢æ¨¡ç‰ˆä¸­å¼•ç”¨å¯¹åº”çš„viewsæ—¶éœ€è¦åŠ ä¸Š<code>poll:</code>å‰ç¼€ï¼š</p>
<pre><code class="language-django">&lt;li&gt;&lt;a href=&quot;{% url 'polls:detail' question.id %}&quot;&gt;{{ question.question_text }}&lt;/a&gt;&lt;/li&gt;
</code></pre>
<h2 id="åœ¨viewsä¸­å®ç°formè¡¨å•"><a class="header" href="#åœ¨viewsä¸­å®ç°formè¡¨å•">åœ¨viewsä¸­å®ç°formè¡¨å•</a></h2>
<p>æ›´æ”¹detail.htmlæ¨¡ç‰ˆï¼Œåœ¨å…¶ä¸­æ’å…¥ä¸€ä¸ªè¡¨å•ï¼Œæ³¨æ„è¡¨å•ä¸­æœ‰ä¸€ä¸ªcsrf_tokenï¼Œè¿™æ˜¯djangoå†…ç½®æ”¯æŒçš„CSRFé˜²å¾¡æœºåˆ¶:</p>
<pre><code class="language-django">&lt;h1&gt;{{ question.question_text }}&lt;/h1&gt;

{% if error_message %}&lt;p&gt;&lt;strong&gt;{{ error_message }}&lt;/strong&gt;&lt;/p&gt;{% endif %}

&lt;form action=&quot;{% url 'polls:vote' question.id %}&quot; method=&quot;post&quot;&gt;
{% csrf_token %}
{% for choice in question.choice_set.all %}
    &lt;input type=&quot;radio&quot; name=&quot;choice&quot; id=&quot;choice{{ forloop.counter }}&quot; value=&quot;{{ choice.id }}&quot;&gt;
    &lt;label for=&quot;choice{{ forloop.counter }}&quot;&gt;{{ choice.choice_text }}&lt;/label&gt;&lt;br&gt;
{% endfor %}
&lt;input type=&quot;submit&quot; value=&quot;Vote&quot;&gt;
&lt;/form&gt;
</code></pre>
<p>åœ¨æ¥æ”¶è¡¨å•è¯·æ±‚çš„viewsä¸­å¤„ç†è¡¨å•æ•°æ®ï¼š</p>
<pre><code class="language-python">from django.http import HttpResponse, HttpResponseRedirect
from django.shortcuts import get_object_or_404, render
from django.urls import reverse

from .models import Choice, Question
# ...
def vote(request, question_id):
    question = get_object_or_404(Question, pk=question_id)
    try:
        selected_choice = question.choice_set.get(pk=request.POST['choice'])
    except (KeyError, Choice.DoesNotExist):
        # Redisplay the question voting form.
        return render(request, 'polls/detail.html', {
            'question': question,
            'error_message': &quot;You didn't select a choice.&quot;,
        })
    else:
        selected_choice.votes += 1
        selected_choice.save()
        # Always return an HttpResponseRedirect after successfully dealing
        # with POST data. This prevents data from being posted twice if a
        # user hits the Back button.
        return HttpResponseRedirect(reverse('polls:results', args=(question.id,)))
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="django-generic-viewçš„ä½¿ç”¨"><a class="header" href="#django-generic-viewçš„ä½¿ç”¨">Django Generic Viewçš„ä½¿ç”¨</a></h1>
<p>ä½¿ç”¨Django Generic Viewså¯ä»¥å‡å°‘å¤§é‡ä»£ç ã€‚</p>
<h2 id="generic-viewsæ–¹å¼ä¸­urlå®šä¹‰"><a class="header" href="#generic-viewsæ–¹å¼ä¸­urlå®šä¹‰">Generic Viewsæ–¹å¼ä¸­urlå®šä¹‰</a></h2>
<pre><code class="language-python">from django.urls import path

from . import views

app_name = 'polls'
urlpatterns = [
    path('', views.IndexView.as_view(), name='index'),
    path('&lt;int:pk&gt;/', views.DetailView.as_view(), name='detail'),
    path('&lt;int:pk&gt;/results/', views.ResultsView.as_view(), name='results'),
    path('&lt;int:question_id&gt;/vote/', views.vote, name='vote'),
]
</code></pre>
<p>æ³¨æ„å‰ä¸‰ä¸ªpathçš„ç¬¬äºŒä¸ªå‚æ•°å’Œä»¥å‰ä¸åŒï¼Œå®ƒä»¬æ˜¯ç»§æ‰¿äº†genericä¸­çš„ç±»çš„å¯¹è±¡ï¼Œåœ¨åº”ç”¨çš„views.pyä¸­å®šä¹‰ã€‚</p>
<h2 id="generic-viewsæ–¹å¼ä¸­viewçš„å®šä¹‰"><a class="header" href="#generic-viewsæ–¹å¼ä¸­viewçš„å®šä¹‰">Generic Viewsæ–¹å¼ä¸­viewçš„å®šä¹‰</a></h2>
<pre><code class="language-python">from django.http import HttpResponseRedirect
from django.shortcuts import get_object_or_404, render
from django.urls import reverse
from django.views import generic

from .models import Choice, Question


class IndexView(generic.ListView):
    template_name = 'polls/index.html'
    context_object_name = 'latest_question_list'

    def get_queryset(self):
        &quot;&quot;&quot;Return the last five published questions.&quot;&quot;&quot;
        return Question.objects.order_by('-pub_date')[:5]


class DetailView(generic.DetailView):
    model = Question
    template_name = 'polls/detail.html'


class ResultsView(generic.DetailView):
    model = Question
    template_name = 'polls/results.html'


def vote(request, question_id):
    ... # same as above, no changes needed.
</code></pre>
<p>è¿™é‡Œç”¨åˆ°çš„<a href="https://docs.djangoproject.com/en/2.2/ref/class-based-views/generic-display/#django.views.generic.list.ListView">generic.ListView</a>å’Œ<a href="https://docs.djangoproject.com/en/2.2/ref/class-based-views/generic-display/#django.views.generic.detail.DetailView">generic.DetailView</a>æ˜¯ä¸¤ä¸ªé€šç”¨çš„viewï¼Œåˆ†åˆ«ç”¨æ¥æ¸²æŸ“åˆ—è¡¨å’ŒPythonå¯¹è±¡ã€‚</p>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="djangoåº”ç”¨çš„æµ‹è¯•ä»£ç ç¼–å†™"><a class="header" href="#djangoåº”ç”¨çš„æµ‹è¯•ä»£ç ç¼–å†™">Djangoåº”ç”¨çš„æµ‹è¯•ä»£ç ç¼–å†™</a></h1>
<p>æµ‹è¯•ä»£ç åœ¨Djangoåº”ç”¨çš„tests.pyæ–‡ä»¶ä¸­ç¼–å†™ï¼ŒDjangoæä¾›ä¸€ä¸ªåä¸ºTestCaseçš„ç±»ã€‚</p>
<h2 id="æµ‹è¯•ç”¨ä¾‹1åˆ·å…¥é”™è¯¯æ•°æ®æ£€æŸ¥è¾“å‡º"><a class="header" href="#æµ‹è¯•ç”¨ä¾‹1åˆ·å…¥é”™è¯¯æ•°æ®æ£€æŸ¥è¾“å‡º">æµ‹è¯•ç”¨ä¾‹1ï¼šåˆ·å…¥é”™è¯¯æ•°æ®ï¼Œæ£€æŸ¥è¾“å‡º</a></h2>
<pre><code class="language-python">from django.test import TestCase

# Create your tests here.

import datetime
from django.utils import timezone
from .models import Question

class QuestionModelTests(TestCase):
    def test_was_published_recently_with_future_question(self):
        &quot;&quot;&quot;
        was_published_recently() returns False for questions whose pub_date
        is in the future.
        &quot;&quot;&quot;
        time = timezone.now() + datetime.timedelta(days=30)
        future_question = Question(pub_date=time)
        self.assertIs(future_question.was_published_recently(), False)
</code></pre>
<p>è¿è¡Œä¸‹é¢çš„å‘½ä»¤è¿›è¡Œæµ‹è¯•ï¼š</p>
<pre><code class="language-sh">python ./manage.py test polls
</code></pre>
<p>å¦‚æœæµ‹è¯•ä¸é€šè¿‡ï¼Œè¾“å‡ºå†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code class="language-python">Creating test database for alias 'default'...
System check identified no issues (0 silenced).
F
======================================================================
FAIL: test_was_published_recently_with_future_question (polls.tests.QuestionModelTests)
----------------------------------------------------------------------
Traceback (most recent call last):
  File &quot;/Users/lijiao/Work/workspace/studys/study-python/django/django-py3/mysite/polls/tests.py&quot;, line 17, in test_was_published_recently_with_future_question
    self.assertIs(future_question.was_published_recently(), False)
AssertionError: True is not False

----------------------------------------------------------------------
Ran 1 test in 0.001s

FAILED (failures=1)
Destroying test database for alias 'default'...
</code></pre>
<p>æµ‹è¯•é€šè¿‡æ—¶è¾“å‡ºå†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code class="language-python">(env) 192:mysite lijiao$ python ./manage.py test polls
Creating test database for alias 'default'...
System check identified no issues (0 silenced).
.
----------------------------------------------------------------------
Ran 1 test in 0.001s

OK
</code></pre>
<h2 id="æµ‹è¯•ç”¨ä¾‹2æµ‹è¯•view"><a class="header" href="#æµ‹è¯•ç”¨ä¾‹2æµ‹è¯•view">æµ‹è¯•ç”¨ä¾‹2ï¼šæµ‹è¯•view</a></h2>
<p>Djangoæä¾›äº†ä¸€ä¸ªæµ‹è¯•ç”¨çš„clientï¼Œå¯ä»¥æ¨¡æ‹Ÿç”¨æˆ·å‘èµ·è¯·æ±‚ï¼Œå¯ä»¥åœ¨test.pyä¸­æˆ–è€…shellä¸­ä½¿ç”¨è¿™ä¸ªclientã€‚</p>
<h3 id="åœ¨å‘½ä»¤è¡Œä½¿ç”¨æµ‹è¯•ç”¨çš„client"><a class="header" href="#åœ¨å‘½ä»¤è¡Œä½¿ç”¨æµ‹è¯•ç”¨çš„client">åœ¨å‘½ä»¤è¡Œä½¿ç”¨æµ‹è¯•ç”¨çš„Client</a></h3>
<pre><code class="language-shell">(env) 192:mysite lijiao$ python manage.py shell
Python 3.7.2 (default, Feb 12 2019, 08:15:36)
[Clang 10.0.0 (clang-1000.11.45.5)] on darwin
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
(InteractiveConsole)
&gt;&gt;&gt; from django.test.utils import setup_test_environment
&gt;&gt;&gt; setup_test_environment()
&gt;&gt;&gt; from django.test import Client
&gt;&gt;&gt; client = Client()
&gt;&gt;&gt; response = client.get('/')
Not Found: /
&gt;&gt;&gt; response.status_code
404
&gt;&gt;&gt; from django.urls import reverse
&gt;&gt;&gt;
&gt;&gt;&gt; response = client.get(reverse('polls:index'))
&gt;&gt;&gt; response.status_code
200
&gt;&gt;&gt; response.content
b'\n    &lt;ul&gt;\n    \n        &lt;li&gt;&lt;a href=&quot;/polls/1/&quot;&gt;What&amp;#39;s up?&lt;/a&gt;&lt;/li&gt;\n    \n    &lt;/ul&gt;\n\n'
&gt;&gt;&gt; response.context['latest_question_list']
&lt;QuerySet [&lt;Question: What's up?&gt;]&gt;
&gt;&gt;&gt;
</code></pre>
<h3 id="åœ¨testspyä¸­ä½¿ç”¨æµ‹è¯•ç”¨çš„client"><a class="header" href="#åœ¨testspyä¸­ä½¿ç”¨æµ‹è¯•ç”¨çš„client">åœ¨tests.pyä¸­ä½¿ç”¨æµ‹è¯•ç”¨çš„Client</a></h3>
<p>åœ¨tests.pyä¸­å†™å…¥æ•°æ®åï¼Œå†ç”¨Clientè¯·æ±‚æŸ¥çœ‹è¿”å›çš„æ•°æ®æ˜¯å¦æ­£ç¡®ï¼š</p>
<pre><code class="language-python">def create_question(question_text, days):
    &quot;&quot;&quot;
    Create a question with the given `question_text` and published the
    given number of `days` offset to now (negative for questions published
    in the past, positive for questions that have yet to be published).
    &quot;&quot;&quot;
    time = timezone.now() + datetime.timedelta(days=days)
    return Question.objects.create(question_text=question_text, pub_date=time)


class QuestionIndexViewTests(TestCase):
    def test_no_questions(self):
        &quot;&quot;&quot;
        If no questions exist, an appropriate message is displayed.
        &quot;&quot;&quot;
        response = self.client.get(reverse('polls:index'))
        self.assertEqual(response.status_code, 200)
        self.assertContains(response, &quot;No polls are available.&quot;)
        self.assertQuerysetEqual(response.context['latest_question_list'], [])

    def test_past_question(self):
        &quot;&quot;&quot;
        Questions with a pub_date in the past are displayed on the
        index page.
        &quot;&quot;&quot;
        create_question(question_text=&quot;Past question.&quot;, days=-30)
        response = self.client.get(reverse('polls:index'))
        self.assertQuerysetEqual(
            response.context['latest_question_list'],
            ['&lt;Question: Past question.&gt;']
        )

    def test_future_question(self):
        &quot;&quot;&quot;
        Questions with a pub_date in the future aren't displayed on
        the index page.
        &quot;&quot;&quot;
        create_question(question_text=&quot;Future question.&quot;, days=30)
        response = self.client.get(reverse('polls:index'))
        self.assertContains(response, &quot;No polls are available.&quot;)
        self.assertQuerysetEqual(response.context['latest_question_list'], [])

    def test_future_question_and_past_question(self):
        &quot;&quot;&quot;
        Even if both past and future questions exist, only past questions
        are displayed.
        &quot;&quot;&quot;
        create_question(question_text=&quot;Past question.&quot;, days=-30)
        create_question(question_text=&quot;Future question.&quot;, days=30)
        response = self.client.get(reverse('polls:index'))
        self.assertQuerysetEqual(
            response.context['latest_question_list'],
            ['&lt;Question: Past question.&gt;']
        )

    def test_two_past_questions(self):
        &quot;&quot;&quot;
        The questions index page may display multiple questions.
        &quot;&quot;&quot;
        create_question(question_text=&quot;Past question 1.&quot;, days=-30)
        create_question(question_text=&quot;Past question 2.&quot;, days=-5)
        response = self.client.get(reverse('polls:index'))
        self.assertQuerysetEqual(
            response.context['latest_question_list'],
            ['&lt;Question: Past question 2.&gt;', '&lt;Question: Past question 1.&gt;']
        )
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="åœ¨djangoé¡µé¢æ¨¡ç‰ˆä¸­å¼•å…¥é™æ€èµ„æº"><a class="header" href="#åœ¨djangoé¡µé¢æ¨¡ç‰ˆä¸­å¼•å…¥é™æ€èµ„æº">åœ¨Djangoé¡µé¢æ¨¡ç‰ˆä¸­å¼•å…¥é™æ€èµ„æº</a></h1>
<p>Djangoé»˜è®¤åˆ°åº”ç”¨çš„staticå­ç›®å½•ä¸­æŸ¥æ‰¾é™æ€èµ„æºã€‚</p>
<pre><code>mkdir polls/static
</code></pre>
<h2 id="åˆ›å»ºä¸€ä¸ªé™æ€çš„cssæ–‡ä»¶"><a class="header" href="#åˆ›å»ºä¸€ä¸ªé™æ€çš„cssæ–‡ä»¶">åˆ›å»ºä¸€ä¸ªé™æ€çš„cssæ–‡ä»¶</a></h2>
<p>åˆ›å»ºä¸€ä¸ªcssæ–‡ä»¶ï¼Œpolls/static/polls/style.cssï¼š</p>
<pre><code class="language-css">li a {
    color: green;
}
</code></pre>
<p>åœ¨é¡µé¢æ¨¡ç‰ˆä¸­ç”¨loadå‘½ä»¤å¼•ç”¨ï¼š</p>
<pre><code class="language-django">{% load static %}

&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;{% static 'polls/style.css' %}&quot;&gt;
</code></pre>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™æ—¶å€™è¦é‡å¯Django serverï¼Œå¦åˆ™ä¼šæ‰¾ä¸åˆ°é™æ€æ–‡ä»¶ï¼š</p>
<pre><code class="language-sh">python manage.py runserver
</code></pre>
<h2 id="å¼•ç”¨é™æ€å›¾ç‰‡"><a class="header" href="#å¼•ç”¨é™æ€å›¾ç‰‡">å¼•ç”¨é™æ€å›¾ç‰‡</a></h2>
<p>å¼•ç”¨å…¶å®ƒé™æ€æ–‡ä»¶æ—¶ç”¨çš„éƒ½æ˜¯ç›¸å¯¹å½“å‰æ–‡ä»¶æ‰€åœ¨ç›®å½•çš„è·¯å¾„ï¼Œä¾‹å¦‚å¯¹äºpolls/static/polls/images/backgroud.gifï¼Œåœ¨polls/static/polls/style.cssä¸­å¼•ç”¨æ—¶ï¼Œç”¨çš„è·¯å¾„æ˜¯:images/background.gifã€‚</p>
<pre><code class="language-css">body {
    background: white url(&quot;images/background.gif&quot;) no-repeat;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="djangoä¼ å…¥å‚æ•°çš„è·å–"><a class="header" href="#djangoä¼ å…¥å‚æ•°çš„è·å–">Djangoä¼ å…¥å‚æ•°çš„è·å–</a></h1>
<p>åœ¨viewsçš„å¼€å‘ä¸€èŠ‚ä¸­è®²è¿‡ï¼Œurlè·¯å¾„å‚æ•°å¯ä»¥djangoç›´æ¥è§£æï¼Œå¹¶ä½œä¸ºå‚æ•°ä¼ å…¥viewsçš„å¤„ç†å‡½æ•°ã€‚ä½†åªæœ‰è·¯å¾„å‚æ•°æ˜¯ä¸å¤Ÿçš„ï¼Œhttpå‘èµ·çš„GETè¯·æ±‚æ˜¯æœ‰å‚æ•°çš„ï¼Œä»¥åŠPOSTè¯·æ±‚æäº¤çš„bodyæ•°æ®éƒ½éœ€è¦è§£æã€‚</p>
<h2 id="è¯·æ±‚å‚æ•°"><a class="header" href="#è¯·æ±‚å‚æ•°">è¯·æ±‚å‚æ•°</a></h2>
<p>viewså‡½æ•°ä¸­ç¬¬ä¸€ä¸ªå‚æ•°ç±»å‹æ˜¯<a href="https://docs.djangoproject.com/en/2.2/ref/request-response/" title="Django Request and response objects">HttpRequest</a>ï¼Œå¯ä»¥ä»è¿™ä¸ªå‚æ•°ä¸­è§£ææ‰€æœ‰çš„è¯·æ±‚ä¿¡æ¯ã€‚</p>
<p><strong>HttpRequest.GET</strong>å°±æ˜¯GETè¯·æ±‚ä¸­çš„æ‰€æœ‰å‚æ•°ï¼Œå®ƒçš„ç±»å‹æ˜¯<a href="https://docs.djangoproject.com/en/2.2/ref/request-response/#querydict-objects" title="QueryDict objects">QueryDict objects</a>ã€‚</p>
<p>å¯ä»¥ç”¨ä¸‹é¢çš„æ–¹å¼è¯»å–å‚æ•°å€¼ï¼Œå¦‚æœå‚æ•°ä¸å­˜åœ¨ä½¿ç”¨defaultå€¼ï¼š</p>
<pre><code class="language-python">signature = request.GET.get('signature', default='')
timestamp = request.GET.get('timestamp',default='')
nonce = request.GET.get('nonce',default='')
echostr = request.GET.get('echostr',default='')
</code></pre>
<p>ä¹Ÿå¯ä»¥ç”¨mapçš„å½¢å¼è·å–ï¼Œå¦‚æœå‚æ•°ä¸å­˜åœ¨ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ï¼š</p>
<pre><code class="language-python">try:
    signature = request.GET['signature']
    timestamp = request.GET['timestamp']
    nonce = request.GET['nonce']
    echostr = request.GET['echostr']
except Exception as err:
    raise Http404(&quot;parameter error&quot;)
</code></pre>
<p>å¼‚å¸¸çš„å…·ä½“ç±»å‹æ˜¯django.utils.datastructures.MultiValueDictKeyErrorï¼Œå®ƒæ˜¯Pythonæ ‡å‡†å¼‚å¸¸KeyErrorçš„å­ç±»ã€‚</p>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="djangoçš„æ—¥å¿—ç®¡ç†"><a class="header" href="#djangoçš„æ—¥å¿—ç®¡ç†">Djangoçš„æ—¥å¿—ç®¡ç†</a></h1>
<p>Djangoçš„æ—¥å¿—åœ¨é¡¹ç›®çš„settings.pyä¸­é…ç½®[LOGGING][1]ã€‚</p>
<h2 id="djangoä¸­ä½¿ç”¨logging"><a class="header" href="#djangoä¸­ä½¿ç”¨logging">Djangoä¸­ä½¿ç”¨logging</a></h2>
<p>åœ¨é¡¹ç›®çš„settings.pyä¸­è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š</p>
<pre><code class="language-python">LOGGING = {
    'version': 1,
    'disable_existing_loggers': False,
    'handlers': {
        'file': {
            'level': 'DEBUG',
            'class': 'logging.FileHandler',
            'filename': '/path/to/django/debug.log',
        },
    },
    'loggers': {
        'django': {
            'handlers': ['file'],
            'level': 'DEBUG',
            'propagate': True,
        },
    },
}
</code></pre>
<p>ç„¶åå°±å¯ä»¥åœ¨Djangoåº”ç”¨ä¸­ç›´æ¥ä½¿ç”¨loggingï¼š</p>
<pre><code class="language-python">import logging

logger = logging.getLogger(__name__)

def auth(request):
    logger.info(&quot;this is log&quot;)
</code></pre>
<p>è¿™æ—¶å€™åªèƒ½æ‰“å°å‡ºdjangoæ¨¡å—çš„æ—¥å¿—ï¼Œä¸Šé¢çš„â€œthis is logâ€ä¸ä¼šå‡ºç°æ—¥å¿—ä¸­ï¼Œè¿™æ˜¯å› ä¸ºä¸Šé¢çš„settings.pyä¸­åªé…ç½®äº†djangoï¼Œè¿˜éœ€è¦åŠ ä¸Šæˆ‘ä»¬è‡ªå·±çš„djangoåº”ç”¨:</p>
<pre><code>'loggers': {
    'django': {
        'handlers': ['file'],
        'level': 'DEBUG',
        'propagate': True,
    },
    'polls': {
        'handlers': ['file'],
        'level': 'DEBUG',
        'propagate': True,
    }
</code></pre>
<h2 id="æ›´å¤æ‚çš„loggingé…ç½®"><a class="header" href="#æ›´å¤æ‚çš„loggingé…ç½®">æ›´å¤æ‚çš„loggingé…ç½®</a></h2>
<p>loggingçš„çµæ´»ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„loggingé…ç½®ï¼š</p>
<pre><code class="language-python">LOGGING = {
    'version': 1,
    'disable_existing_loggers': False,
    'formatters': {
        'verbose': {
            'format': '{levelname} {asctime} {module} {process:d} {thread:d} {message}',
            'style': '{',
        },
        'simple': {
            'format': '{levelname} {message}',
            'style': '{',
        },
    },
    'filters': {
        'special': {
            '()': 'project.logging.SpecialFilter',
            'foo': 'bar',
        },
        'require_debug_true': {
            '()': 'django.utils.log.RequireDebugTrue',
        },
    },
    'handlers': {
        'console': {
            'level': 'INFO',
            'filters': ['require_debug_true'],
            'class': 'logging.StreamHandler',
            'formatter': 'simple'
        },
        'mail_admins': {
            'level': 'ERROR',
            'class': 'django.utils.log.AdminEmailHandler',
            'filters': ['special']
        }
    },
    'loggers': {
        'django': {
            'handlers': ['console'],
            'propagate': True,
        },
        'django.request': {
            'handlers': ['mail_admins'],
            'level': 'ERROR',
            'propagate': False,
        },
        'myproject.custom': {
            'handlers': ['console', 'mail_admins'],
            'level': 'INFO',
            'filters': ['special']
        }
    }
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="ä½¿ç”¨djangoé¡¹ç›®çš„settingspyä¸­çš„å…¨å±€å˜é‡"><a class="header" href="#ä½¿ç”¨djangoé¡¹ç›®çš„settingspyä¸­çš„å…¨å±€å˜é‡">ä½¿ç”¨Djangoé¡¹ç›®çš„settings.pyä¸­çš„å…¨å±€å˜é‡</a></h1>
<pre><code class="language-python">from django.conf import settings

print(settings.WECHAT_TOKEN)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="djangoä½¿ç”¨è¿‡ç¨‹é‡åˆ°çš„é—®é¢˜"><a class="header" href="#djangoä½¿ç”¨è¿‡ç¨‹é‡åˆ°çš„é—®é¢˜">Djangoä½¿ç”¨è¿‡ç¨‹é‡åˆ°çš„é—®é¢˜</a></h1>
<h2 id="lookuperror-no-installed-app-with-label-admin"><a class="header" href="#lookuperror-no-installed-app-with-label-admin">LookupError: No installed app with label 'admin'.</a></h2>
<p>ä¸€ä¸ªç©ºçš„Djangoé¡¹ç›®è¿è¡Œæ—¶ç›´æ¥æŠ¥é”™ï¼š<code>LookupError: No installed app with label 'admin'.</code>ã€‚</p>
<p>Djangoç‰ˆæœ¬æ˜¯2.2ï¼Œå‡ºç°è¿™ä¸ªé”™è¯¯åŸå› æ˜¯ç³»ç»Ÿä¸Šçš„sqliteç‰ˆæœ¬å¤ªä½ï¼Œä½äºdjango2.2çš„è¦æ±‚ï¼š</p>
<pre><code>  File &quot;/root/discount/env/lib/python3.6/site-packages/django/db/backends/sqlite3/base.py&quot;, line 66, in &lt;module&gt;
    check_sqlite_version()
  File &quot;/root/discount/env/lib/python3.6/site-packages/django/db/backends/sqlite3/base.py&quot;, line 63, in check_sqlite_version
    raise ImproperlyConfigured('SQLite 3.8.3 or later is required (found %s).' % Database.sqlite_version)
django.core.exceptions.ImproperlyConfigured: SQLite 3.8.3 or later is required (found 3.7.17).
</code></pre>
<p>åœ¨settings.pyé…ç½®é…ç½®å…¶å®ƒæ•°æ®åº“ï¼Œæ¯”å¦‚mysqlï¼Œä¸è¦ä½¿ç”¨sqliteï¼Œæˆ–è€…å°†æœ¬åœ°çš„sqliteå‡çº§ã€‚</p>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="ideaè¿œç¨‹è°ƒè¯•python"><a class="header" href="#ideaè¿œç¨‹è°ƒè¯•python">IDEAè¿œç¨‹è°ƒè¯•python</a></h1>
<p>Tools-&gt;Deployment-&gt;Configurationï¼Œåœ¨å¼¹å‡ºçš„çª—å£ä¸­æ·»åŠ è¿œç¨‹Serverï¼Œæ ¹æ®éœ€è¦é€‰æ‹©FTPæˆ–è€…SFTPåè®®ï¼Œè¿™é‡Œä½¿ç”¨SFTPã€‚</p>
<p>æ·»åŠ è¿œç¨‹serverä¹‹åï¼Œå…ˆä¸è¦å…³é—­çª—å£ï¼Œåˆ°<code>Mapping</code>é€‰é¡¹å¡ä¸­ï¼Œè®¾ç½®ä¸€ä¸‹è¿œç¨‹è·¯å¾„ï¼Œä»£ç å°†è¢«ä¸Šä¼ åˆ°è¿œç¨‹æœåŠ¡å™¨çš„æŒ‡å®šç›®å½•ä¸­ã€‚</p>
<p>è¿œç¨‹æœºå™¨ä¸Šéœ€è¦è®¾ç½®SFTPï¼Œsshdé»˜è®¤å°±å¯ç”¨äº†sftpï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤éªŒè¯ä»¥ä¸‹ï¼š</p>
<pre><code>sftp root@SERVER_ADDR
</code></pre>
<p>å¦‚æœåœ¨IntellJ Idealä¸­Test SFTP Connectionæ€»æ˜¯å¤±è´¥ï¼Œåœ¨shellä¸­æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼ˆè®¤è¯æ–¹å¼é€‰æ‹©OpenSSH config and authentication agentçš„æ—¶å€™ï¼‰ï¼š</p>
<pre><code>ssh-add ~/.ssh/id_rsa
</code></pre>
<p><a href="https://intellij-support.jetbrains.com/hc/en-us/community/posts/115000808830-SFTP-Connection-Failed">SFTP Connection Failed</a></p>
<p>Test SFTP ConnectionæˆåŠŸä¹‹åï¼Œç‚¹è¿›Tools-&gt;Deployment-&gt;Upload to XXXï¼Œå°†ä»£ç ä¸Šä¼ åˆ°æŒ‡å®šçš„æœåŠ¡å™¨ã€‚</p>
<p>ä¹Ÿå¯ä»¥åœ¨å·¦ä¾§çš„ç›®å½•ä¸­é€‰æ‹©è¦ä¸Šä¼ çš„ç›®å½•ï¼Œç„¶åç‚¹å‡»å³é”®ï¼Œé€‰æ‹©Deployment-&gt;Upload to XXXã€‚</p>
<p>é¼ æ ‡åœ¨ç¼–è¾‘çª—å£ä¸­æ˜¯ï¼ŒæŒ‰ä¸‹shift+alt+command+xï¼Œä¼šå¼¹å‡ºæœåŠ¡å™¨åˆ—è¡¨ï¼Œé€‰ä¸­ä¹‹åå°±ç›´æ¥å°†å½“å‰æ–‡ä»¶ä¸Šä¼ äº†ã€‚</p>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="åœ¨djangoé¡¹ç›®è‡ªå®šä¹‰package"><a class="header" href="#åœ¨djangoé¡¹ç›®è‡ªå®šä¹‰package">åœ¨Djangoé¡¹ç›®è‡ªå®šä¹‰Package</a></h1>
<p>ä¸€äº›å¸¸ç”¨çš„ä»£ç å¯ä»¥åšæˆPackageï¼Œä»è€Œå¯ä»¥åœ¨å¤šä¸ªåœ°æ–¹å¤ç”¨ï¼Œåœ¨Djangoé¡¹ç›®ä»£ç ä¸­å¯ä»¥ç›´æ¥åº”ç”¨è‡ªå®šä¹‰çš„Packageã€‚</p>
<h2 id="åœ¨djangoé¡¹ç›®ä¸­åˆ›å»ºpakcage"><a class="header" href="#åœ¨djangoé¡¹ç›®ä¸­åˆ›å»ºpakcage">åœ¨Djangoé¡¹ç›®ä¸­åˆ›å»ºPakcage</a></h2>
<p>åœ¨Djangoé¡¹ç›®çš„ç›®å½•å¦‚ä¸‹ï¼Œå­ç›®å½•mysiteæ˜¯djangoé¡¹ç›®çš„é…ç½®packageï¼Œwechatæ˜¯Djangoåº”ç”¨ã€‚</p>
<pre><code>â–¾ mysite/
  â–¸ mysite/
  â–¸ wechat/
    __init__.py
    manage.py*
</code></pre>
<p>åœ¨Djangoçš„ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªwechatsdkçš„packageï¼Œwechatsdkç›®å½•ä¸­è¦æœ‰<code>__init__.py</code>æ–‡ä»¶ï¼š</p>
<pre><code>â–¾ mysite/
  â–¸ mysite/
  â–¸ wechat/
  â–¸ wechatsdk/
      __init__.py
      auth.py
      msgtype.py
    __init__.py
    manage.py*
</code></pre>
<p>ç„¶åå°±å¯ä»¥åœ¨Djangoåº”ç”¨å¼•ç”¨wechatsdké‡Œï¼Œä¾‹å¦‚åœ¨Djangoåº”ç”¨wechat/views.pyä¸­å¼•ç”¨wechatsdkï¼š</p>
<pre><code class="language-python">from wechatsdk import msgtype
from wechatsdk import auth
</code></pre>
<p>åœ¨ç”¨â€œpython ./manager.py runserverâ€å¯åŠ¨DjangoæœåŠ¡çš„æ—¶å€™ï¼Œä¼šä»å½“å‰ç›®å½•ä¸­æŸ¥æ‰¾packageï¼Œå› æ­¤wechatsdkèƒ½å¤Ÿè¢«æ‰¾åˆ°ã€‚å¦‚æœIDE IntellJ Ideaè¦æ­£ç¡®åœ°æ‰¾åˆ°wechatsdkï¼Œé¡¹ç›®çš„æ ¹ç›®å½•éœ€è¦æ˜¯wechatsdkçš„çˆ¶ç›®å½•mysiteï¼Œå¯ä»¥åœ¨File-&gt;Project Structure -&gt; Modulesä¸­ä¿®æ”¹Content Rootã€‚</p>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="ç”¨wsgiæ–¹å¼éƒ¨ç½²djangoæœåŠ¡"><a class="header" href="#ç”¨wsgiæ–¹å¼éƒ¨ç½²djangoæœåŠ¡">ç”¨WSGIæ–¹å¼éƒ¨ç½²DjangoæœåŠ¡</a></h1>
<p>Djangoçš„ä¸»è¦éƒ¨ç½²å¹³å°æ˜¯WSGIï¼ŒWSGIæ˜¯pythonçš„webæœåŠ¡å’Œåº”ç”¨æ ‡å‡†ï¼Œæ–‡æ¡£<a href="https://docs.djangoproject.com/en/2.2/howto/deployment/wsgi/" title="How to deploy with WSGI">How to deploy with WSGI</a>ä¸­ä»‹ç»äº†å››ç§æ–¹å¼ï¼šä½¿ç”¨mod_swgiæ¨¡å—çš„Apacheï¼ŒGunicornã€uWSGIã€‚</p>
<h2 id="æŒ‡å®šé…ç½®æ–‡ä»¶"><a class="header" href="#æŒ‡å®šé…ç½®æ–‡ä»¶">æŒ‡å®šé…ç½®æ–‡ä»¶</a></h2>
<p>Djangoé¡¹ç›®ä¸­çš„wsgi.pyå°±æ˜¯æ”¯æŒWSGIçš„web serverè¦åŠ è½½çš„åº”ç”¨å…¥å£æ–‡ä»¶ã€‚wsgi.pyä¸­è¦è®¾ç½®ç¯å¢ƒå˜é‡<code>DJANGO_SETTINGS_MODULE</code>ï¼ŒæŒ‡å‘Djangoåº”ç”¨çš„é…ç½®æ¨¡å—ï¼Œé»˜è®¤æ˜¯é¡¹ç›®ç›®å½•ä¸­mysite/settings.pyï¼š</p>
<pre><code class="language-python">os.environ.setdefault(&quot;DJANGO_SETTINGS_MODULE&quot;, &quot;mysite.settings&quot;)
</code></pre>
<p><code>DJANGO_SETTINGS_MODULE</code>çš„å€¼å¯ä»¥çµæ´»è®¾ç½®ï¼Œå› æ­¤å¯ä»¥ä¸ºç”Ÿäº§ç¯å¢ƒã€æµ‹è¯•å¼€å‘ç¯å¢ƒå¯ä»¥ä½¿ç”¨ä¸åŒçš„settings.pyæ–‡ä»¶ã€‚</p>
<h2 id="æ·»åŠ wsgiä¸­é—´ä»¶"><a class="header" href="#æ·»åŠ wsgiä¸­é—´ä»¶">æ·»åŠ wsgiä¸­é—´ä»¶</a></h2>
<p>WSGIçš„ä¸€ä¸ªä¸»è¦å–ç‚¹æ˜¯å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ·»åŠ ä¸­é—´å¤„ç†ç¯èŠ‚ï¼Œè¿™ä¸ªåŠŸèƒ½å«åš<a href="https://www.python.org/dev/peps/pep-3333/#middleware-components-that-play-both-sides" title="WSGI middleware">wsgi middleware</a>ï¼Œå¯ä»¥å°†å¼€å‘çš„ä¸­é—´ä»·å¾ˆæ–¹ä¾¿çš„å¥—åœ¨Djangoåº”ç”¨ä¸Šï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="language-python">from helloworld.wsgi import HelloWorldApplication
application = get_wsgi_application()
application = HelloWorldApplication(application)
</code></pre>
<p>é€šè¿‡<code>get_wsgi_application()</code>è¿”å›çš„applicationæ˜¯åŸå§‹çš„Djangoåº”ç”¨ã€‚</p>
<h2 id="wsgièµ„æ–™"><a class="header" href="#wsgièµ„æ–™">wsgièµ„æ–™</a></h2>
<p>wsgiçš„é…ç½®æ ·ä¾‹ï¼Œ<a href="https://modwsgi.readthedocs.io/en/develop/user-guides/quick-configuration-guide.html" title="Quick Configuration Guide">Quick Configuration Guide</a>ï¼š</p>
<pre><code class="language-conf">&lt;VirtualHost *:80&gt;

    ServerName www.example.com
    ServerAlias example.com
    ServerAdmin webmaster@example.com

    DocumentRoot /usr/local/www/documents

    &lt;Directory /usr/local/www/documents&gt;
    &lt;IfVersion &lt; 2.4&gt;
        Order allow,deny
        Allow from all
    &lt;/IfVersion&gt;
    &lt;IfVersion &gt;= 2.4&gt;
        Require all granted
    &lt;/IfVersion&gt;
    &lt;/Directory&gt;

    WSGIScriptAlias /myapp /usr/local/www/wsgi-scripts/myapp.wsgi

    &lt;Directory /usr/local/www/wsgi-scripts&gt;
    &lt;IfVersion &lt; 2.4&gt;
        Order allow,deny
        Allow from all
    &lt;/IfVersion&gt;
    &lt;IfVersion &gt;= 2.4&gt;
        Require all granted
    &lt;/IfVersion&gt;
    &lt;/Directory&gt;

&lt;/VirtualHost&gt;

</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="åœ¨apacheä¸­éƒ¨ç½²djangoåº”ç”¨"><a class="header" href="#åœ¨apacheä¸­éƒ¨ç½²djangoåº”ç”¨">åœ¨Apacheä¸­éƒ¨ç½²Djangoåº”ç”¨</a></h1>
<p>åœ¨apacheä¸­éƒ¨ç½²çš„æ—¶å€™ï¼Œéœ€è¦å¯ç”¨apacheçš„<a href="https://modwsgi.readthedocs.io/en/develop/" title="mod_wsgi">mod_wsgi</a>æ¨¡å—ï¼Œè¿™ä¸ªæ¨¡å—ç”¨æ¥å…¼å®¹pythonçš„wsgiåº”ç”¨ï¼ŒåŒ…æ‹¬Djangoã€‚<a href="https://docs.djangoproject.com/en/2.2/howto/deployment/wsgi/modwsgi/" title="How to use Django with Apache and mod_wsgi">How to use Django with Apache and mod_wsgi</a>ä¸­æœ‰è¯¦ç»†ä»‹ç»ã€‚</p>
<h2 id="å®‰è£…apacheå’Œmod_wsgi"><a class="header" href="#å®‰è£…apacheå’Œmod_wsgi">å®‰è£…Apacheå’Œmod_wsgi</a></h2>
<p>å»ºè®®ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼ï¼Œå®‰è£…iusæºä¸­python**wsgiã€‚</p>
<h3 id="ä½¿ç”¨yumç›´æ¥å®‰è£…mod_wsgi"><a class="header" href="#ä½¿ç”¨yumç›´æ¥å®‰è£…mod_wsgi">ä½¿ç”¨yumç›´æ¥å®‰è£…mod_wsgi</a></h3>
<p>CentOSä¸­æä¾›äº†mod_wsgiçš„å®‰è£…åŒ…ï¼Œå®‰è£…çš„æ—¶å€™ä¼šè¿åŒä¾èµ–çš„apacheï¼ˆåœ¨CentOSä¸­åä¸ºhttpdï¼‰ä¸€èµ·å®‰è£…ï¼š</p>
<pre><code class="language-bash">$ yum install -y mod_wsgi
Dependencies Resolved

================================================================================
 Package            Arch          Version                       Repository
                                                                           Size
================================================================================
Installing:
 mod_wsgi           x86_64        3.4-18.el7                    os         77 k
Installing for dependencies:
 apr                x86_64        1.4.8-3.el7_4.1               os        103 k
 apr-util           x86_64        1.5.2-6.el7                   os         92 k
 httpd              x86_64        2.4.6-88.el7.centos           os        2.7 M
 httpd-tools        x86_64        2.4.6-88.el7.centos           os         90 k
 mailcap            noarch        2.1.41-2.el7                  os         31 k
</code></pre>
<p>ä½†æ˜¯æ ¹æ®<a href="https://stackoverflow.com/questions/41005030/django-apache-and-virtualenv-importerror-no-module-named-site" title="Django Apache and Virtualenv ImportError: No module named site">Django Apache and Virtualenv ImportError: No module named site</a>ä¸­çš„è¯´æ³•ï¼Œå¦‚æœwsgiç¼–è¯‘æ—¶ä½¿ç”¨çš„pythonç‰ˆæœ¬å’Œdjangoåº”ç”¨ä½¿ç”¨pythonç‰ˆæœ¬ä¸ä¸€è‡´ï¼Œå¯èƒ½ä¼šå‡ºç°æ‰¾ä¸åˆ°python packageçš„æƒ…å†µï¼š</p>
<pre><code class="language-sh">#æ—¥å¿—æ–‡ä»¶ /var/log/httpd/error_log
ImportError: No module named site
ImportError: No module named site
ImportError: No module named site
ImportError: No module named site
ImportError: No module named site
ImportError: No module named site
</code></pre>
<p><a href="https://pypi.org/project/mod_wsgi/" title="mod_wsgi 4.6.5 ">mod_wsgi</a>ä¸­å»ºè®®ä½¿ç”¨pipå®‰è£…ï¼Œçœ‹äº†ä¸€ä¸‹è¿˜æ˜¯æŒºéº»çƒ¦çš„ã€‚<a href="https://stackoverflow.com/questions/41005030/django-apache-and-virtualenv-importerror-no-module-named-site" title="Django Apache and Virtualenv ImportError: No module named site">Django Apache and Virtualenv ImportError: No module named site</a>ä¸­çš„æ ‡é¢˜ä¸º<code>Solved in CentOS 7 with Apache 2.4.6</code>ç­”æ¡ˆä¸­ç»™å‡ºçš„ç”¨iusæºå®‰è£…çš„æ–¹æ³•æ¯”è¾ƒæ–¹ä¾¿ã€‚</p>
<h3 id="ä½¿ç”¨iusæºä¸­çš„python36u-mod_wsgi"><a class="header" href="#ä½¿ç”¨iusæºä¸­çš„python36u-mod_wsgi">ä½¿ç”¨iusæºä¸­çš„python36u-mod_wsgi</a></h3>
<p>é¦–å…ˆå®‰è£…<a href="https://ius.io/GettingStarted/">ius</a>æºï¼š</p>
<pre><code class="language-sh">$ curl https://setup.ius.io/ | bash
</code></pre>
<p>iusæºä¸­åŒ…å«äº†ä¸åŒpythonç‰ˆæœ¬çš„mod_wsgiï¼š</p>
<pre><code class="language-sh">$ yum search mod_wsgi
python35u-mod_wsgi-debuginfo.x86_64 : Debug information for package python35u-mod_wsgi
python36u-mod_wsgi-debuginfo.x86_64 : Debug information for package python36u-mod_wsgi
koschei-frontend.noarch : Web frontend for koschei using mod_wsgi
mod_wsgi.x86_64 : A WSGI interface for Python web applications in Apache
python35u-mod_wsgi.x86_64 : A WSGI interface for Python web applications in Apache
python36u-mod_wsgi.x86_64 : A WSGI interface for Python web applications in Apache
viewvc-httpd-wsgi.noarch : ViewVC configuration for Apache/mod_wsgi
</code></pre>
<p>æˆ‘ä½¿ç”¨çš„æ˜¯python3.6ï¼Œç›´æ¥å®‰è£…python36u-mod_wsgiï¼Œå¦‚æœiusé‡Œä¹Ÿæ²¡æœ‰ä½ ç”¨çš„ç‰ˆæœ¬ï¼Œé‚£ä¹ˆå°±è€ƒè™‘è‡ªå·±ç¼–è¯‘å®‰è£…<a href="https://pypi.org/project/mod_wsgi/" title="mod_wsgi 4.6.5 ">mod_wsgi</a>ã€‚</p>
<pre><code class="language-sh">yum erase mod_wsgi  # å¸è½½ä¹‹å‰å®‰è£…çš„mod_wsgi
yum install -y python36u-mod_wsgi
</code></pre>
<p>å®‰è£…å®Œæˆä¹‹åä¼šç”Ÿæˆæ–‡ä»¶ /etc/httpd/conf.modules.d/10-wsgi-python3.6.confï¼Œè¿™ä¸ªå°±æ˜¯æ–°å®‰è£…çš„apacheæ¨¡å—çš„é…ç½®æ–‡ä»¶ã€‚</p>
<h2 id="åœ¨httpdconfé…ç½®wsgiåº”ç”¨"><a class="header" href="#åœ¨httpdconfé…ç½®wsgiåº”ç”¨">åœ¨httpd.confé…ç½®wsgiåº”ç”¨</a></h2>
<p>Apacheå’Œmod_wsgiå®‰è£…å®Œæˆä¹‹åï¼Œåœ¨httpd.confä¸­æ·»åŠ ä¸‹é¢çš„é…ç½®ï¼ˆè·¯å¾„æ ¹æ®å®é™…æƒ…å†µé…ç½®ï¼‰ï¼Œå¯ä»¥ç›´æ¥åœ¨<code> /etc/httpd/conf/httpd.conf</code>ä¸­æ·»åŠ ï¼Œä¹Ÿå¯ä»¥åœ¨<code>/etc/httpd/conf.d/</code>å•ç‹¬åˆ›å»ºä¸€ä¸ªåŒ…å«ä¸‹é¢é…ç½®çš„æ–‡ä»¶ï¼š</p>
<pre><code class="language-conf">WSGIScriptAlias / /path/to/mysite.com/mysite/wsgi.py
WSGIPythonHome /path/to/venv
WSGIPythonPath /path/to/mysite.com

&lt;Directory /path/to/mysite.com/mysite&gt;
&lt;Files wsgi.py&gt;
Require all granted
&lt;/Files&gt;
&lt;/Directory&gt;
</code></pre>
<p><code>WSGIScriptAlias</code>åé¢ç´§è·Ÿç€çš„æ˜¯åº”ç”¨çš„base URLè·¯å¾„ï¼Œç„¶åæ˜¯åº”ç”¨çš„wsgiæ–‡ä»¶ã€‚</p>
<p>å¦‚æœDjangoåº”ç”¨ä½¿ç”¨çš„æ˜¯virtualenvåˆ›å»ºçš„è¿è¡Œç¯å¢ƒï¼Œç”¨<code>WSGIPythonHome</code>æŒ‡å®švirtuanenvçš„è·¯å¾„ã€‚</p>
<p><code>WSGIPythonPath</code>æŒ‡å®šæ•´ä¸ªé¡¹ç›®çš„æ–‡ä»¶ç›®å½•ï¼Œæ˜¯importæ—¶çš„æ ¹è·¯å¾„ï¼Œç¡®ä¿æ‰€æœ‰çš„é¡¹ç›®æ–‡ä»¶éƒ½åœ¨è¿™ä¸ªç›®å½•ä¸­ã€‚</p>
<p><code>&lt;Directory&gt;</code>ä¸­çš„é…ç½®æ˜¯å…è®¸apacheè¯»å–wsgi.pyæ–‡ä»¶ã€‚</p>
<p>Apache2.4ä»¥å‰çš„ç‰ˆæœ¬ï¼Œéœ€è¦æŠŠ<code>Require all granted</code>æ¢æˆ<code>Allow from all</code>ã€‚</p>
<p>å¦‚æœé…ç½®ä¸ç”Ÿæ•ˆï¼Œåˆ°<code>/var/log/httpd/error_log</code>ä¸­æ‰¾çº¿ç´¢ã€‚</p>
<h2 id="å°†mod_wsgié…ç½®æˆdaemonæ¨¡å¼"><a class="header" href="#å°†mod_wsgié…ç½®æˆdaemonæ¨¡å¼">å°†mod_wsgié…ç½®æˆdaemonæ¨¡å¼</a></h2>
<p>åœ¨éwindowså¹³å°ä¸Šï¼Œmod_wsgiæ¨èä½¿ç”¨daemonæ¨¡å¼ã€‚ä½¿ç”¨daemonæ¨¡å¼åï¼Œå‰é¢çš„é…ç½®çš„<code>WSGIPythonHome</code>å’Œ<code>WSGIPythonPath</code>è¦å»æ‰ï¼Œæ”¹ä¸ºåœ¨<code>WSGIDaemonProcess</code>ä¸­ç”¨<code>python-home</code>å’Œ<code>python-path</code>æŒ‡å®šï¼Œä¿®æ”¹åçš„é…ç½®å¦‚ä¸‹ï¼š</p>
<pre><code class="language-conf">WSGIProcessGroup example.com
WSGIDaemonProcess example.com python-home=/path/to/venv python-path=/path/to/mysite.com lang='en_US.UTF-8' locale='en_US.UTF-8'
WSGIScriptAlias / /path/to/mysite.com/mysite/wsgi.py process-group=example.com
</code></pre>
<p>æ³¨æ„WSGIDaemonProcessä¸€è¡Œä¸­çš„en_US.UTF-8ï¼Œå¦‚æœDjangoåº”ç”¨ä¼šæ‰“å°utf-8ç¼–ç çš„å­—ç¬¦ï¼Œéœ€è¦å°†wsgilangå’Œlocalè®¾ç½®ä¸ºUTF-8ï¼Œå¦åˆ™wsgiä¼šæŠ¥é”™ï¼š</p>
<pre><code>UnicodeEncodeError: 'ascii' codec can't encode characters in position 154-155: ordinal not in range(128)
</code></pre>
<p>å¦‚æœåœ¨shellç»ˆç«¯ç”¨<code>python ./manage.py runserver</code>è¿è¡Œæ—¶ä¹ŸæŠ¥åŒæ ·çš„é”™è¯¯ï¼Œä¿®æ”¹/etc/locale.confæ–‡ä»¶åé‡æ–°ç™»å½•ï¼š</p>
<pre><code class="language-sh">$ cat /etc/locale.conf
LANG=en_US.utf8
LC_CTYPE=en_US.UTF-8
</code></pre>
<h2 id="ä¸€ä¸ªé…ç½®wsgié…ç½®æ ·ä¾‹"><a class="header" href="#ä¸€ä¸ªé…ç½®wsgié…ç½®æ ·ä¾‹">ä¸€ä¸ªé…ç½®wsgié…ç½®æ ·ä¾‹</a></h2>
<p>ä¸‹é¢è¿™ä¸ªç‹¬ç«‹çš„ï¼ˆ<a href="https://wiki.centos.org/TipsAndTricks/ApacheVhostDir" title="Apache Virtual Host Containers in Separate Files">Apache Virtual Host Containers in Separate Files</a>)é…ç½®æ–‡ä»¶ä¸­ï¼Œå°†djangoçš„æ—¥å¿—ä¹Ÿæ‹†åˆ†äº†å‡ºæ¥ï¼š</p>
<pre><code class="language-sh"># cat /etc/httpd/conf.d/discount.conf
&lt;VirtualHost *:80&gt;
  ServerName 127.0.0.1    # æ ¹æ®å®é™…æƒ…å†µè®¾ç½®
  WSGIProcessGroup discount
  WSGIDaemonProcess discount python-home=/opt/discount/env  python-path=/opt/discount/mysite lang='en_US.UTF-8' locale='en_US.UTF-8'
  WSGIScriptAlias / /opt/discount/mysite/mysite/wsgi.py process-group=discount

  &lt;Directory /opt/discount/mysite/mysite/&gt;
  &lt;Files wsgi.py&gt;
  Require all granted
  &lt;/Files&gt;
  &lt;/Directory&gt;

  LogLevel info
  ErrorLog &quot;logs/discount_error_log&quot;
  CustomLog &quot;logs/discount_access_log&quot; combined
&lt;/VirtualHost&gt;
</code></pre>
<p>ä¸Šé¢çš„logsç›®å½•æ˜¯/etc/httpd/logsï¼Œå®ƒæ˜¯ç¬¦å·é“¾æ¥ï¼Œé“¾æ¥åˆ°äº†/var/log/httpdã€‚</p>
<p>Djangoçš„æ—¥å¿—å’Œwsgiçš„æ—¥å¿—æ˜¯åˆ†å¼€çš„ï¼Œä½†æ˜¯ç”¨mod_wsgiè¿è¡Œdjangoåº”ç”¨çš„æ—¶å€™ï¼ŒDjangoçš„æ—¥å¿—ç›®å½•éœ€è¦èƒ½å¤Ÿè¢«apacheç”¨æˆ·è¯»å†™ï¼Œå› ä¸ºhttpdè¿›ç¨‹çš„ç”¨æˆ·æ˜¯apacheã€‚</p>
<p>æœ€å¥½åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„ç›®å½•ï¼Œå¹¶ä¸”ç›®å½•æ‰€å±ä¿®æ”¹ä¸ºapacheï¼š</p>
<pre><code>mkdir -p /var/log/discount/
chwon apache:apache /var/log/discount/
</code></pre>
<p>æ³¨æ„Djangoæ—¥å¿—æ–‡ä»¶ä¸èƒ½åœ¨/tmpç›®å½•ä¸­ï¼ŒDjangoæ—¥å¿—ä½äº/tmpç›®å½•ä¸­æ—¶ï¼Œwsgiè™½ç„¶ä¸æŠ¥é”™ï¼Œä½†æ˜¯æ—¥å¿—æ–‡ä»¶ä¹Ÿä¸ä¼šåˆ›å»ºï¼Œæ¯”è¾ƒå¥‡æ€ªã€‚</p>
<p>ä¸‹é¢æ˜¯Djangoçš„æ—¥å¿—é…ç½®ï¼ˆåœ¨é¡¹ç›®çš„settings.pyä¸­ï¼‰:</p>
<pre><code class="language-python">LOGGING = {
    'version': 1,
    'disable_existing_loggers': False,
    'formatters': {
        'standard': {
            'format': '%(asctime)s [%(levelname)s] %(name)s: %(message)s',
        }
    },
    'handlers': {
        'file': {
            'level': 'DEBUG',
            'formatter': 'standard',
            'class': 'logging.handlers.RotatingFileHandler',
            'filename': '/var/log/discount/discount.log',
            'maxBytes': 1024*1024*100,
            'backupCount': 10,
        },
        'console':{
            'level': 'DEBUG',
            'class': 'logging.StreamHandler',
            'formatter': 'standard',
        }
    },
    'loggers': {
        'django': {
            'handlers': ['file'],
            'level': 'INFO',
            'propagate': True,
        },
        'wechat': {
            'handlers': ['file'],
            'level': 'INFO',
            'propagate': True,
        }
    },
}
</code></pre>
<h2 id="æ–‡ä»¶æœåŠ¡å™¨"><a class="header" href="#æ–‡ä»¶æœåŠ¡å™¨">æ–‡ä»¶æœåŠ¡å™¨</a></h2>
<p>Djangoæœ¬èº«ä¸æä¾›æ–‡ä»¶æœåŠ¡ï¼Œé™æ€æ–‡ä»¶æœåŠ¡çš„éœ€è¦ç”¨nginxã€apacheç­‰è½¯ä»¶å®ç°ã€‚</p>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="djangoä¸­ä½¿ç”¨redisç¼“å­˜"><a class="header" href="#djangoä¸­ä½¿ç”¨redisç¼“å­˜">Djangoä¸­ä½¿ç”¨Redisç¼“å­˜</a></h1>
<p><a href="http://niwinz.github.io/django-redis/latest/" title="django-redis documentation">django-redis documentation</a>æ˜¯pythonåº“ï¼Œå°†redisä¸Djangoæ— ç¼ç»“åˆäº†èµ·æ¥ã€‚</p>
<h2 id="å®‰è£…redis"><a class="header" href="#å®‰è£…redis">å®‰è£…Redis</a></h2>
<pre><code>yum install -y redis
</code></pre>
<p>redisçš„é…ç½®æ–‡ä»¶æ˜¯/etc/redis.confï¼Œ</p>
<pre><code>maxmemory 30mb
maxmemory-policy volatile-lru
databases 1
</code></pre>
<p>å¯åŠ¨ï¼Œé»˜è®¤åªç›‘å¬åœ°å€æ˜¯127.0.0.1:6739ï¼š</p>
<pre><code>systemctl start redis
</code></pre>
<p>éªŒè¯ï¼š</p>
<pre><code># redis-cli  ping
PONG
</code></pre>
<h2 id="å®‰è£…é…ç½®django-redis"><a class="header" href="#å®‰è£…é…ç½®django-redis">å®‰è£…é…ç½®django-redis</a></h2>
<p>å®‰è£…ï¼š</p>
<pre><code class="language-sh">pip install django-redis
</code></pre>
<p>åœ¨settings.pyä¸­é…ç½®ï¼š</p>
<pre><code class="language-python">CACHES = {
    &quot;default&quot;: {
        &quot;BACKEND&quot;: &quot;django_redis.cache.RedisCache&quot;,
        &quot;LOCATION&quot;: &quot;redis://127.0.0.1:6379/0&quot;,
        &quot;OPTIONS&quot;: {
            &quot;CLIENT_CLASS&quot;: &quot;django_redis.client.DefaultClient&quot;,
        }
    }
}
</code></pre>
<h2 id="ä½¿ç”¨redisä½œä¸ºsession-backend"><a class="header" href="#ä½¿ç”¨redisä½œä¸ºsession-backend">ä½¿ç”¨redisä½œä¸ºsession backend</a></h2>
<p>å°†redisä½œä¸ºsession backendä¸éœ€è¦é¢å¤–è®¾ç½®ï¼Œç›´æ¥å¯ç”¨session backendå³å¯ï¼š</p>
<pre><code>SESSION_ENGINE = &quot;django.contrib.sessions.backends.cache&quot;
SESSION_CACHE_ALIAS = &quot;default&quot;
</code></pre>
<h2 id="æ“ä½œredis"><a class="header" href="#æ“ä½œredis">æ“ä½œredis</a></h2>
<pre><code class="language-python">(env) lijiaos-mbp:mysite lijiao$ python manage.py shell
Python 3.7.2 (default, Feb 12 2019, 08:15:36)
[Clang 10.0.0 (clang-1000.11.45.5)] on darwin
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
(InteractiveConsole)
&gt;&gt;&gt; from django.core.cache import cache
&gt;&gt;&gt; cache.set(&quot;foo&quot;, &quot;value&quot;, timeout=25)
True
&gt;&gt;&gt; cache.ttl(&quot;foo&quot;)
20
&gt;&gt;&gt; cache.get(&quot;foo&quot;)
'value'
&gt;&gt;&gt;
</code></pre>
<p>åœ¨redisä¸­çœ‹åˆ°çš„æ•°æ®è¿™æ ·çš„ï¼š</p>
<pre><code class="language-sh">127.0.0.1:6379&gt; keys *
1) &quot;:1:foo&quot;
127.0.0.1:6379&gt; get &quot;:1:foo&quot;
&quot;\x80\x04\x95\t\x00\x00\x00\x00\x00\x00\x00\x8c\x05value\x94.&quot;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="ç‹¬ç«‹æ–‡ä»¶å¯¼å…¥-django-ç¯å¢ƒ"><a class="header" href="#ç‹¬ç«‹æ–‡ä»¶å¯¼å…¥-django-ç¯å¢ƒ">ç‹¬ç«‹æ–‡ä»¶å¯¼å…¥ Django ç¯å¢ƒ</a></h1>
<p>åˆ›å»ºæ–‡ä»¶ bin/movie-spider.pyï¼Œå¯¼å…¥ django ç¯å¢ƒï¼š</p>
<pre><code class="language-python">import os
import sys
import django
# load django environment
sys.path.append(os.path.dirname(os.path.dirname(os.path.realpath(__file__))))
os.environ['DJANGO_SETTINGS_MODULE'] = 'spider3.settings'
django.setup()
</code></pre>
<p>ç„¶åå¯¼å…¥å¹¶ä½¿ç”¨ django é¡¹ç›®ä¸­çš„ä»£ç ï¼Œè­¬å¦‚ä½¿ç”¨ modelï¼š</p>
<pre><code class="language-python">from movie.models import Movi
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="ç®€å•äº†è§£ä¸€ä¸‹-android-åº”ç”¨çš„å¼€å‘è¿‡ç¨‹"><a class="header" href="#ç®€å•äº†è§£ä¸€ä¸‹-android-åº”ç”¨çš„å¼€å‘è¿‡ç¨‹">ç®€å•äº†è§£ä¸€ä¸‹ android åº”ç”¨çš„å¼€å‘è¿‡ç¨‹</a></h1>
<h2 id="é¡¹ç›®ç»“æ„"><a class="header" href="#é¡¹ç›®ç»“æ„">é¡¹ç›®ç»“æ„</a></h2>
<p>ç”¨ Intelli Idea æˆ–è€… Android Studio åˆ›å»ºä¸€ä¸ª andorid é¡¹ç›®ã€‚</p>
<p>é¡¹ç›®çš„ä¸»è¦ä»£ç ä½äº app/src/main ç›®å½•ä¸­ï¼š</p>
<pre><code class="language-sh">$ tree -L 2 android-quickstart/app/src/main
android-quickstart/app/src/main
â”œâ”€â”€ AndroidManifest.xml   # åº”ç”¨çš„ç‰¹æ€§é…ç½®
â”œâ”€â”€ java
â”œ   â””â”€â”€ com
â”œ       â””â”€â”€ example
â”œ           â””â”€â”€ android_quickstart
â”œ               â”œâ”€â”€ MainActivity.java  # åº”ç”¨å…¥å£
â”œ               â””â”€â”€ ui
â””â”€â”€ res
    â”œâ”€â”€ drawable
    â”œâ”€â”€ drawable-v24
    â”œâ”€â”€ layout              # activity çš„ UI
    â”œâ”€â”€ menu
    â”œâ”€â”€ mipmap-anydpi-v26
    â”œâ”€â”€ mipmap-hdpi
    â”œâ”€â”€ mipmap-mdpi
    â”œâ”€â”€ mipmap-xhdpi
    â”œâ”€â”€ mipmap-xxhdpi
    â”œâ”€â”€ mipmap-xxxhdpi
    â”œâ”€â”€ navigation
    â””â”€â”€ values
</code></pre>
<h2 id="apk-æ–‡ä»¶"><a class="header" href="#apk-æ–‡ä»¶">apk æ–‡ä»¶</a></h2>
<p>å®‰å“åº”ç”¨çš„ä»£ç ã€æ•°æ®å’Œèµ„æºæ–‡ä»¶ä¸€èµ·å¤§åŒ…æˆ apk æ–‡ä»¶å‘å¸ƒï¼Œå®‰å“åº”ç”¨åœ¨å®‰å…¨æ²™ç›’ä¸­è¿è¡Œï¼š</p>
<ul>
<li>æ¯ä¸ª app é»˜è®¤ä½¿ç”¨ä¸€ä¸ªç‹¬ç«‹çš„ linux ç”¨æˆ·ï¼Œå®ç°æ–‡ä»¶çš„éš”ç¦»</li>
<li>è¿›ç¨‹åœ¨éš”ç¦»çš„ vm ä¸­è¿è¡Œ</li>
<li>ä½¿ç”¨åŒä¸€ä¸ªè¯ä¹¦ç­¾ç½²çš„ app å¯ä»¥å…±ç”¨ç”¨æˆ·ã€vmï¼Œä»è€Œå¯ä»¥è®¿é—®å½¼æ­¤çš„æ–‡ä»¶</li>
<li>app å¯ä»¥ç”³è¯·è®¾å¤‡çš„è®¿é—®æƒé™</li>
</ul>
<h2 id="app-çš„ç»„æˆ"><a class="header" href="#app-çš„ç»„æˆ">app çš„ç»„æˆ</a></h2>
<p><strong>Activities</strong>: </p>
<ul>
<li>æ¯ä¸ªäº¤äº’ç•Œé¢å¯¹åº”ä¸€ä¸ª Activity</li>
<li>å…¶å®ƒ app å¯ä»¥å”¤èµ·å¦ä¸€ä¸ª app å…è®¸çš„ activity</li>
<li>çˆ¶ç±»ï¼šActivity</li>
</ul>
<p><strong>Services</strong>:</p>
<ul>
<li>åå°è¿è¡Œçš„æœåŠ¡</li>
<li>activity ç­‰ç»„ä»¶å¯ä»¥å¯åŠ¨ã€ç»‘å®š service</li>
<li>service åˆ†ä¸ºç”¨æˆ·å¯æ„ŸçŸ¥ï¼ˆåå°éŸ³ä¹ï¼‰å’Œç”¨æˆ·æ— æ„ŸçŸ¥ï¼ˆæœåŠ¡è°ƒç”¨ï¼‰ä¸¤ç§ç±»å‹</li>
<li>çˆ¶ç±»ï¼šService</li>
</ul>
<p><strong>Broadcast receivers</strong>:</p>
<ul>
<li>è·¨ app çš„äº‹ä»¶å¹¿æ’­</li>
<li>äº‹ä»¶æ˜¯ä¸€ä¸ª Intentï¼ŒBroadcastReceiver çš„å­ç±»æ¥æ”¶å¹¶å“åº”äº‹ä»¶</li>
</ul>
<p><strong>Content providers</strong>:</p>
<ul>
<li>å†™å…¥æ–‡ä»¶ç³»ç»Ÿçš„æŒä¹…æ•°æ®ï¼Œå…¶å®ƒ app å¯ä»¥æ“ä½œå¦ä¸€ä¸ª app å…è®¸çš„æ•°æ®</li>
<li>çˆ¶ç±»ï¼šContentProvider</li>
</ul>
<p>ä»¥ä¸Šç»„ä»¶é€šè¿‡ Intent äº¤äº’ã€‚</p>
<p>åœ¨ AndroidManifest.xml ä¸­å£°æ˜æ‰€æœ‰çš„ç»„ä»¶ï¼Œä»¥åŠå£°æ˜éœ€è¦çš„æƒé™ã€‚</p>
<h2 id="å‚è€ƒ-48"><a class="header" href="#å‚è€ƒ-48">å‚è€ƒ</a></h2>
<ol>
<li><a href="https://www.lijiaocn.com" title="æä½¶æ¾³çš„åšå®¢">æä½¶æ¾³çš„åšå®¢</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="vue-å­¦ä¹ èµ„æ–™"><a class="header" href="#vue-å­¦ä¹ èµ„æ–™">vue å­¦ä¹ èµ„æ–™</a></h1>
<p>å®˜ç½‘æ•™ç¨‹ï¼š https://cn.vuejs.org/v2/guide/</p>
<p>åˆ›å»ºé¡¹ç›®çš„è„šæ‰‹æ¶å·¥å…·vue-cliï¼š https://cli.vuejs.org/zh/guide/</p>
<p>å…¥é—¨è§†é¢‘è¯¾ç¨‹ï¼šhttps://www.imooc.com/learn/980</p>
<h2 id="vue-å¼€å‘ç¯å¢ƒ"><a class="header" href="#vue-å¼€å‘ç¯å¢ƒ">vue å¼€å‘ç¯å¢ƒ</a></h2>
<p>IDE ä½¿ç”¨ Intelli Ideaï¼Œåœ¨ Preference -&gt; Plugins -&gt; Marketplace ä¸­æœç´¢æ’ä»¶ &quot;vue.js&quot;ï¼Œå®‰è£…ã€‚</p>
<p>åœ¨ Preference -&gt; Editor -&gt; File Types -&gt; HTML ä¸­ï¼Œæ·»åŠ æ–°çš„æ–‡ä»¶åç¼€ &quot;*.vue&quot;ã€‚</p>
<p>åœ¨ Preference -&gt; Languages &amp; Frameworks -&gt; JavaScriptï¼Œé€‰æ‹© ECMAScript6</p>
<p>åœ¨ Preference -&gt; Editor -&gt; File and Code Templates ä¸­ï¼Œåˆ›å»ºä¸€ä¸ª vue æ¨¡ç‰ˆï¼š</p>
<pre><code class="language-html">&lt;template&gt;

    &lt;div&gt; {{msg}}&lt;/div&gt;

&lt;/template&gt;

&lt;style&gt;&lt;/style&gt;

&lt;script&gt;

    export default{ data () { return {msg: 'vueæ¨¡æ¿é¡µ'} } }

&lt;/script&gt;
</code></pre>
<p>æ–°å»º vue é¡¹ç›®ï¼šStatic Web -&gt; Vue.js</p>
<h2 id="vue-cli"><a class="header" href="#vue-cli">vue-cli</a></h2>
<p><a href="https://cli.vuejs.org/zh/guide/" title="vue-cli">vue-cli</a> æ˜¯æ­å»º vue é¡¹ç›®çš„è„šæ‰‹æ¶ã€‚</p>
<p>å®‰è£…ã€éªŒè¯ï¼š</p>
<pre><code class="language-sh">$ npm install -g @vue/cli
$ npm --version
 vue --version
@vue/cli 4.1.2
</code></pre>
<p>åˆ›å»ºé¡¹ç›®:</p>
<pre><code class="language-sh">$ vue create hello-world
</code></pre>
<p>æ„å»ºï¼š</p>
<pre><code class="language-sh">$ cd hello-world
$ npm run serve
$ npm run lint
$ npm run build 
</code></pre>
<p>é¡¹ç›®ç»“æ„ï¼š</p>
<pre><code class="language-sh">$ tree -L 2 
public
â”œâ”€â”€ favicon.ico
â””â”€â”€ index.html     //å…¥å£
src
â”œâ”€â”€ App.vue        //app
â”œâ”€â”€ assets         //èµ„æºæ–‡ä»¶
â”‚Â Â  â””â”€â”€ logo.png
â”œâ”€â”€ components     //vue ç»„ä»¶
â”‚Â Â  â””â”€â”€ HelloWorld.vue
â””â”€â”€ main.js
</code></pre>
<h2 id="å‚è€ƒ-49"><a class="header" href="#å‚è€ƒ-49">å‚è€ƒ</a></h2>
<ol>
<li><a href="https://www.lijiaocn.com" title="æä½¶æ¾³çš„åšå®¢">æä½¶æ¾³çš„åšå®¢</a></li>
<li><a href="https://www.cnblogs.com/wyq-web/p/9639274.html" title="Intellij IDEAæ­å»ºvue-clié¡¹ç›®">Intellij IDEAæ­å»ºvue-clié¡¹ç›®</a></li>
<li><a href="https://cli.vuejs.org/zh/guide/" title="vue-cli">vue-cli</a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="å¾®ä¿¡å…¬ä¼—å¹³å°å…¬ä¼—å·api"><a class="header" href="#å¾®ä¿¡å…¬ä¼—å¹³å°å…¬ä¼—å·api">å¾®ä¿¡å…¬ä¼—å¹³å°ï¼ˆå…¬ä¼—å·ï¼‰API</a></h1>
<p><a href="https://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1433401084">å…¬ä¼—å·æ¥å£æƒé™</a></p>
<p><a href="https://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1472017492_58YV5">å…¥é—¨æŒ‡å¼•</a></p>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="å¾®ä¿¡å…¬ä¼—å·apiå›è°ƒè®¾ç½®"><a class="header" href="#å¾®ä¿¡å…¬ä¼—å·apiå›è°ƒè®¾ç½®">å¾®ä¿¡å…¬ä¼—å·APIå›è°ƒè®¾ç½®</a></h1>
<p><a href="https://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1472017492_58YV5">å…¥é—¨æŒ‡å¼•</a>ä¸­ä»‹ç»çš„æ¯”è¾ƒè¯¦ç»†ã€‚</p>
<p>åœ¨å¾®ä¿¡å…¬ä¼—å·è®¾ç½®äº†æœåŠ¡çš„åœ°å€å’ŒTokenä¹‹åï¼Œç”¨æˆ·ç•™è¨€ç­‰ä¿¡æ¯ä¼šè¢«å¾®ä¿¡å…¬ä¼—å¹³å°ä»¥å›ºå®šçš„æ ¼å¼è½¬å‘åˆ°æœåŠ¡åœ°å€ï¼Œæå‰éƒ¨ç½²å¥½çš„æœåŠ¡å¯ä»¥æŒ‰ç…§ç¨‹åºä¸­çš„é€»è¾‘å¯¹ä¸åŒç”¨æˆ·è¿›è¡Œä¸åŒçš„å›å¤ã€‚æœåŠ¡å¿…é¡»æ˜¯å¯ä»¥ä»å…¬ç½‘è®¿é—®çš„ï¼Œå¦åˆ™å…¬ä¼—å¹³å°æ— æ³•å›è°ƒã€‚</p>
<p>é…ç½®å…¥å£æ˜¯å…¬ä¼—å·åå°å·¦ä¸‹è§’çš„â€œåŸºæœ¬é…ç½®â€ï¼Œè¯¦æƒ…è§<a href="https://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1421135319" title="æ¥å…¥æŒ‡å—">æ¥å…¥æŒ‡å—</a>ã€‚</p>
<h2 id="éªŒè¯å¾®ä¿¡æœåŠ¡å™¨æ¶ˆæ¯"><a class="header" href="#éªŒè¯å¾®ä¿¡æœåŠ¡å™¨æ¶ˆæ¯">éªŒè¯å¾®ä¿¡æœåŠ¡å™¨æ¶ˆæ¯</a></h2>
<p>è®¾ç½®å®Œæˆä¹‹åï¼Œå¾®ä¿¡æœåŠ¡å™¨ä¼šå‘é€ä¸€ä¸ªGETè¯·æ±‚ï¼Œå¸¦æœ‰å››ä¸ªå‚æ•°ï¼š</p>
<p><strong>signature</strong>: å¾®ä¿¡åŠ å¯†ç­¾åï¼Œsignatureç»“åˆäº†å¼€å‘è€…å¡«å†™çš„tokenå‚æ•°å’Œè¯·æ±‚ä¸­çš„timestampå‚æ•°ã€nonceå‚æ•°</p>
<p><strong>timestamp</strong>: æ—¶é—´æˆ³</p>
<p><strong>nonce</strong>: éšæœºæ•°</p>
<p><strong>echostr</strong>: éšæœºå­—ç¬¦ä¸²</p>
<p>signatureçš„ç”Ÿæˆè§„åˆ™æ˜¯ï¼šå°†tokenã€timesstampå’Œnonceä¸‰ä¸ªå‚æ•°å°½å¿ƒå­—å…¸æ’åºï¼Œç„¶åæ‹¼æ¥ç§°ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç”¨sha1åŠ å¯†ã€‚</p>
<p>å¦‚æœç”Ÿæˆçš„ç­¾åä¸ä¼ å…¥çš„signatureå‚æ•°ç›¸åŒï¼Œè¯æ˜è¯·æ±‚ç¡®å®æ¥è‡ªäºå¾®ä¿¡æœåŠ¡å™¨ï¼Œå°†echostrcå‚æ•°åŸæ ·è¿”å›ç»™å¾®ä¿¡æœåŠ¡å™¨ï¼Œæ¥å…¥å³ç”Ÿæ•ˆã€‚</p>
<h2 id="è®¾ç½®å¼€å‘è€…å¯†é’¥"><a class="header" href="#è®¾ç½®å¼€å‘è€…å¯†é’¥">è®¾ç½®å¼€å‘è€…å¯†é’¥</a></h2>
<p>åœ¨è°ƒç”¨å¾®ä¿¡å…¬ä¼—å¹³å°çš„æ¥å£æ—¶ï¼Œéœ€è¦å¸¦æœ‰access_tokenï¼Œå®ƒæ˜¯ç”¨å¼€å‘è€…IDå’Œå¼€å‘è€…å¯†ç è·å–çš„ã€‚</p>
<p>åœ¨â€œåŸºæœ¬é…ç½®â€å¯ä»¥çœ‹åˆ°å¼€å‘è€…IDï¼Œå¼€å‘è€…å¯†ç æ˜¯å¹³å°ç”Ÿæˆçš„ï¼Œç›´æ¥ç‚¹å‡»è®¾ç½®æˆ–è€…é‡ç½®è·å–ã€‚å¹³å°æœ¬èº«ä¸å­˜å‚¨å¼€å‘è€…å¯†ç ï¼Œå¦‚æœå¯†ç ä¸¢å¤±äº†ï¼Œåªèƒ½é‡ç½®ï¼Œè·å–ä¸€ä¸ªæ–°çš„å¯†ç ã€‚</p>
<p>è·å–äº†å¼€å‘è€…å¯†ç åï¼Œè¿˜è¦åœ¨â€œIPç™½åå•â€ä¸­æ·»åŠ ç”¨æ¥è®¿é—®å…¬ä¼—å¹³å°çš„æœåŠ¡å™¨IPï¼Œåªæœ‰åŠ å…¥äº†ç™¾åå•çš„IPæ‰èƒ½è°ƒç”¨å¹³å°çš„access_tokenè·å–æ¥å£ã€‚</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="å¾®ä¿¡å…¬ä¼—å¹³å°å›ä¼ çš„æ¶ˆæ¯æ ¼å¼"><a class="header" href="#å¾®ä¿¡å…¬ä¼—å¹³å°å›ä¼ çš„æ¶ˆæ¯æ ¼å¼">å¾®ä¿¡å…¬ä¼—å¹³å°å›ä¼ çš„æ¶ˆæ¯æ ¼å¼</a></h1>
<p>æ™®é€šæ¶ˆæ¯åˆ†ä¸ºï¼šæ–‡æœ¬ã€å›¾ç‰‡ã€è¯­éŸ³ã€è§†é¢‘ã€å°è§†é¢‘ã€åœ°ç†ä½ç½®ã€é“¾æ¥ï¼Œ7ç§ç±»å‹ã€‚</p>
<p><a href="https://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1421140453">æ™®é€šæ¶ˆæ¯æ ¼å¼</a></p>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="å¾®ä¿¡å…¬ä¼—å¹³å°æ¥å£è°ƒè¯•"><a class="header" href="#å¾®ä¿¡å…¬ä¼—å¹³å°æ¥å£è°ƒè¯•">å¾®ä¿¡å…¬ä¼—å¹³å°æ¥å£è°ƒè¯•</a></h1>
<p>å¾®ä¿¡å…¬ä¼—å¹³å°æä¾›äº†ä¸€ä¸ª<a href="https://mp.weixin.qq.com/debug/" title="å¾®ä¿¡å…¬ä¼—å¹³å°æ¥å£è°ƒè¯•å·¥å…·">æ¥å£è°ƒè¯•å·¥å…·</a>å·¥å…·ï¼Œé€‰æ‹©ä¸åŒçš„æ¥å£ç±»å‹ï¼Œå¯ä»¥å‘å¾®ä¿¡å…¬ä¼—å¹³å°å‘é€æ¶ˆæ¯ï¼Œæˆ–è€…è®©å¾®ä¿¡å…¬ä¼—å¹³å°ç»™å¼€å‘è€…çš„åº”ç”¨å‘é€æ¶ˆæ¯ã€‚</p>
<h2 id="æ¶ˆæ¯æ¥å£è°ƒè¯•"><a class="header" href="#æ¶ˆæ¯æ¥å£è°ƒè¯•">æ¶ˆæ¯æ¥å£è°ƒè¯•</a></h2>
<p>æ¶ˆæ¯æ¥å£è°ƒè¯•ä¸­ï¼Œå¾®ä¿¡å…¬ä¼—å¹³å°å¯ä»¥å‘å¼€å‘è€…æŒ‡å®šçš„urlä¸­å‘é€å¼€å‘è€…è‡ªå®šä¹‰çš„æ¶ˆæ¯ã€‚</p>
<p>å¦‚æœä½¿ç”¨Djangoå®ç°ï¼Œéœ€è¦è±å…è¯¥æ¥å£çš„CSRFæ£€æŸ¥ï¼Œå¦åˆ™Djangoä¼šæŠ¥é”™ï¼š</p>
<pre><code>Forbidden (CSRF cookie not set.): /wechat/
</code></pre>
<p>è±å…æ–¹æ³•æ˜¯ä¸ºDjangoçš„viewså‡½æ•°æ·»åŠ ä¸€ä¸ªè±å…ä¿®é¥°ï¼š</p>
<pre><code class="language-python">from django.views.decorators.csrf import csrf_exempt
...
@csrf_exempt
def index(request):
  ...
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="æ·˜å®å®¢apiçš„ä½¿ç”¨"><a class="header" href="#æ·˜å®å®¢apiçš„ä½¿ç”¨">æ·˜å®å®¢APIçš„ä½¿ç”¨</a></h1>
<p><a href="https://tbk.bbs.taobao.com/detail.html?postId=8576944">å²ä¸Šæœ€è¯¦ç»†æ·˜å®è”ç›ŸAPIä½¿ç”¨æ•™ç¨‹</a></p>
<p><a href="https://open.taobao.com/doc.htm?docId=103232&amp;docType=1">æ·˜å®å¼€æ”¾å¹³å°æŠ€æœ¯æ–‡æ¡£</a></p>
<p><a href="https://open.taobao.com/api.htm?docId=24515&amp;docType=2&amp;scopeId=11655">æ·˜å®å®¢åŸºç¡€API</a></p>
<p><a href="http://open.alimama.com/api/doc.php?spm=a219t.7900221/1.1998910419.d8546b700.6c6975a5C3VViY">æ·˜å®å®¢APIï¼ˆæ—§ç‰ˆæ–‡æ¡£ï¼‰</a></p>
<p><a href="https://open.taobao.com/api.htm?docId=120&amp;docType=2&amp;scopeId=381">ç³»ç»Ÿå·¥å…·API</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="æ·˜å®å®¢apiå¼€é€šæ–¹æ³•"><a class="header" href="#æ·˜å®å®¢apiå¼€é€šæ–¹æ³•">æ·˜å®å®¢APIå¼€é€šæ–¹æ³•</a></h1>
<p>æ·˜å®å®¢çš„å¼€é€šè¦åˆ°<a href="https://pub.alimama.com/" title="æ·˜å®è”ç›Ÿ-é˜¿é‡Œå¦ˆå¦ˆæ——ä¸‹äº§å“">æ·˜å®è”ç›Ÿ</a>ä¸­ç”³è¯·ï¼Œå¼€é€šæ–¹æ³•ä¸<a href="https://tbk.bbs.taobao.com/detail.html?postId=8576944">å²ä¸Šæœ€è¯¦ç»†æ·˜å®è”ç›ŸAPIä½¿ç”¨æ•™ç¨‹</a>ä¸­çš„ä»‹ç»ä¸€è‡´ã€‚</p>
<p>åœ¨æ·˜å®è”ç›Ÿä¸­ï¼šè¿›å…¥æˆ‘çš„è”ç›Ÿ-&gt;æ¨å¹¿ç®¡ç†-&gt;åª’ä½“ç®¡ç†-&gt;ç½‘ç«™ç®¡ç†ï¼Œåœ¨æ¯ä¸ªç½‘ç«™æ¡ç›®ä¸­éƒ½æœ‰ä¸€ä¸ªâ€œæŸ¥çœ‹æƒé™â€ï¼Œç‚¹å‡»åä¼šå‡ºç°â€œè”ç›Ÿåˆä½œç½‘ç«™APIâ€ä¿¡æ¯ï¼Œå¦‚æœæ²¡æœ‰ç”³è¯·ï¼Œå°±ç‚¹å‡»ç”³è¯·ã€‚</p>
<p>æ·˜å®è”ç›Ÿå®¡æ ¸é€šè¿‡åï¼Œå›åˆ°<a href="https://open.taobao.com/" title="æ·˜å®å¼€æ”¾å¹³å°">æ·˜å®å¼€æ”¾å¹³å°</a>çš„æ§åˆ¶å°ä¸­ï¼Œä¼šå‘ç°å¤šå‡ºäº†ä¸€ä¸ªç±»å‹ä¸ºâ€è”ç›Ÿåˆä½œç½‘ç«™â€çš„åº”ç”¨ï¼Œè¿™ä¸ªå°±æ˜¯æ·˜å®å®¢APIå¯¹åº”çš„åº”ç”¨ã€‚ç‚¹å‡»åº”ç”¨ç®¡ç†ï¼Œå¯ä»¥çœ‹åˆ°APP Keyå’ŒAPP Secretï¼Œå¹¶åœ¨é¡µé¢ä¸‹æ–¹å±•ç¤ºäº†è¯¥åº”ç”¨å¯ä»¥ä½¿ç”¨çš„APIã€‚</p>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="æ·˜å®å®¢apiçš„sdkä¸‹è½½"><a class="header" href="#æ·˜å®å®¢apiçš„sdkä¸‹è½½">æ·˜å®å®¢APIçš„SDKä¸‹è½½</a></h1>
<p>åœ¨æ·˜å®å¼€æ”¾å¹³å°ä¸­ï¼Œè¿›å…¥åº”ç”¨ä»¥åï¼Œåœ¨å·¦ä¾§è¾¹æ ä¸­æœ‰ä¸€ä¸ªâ€œSDKä¸‹è½½â€çš„èœå•ï¼Œè¿›å…¥åï¼Œå¯ä»¥é€‰æ‹©ä¸‹è½½å„ç§ç¼–ç¨‹è¯­è¨€çš„SDKï¼Œç›®å‰æ”¯æŒï¼šJavaã€PHPã€Pythonã€.NETã€Metadataã€Cã€NodeJSã€‚</p>
<p>å…·ä½“ç”¨æ³•å‚è€ƒ<a href="https://open.taobao.com/doc.htm?docId=101618&amp;docType=1" title="æ·˜å®å®¢SDKçš„ä½¿ç”¨è¯´æ˜">æ·˜å®å®¢SDKçš„ä½¿ç”¨è¯´æ˜</a>ã€‚</p>
<h2 id="python-sdkä½¿ç”¨å‰å‡†å¤‡"><a class="header" href="#python-sdkä½¿ç”¨å‰å‡†å¤‡">python sdkä½¿ç”¨å‰å‡†å¤‡</a></h2>
<p>ä½¿ç”¨æ·˜å®å®¢çš„Python SDKçš„æ—¶å€™è¦æ³¨æ„ï¼Œå¦‚æœç”¨çš„æ˜¯Python3ï¼Œç›´æ¥ä½¿ç”¨ä¼šé‡åˆ°é”™è¯¯ï¼š</p>
<pre><code>name 'long' is not defined
</code></pre>
<p>è¿™æ˜¯å› ä¸ºpython3ä¸­ç”¨<a href="https://stackoverflow.com/questions/14904814/nameerror-global-name-long-is-not-defined">intå–ä»£äº†å…³é”®å­—long</a>ï¼Œæ·˜å®å®¢çš„python sdkä¸­top/api/base.pyè¿˜åœ¨ä½¿ç”¨longï¼š</p>
<pre><code>P_TIMESTAMP: str(long(time.time() * 1000)),
</code></pre>
<p>å°†longä¿®æ”¹ä½intï¼š</p>
<pre><code>P_TIMESTAMP: str(int(time.time() * 1000)),
</code></pre>
<p>ä½†æ˜¯æ·˜å®å®¢APIä¸­è¿˜æœ‰å…¶å®ƒpython2çš„ç”¨æ³•ï¼Œä¸€ä¸ªä¸€ä¸ªä¿®æ”¹å¤ªéº»çƒ¦äº†ï¼Œå¯ä»¥ç”¨pythonæä¾›çš„<a href="https://docs.python.org/2/library/2to3.html">2to3</a>å‘½ä»¤ï¼Œå°†æ•´ä¸ªç›®å½•ä¸­çš„python2ä»£ç è½¬æ¢æˆpython3ï¼š</p>
<pre><code class="language-sh">$ 2to3 -w top
RefactoringTool: Skipping optional fixer: buffer
RefactoringTool: Skipping optional fixer: idioms
RefactoringTool: Skipping optional fixer: set_literal
RefactoringTool: Skipping optional fixer: ws_comma
RefactoringTool: No changes to top/__init__.py
...
</code></pre>
<p>è½¬æ¢ä¹‹åè¿˜æ˜¯ä¼šæœ‰ä¸€äº›é”™è¯¯ï¼Œåªèƒ½ä¸€ä¸ªä¸ªä¿®æ”¹ï¼š</p>
<h3 id="unicode-objects-must-be-encoded-before-hashing"><a class="header" href="#unicode-objects-must-be-encoded-before-hashing">Unicode-objects must be encoded before hashing</a></h3>
<pre><code>sign = hashlib.md5(parameters).hexdigest().upper()
</code></pre>
<p>ä¿®æ”¹ä¸ºï¼š</p>
<pre><code>sign = hashlib.md5(parameters.encode('utf-8')).hexdigest().upper()
</code></pre>
<h3 id="getsockaddrarg-af_inet-address-must-be-tuple-not-int"><a class="header" href="#getsockaddrarg-af_inet-address-must-be-tuple-not-int">getsockaddrarg: AF_INET address must be tuple, not int</a></h3>
<p>è¿™æ˜¯å› ä¸ºpython3çš„http.client.HTTPConnection()çš„æ„é€ å‚æ•°é¡ºåºå‘ç”Ÿäº†å˜åŒ–ã€‚</p>
<p>å°†ä»£ç ï¼š</p>
<pre><code class="language-python">if(self.__port == 443):
	connection = http.client.HTTPSConnection(self.__domain, self.__port, None, None, False, timeout)
else:
	connection = http.client.HTTPConnection(self.__domain, self.__port, False, timeout)

</code></pre>
<p>ä¿®æ”¹ä¸ºï¼š</p>
<pre><code class="language-python">if(self.__port == 443):
    connection = http.client.HTTPSConnection(host=self.__domain, port=self.__port, timeout=timeout)
else:
    connection = http.client.HTTPConnection(self.__domain, self.__port, timeout=timeout)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="æ·˜å®å®¢åŸºç¡€apiæ¢³ç†"><a class="header" href="#æ·˜å®å®¢åŸºç¡€apiæ¢³ç†">æ·˜å®å®¢åŸºç¡€APIæ¢³ç†</a></h1>
<p>è¯¦æƒ…è§<a href="https://open.taobao.com/api.htm?docId=24515&amp;docType=2&amp;scopeId=11655" title="æ·˜å®å®¢åŸºç¡€API">æ·˜å®å®¢åŸºç¡€API</a>ï¼Œè¿™é‡Œæ•´ç†å‡ ä¸ªä¸»è¦APIçš„ç”¨é€”ã€‚</p>
<h2 id="ç”¨å…³é”®å­—æŸ¥æ‰¾æ·˜å®å®¢å•†å“å’Œä¼˜æƒ åˆ¸"><a class="header" href="#ç”¨å…³é”®å­—æŸ¥æ‰¾æ·˜å®å®¢å•†å“å’Œä¼˜æƒ åˆ¸">ç”¨å…³é”®å­—æŸ¥æ‰¾æ·˜å®å®¢å•†å“å’Œä¼˜æƒ åˆ¸</a></h2>
<p><a href="https://open.taobao.com/api.htm?docId=24515&amp;docType=2&amp;scopeId=11655">taobao.tbk.item.get</a>ï¼Œç”¨å…³é”®å­—åŒæ—¶ä»æœ€å¤š10ä¸ªç±»ç›®ä¸­æŸ¥è¯¢æ·˜å®å®¢å•†å“ï¼Œå¯ä»¥è®¾ç½®åœ°åŸŸã€æŠ˜æ‰£ã€ä½£é‡‘æ¯”ç‡ç­‰ã€‚</p>
<p><a href="https://open.taobao.com/api.htm?docId=29821&amp;docType=2&amp;scopeId=11655">taobao.tbk.dg.item.coupon.get</a>ï¼Œç”¨å…³é”®å­—åŒæ—¶ä»æœ€å¤š10ä¸ªç±»ç›®ä¸­æŸ¥è¯¢ä¼˜æƒ åˆ¸ã€‚</p>
<h2 id="è·å–ä¸æŒ‡å®šå•†å“ç›¸å…³è”çš„æ·˜å®å®¢å•†å“"><a class="header" href="#è·å–ä¸æŒ‡å®šå•†å“ç›¸å…³è”çš„æ·˜å®å®¢å•†å“">è·å–ä¸æŒ‡å®šå•†å“ç›¸å…³è”çš„æ·˜å®å®¢å•†å“</a></h2>
<p><a href="https://open.taobao.com/api.htm?docId=24517&amp;docType=2&amp;scopeId=11655">taobao.tbk.item.recommend.get</a>ï¼Œä¼ å…¥ä¸€ä¸ªå•†å“IDï¼Œè¿”å›ä¸ä¹‹ç›¸å…³é¢†å¯¼å•†å“ï¼Œæœ€å¤š40ä¸ªã€‚</p>
<h2 id="æ·˜å®å®¢å•†å“è¯¦æƒ…æ‰¹é‡æŸ¥è¯¢"><a class="header" href="#æ·˜å®å®¢å•†å“è¯¦æƒ…æ‰¹é‡æŸ¥è¯¢">æ·˜å®å®¢å•†å“è¯¦æƒ…æ‰¹é‡æŸ¥è¯¢</a></h2>
<p><a href="https://open.taobao.com/api.htm?docId=24518&amp;docType=2&amp;scopeId=11655">taobao.tbk.item.info.get</a>ï¼Œæœ€å¤šä¼ å…¥40ä¸ªå•†å“IDï¼Œè¿”å›è¿™äº›å•†å“çš„è¯¦ç»†ä¿¡æ¯ã€‚</p>
<h2 id="è·å–æ‹¼å›¢æŠ¢è´­çš„å•†å“"><a class="header" href="#è·å–æ‹¼å›¢æŠ¢è´­çš„å•†å“">è·å–æ‹¼å›¢æŠ¢è´­çš„å•†å“</a></h2>
<p><a href="https://open.taobao.com/api.htm?docId=27543&amp;docType=2&amp;scopeId=11655">taobao.tbk.ju.tqg.get</a>ï¼Œè¿”å›æŒ‡å®šæ—¶é—´èŒƒå›´å†…çš„æ‹¼å›¢æŠ¢è´­å•†å“ã€‚</p>
<h2 id="æ·˜å£ä»¤ç”Ÿæˆæ¥å£"><a class="header" href="#æ·˜å£ä»¤ç”Ÿæˆæ¥å£">æ·˜å£ä»¤ç”Ÿæˆæ¥å£</a></h2>
<p><a href="https://open.taobao.com/api.htm?docId=31127&amp;docType=2&amp;scopeId=11655">taobao.tbk.tpwd.create</a>ï¼Œè®¾ç½®æ·˜å£ä»¤çš„å¼¹æ¡†å†…å®¹ã€è·³è½¬ç›®æ ‡é¡µã€å¼¹æ¡†Logoã€æ‰©å±•å­—æ®µç­‰ã€‚</p>
<p><a href="https://jingyan.baidu.com/article/c33e3f48d57403ea15cbb507.html">å¦‚ä½•æ‰¾åˆ°è‡ªå·±çš„æ·˜å®å£ä»¤ID</a></p>
<h2 id="è·å–æŒ‡å®šå•†å“çš„å•†å“å’Œåˆ¸äºŒåˆä¸€æ¨å¹¿é“¾æ¥"><a class="header" href="#è·å–æŒ‡å®šå•†å“çš„å•†å“å’Œåˆ¸äºŒåˆä¸€æ¨å¹¿é“¾æ¥">è·å–æŒ‡å®šå•†å“çš„å•†å“å’Œåˆ¸äºŒåˆä¸€æ¨å¹¿é“¾æ¥</a></h2>
<p><a href="https://open.taobao.com/api.htm?docId=33947&amp;docType=2&amp;scopeId=11655">taobao.tbk.dg.optimus.material</a>ï¼Œä¼ å…¥å•†å“IDã€ç‰©æ–™IDï¼Œè¿”å›â€œé“¾æ¥-å®è´+åˆ¸äºŒåˆä¸€é¡µé¢é“¾æ¥â€ç­‰å¤šç§ä¿ƒé”€ä¿¡æ¯ã€‚</p>
<p><a href="https://open.taobao.com/api.htm?docId=35896&amp;docType=2&amp;scopeId=11655">taobao.tbk.dg.material.optional</a>ï¼Œä¼ å…¥å…³é”®å­—ã€ç‰©æ–™IDï¼Œè¿”å›â€œé“¾æ¥-å®è´+åˆ¸äºŒåˆä¸€é¡µé¢é“¾æ¥â€ç­‰å¤šç§ä¿ƒé”€ä¿¡æ¯ã€‚</p>
<p><a href="https://open.taobao.com/api.htm?docId=37884&amp;docType=2&amp;scopeId=11655">taobao.tbk.sc.optimus.material</a>ï¼Œä¼ å…¥å•†å“IDã€ç‰©æ–™IDï¼Œè¿”å›â€œé“¾æ¥-å®è´+åˆ¸äºŒåˆä¸€é¡µé¢é“¾æ¥â€ç­‰å¤šç§ä¿ƒé”€ä¿¡æ¯ã€‚è¿™ä¸ªæ¥å£å’Œè¿™ä¸€èŠ‚ç¬¬ä¸€ä¸ªæ¥å£çš„åŠŸèƒ½åŸºæœ¬ç›¸åŒï¼ŒåŒºåˆ«æ˜¯è¿™ä¸ªæ¥å£éœ€è¦å–å®¶æˆæƒï¼Œæˆæƒæ–¹å¼è§<a href="https://open.taobao.com/doc.htm?docId=102635&amp;docType=1">ç”¨æˆ·æˆæƒä»‹ç»</a>ã€‚</p>
<p>â€œé“¾æ¥-å®è´+åˆ¸äºŒåˆä¸€é¡µé¢é“¾æ¥â€éå¸¸é‡è¦ï¼Œå®ƒæ˜¯æ·˜å£ä»¤çš„è·³è½¬ç›®æ ‡é¡µåœ°å€ã€‚</p>
<p><a href="https://tbk.bbs.taobao.com/detail.html?appId=45301&amp;postId=8576096">å®˜æ–¹æ¨èå•†å“åº“å¤§å…¨</a>ç»™å‡ºæ‰€æœ‰çš„ç‰©æ–™IDï¼Œç‰©æ–™IDæ¯”è¾ƒä¹±ï¼Œåˆ†ä¸ºå¥½å‡ ç±»ã€‚</p>
<p><strong>å¥½åˆ¸ç›´æ’­</strong>ï¼Œçƒ­é—¨å•†å“ï¼ŒæŒ‰å°æ—¶æ›´æ–°ï¼Œæ¯ä¸ªmaterial_id åŒæ—¶äº§å‡º200æ¬¾å•†å“ã€‚</p>
<p><strong>å¤§é¢åˆ¸</strong>,  æŠ˜æ‰£åŠ›åº¦å¤§çš„å•†å“ï¼Œå°æ—¶æ›´æ–°ï¼Œæ¯ä¸ªmaterial_id åŒæ—¶äº§å‡º500æ¬¾å•†å“ã€‚</p>
<p><strong>é«˜ä½£æ¦œ</strong>ï¼Œé«˜ä½£å•†å“ï¼Œæœ€é«˜è¾¾90%ï¼ŒæŒ‰å¤©æ›´æ–°ï¼Œæ¯ä¸ªmaterial_id åŒæ—¶äº§å‡º500æ¬¾å•†å“ã€‚</p>
<p><strong>å“ç‰Œæ¦œ</strong>ï¼Œä¼˜è´¨å“ç‰Œå•†å“ï¼Œæ¯ä¸ªmaterial_id åŒæ—¶äº§å‡º200æ¬¾å•†å“ã€‚</p>
<p><strong>æ¯å©´ä¸»é¢˜</strong>ï¼Œä»å¤‡å­•åˆ°å„¿ç«¥ä¸åŒé˜¶æ®µå•†å“ï¼Œæ¯ä¸ªmaterial_id åŒæ—¶äº§å‡º1000æ¬¾å•†å“ã€‚</p>
<p><strong>æœ‰å¥½è´§</strong>ï¼Œå¥½è´§ç²¾é€‰,æ¯ä¸ªmaterial_id åŒæ—¶äº§å‡º1000æ¬¾å•†å“ã€‚</p>
<p><strong>æ½®æµèŒƒ</strong>ï¼Œæ—¶å°šæµè¡Œå•†å“ï¼Œæ¯ä¸ªmaterial_id åŒæ—¶äº§å‡º1000æ¬¾å•†å“ã€‚</p>
<p><strong>ç‰¹æƒ </strong>ï¼Œé”€é‡é«˜, è¯„ä»·é«˜,ç‚¹å‡»è½¬åŒ–å¥½, åˆ›æ„å…·æœ‰å¸å¼•åŠ›çš„ä¼˜è´¨ä½ä»·å®ï¼Œæ¯ä¸ªmaterial_id åŒæ—¶äº§å‡º1000æ¬¾å•†å“ ã€‚</p>
<div style="break-before: page; page-break-before: always;"></div><!-- toc -->
<h1 id="æ·˜å®å®¢åŸºç¡€apiè°ƒç”¨æ–¹æ³•"><a class="header" href="#æ·˜å®å®¢åŸºç¡€apiè°ƒç”¨æ–¹æ³•">æ·˜å®å®¢åŸºç¡€APIè°ƒç”¨æ–¹æ³•</a></h1>
<p>ä¸‹é¢ä»¥Python APIä¸ºä¾‹ã€‚</p>
<h2 id="è·å–app-keyå’Œapp-secret"><a class="header" href="#è·å–app-keyå’Œapp-secret">è·å–APP Keyå’ŒAPP Secret</a></h2>
<p>åœ¨æ·˜å¼€æ”¾å¹³å°çš„<a href="http://console.open.taobao.com">æ§åˆ¶å°</a>ä¸­ï¼Œè¿›å…¥ä¸€ä¸ªåº”ç”¨ï¼Œå°±å¯ä»¥çœ‹åˆ°é¦–é¡µæ˜¾ç¤ºæœ‰è¿™ä¸ªåº”ç”¨çš„App Keyå’ŒApp Secretã€‚</p>
<p>åœ¨ä½¿ç”¨Python APIçš„æ—¶å€™ï¼Œéœ€è¦ä¼ å…¥è¿™ä¸ªä¸¤ä¸ªå‚æ•°ï¼š</p>
<pre><code>appKey='XXX'
appSecret='XXX'
top.setDefaultAppInfo(appkey, appSecret)
</code></pre>
<h2 id="è·å–adzone_id"><a class="header" href="#è·å–adzone_id">è·å–adzone_id</a></h2>
<p>æœ‰äº›æ¥å£ä¸­éœ€è¦ä¼ å…¥adzone_idã€‚adzone_idæ˜¯æ¨å¹¿ä½çš„IDï¼Œåˆ°æ·˜å®è”ç›Ÿåå°ä¸­æŸ¥çœ‹ï¼šâ€œæ¨å¹¿ç®¡ç†â€-&gt;â€œæ¨å¹¿èµ„æºç®¡ç†â€-&gt;â€œæ¨å¹¿ä½ç®¡ç†â€ã€‚æ”¯æŒå››ç§ç±»å‹çš„æ¨å¹¿ä½ï¼šç½‘ç«™æ¨å¹¿ä½ã€APPæ¨å¹¿ä½ã€å¯¼è´­æ¨å¹¿ä½ã€è½¯ä»¶æ¨å¹¿ä½ã€‚</p>
<p>æ³¨æ„åå°ä¸­æ²¡æœ‰æ¨å¹¿ä½çš„åˆ›å»ºè¿æ¥ï¼Œéœ€è¦<a href="http://pub.alimama.com/promo/search/index.htm?q=%E9%9E%8B%E5%AD%90&amp;_t=1554643902198">å•†å“é¡µ</a>ä¸­éšä¾¿æ‰¾ä¸€ä¸ªå•†å“ï¼Œç‚¹å‡»ç«‹å³æ¨å¹¿ï¼Œåœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­ï¼Œåˆ›å»ºæ¨å¹¿ä½ã€‚åˆ›å»ºä¹‹åï¼Œå›åˆ°â€œæ¨å¹¿ä½ç®¡ç†â€é¡µé¢ï¼Œå°±å¯ä»¥çœ‹åˆ°æ–°å»ºçš„æ¨å¹¿ä½ã€‚</p>
<p>æ¨å¹¿ä½çš„Pidæ ·å¼æ˜¯â€œmm_33963329_6520758_144842297â€ï¼Œadzone_idæ˜¯ç¬¬ä¸‰æ®µæ•°å­—ã€‚</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
                <div style="text-align:center;width:100%">
                    <!--h1>åº•éƒ¨ç›¸å…³å¹¿å‘Š</h1-->
                    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8176866190626448"
                         crossorigin="anonymous"></script>
                    <ins class="adsbygoogle"
                         style="display:block"
                         data-ad-format="autorelaxed"
                         data-ad-client="ca-pub-8176866190626448"
                         data-ad-slot="6443696990"></ins>
                    <script>
                         (adsbygoogle = window.adsbygoogle || []).push({});
                    </script>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
