# 微信公众号API回调设置

[入门指引](https://mp.weixin.qq.com/wiki?t=resource/res_main&id=mp1472017492_58YV5)中介绍的比较详细。

在微信公众号设置了服务的地址和Token之后，用户留言等信息会被微信公众平台以固定的格式转发到服务地址，提前部署好的服务可以按照程序中的逻辑对不同用户进行不同的回复。服务必须是可以从公网访问的，否则公众平台无法回调。

配置入口是公众号后台左下角的“基本配置”，详情见[接入指南][1]。

## 验证微信服务器消息

设置完成之后，微信服务器会发送一个GET请求，带有四个参数：

**signature**: 微信加密签名，signature结合了开发者填写的token参数和请求中的timestamp参数、nonce参数

**timestamp**: 时间戳

**nonce**: 随机数

**echostr**: 随机字符串

signature的生成规则是：将token、timesstamp和nonce三个参数尽心字典排序，然后拼接称一个字符串，用sha1加密。

如果生成的签名与传入的signature参数相同，证明请求确实来自于微信服务器，将echostrc参数原样返回给微信服务器，接入即生效。

## 设置开发者密钥

在调用微信公众平台的接口时，需要带有access_token，它是用开发者ID和开发者密码获取的。

在“基本配置”可以看到开发者ID，开发者密码是平台生成的，直接点击设置或者重置获取。平台本身不存储开发者密码，如果密码丢失了，只能重置，获取一个新的密码。

获取了开发者密码后，还要在“IP白名单”中添加用来访问公众平台的服务器IP，只有加入了百名单的IP才能调用平台的access_token获取接口。

[1]: https://mp.weixin.qq.com/wiki?t=resource/res_main&id=mp1421135319 "接入指南"
